/*! For license information please see e759a8b013baa9ac95f0.chunk.js.LICENSE.txt */
(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[452],{8177:(e,t,n)=>{e.exports={default:n(77084),__esModule:!0}},77084:(e,t,n)=>{n(75789);var r=n(94731).Object;e.exports=function(e,t){return r.getOwnPropertyDescriptor(e,t)}},75789:(e,t,n)=>{var r=n(64874),i=n(18437).f;n(44903)("getOwnPropertyDescriptor",(function(){return function(e,t){return i(r(e),t)}}))},50139:(e,t)=>{"use strict";t.__esModule=!0,t.default=void 0;var n=!("undefined"==typeof window||!window.document||!window.document.createElement);t.default=n,e.exports=t.default},44825:(e,t,n)=>{"use strict";var r=n(95318);t.__esModule=!0,t.default=function(e){if((!i&&0!==i||e)&&o.default){var t=document.createElement("div");t.style.position="absolute",t.style.top="-9999px",t.style.width="50px",t.style.height="50px",t.style.overflow="scroll",document.body.appendChild(t),i=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return i};var i,o=r(n(50139));e.exports=t.default},82689:(e,t,n)=>{var r=n(29932),i=n(97786),o=n(67206),a=n(69199),s=n(71131),l=n(7518),d=n(85022),c=n(6557),u=n(1469);e.exports=function(e,t,n){t=t.length?r(t,(function(e){return u(e)?function(t){return i(t,1===e.length?e[0]:e)}:e})):[c];var h=-1;t=r(t,l(o));var p=a(e,(function(e,n,i){return{criteria:r(t,(function(t){return t(e)})),index:++h,value:e}}));return s(p,(function(e,t){return d(e,t,n)}))}},71131:e=>{e.exports=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}},26393:(e,t,n)=>{var r=n(33448);e.exports=function(e,t){if(e!==t){var n=void 0!==e,i=null===e,o=e==e,a=r(e),s=void 0!==t,l=null===t,d=t==t,c=r(t);if(!l&&!c&&!a&&e>t||a&&s&&d&&!l&&!c||i&&s&&d||!n&&d||!o)return 1;if(!i&&!a&&!c&&e<t||c&&n&&o&&!i&&!a||l&&n&&o||!s&&o||!d)return-1}return 0}},85022:(e,t,n)=>{var r=n(26393);e.exports=function(e,t,n){for(var i=-1,o=e.criteria,a=t.criteria,s=o.length,l=n.length;++i<s;){var d=r(o[i],a[i]);if(d)return i>=l?d:d*("desc"==n[i]?-1:1)}return e.index-t.index}},94654:(e,t,n)=>{var r=n(21078),i=n(35161);e.exports=function(e,t){return r(i(e,t),1)}},10752:(e,t,n)=>{var r=n(21078),i=n(35161);e.exports=function(e,t){return r(i(e,t),1/0)}},8802:(e,t,n)=>{var r=n(90939);e.exports=function(e,t,n){var i=(n="function"==typeof n?n:void 0)?n(e,t):void 0;return void 0===i?r(e,t,void 0,n):!!i}},89734:(e,t,n)=>{var r=n(21078),i=n(82689),o=n(5976),a=n(16612),s=o((function(e,t){if(null==e)return[];var n=t.length;return n>1&&a(e,t[0],t[1])?t=[]:n>2&&a(t[0],t[1],t[2])&&(t=[t[0]]),i(e,r(t,1),[])}));e.exports=s},44908:(e,t,n)=>{var r=n(45652);e.exports=function(e){return e&&e.length?r(e):[]}},87185:(e,t,n)=>{var r=n(45652);e.exports=function(e,t){return t="function"==typeof t?t:void 0,e&&e.length?r(e,void 0,t):[]}},75:function(e,t,n){var r=n(34155);(function(){var t,n,i,o,a,s;"undefined"!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:null!=r&&r.hrtime?(e.exports=function(){return(t()-a)/1e6},n=r.hrtime,o=(t=function(){var e;return 1e9*(e=n())[0]+e[1]})(),s=1e9*r.uptime(),a=o-s):Date.now?(e.exports=function(){return Date.now()-i},i=Date.now()):(e.exports=function(){return(new Date).getTime()-i},i=(new Date).getTime())}).call(this)},54087:(e,t,n)=>{for(var r=n(75),i="undefined"==typeof window?n.g:window,o=["moz","webkit"],a="AnimationFrame",s=i["request"+a],l=i["cancel"+a]||i["cancelRequest"+a],d=0;!s&&d<o.length;d++)s=i[o[d]+"Request"+a],l=i[o[d]+"Cancel"+a]||i[o[d]+"CancelRequest"+a];if(!s||!l){var c=0,u=0,h=[];s=function(e){if(0===h.length){var t=r(),n=Math.max(0,16.666666666666668-(t-c));c=n+t,setTimeout((function(){var e=h.slice(0);h.length=0;for(var t=0;t<e.length;t++)if(!e[t].cancelled)try{e[t].callback(c)}catch(e){setTimeout((function(){throw e}),0)}}),Math.round(n))}return h.push({handle:++u,callback:e,cancelled:!1}),u},l=function(e){for(var t=0;t<h.length;t++)h[t].handle===e&&(h[t].cancelled=!0)}}e.exports=function(e){return s.call(i,e)},e.exports.cancel=function(){l.apply(i,arguments)},e.exports.polyfill=function(e){e||(e=i),e.requestAnimationFrame=s,e.cancelAnimationFrame=l}},28388:(e,t,n)=>{var r;window,e.exports=(r=n(67294),function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=27)}([function(e,t,n){e.exports=n(96)()},function(e,t){e.exports=r},function(e,t,n){var r=n(16),i="object"==typeof self&&self&&self.Object===Object&&self,o=r||i||Function("return this")();e.exports=o},function(e,t,n){var r=n(41),i=n(47);e.exports=function(e,t){var n=i(e,t);return r(n)?n:void 0}},function(e,t,n){var r=n(31),i=n(32),o=n(33),a=n(34),s=n(35);function l(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}l.prototype.clear=r,l.prototype.delete=i,l.prototype.get=o,l.prototype.has=a,l.prototype.set=s,e.exports=l},function(e,t,n){var r=n(14);e.exports=function(e,t){for(var n=e.length;n--;)if(r(e[n][0],t))return n;return-1}},function(e,t,n){var r=n(12),i=n(43),o=n(44),a=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":a&&a in Object(e)?i(e):o(e)}},function(e,t,n){var r=n(3)(Object,"create");e.exports=r},function(e,t,n){var r=n(56);e.exports=function(e,t){var n=e.__data__;return r(t)?n["string"==typeof t?"string":"hash"]:n.map}},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,n){var r;!function(){"use strict";var n={}.hasOwnProperty;function i(){for(var e=[],t=0;t<arguments.length;t++){var r=arguments[t];if(r){var o=typeof r;if("string"===o||"number"===o)e.push(r);else if(Array.isArray(r)&&r.length){var a=i.apply(null,r);a&&e.push(a)}else if("object"===o)for(var s in r)n.call(r,s)&&r[s]&&e.push(s)}}return e.join(" ")}e.exports?(i.default=i,e.exports=i):void 0===(r=function(){return i}.apply(t,[]))||(e.exports=r)}()},function(e,t,n){var r=n(3)(n(2),"Map");e.exports=r},function(e,t,n){var r=n(2).Symbol;e.exports=r},function(e,t){var n=Array.isArray;e.exports=n},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,n){var r=n(6),i=n(17);e.exports=function(e){if(!i(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(this,n(42))},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t){var n=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return n.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t,n){var r=n(48),i=n(55),o=n(57),a=n(58),s=n(59);function l(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}l.prototype.clear=r,l.prototype.delete=i,l.prototype.get=o,l.prototype.has=a,l.prototype.set=s,e.exports=l},function(e,t,n){var r=n(60),i=n(63),o=n(64);e.exports=function(e,t,n,a,s,l){var d=1&n,c=e.length,u=t.length;if(c!=u&&!(d&&u>c))return!1;var h=l.get(e);if(h&&l.get(t))return h==t;var p=-1,f=!0,m=2&n?new r:void 0;for(l.set(e,t),l.set(t,e);++p<c;){var g=e[p],v=t[p];if(a)var b=d?a(v,g,p,t,e,l):a(g,v,p,e,t,l);if(void 0!==b){if(b)continue;f=!1;break}if(m){if(!i(t,(function(e,t){if(!o(m,t)&&(g===e||s(g,e,n,a,l)))return m.push(t)}))){f=!1;break}}else if(g!==v&&!s(g,v,n,a,l)){f=!1;break}}return l.delete(e),l.delete(t),f}},function(e,t,n){(function(e){var r=n(2),i=n(81),o=t&&!t.nodeType&&t,a=o&&"object"==typeof e&&e&&!e.nodeType&&e,s=a&&a.exports===o?r.Buffer:void 0,l=(s?s.isBuffer:void 0)||i;e.exports=l}).call(this,n(22)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){var r=n(83),i=n(84),o=n(85),a=o&&o.isTypedArray,s=a?i(a):r;e.exports=s},function(e,t){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},function(e,t,n){var r=n(28);e.exports=function(e,t){return r(e,t)}},function(e,t,n){var r=self.crypto||self.msCrypto;e.exports=function(e){e=e||21;for(var t="",n=r.getRandomValues(new Uint8Array(e));0<e--;)t+="Uint8ArdomValuesObj012345679BCDEFGHIJKLMNPQRSTWXYZ_cfghkpqvwxyz-"[63&n[e]];return t}},function(e,t,n){e.exports=n(98).default},function(e,t,n){var r=n(29),i=n(9);e.exports=function e(t,n,o,a,s){return t===n||(null==t||null==n||!i(t)&&!i(n)?t!=t&&n!=n:r(t,n,o,a,e,s))}},function(e,t,n){var r=n(30),i=n(20),o=n(65),a=n(69),s=n(91),l=n(13),d=n(21),c=n(23),u="[object Arguments]",h="[object Array]",p="[object Object]",f=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,m,g,v){var b=l(e),y=l(t),C=b?h:s(e),S=y?h:s(t),x=(C=C==u?p:C)==p,k=(S=S==u?p:S)==p,w=C==S;if(w&&d(e)){if(!d(t))return!1;b=!0,x=!1}if(w&&!x)return v||(v=new r),b||c(e)?i(e,t,n,m,g,v):o(e,t,C,n,m,g,v);if(!(1&n)){var R=x&&f.call(e,"__wrapped__"),Z=k&&f.call(t,"__wrapped__");if(R||Z){var F=R?e.value():e,T=Z?t.value():t;return v||(v=new r),g(F,T,n,m,v)}}return!!w&&(v||(v=new r),a(e,t,n,m,g,v))}},function(e,t,n){var r=n(4),i=n(36),o=n(37),a=n(38),s=n(39),l=n(40);function d(e){var t=this.__data__=new r(e);this.size=t.size}d.prototype.clear=i,d.prototype.delete=o,d.prototype.get=a,d.prototype.has=s,d.prototype.set=l,e.exports=d},function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,n){var r=n(5),i=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=r(t,e);return!(n<0||(n==t.length-1?t.pop():i.call(t,n,1),--this.size,0))}},function(e,t,n){var r=n(5);e.exports=function(e){var t=this.__data__,n=r(t,e);return n<0?void 0:t[n][1]}},function(e,t,n){var r=n(5);e.exports=function(e){return r(this.__data__,e)>-1}},function(e,t,n){var r=n(5);e.exports=function(e,t){var n=this.__data__,i=r(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this}},function(e,t,n){var r=n(4);e.exports=function(){this.__data__=new r,this.size=0}},function(e,t){e.exports=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}},function(e,t){e.exports=function(e){return this.__data__.get(e)}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,n){var r=n(4),i=n(11),o=n(19);e.exports=function(e,t){var n=this.__data__;if(n instanceof r){var a=n.__data__;if(!i||a.length<199)return a.push([e,t]),this.size=++n.size,this;n=this.__data__=new o(a)}return n.set(e,t),this.size=n.size,this}},function(e,t,n){var r=n(15),i=n(45),o=n(17),a=n(18),s=/^\[object .+?Constructor\]$/,l=Function.prototype,d=Object.prototype,c=l.toString,u=d.hasOwnProperty,h=RegExp("^"+c.call(u).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||i(e))&&(r(e)?h:s).test(a(e))}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(12),i=Object.prototype,o=i.hasOwnProperty,a=i.toString,s=r?r.toStringTag:void 0;e.exports=function(e){var t=o.call(e,s),n=e[s];try{e[s]=void 0;var r=!0}catch(e){}var i=a.call(e);return r&&(t?e[s]=n:delete e[s]),i}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},function(e,t,n){var r,i=n(46),o=(r=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!o&&o in e}},function(e,t,n){var r=n(2)["__core-js_shared__"];e.exports=r},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t,n){var r=n(49),i=n(4),o=n(11);e.exports=function(){this.size=0,this.__data__={hash:new r,map:new(o||i),string:new r}}},function(e,t,n){var r=n(50),i=n(51),o=n(52),a=n(53),s=n(54);function l(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}l.prototype.clear=r,l.prototype.delete=i,l.prototype.get=o,l.prototype.has=a,l.prototype.set=s,e.exports=l},function(e,t,n){var r=n(7);e.exports=function(){this.__data__=r?r(null):{},this.size=0}},function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},function(e,t,n){var r=n(7),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(r){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return i.call(t,e)?t[e]:void 0}},function(e,t,n){var r=n(7),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return r?void 0!==t[e]:i.call(t,e)}},function(e,t,n){var r=n(7);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=r&&void 0===t?"__lodash_hash_undefined__":t,this}},function(e,t,n){var r=n(8);e.exports=function(e){var t=r(this,e).delete(e);return this.size-=t?1:0,t}},function(e,t){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,n){var r=n(8);e.exports=function(e){return r(this,e).get(e)}},function(e,t,n){var r=n(8);e.exports=function(e){return r(this,e).has(e)}},function(e,t,n){var r=n(8);e.exports=function(e,t){var n=r(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this}},function(e,t,n){var r=n(19),i=n(61),o=n(62);function a(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new r;++t<n;)this.add(e[t])}a.prototype.add=a.prototype.push=i,a.prototype.has=o,e.exports=a},function(e,t){e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}},function(e,t){e.exports=function(e,t){return e.has(t)}},function(e,t,n){var r=n(12),i=n(66),o=n(14),a=n(20),s=n(67),l=n(68),d=r?r.prototype:void 0,c=d?d.valueOf:void 0;e.exports=function(e,t,n,r,d,u,h){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!u(new i(e),new i(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return o(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var p=s;case"[object Set]":var f=1&r;if(p||(p=l),e.size!=t.size&&!f)return!1;var m=h.get(e);if(m)return m==t;r|=2,h.set(e,t);var g=a(p(e),p(t),r,d,u,h);return h.delete(e),g;case"[object Symbol]":if(c)return c.call(e)==c.call(t)}return!1}},function(e,t,n){var r=n(2).Uint8Array;e.exports=r},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}},function(e,t,n){var r=n(70),i=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,o,a,s){var l=1&n,d=r(e),c=d.length;if(c!=r(t).length&&!l)return!1;for(var u=c;u--;){var h=d[u];if(!(l?h in t:i.call(t,h)))return!1}var p=s.get(e);if(p&&s.get(t))return p==t;var f=!0;s.set(e,t),s.set(t,e);for(var m=l;++u<c;){var g=e[h=d[u]],v=t[h];if(o)var b=l?o(v,g,h,t,e,s):o(g,v,h,e,t,s);if(!(void 0===b?g===v||a(g,v,n,o,s):b)){f=!1;break}m||(m="constructor"==h)}if(f&&!m){var y=e.constructor,C=t.constructor;y!=C&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof C&&C instanceof C)&&(f=!1)}return s.delete(e),s.delete(t),f}},function(e,t,n){var r=n(71),i=n(73),o=n(76);e.exports=function(e){return r(e,o,i)}},function(e,t,n){var r=n(72),i=n(13);e.exports=function(e,t,n){var o=t(e);return i(e)?o:r(o,n(e))}},function(e,t){e.exports=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}},function(e,t,n){var r=n(74),i=n(75),o=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,s=a?function(e){return null==e?[]:(e=Object(e),r(a(e),(function(t){return o.call(e,t)})))}:i;e.exports=s},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}},function(e,t){e.exports=function(){return[]}},function(e,t,n){var r=n(77),i=n(86),o=n(90);e.exports=function(e){return o(e)?r(e):i(e)}},function(e,t,n){var r=n(78),i=n(79),o=n(13),a=n(21),s=n(82),l=n(23),d=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=o(e),c=!n&&i(e),u=!n&&!c&&a(e),h=!n&&!c&&!u&&l(e),p=n||c||u||h,f=p?r(e.length,String):[],m=f.length;for(var g in e)!t&&!d.call(e,g)||p&&("length"==g||u&&("offset"==g||"parent"==g)||h&&("buffer"==g||"byteLength"==g||"byteOffset"==g)||s(g,m))||f.push(g);return f}},function(e,t){e.exports=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}},function(e,t,n){var r=n(80),i=n(9),o=Object.prototype,a=o.hasOwnProperty,s=o.propertyIsEnumerable,l=r(function(){return arguments}())?r:function(e){return i(e)&&a.call(e,"callee")&&!s.call(e,"callee")};e.exports=l},function(e,t,n){var r=n(6),i=n(9);e.exports=function(e){return i(e)&&"[object Arguments]"==r(e)}},function(e,t){e.exports=function(){return!1}},function(e,t){var n=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&n.test(e))&&e>-1&&e%1==0&&e<t}},function(e,t,n){var r=n(6),i=n(24),o=n(9),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&i(e.length)&&!!a[r(e)]}},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t,n){(function(e){var r=n(16),i=t&&!t.nodeType&&t,o=i&&"object"==typeof e&&e&&!e.nodeType&&e,a=o&&o.exports===i&&r.process,s=function(){try{return o&&o.require&&o.require("util").types||a&&a.binding&&a.binding("util")}catch(e){}}();e.exports=s}).call(this,n(22)(e))},function(e,t,n){var r=n(87),i=n(88),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return i(e);var t=[];for(var n in Object(e))o.call(e,n)&&"constructor"!=n&&t.push(n);return t}},function(e,t){var n=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||n)}},function(e,t,n){var r=n(89)(Object.keys,Object);e.exports=r},function(e,t){e.exports=function(e,t){return function(n){return e(t(n))}}},function(e,t,n){var r=n(15),i=n(24);e.exports=function(e){return null!=e&&i(e.length)&&!r(e)}},function(e,t,n){var r=n(92),i=n(11),o=n(93),a=n(94),s=n(95),l=n(6),d=n(18),c=d(r),u=d(i),h=d(o),p=d(a),f=d(s),m=l;(r&&"[object DataView]"!=m(new r(new ArrayBuffer(1)))||i&&"[object Map]"!=m(new i)||o&&"[object Promise]"!=m(o.resolve())||a&&"[object Set]"!=m(new a)||s&&"[object WeakMap]"!=m(new s))&&(m=function(e){var t=l(e),n="[object Object]"==t?e.constructor:void 0,r=n?d(n):"";if(r)switch(r){case c:return"[object DataView]";case u:return"[object Map]";case h:return"[object Promise]";case p:return"[object Set]";case f:return"[object WeakMap]"}return t}),e.exports=m},function(e,t,n){var r=n(3)(n(2),"DataView");e.exports=r},function(e,t,n){var r=n(3)(n(2),"Promise");e.exports=r},function(e,t,n){var r=n(3)(n(2),"Set");e.exports=r},function(e,t,n){var r=n(3)(n(2),"WeakMap");e.exports=r},function(e,t,n){"use strict";var r=n(97);function i(){}e.exports=function(){function e(e,t,n,i,o,a){if(a!==r){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t};return n.checkPropTypes=i,n.PropTypes=n,n}},function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,n){"use strict";n.r(t);var r=n(10),i=n.n(r),o=n(25),a=n.n(o),s=n(26),l=n.n(s),d=n(0),c=n.n(d),u=n(1),h=n.n(u);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var C=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),g(this,v(t).apply(this,arguments))}var n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,h.a.PureComponent),n=t,(r=[{key:"render",value:function(){var e=this.props,t=e.children,n=e.title,r=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,["children","title"]);return h.a.createElement("button",f({"aria-label":n,title:n,type:"button"},r),t)}}])&&m(n.prototype,r),t}();y(C,"propTypes",{children:c.a.node.isRequired,title:c.a.string}),y(C,"defaultProps",{title:null});var S=C;function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var w=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.props=t,this.flatNodes=n}var t,n;return t=e,(n=[{key:"setProps",value:function(e){this.props=e}},{key:"clone",value:function(){var t=this,n={};return Object.keys(this.flatNodes).forEach((function(e){var r=t.flatNodes[e];n[e]=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){x(e,t,n[t])}))}return e}({},r)})),new e(this.props,n)}},{key:"getNode",value:function(e){return this.flatNodes[e]}},{key:"flattenNodes",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(Array.isArray(e)&&0!==e.length){var i=this.props,o=i.disabled,a=i.noCascade;e.forEach((function(e,i){var s=t.nodeHasChildren(e);t.flatNodes[e.value]={label:e.label,value:e.value,children:e.children,parent:n,isParent:s,isLeaf:!s,showCheckbox:void 0===e.showCheckbox||e.showCheckbox,disabled:t.getDisabledState(e,n,o,a),treeDepth:r,index:i},t.flattenNodes(e.children,e,r+1)}))}}},{key:"nodeHasChildren",value:function(e){return Array.isArray(e.children)&&e.children.length>0}},{key:"getDisabledState",value:function(e,t,n,r){return!!n||!(r||!t.disabled)||Boolean(e.disabled)}},{key:"deserializeLists",value:function(e){var t=this,n=["checked","expanded"];Object.keys(this.flatNodes).forEach((function(e){n.forEach((function(n){t.flatNodes[e][n]=!1}))})),n.forEach((function(n){e[n].forEach((function(e){void 0!==t.flatNodes[e]&&(t.flatNodes[e][n]=!0)}))}))}},{key:"serializeList",value:function(e){var t=this,n=[];return Object.keys(this.flatNodes).forEach((function(r){t.flatNodes[r][e]&&n.push(r)})),n}},{key:"expandAllNodes",value:function(e){var t=this;return Object.keys(this.flatNodes).forEach((function(n){t.flatNodes[n].isParent&&(t.flatNodes[n].expanded=e)})),this}},{key:"toggleChecked",value:function(e,t,n){var r=this,i=this.flatNodes[e.value];if(i.isLeaf||n){if(e.disabled)return this;this.toggleNode(e.value,"checked",t)}else i.children.forEach((function(e){r.toggleChecked(e,t,n)}));return this}},{key:"toggleNode",value:function(e,t,n){return this.flatNodes[e][t]=n,this}}])&&k(t.prototype,n),e}();function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Z(){return(Z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function F(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t){return!t||"object"!==R(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e,t){return(D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var E=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),T(this,_(t).apply(this,arguments))}var n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&D(e,t)}(t,h.a.PureComponent),n=t,(r=[{key:"componentDidMount",value:function(){this.updateDeterminateProperty()}},{key:"componentDidUpdate",value:function(){this.updateDeterminateProperty()}},{key:"updateDeterminateProperty",value:function(){var e=this.props.indeterminate;this.checkbox.indeterminate=e}},{key:"render",value:function(){var e=this,t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){M(e,t,n[t])}))}return e}({},this.props);return delete t.indeterminate,h.a.createElement("input",Z({},t,{ref:function(t){e.checkbox=t},type:"checkbox"}))}}])&&F(n.prototype,r),t}();M(E,"propTypes",{indeterminate:c.a.bool}),M(E,"defaultProps",{indeterminate:!1});var I=E,O=c.a.shape({check:c.a.node,uncheck:c.a.node,halfCheck:c.a.node,expandClose:c.a.node,expandOpen:c.a.node,expandAll:c.a.node,collapseAll:c.a.node,parentClose:c.a.node,parentOpen:c.a.node,leaf:c.a.node}),P=c.a.shape({collapseAll:c.a.string.isRequired,expandAll:c.a.string.isRequired,toggle:c.a.string.isRequired});function N(e){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function q(e){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var U=function(e){function t(e){var n,r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this,(n=!(r=q(t).call(this,e))||"object"!==N(r)&&"function"!=typeof r?A(this):r).onCheck=n.onCheck.bind(A(A(n))),n.onClick=n.onClick.bind(A(A(n))),n.onExpand=n.onExpand.bind(A(A(n))),n}var n,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(t,h.a.Component),n=t,(r=[{key:"onCheck",value:function(){var e=this.props,t=e.value;(0,e.onCheck)({value:t,checked:this.getCheckState({toggle:!0})})}},{key:"onClick",value:function(){var e=this.props,t=e.expandOnClick,n=e.isParent,r=e.value,i=e.onClick;n&&t&&this.onExpand(),i({value:r,checked:this.getCheckState({toggle:!1})})}},{key:"onExpand",value:function(){var e=this.props,t=e.expanded,n=e.value;(0,e.onExpand)({value:n,expanded:!t})}},{key:"getCheckState",value:function(e){var t=e.toggle,n=this.props,r=n.checked,i=n.optimisticToggle;return!(0!==r||!t)||1===r&&!t||2===r&&i}},{key:"renderCollapseButton",value:function(){var e=this.props,t=e.expandDisabled,n=e.isLeaf,r=e.lang;return n?h.a.createElement("span",{className:"rct-collapse"},h.a.createElement("span",{className:"rct-icon"})):h.a.createElement(S,{className:"rct-collapse rct-collapse-btn",disabled:t,title:r.toggle,onClick:this.onExpand},this.renderCollapseIcon())}},{key:"renderCollapseIcon",value:function(){var e=this.props,t=e.expanded,n=e.icons,r=n.expandClose,i=n.expandOpen;return t?i:r}},{key:"renderCheckboxIcon",value:function(){var e=this.props,t=e.checked,n=e.icons,r=n.uncheck,i=n.check,o=n.halfCheck;return 0===t?r:1===t?i:o}},{key:"renderNodeIcon",value:function(){var e=this.props,t=e.expanded,n=e.icon,r=e.icons,i=r.leaf,o=r.parentClose,a=r.parentOpen,s=e.isLeaf;return null!==n?n:s?i:t?a:o}},{key:"renderBareLabel",value:function(e){var t=this.props,n=t.onClick,r=t.title,i=null!==n;return h.a.createElement("span",{className:"rct-bare-label",title:r},i?h.a.createElement("span",{className:"rct-node-clickable",onClick:this.onClick,onKeyPress:this.onClick,role:"button",tabIndex:0},e):e)}},{key:"renderCheckboxLabel",value:function(e){var t=this.props,n=t.checked,r=t.disabled,i=t.title,o=t.treeId,a=t.value,s=null!==t.onClick,l="".concat(o,"-").concat(String(a).split(" ").join("_")),d=[h.a.createElement("label",{key:0,htmlFor:l,title:i},h.a.createElement(I,{checked:1===n,disabled:r,id:l,indeterminate:2===n,onClick:this.onCheck,onChange:function(){}}),h.a.createElement("span",{className:"rct-checkbox"},this.renderCheckboxIcon()),s?null:e)];return s&&d.push(h.a.createElement("span",{key:1,className:"rct-node-clickable",onClick:this.onClick,onKeyPress:this.onClick,role:"link",tabIndex:0},e)),d}},{key:"renderLabel",value:function(){var e=this.props,t=e.label,n=e.showCheckbox,r=[e.showNodeIcon?h.a.createElement("span",{key:0,className:"rct-node-icon"},this.renderNodeIcon()):null,h.a.createElement("span",{key:1,className:"rct-title"},t)];return n?this.renderCheckboxLabel(r):this.renderBareLabel(r)}},{key:"renderChildren",value:function(){return this.props.expanded?this.props.children:null}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.disabled,r=e.expanded,o=e.isLeaf,a=i()({"rct-node":!0,"rct-node-leaf":o,"rct-node-parent":!o,"rct-node-expanded":!o&&r,"rct-node-collapsed":!o&&!r,"rct-disabled":n},t);return h.a.createElement("li",{className:a},h.a.createElement("span",{className:"rct-text"},this.renderCollapseButton(),this.renderLabel()),this.renderChildren())}}])&&j(n.prototype,r),t}();$(U,"propTypes",{checked:c.a.number.isRequired,disabled:c.a.bool.isRequired,expandDisabled:c.a.bool.isRequired,expanded:c.a.bool.isRequired,icons:O.isRequired,isLeaf:c.a.bool.isRequired,isParent:c.a.bool.isRequired,label:c.a.node.isRequired,lang:P.isRequired,optimisticToggle:c.a.bool.isRequired,showNodeIcon:c.a.bool.isRequired,treeId:c.a.string.isRequired,value:c.a.oneOfType([c.a.string,c.a.number]).isRequired,onCheck:c.a.func.isRequired,onExpand:c.a.func.isRequired,children:c.a.node,className:c.a.string,expandOnClick:c.a.bool,icon:c.a.node,showCheckbox:c.a.bool,title:c.a.string,onClick:c.a.func}),$(U,"defaultProps",{children:null,className:null,expandOnClick:!1,icon:null,showCheckbox:!0,title:null,onClick:function(){}});var L=U,V=c.a.oneOfType([c.a.arrayOf(c.a.string),c.a.arrayOf(c.a.number)]);function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var B={label:c.a.node.isRequired,value:c.a.oneOfType([c.a.string,c.a.number]).isRequired,disabled:c.a.bool,icon:c.a.node,showCheckbox:c.a.bool,title:c.a.string},W=c.a.oneOfType([c.a.shape(B),c.a.shape(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){K(e,t,n[t])}))}return e}({},B,{children:c.a.arrayOf(B).isRequired}))]);function H(e){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ee(e,t,n[t])}))}return e}function Q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function J(e){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Y(e,t){return(Y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function X(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var te=function(e){function t(e){var n,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=!(r=J(t).call(this,e))||"object"!==H(r)&&"function"!=typeof r?X(this):r;var i=new w(e);return i.flattenNodes(e.nodes),i.deserializeLists({checked:e.checked,expanded:e.expanded}),n.state={id:e.id||"rct-".concat(l()(7)),model:i,prevProps:e},n.onCheck=n.onCheck.bind(X(X(n))),n.onExpand=n.onExpand.bind(X(X(n))),n.onNodeClick=n.onNodeClick.bind(X(X(n))),n.onExpandAll=n.onExpandAll.bind(X(X(n))),n.onCollapseAll=n.onCollapseAll.bind(X(X(n))),n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Y(e,t)}(t,h.a.Component),n=t,o=[{key:"getDerivedStateFromProps",value:function(e,t){var n=t.model,r=t.prevProps,i=e.disabled,o=e.id,s=e.nodes,l=G({},t,{prevProps:e});return n.setProps(e),a()(r.nodes,s)&&r.disabled===i||n.flattenNodes(s),null!==o&&(l=G({},l,{id:o})),n.deserializeLists({checked:e.checked,expanded:e.expanded}),l}}],(r=[{key:"onCheck",value:function(e){var t=this.props,n=t.noCascade,r=t.onCheck,i=this.state.model.clone(),o=i.getNode(e.value);i.toggleChecked(e,e.checked,n),r(i.serializeList("checked"),G({},o,e))}},{key:"onExpand",value:function(e){var t=this.props.onExpand,n=this.state.model.clone(),r=n.getNode(e.value);n.toggleNode(e.value,"expanded",e.expanded),t(n.serializeList("expanded"),G({},r,e))}},{key:"onNodeClick",value:function(e){(0,this.props.onClick)(G({},this.state.model.getNode(e.value),e))}},{key:"onExpandAll",value:function(){this.expandAllNodes()}},{key:"onCollapseAll",value:function(){this.expandAllNodes(!1)}},{key:"expandAllNodes",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,this.props.onExpand)(this.state.model.clone().expandAllNodes(e).serializeList("expanded"))}},{key:"determineShallowCheckState",value:function(e,t){var n=this.state.model.getNode(e.value);return n.isLeaf||t?n.checked?1:0:this.isEveryChildChecked(e)?1:this.isSomeChildChecked(e)?2:0}},{key:"isEveryChildChecked",value:function(e){var t=this;return e.children.every((function(e){return 1===t.state.model.getNode(e.value).checkState}))}},{key:"isSomeChildChecked",value:function(e){var t=this;return e.children.some((function(e){return t.state.model.getNode(e.value).checkState>0}))}},{key:"renderTreeNodes",value:function(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.props,o=i.expandDisabled,a=i.expandOnClick,s=i.icons,l=i.lang,d=i.noCascade,c=i.onClick,u=i.onlyLeafCheckboxes,p=i.optimisticToggle,f=i.showNodeTitle,m=i.showNodeIcon,g=this.state,v=g.id,b=g.model,y=t.defaultProps.icons,C=e.map((function(e){var t=e.value,i=b.getNode(e.value),g=i.isParent?n.renderTreeNodes(e.children,e):null;i.checkState=n.determineShallowCheckState(e,d);var C=u?i.isLeaf:i.showCheckbox;return!r.value||b.getNode(r.value).expanded?h.a.createElement(L,{key:t,checked:i.checkState,className:e.className,disabled:i.disabled,expandDisabled:o,expandOnClick:a,expanded:i.expanded,icon:e.icon,icons:G({},y,s),label:e.label,lang:l,optimisticToggle:p,isLeaf:i.isLeaf,isParent:i.isParent,showCheckbox:C,showNodeIcon:m,title:f?e.title||e.label:e.title,treeId:v,value:e.value,onCheck:n.onCheck,onClick:c&&n.onNodeClick,onExpand:n.onExpand},g):null}));return h.a.createElement("ol",null,C)}},{key:"renderExpandAll",value:function(){var e=this.props,t=e.icons,n=t.expandAll,r=t.collapseAll,i=e.lang;return e.showExpandAll?h.a.createElement("div",{className:"rct-options"},h.a.createElement(S,{className:"rct-option rct-option-expand-all",title:i.expandAll,onClick:this.onExpandAll},n),h.a.createElement(S,{className:"rct-option rct-option-collapse-all",title:i.collapseAll,onClick:this.onCollapseAll},r)):null}},{key:"renderHiddenInput",value:function(){var e=this.props,t=e.name,n=e.nameAsArray;return void 0===t?null:n?this.renderArrayHiddenInput():this.renderJoinedHiddenInput()}},{key:"renderArrayHiddenInput",value:function(){var e=this.props,t=e.checked,n=e.name;return t.map((function(e){var t="".concat(n,"[]");return h.a.createElement("input",{key:e,name:t,type:"hidden",value:e})}))}},{key:"renderJoinedHiddenInput",value:function(){var e=this.props,t=e.checked,n=e.name,r=t.join(",");return h.a.createElement("input",{name:n,type:"hidden",value:r})}},{key:"render",value:function(){var e=this.props,t=e.disabled,n=e.nodes,r=e.nativeCheckboxes,o=this.renderTreeNodes(n),a=i()({"react-checkbox-tree":!0,"rct-disabled":t,"rct-native-display":r});return h.a.createElement("div",{className:a},this.renderExpandAll(),this.renderHiddenInput(),o)}}])&&Q(n.prototype,r),o&&Q(n,o),t}();ee(te,"propTypes",{nodes:c.a.arrayOf(W).isRequired,checked:V,disabled:c.a.bool,expandDisabled:c.a.bool,expandOnClick:c.a.bool,expanded:V,icons:O,id:c.a.string,lang:P,name:c.a.string,nameAsArray:c.a.bool,nativeCheckboxes:c.a.bool,noCascade:c.a.bool,onlyLeafCheckboxes:c.a.bool,optimisticToggle:c.a.bool,showExpandAll:c.a.bool,showNodeIcon:c.a.bool,showNodeTitle:c.a.bool,onCheck:c.a.func,onClick:c.a.func,onExpand:c.a.func}),ee(te,"defaultProps",{checked:[],disabled:!1,expandDisabled:!1,expandOnClick:!1,expanded:[],icons:{check:h.a.createElement("span",{className:"rct-icon rct-icon-check"}),uncheck:h.a.createElement("span",{className:"rct-icon rct-icon-uncheck"}),halfCheck:h.a.createElement("span",{className:"rct-icon rct-icon-half-check"}),expandClose:h.a.createElement("span",{className:"rct-icon rct-icon-expand-close"}),expandOpen:h.a.createElement("span",{className:"rct-icon rct-icon-expand-open"}),expandAll:h.a.createElement("span",{className:"rct-icon rct-icon-expand-all"}),collapseAll:h.a.createElement("span",{className:"rct-icon rct-icon-collapse-all"}),parentClose:h.a.createElement("span",{className:"rct-icon rct-icon-parent-close"}),parentOpen:h.a.createElement("span",{className:"rct-icon rct-icon-parent-open"}),leaf:h.a.createElement("span",{className:"rct-icon rct-icon-leaf"})},id:null,lang:{collapseAll:"Collapse all",expandAll:"Expand all",toggle:"Toggle"},name:void 0,nameAsArray:!1,nativeCheckboxes:!1,noCascade:!1,onlyLeafCheckboxes:!1,optimisticToggle:!0,showExpandAll:!1,showNodeIcon:!0,showNodeTitle:!1,onCheck:function(){},onClick:null,onExpand:function(){}}),t.default=te}]))},9238:(e,t,n)=>{"use strict";n.d(t,{DragLayer:()=>te,DragSource:()=>q,DropTarget:()=>K});var r=n(28195);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function o(e){return"function"==typeof e}function a(){}function s(e){if(!function(e){return"object"===i(e)&&null!==e}(e))return!1;if(null===Object.getPrototypeOf(e))return!0;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function l(e){var t=e.current;return null==t?null:t.decoratedRef?t.decoratedRef.current:t}function d(e){return(t=e)&&t.prototype&&"function"==typeof t.prototype.render||function(e){var t;return"Symbol(react.forward_ref)"===(null==e||null===(t=e.$$typeof)||void 0===t?void 0:t.toString())}(e);var t}var c=n(67294),u=n(15047),h=n(8679),p=n.n(h),f=n(82514);function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function v(e,t,n){return t&&g(e.prototype,t),n&&g(e,n),e}var b=function(){var e=function(){function e(t){m(this,e),this.isDisposed=!1,this.action=o(t)?t:a}return v(e,[{key:"dispose",value:function(){this.isDisposed||(this.action(),this.isDisposed=!0)}}],[{key:"isDisposable",value:function(e){return Boolean(e&&o(e.dispose))}},{key:"_fixup",value:function(t){return e.isDisposable(t)?t:e.empty}},{key:"create",value:function(t){return new e(t)}}]),e}();return e.empty={dispose:a},e}(),y=function(){function e(){m(this,e),this.isDisposed=!1;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.disposables=n}return v(e,[{key:"add",value:function(e){this.isDisposed?e.dispose():this.disposables.push(e)}},{key:"remove",value:function(e){var t=!1;if(!this.isDisposed){var n=this.disposables.indexOf(e);-1!==n&&(t=!0,this.disposables.splice(n,1),e.dispose())}return t}},{key:"clear",value:function(){if(!this.isDisposed){for(var e=this.disposables.length,t=new Array(e),n=0;n<e;n++)t[n]=this.disposables[n];this.disposables=[];for(var r=0;r<e;r++)t[r].dispose()}}},{key:"dispose",value:function(){if(!this.isDisposed){this.isDisposed=!0;for(var e=this.disposables.length,t=new Array(e),n=0;n<e;n++)t[n]=this.disposables[n];this.disposables=[];for(var r=0;r<e;r++)t[r].dispose()}}}]),e}(),C=function(){function e(){m(this,e),this.isDisposed=!1}return v(e,[{key:"getDisposable",value:function(){return this.current}},{key:"setDisposable",value:function(e){var t=this.isDisposed;if(!t){var n=this.current;this.current=e,n&&n.dispose()}t&&e&&e.dispose()}},{key:"dispose",value:function(){if(!this.isDisposed){this.isDisposed=!0;var e=this.current;this.current=void 0,e&&e.dispose()}}}]),e}();function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t){return w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},w(e,t)}function R(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Z(e){return Z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Z(e)}function F(e){var t=e.DecoratedComponent,n=e.createHandler,i=e.createMonitor,o=e.createConnector,a=e.registerHandler,s=e.containerDisplayName,l=e.getType,h=e.collect,m=e.options.arePropsEqual,g=void 0===m?u.w:m,v=t,S=t.displayName||t.name||"Component",F=function(){var e=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}(T,e);var t,s,p,m,F=(p=T,m=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Z(p);if(m){var n=Z(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return R(this,e)});function T(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,T),(t=F.call(this,e)).decoratedRef=c.createRef(),t.handleChange=function(){var e=t.getCurrentState();(0,u.w)(e,t.state)||t.setState(e)},t.disposable=new C,t.receiveProps(e),t.dispose(),t}return t=T,(s=[{key:"getHandlerId",value:function(){return this.handlerId}},{key:"getDecoratedComponentInstance",value:function(){return(0,r.k)(this.decoratedRef.current,"In order to access an instance of the decorated component, it must either be a class component or use React.forwardRef()"),this.decoratedRef.current}},{key:"shouldComponentUpdate",value:function(e,t){return!g(e,this.props)||!(0,u.w)(t,this.state)}},{key:"componentDidMount",value:function(){this.disposable=new C,this.currentType=void 0,this.receiveProps(this.props),this.handleChange()}},{key:"componentDidUpdate",value:function(e){g(this.props,e)||(this.receiveProps(this.props),this.handleChange())}},{key:"componentWillUnmount",value:function(){this.dispose()}},{key:"receiveProps",value:function(e){this.handler&&(this.handler.receiveProps(e),this.receiveType(l(e)))}},{key:"receiveType",value:function(e){if(this.handlerMonitor&&this.manager&&this.handlerConnector&&e!==this.currentType){this.currentType=e;var t=(o=a(e,this.handler,this.manager),s=2,function(e){if(Array.isArray(e))return e}(o)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(o,s)||function(e,t){if(e){if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}(o,s)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),n=t[0],r=t[1];this.handlerId=n,this.handlerMonitor.receiveHandlerId(n),this.handlerConnector.receiveHandlerId(n);var i=this.manager.getMonitor().subscribeToStateChange(this.handleChange,{handlerIds:[n]});this.disposable.setDisposable(new y(new b(i),new b(r)))}var o,s}},{key:"dispose",value:function(){this.disposable.dispose(),this.handlerConnector&&this.handlerConnector.receiveHandlerId(null)}},{key:"getCurrentState",value:function(){return this.handlerConnector?h(this.handlerConnector.hooks,this.handlerMonitor,this.props):{}}},{key:"render",value:function(){var e=this;return c.createElement(f.L.Consumer,null,(function(t){var n=t.dragDropManager;return e.receiveDragDropManager(n),"undefined"!=typeof requestAnimationFrame&&requestAnimationFrame((function(){var t;return null===(t=e.handlerConnector)||void 0===t?void 0:t.reconnect()})),c.createElement(v,Object.assign({},e.props,e.getCurrentState(),{ref:d(v)?e.decoratedRef:null}))}))}},{key:"receiveDragDropManager",value:function(e){void 0===this.manager&&((0,r.k)(void 0!==e,"Could not find the drag and drop manager in the context of %s. Make sure to render a DndProvider component in your top-level component. Read more: http://react-dnd.github.io/react-dnd/docs/troubleshooting#could-not-find-the-drag-and-drop-manager-in-the-context",S,S),void 0!==e&&(this.manager=e,this.handlerMonitor=i(e),this.handlerConnector=o(e.getBackend()),this.handler=n(this.handlerMonitor,this.decoratedRef)))}}])&&k(t.prototype,s),T}(c.Component);return e.DecoratedComponent=t,e.displayName="".concat(s,"(").concat(S,")"),e}();return p()(F,t)}var T=n(33273),_=n(60938),D=n(8556);function M(e){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(e)}function E(e,t){return"string"==typeof e||"symbol"===M(e)||!!t&&Array.isArray(e)&&e.every((function(e){return E(e,!1)}))}function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var O=["canDrag","beginDrag","isDragging","endDrag"],P=["beginDrag"],N=function(){function e(t,n,r){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.props=null,this.beginDrag=function(){if(i.props)return i.spec.beginDrag(i.props,i.monitor,i.ref.current)},this.spec=t,this.monitor=n,this.ref=r}var t,n;return t=e,(n=[{key:"receiveProps",value:function(e){this.props=e}},{key:"canDrag",value:function(){return!!this.props&&(!this.spec.canDrag||this.spec.canDrag(this.props,this.monitor))}},{key:"isDragging",value:function(e,t){return!!this.props&&(this.spec.isDragging?this.spec.isDragging(this.props,this.monitor):t===e.getSourceId())}},{key:"endDrag",value:function(){this.props&&this.spec.endDrag&&this.spec.endDrag(this.props,this.monitor,l(this.ref))}}])&&I(t.prototype,n),e}();function j(e){return Object.keys(e).forEach((function(t){(0,r.k)(O.indexOf(t)>-1,'Expected the drag source specification to only have some of the following keys: %s. Instead received a specification with an unexpected "%s" key. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',O.join(", "),t),(0,r.k)("function"==typeof e[t],"Expected %s in the drag source specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source",t,t,e[t])})),P.forEach((function(t){(0,r.k)("function"==typeof e[t],"Expected %s in the drag source specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source",t,t,e[t])})),function(t,n){return new N(e,t,n)}}function q(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=e;"function"!=typeof e&&((0,r.k)(E(e),'Expected "type" provided as the first argument to DragSource to be a string, or a function that returns a string given the current props. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',e),o=function(){return e}),(0,r.k)(s(t),'Expected "spec" provided as the second argument to DragSource to be a plain object. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',t);var a=j(t);return(0,r.k)("function"==typeof n,'Expected "collect" provided as the third argument to DragSource to be a function that returns a plain object of props to inject. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',n),(0,r.k)(s(i),'Expected "options" provided as the fourth argument to DragSource to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',n),function(e){return F({containerDisplayName:"DragSource",createHandler:a,registerHandler:T.w,createConnector:function(e){return new D.x(e)},createMonitor:function(e){return new _.p(e)},DecoratedComponent:e,getType:o,collect:n,options:i})}}var z=n(89026),A=n(56941);function $(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var U=["canDrop","hover","drop"],L=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.props=null,this.spec=t,this.monitor=n,this.ref=r}var t,n;return t=e,(n=[{key:"receiveProps",value:function(e){this.props=e}},{key:"receiveMonitor",value:function(e){this.monitor=e}},{key:"canDrop",value:function(){return!this.spec.canDrop||this.spec.canDrop(this.props,this.monitor)}},{key:"hover",value:function(){this.spec.hover&&this.props&&this.spec.hover(this.props,this.monitor,l(this.ref))}},{key:"drop",value:function(){if(this.spec.drop)return this.spec.drop(this.props,this.monitor,this.ref.current)}}])&&$(t.prototype,n),e}();function V(e){return Object.keys(e).forEach((function(t){(0,r.k)(U.indexOf(t)>-1,'Expected the drop target specification to only have some of the following keys: %s. Instead received a specification with an unexpected "%s" key. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',U.join(", "),t),(0,r.k)("function"==typeof e[t],"Expected %s in the drop target specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target",t,t,e[t])})),function(t,n){return new L(e,t,n)}}function K(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=e;"function"!=typeof e&&((0,r.k)(E(e,!0),'Expected "type" provided as the first argument to DropTarget to be a string, an array of strings, or a function that returns either given the current props. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',e),o=function(){return e}),(0,r.k)(s(t),'Expected "spec" provided as the second argument to DropTarget to be a plain object. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',t);var a=V(t);return(0,r.k)("function"==typeof n,'Expected "collect" provided as the third argument to DropTarget to be a function that returns a plain object of props to inject. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',n),(0,r.k)(s(i),'Expected "options" provided as the fourth argument to DropTarget to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',n),function(e){return F({containerDisplayName:"DropTarget",createHandler:a,registerHandler:T.n,createMonitor:function(e){return new A.H(e)},createConnector:function(e){return new z.Y(e)},DecoratedComponent:e,getType:o,collect:n,options:i})}}function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function G(e,t,n){return t&&H(e.prototype,t),n&&H(e,n),e}function Q(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&J(e,t)}function J(e,t){return J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},J(e,t)}function Y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ee(e);if(t){var i=ee(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return X(this,n)}}function X(e,t){return!t||"object"!==B(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ee(e){return ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ee(e)}function te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.k)("function"==typeof e,'Expected "collect" provided as the first argument to DragLayer to be a function that collects props to inject into the component. ',"Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-layer",e),(0,r.k)(s(t),'Expected "options" provided as the second argument to DragLayer to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-layer',t),function(n){var i=n,o=t.arePropsEqual,a=void 0===o?u.w:o,s=i.displayName||i.name||"Component",l=function(){var t=function(t){Q(o,t);var n=Y(o);function o(){var e;return W(this,o),(e=n.apply(this,arguments)).isCurrentlyMounted=!1,e.ref=c.createRef(),e.handleChange=function(){if(e.isCurrentlyMounted){var t=e.getCurrentState();(0,u.w)(t,e.state)||e.setState(t)}},e}return G(o,[{key:"getDecoratedComponentInstance",value:function(){return(0,r.k)(this.ref.current,"In order to access an instance of the decorated component, it must either be a class component or use React.forwardRef()"),this.ref.current}},{key:"shouldComponentUpdate",value:function(e,t){return!a(e,this.props)||!(0,u.w)(t,this.state)}},{key:"componentDidMount",value:function(){this.isCurrentlyMounted=!0,this.handleChange()}},{key:"componentWillUnmount",value:function(){this.isCurrentlyMounted=!1,this.unsubscribeFromOffsetChange&&(this.unsubscribeFromOffsetChange(),this.unsubscribeFromOffsetChange=void 0),this.unsubscribeFromStateChange&&(this.unsubscribeFromStateChange(),this.unsubscribeFromStateChange=void 0)}},{key:"render",value:function(){var e=this;return c.createElement(f.L.Consumer,null,(function(t){var n=t.dragDropManager;return void 0===n?null:(e.receiveDragDropManager(n),e.isCurrentlyMounted?c.createElement(i,Object.assign({},e.props,e.state,{ref:d(i)?e.ref:null})):null)}))}},{key:"receiveDragDropManager",value:function(e){if(void 0===this.manager){this.manager=e,(0,r.k)("object"===B(e),"Could not find the drag and drop manager in the context of %s. Make sure to render a DndProvider component in your top-level component. Read more: http://react-dnd.github.io/react-dnd/docs/troubleshooting#could-not-find-the-drag-and-drop-manager-in-the-context",s,s);var t=this.manager.getMonitor();this.unsubscribeFromOffsetChange=t.subscribeToOffsetChange(this.handleChange),this.unsubscribeFromStateChange=t.subscribeToStateChange(this.handleChange)}}},{key:"getCurrentState",value:function(){if(!this.manager)return{};var t=this.manager.getMonitor();return e(t,this.props)}}]),o}(c.Component);return t.displayName="DragLayer(".concat(s,")"),t.DecoratedComponent=n,t}();return p()(l,n)}}},84785:(e,t,n)=>{"use strict";n.d(t,{DragLayer:()=>i.DragLayer,DragSource:()=>i.DragSource,DropTarget:()=>i.DropTarget});var r=n(31388);n.o(r,"DragLayer")&&n.d(t,{DragLayer:function(){return r.DragLayer}}),n.o(r,"DragSource")&&n.d(t,{DragSource:function(){return r.DragSource}}),n.o(r,"DropTarget")&&n.d(t,{DropTarget:function(){return r.DropTarget}});var i=n(9238)},73897:()=>{},48058:()=>{},31388:(e,t,n)=>{"use strict";var r=n(75253);n.o(r,"DragLayer")&&n.d(t,{DragLayer:function(){return r.DragLayer}}),n.o(r,"DragSource")&&n.d(t,{DragSource:function(){return r.DragSource}}),n.o(r,"DropTarget")&&n.d(t,{DropTarget:function(){return r.DropTarget}});var i=n(48058);n.o(i,"DragLayer")&&n.d(t,{DragLayer:function(){return i.DragLayer}}),n.o(i,"DragSource")&&n.d(t,{DragSource:function(){return i.DragSource}}),n.o(i,"DropTarget")&&n.d(t,{DropTarget:function(){return i.DropTarget}});var o=n(72105);n.o(o,"DragLayer")&&n.d(t,{DragLayer:function(){return o.DragLayer}}),n.o(o,"DragSource")&&n.d(t,{DragSource:function(){return o.DragSource}}),n.o(o,"DropTarget")&&n.d(t,{DropTarget:function(){return o.DropTarget}});var a=n(73897);n.o(a,"DragLayer")&&n.d(t,{DragLayer:function(){return a.DragLayer}}),n.o(a,"DragSource")&&n.d(t,{DragSource:function(){return a.DragSource}}),n.o(a,"DropTarget")&&n.d(t,{DropTarget:function(){return a.DropTarget}})},75253:()=>{},72105:()=>{},46871:(e,t,n)=>{"use strict";function r(){var e=this.constructor.getDerivedStateFromProps(this.props,this.state);null!=e&&this.setState(e)}function i(e){this.setState(function(t){var n=this.constructor.getDerivedStateFromProps(e,t);return null!=n?n:null}.bind(this))}function o(e,t){try{var n=this.props,r=this.state;this.props=e,this.state=t,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(n,r)}finally{this.props=n,this.state=r}}function a(e){var t=e.prototype;if(!t||!t.isReactComponent)throw new Error("Can only polyfill class components");if("function"!=typeof e.getDerivedStateFromProps&&"function"!=typeof t.getSnapshotBeforeUpdate)return e;var n=null,a=null,s=null;if("function"==typeof t.componentWillMount?n="componentWillMount":"function"==typeof t.UNSAFE_componentWillMount&&(n="UNSAFE_componentWillMount"),"function"==typeof t.componentWillReceiveProps?a="componentWillReceiveProps":"function"==typeof t.UNSAFE_componentWillReceiveProps&&(a="UNSAFE_componentWillReceiveProps"),"function"==typeof t.componentWillUpdate?s="componentWillUpdate":"function"==typeof t.UNSAFE_componentWillUpdate&&(s="UNSAFE_componentWillUpdate"),null!==n||null!==a||null!==s){var l=e.displayName||e.name,d="function"==typeof e.getDerivedStateFromProps?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error("Unsafe legacy lifecycles will not be called for components using new component APIs.\n\n"+l+" uses "+d+" but also contains the following legacy lifecycles:"+(null!==n?"\n  "+n:"")+(null!==a?"\n  "+a:"")+(null!==s?"\n  "+s:"")+"\n\nThe above lifecycles should be removed. Learn more about this warning here:\nhttps://fb.me/react-async-component-lifecycle-hooks")}if("function"==typeof e.getDerivedStateFromProps&&(t.componentWillMount=r,t.componentWillReceiveProps=i),"function"==typeof t.getSnapshotBeforeUpdate){if("function"!=typeof t.componentDidUpdate)throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");t.componentWillUpdate=o;var c=t.componentDidUpdate;t.componentDidUpdate=function(e,t,n){var r=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:n;c.call(this,e,t,r)}}return e}n.r(t),n.d(t,{polyfill:()=>a}),r.__suppressDeprecationWarning=!0,i.__suppressDeprecationWarning=!0,o.__suppressDeprecationWarning=!0},24903:(e,t,n)=>{"use strict";t.cj=void 0;var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(67294),o=l(i),a=l(n(45697)),s=n(76597);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={searchTerm:n.props.value||""},n.updateSearch=n.updateSearch.bind(n),n.filter=n.filter.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"componentWillReceiveProps",value:function(e){if(void 0!==e.value&&e.value!==this.props.value){var t={target:{value:e.value}};this.updateSearch(t)}}},{key:"render",value:function(){var e=this.props,t=e.className,n=(e.onChange,e.caseSensitive,e.sortResults,e.throttle,e.filterKeys,e.value,e.fuzzy,e.inputClassName),r=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}(e,["className","onChange","caseSensitive","sortResults","throttle","filterKeys","value","fuzzy","inputClassName"]);return r.type=r.type||"search",r.value=this.state.searchTerm,r.onChange=this.updateSearch,r.className=n,r.placeholder=r.placeholder||"Search",o.default.createElement("div",{className:t},o.default.createElement("input",r))}},{key:"updateSearch",value:function(e){var t=this,n=e.target.value;this.setState({searchTerm:n},(function(){t._throttleTimeout&&clearTimeout(t._throttleTimeout),t._throttleTimeout=setTimeout((function(){return t.props.onChange(n)}),t.props.throttle)}))}},{key:"filter",value:function(e){var t=this.props,n=t.filterKeys,r=t.caseSensitive,i=t.fuzzy,o=t.sortResults;return(0,s.createFilter)(this.state.searchTerm,e||n,{caseSensitive:r,fuzzy:i,sortResults:o})}}]),t}(i.Component);d.defaultProps={className:"",onChange:function(){},caseSensitive:!1,fuzzy:!1,throttle:200},d.propTypes={className:a.default.string,inputClassName:a.default.string,onChange:a.default.func,caseSensitive:a.default.bool,sortResults:a.default.bool,fuzzy:a.default.bool,throttle:a.default.number,filterKeys:a.default.oneOf([a.default.string,a.default.arrayOf(a.default.string)]),value:a.default.string},t.cj=s.createFilter},76597:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getValuesForKey=a,t.searchStrings=s,t.createFilter=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(r){if(""===e)return!0;n.caseSensitive||(e=e.toLowerCase());var i=e.split(" ");return t?("string"==typeof t&&(t=[t]),i.every((function(e){var i=void 0;if(-1!==e.indexOf(":")){var o=e.split(":")[0];e=e.split(":")[1],i=t.filter((function(e){return e.toLowerCase().indexOf(o)>-1}))}else i=t;return i.some((function(t){return s(a(t,r),e,n)}))}))):i.every((function(e){return s([r],e,n)}))}};var r,i=(r=n(69021))&&r.__esModule?r:{default:r};function o(e){return e.reduce((function(e,t){return e.concat(Array.isArray(t)?o(t):t)}),[])}function a(e,t){var n=e.split("."),r=[t];return n.forEach((function(e){var t=[];r.forEach((function(n){if(n)if(n instanceof Array){var r=parseInt(e,10);if(!isNaN(r))return t.push(n[r]);n.forEach((function(n){t.push(n[e])}))}else n&&"function"==typeof n.get?t.push(n.get(e)):t.push(n[e])})),r=t})),(r=o(r=r.map((function(e){return e&&e.push&&e.toArray?e.toArray():e})))).filter((function(e){return"string"==typeof e||"number"==typeof e}))}function s(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.caseSensitive,o=n.fuzzy,a=n.sortResults,s=n.exactMatch;e=e.map((function(e){return e.toString()}));try{if(o){"function"==typeof e.toJS&&(e=e.toJS());var l=new i.default(e.map((function(e){return{id:e}})),{keys:["id"],id:"id",caseSensitive:r,shouldSort:a});return l.search(t).length}return e.some((function(e){try{return r||(e=e.toLowerCase()),s&&(t=new RegExp("^"+t+"$","i")),!(!e||-1===e.search(t))}catch(e){return!1}}))}catch(e){return!1}}},69021:function(e){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(1),a=n(7),s=a.get,l=(a.deepValue,a.isArray),d=function(){function e(t,n){var r=n.location,i=void 0===r?0:r,o=n.distance,a=void 0===o?100:o,l=n.threshold,d=void 0===l?.6:l,c=n.maxPatternLength,u=void 0===c?32:c,h=n.caseSensitive,p=void 0!==h&&h,f=n.tokenSeparator,m=void 0===f?/ +/g:f,g=n.findAllMatches,v=void 0!==g&&g,b=n.minMatchCharLength,y=void 0===b?1:b,C=n.id,S=void 0===C?null:C,x=n.keys,k=void 0===x?[]:x,w=n.shouldSort,R=void 0===w||w,Z=n.getFn,F=void 0===Z?s:Z,T=n.sortFn,_=void 0===T?function(e,t){return e.score-t.score}:T,D=n.tokenize,M=void 0!==D&&D,E=n.matchAllTokens,I=void 0!==E&&E,O=n.includeMatches,P=void 0!==O&&O,N=n.includeScore,j=void 0!==N&&N,q=n.verbose,z=void 0!==q&&q;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:i,distance:a,threshold:d,maxPatternLength:u,isCaseSensitive:p,tokenSeparator:m,findAllMatches:v,minMatchCharLength:y,id:S,keys:k,includeMatches:P,includeScore:j,shouldSort:R,getFn:F,sortFn:_,verbose:z,tokenize:M,matchAllTokens:I},this.setCollection(t),this._processKeys(k)}var t,n;return t=e,(n=[{key:"setCollection",value:function(e){return this.list=e,e}},{key:"_processKeys",value:function(e){if(this._keyWeights={},this._keyNames=[],e.length&&"string"==typeof e[0])for(var t=0,n=e.length;t<n;t+=1){var r=e[t];this._keyWeights[r]=1,this._keyNames.push(r)}else{for(var i=null,o=null,a=0,s=0,l=e.length;s<l;s+=1){var d=e[s];if(!d.hasOwnProperty("name"))throw new Error('Missing "name" property in key object');var c=d.name;if(this._keyNames.push(c),!d.hasOwnProperty("weight"))throw new Error('Missing "weight" property in key object');var u=d.weight;if(u<0||u>1)throw new Error('"weight" property in key must bein the range of [0, 1)');o=null==o?u:Math.max(o,u),i=null==i?u:Math.min(i,u),this._keyWeights[c]=u,a+=u}if(a>1)throw new Error("Total of weights cannot exceed 1")}}},{key:"search",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{limit:!1};this._log('---------\nSearch pattern: "'.concat(e,'"'));var n=this._prepareSearchers(e),r=n.tokenSearchers,i=n.fullSearcher,o=this._search(r,i);return this._computeScore(o),this.options.shouldSort&&this._sort(o),t.limit&&"number"==typeof t.limit&&(o=o.slice(0,t.limit)),this._format(o)}},{key:"_prepareSearchers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[];if(this.options.tokenize)for(var n=e.split(this.options.tokenSeparator),r=0,i=n.length;r<i;r+=1)t.push(new o(n[r],this.options));return{tokenSearchers:t,fullSearcher:new o(e,this.options)}}},{key:"_search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=this.list,r={},i=[];if("string"==typeof n[0]){for(var o=0,a=n.length;o<a;o+=1)this._analyze({key:"",value:n[o],record:o,index:o},{resultMap:r,results:i,tokenSearchers:e,fullSearcher:t});return i}for(var s=0,l=n.length;s<l;s+=1)for(var d=n[s],c=0,u=this._keyNames.length;c<u;c+=1){var h=this._keyNames[c];this._analyze({key:h,value:this.options.getFn(d,h),record:d,index:s},{resultMap:r,results:i,tokenSearchers:e,fullSearcher:t})}return i}},{key:"_analyze",value:function(e,t){var n=this,r=e.key,i=e.arrayIndex,o=void 0===i?-1:i,a=e.value,s=e.record,d=e.index,c=t.tokenSearchers,u=void 0===c?[]:c,h=t.fullSearcher,p=t.resultMap,f=void 0===p?{}:p,m=t.results,g=void 0===m?[]:m;!function e(t,i,o,a){if(null!=i)if("string"==typeof i){var s=!1,d=-1,c=0;n._log("\nKey: ".concat(""===r?"--":r));var p=h.search(i);if(n._log('Full text: "'.concat(i,'", score: ').concat(p.score)),n.options.tokenize){for(var m=i.split(n.options.tokenSeparator),v=m.length,b=[],y=0,C=u.length;y<C;y+=1){var S=u[y];n._log('\nPattern: "'.concat(S.pattern,'"'));for(var x=!1,k=0;k<v;k+=1){var w=m[k],R=S.search(w),Z={};R.isMatch?(Z[w]=R.score,s=!0,x=!0,b.push(R.score)):(Z[w]=1,n.options.matchAllTokens||b.push(1)),n._log('Token: "'.concat(w,'", score: ').concat(Z[w]))}x&&(c+=1)}d=b[0];for(var F=b.length,T=1;T<F;T+=1)d+=b[T];d/=F,n._log("Token score average:",d)}var _=p.score;d>-1&&(_=(_+d)/2),n._log("Score average:",_);var D=!n.options.tokenize||!n.options.matchAllTokens||c>=u.length;if(n._log("\nCheck Matches: ".concat(D)),(s||p.isMatch)&&D){var M={key:r,arrayIndex:t,value:i,score:_};n.options.includeMatches&&(M.matchedIndices=p.matchedIndices);var E=f[a];E?E.output.push(M):(f[a]={item:o,output:[M]},g.push(f[a]))}}else if(l(i))for(var I=0,O=i.length;I<O;I+=1)e(I,i[I],o,a)}(o,a,s,d)}},{key:"_computeScore",value:function(e){this._log("\n\nComputing score:\n");for(var t=this._keyWeights,n=!!Object.keys(t).length,r=0,i=e.length;r<i;r+=1){for(var o=e[r],a=o.output,s=a.length,l=1,d=0;d<s;d+=1){var c=a[d],u=c.key,h=n?t[u]:1,p=0===c.score&&t&&t[u]>0?Number.EPSILON:c.score;l*=Math.pow(p,h)}o.score=l,this._log(o)}}},{key:"_sort",value:function(e){this._log("\n\nSorting...."),e.sort(this.options.sortFn)}},{key:"_format",value:function(e){var t=[];if(this.options.verbose){var n=[];this._log("\n\nOutput:\n\n",JSON.stringify(e,(function(e,t){if("object"===r(t)&&null!==t){if(-1!==n.indexOf(t))return;n.push(t)}return t}),2)),n=null}var i=[];this.options.includeMatches&&i.push((function(e,t){var n=e.output;t.matches=[];for(var r=0,i=n.length;r<i;r+=1){var o=n[r];if(0!==o.matchedIndices.length){var a={indices:o.matchedIndices,value:o.value};o.key&&(a.key=o.key),o.hasOwnProperty("arrayIndex")&&o.arrayIndex>-1&&(a.arrayIndex=o.arrayIndex),t.matches.push(a)}}})),this.options.includeScore&&i.push((function(e,t){t.score=e.score}));for(var o=0,a=e.length;o<a;o+=1){var s=e[o];if(this.options.id&&(s.item=this.options.getFn(s.item,this.options.id)[0]),i.length){for(var l={item:s.item},d=0,c=i.length;d<c;d+=1)i[d](s,l);t.push(l)}else t.push(s.item)}return t}},{key:"_log",value:function(){var e;this.options.verbose&&(e=console).log.apply(e,arguments)}}])&&i(t.prototype,n),e}();e.exports=d},function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=n(2),o=n(3),a=n(6),s=function(){function e(t,n){var r=n.location,i=void 0===r?0:r,o=n.distance,s=void 0===o?100:o,l=n.threshold,d=void 0===l?.6:l,c=n.maxPatternLength,u=void 0===c?32:c,h=n.isCaseSensitive,p=void 0!==h&&h,f=n.tokenSeparator,m=void 0===f?/ +/g:f,g=n.findAllMatches,v=void 0!==g&&g,b=n.minMatchCharLength,y=void 0===b?1:b,C=n.includeMatches,S=void 0!==C&&C;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:i,distance:s,threshold:d,maxPatternLength:u,isCaseSensitive:p,tokenSeparator:m,findAllMatches:v,includeMatches:S,minMatchCharLength:y},this.pattern=p?t:t.toLowerCase(),this.pattern.length<=u&&(this.patternAlphabet=a(this.pattern))}var t,n;return t=e,(n=[{key:"search",value:function(e){var t=this.options,n=t.isCaseSensitive,r=t.includeMatches;if(n||(e=e.toLowerCase()),this.pattern===e){var a={isMatch:!0,score:0};return r&&(a.matchedIndices=[[0,e.length-1]]),a}var s=this.options,l=s.maxPatternLength,d=s.tokenSeparator;if(this.pattern.length>l)return i(e,this.pattern,d);var c=this.options,u=c.location,h=c.distance,p=c.threshold,f=c.findAllMatches,m=c.minMatchCharLength;return o(e,this.pattern,this.patternAlphabet,{location:u,distance:h,threshold:p,findAllMatches:f,minMatchCharLength:m,includeMatches:r})}}])&&r(t.prototype,n),e}();e.exports=s},function(e,t){var n=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/ +/g,i=new RegExp(t.replace(n,"\\$&").replace(r,"|")),o=e.match(i),a=!!o,s=[];if(a)for(var l=0,d=o.length;l<d;l+=1){var c=o[l];s.push([e.indexOf(c),c.length-1])}return{score:a?.5:1,isMatch:a,matchedIndices:s}}},function(e,t,n){var r=n(4),i=n(5);e.exports=function(e,t,n,o){for(var a=o.location,s=void 0===a?0:a,l=o.distance,d=void 0===l?100:l,c=o.threshold,u=void 0===c?.6:c,h=o.findAllMatches,p=void 0!==h&&h,f=o.minMatchCharLength,m=void 0===f?1:f,g=o.includeMatches,v=void 0!==g&&g,b=s,y=e.length,C=u,S=e.indexOf(t,b),x=t.length,k=[],w=0;w<y;w+=1)k[w]=0;if(-1!==S){var R=r(t,{errors:0,currentLocation:S,expectedLocation:b,distance:d});if(C=Math.min(R,C),-1!==(S=e.lastIndexOf(t,b+x))){var Z=r(t,{errors:0,currentLocation:S,expectedLocation:b,distance:d});C=Math.min(Z,C)}}S=-1;for(var F=[],T=1,_=x+y,D=1<<(x<=31?x-1:30),M=0;M<x;M+=1){for(var E=0,I=_;E<I;)r(t,{errors:M,currentLocation:b+I,expectedLocation:b,distance:d})<=C?E=I:_=I,I=Math.floor((_-E)/2+E);_=I;var O=Math.max(1,b-I+1),P=p?y:Math.min(b+I,y)+x,N=Array(P+2);N[P+1]=(1<<M)-1;for(var j=P;j>=O;j-=1){var q=j-1,z=n[e.charAt(q)];if(z&&(k[q]=1),N[j]=(N[j+1]<<1|1)&z,0!==M&&(N[j]|=(F[j+1]|F[j])<<1|1|F[j+1]),N[j]&D&&(T=r(t,{errors:M,currentLocation:q,expectedLocation:b,distance:d}))<=C){if(C=T,(S=q)<=b)break;O=Math.max(1,2*b-S)}}if(r(t,{errors:M+1,currentLocation:b,expectedLocation:b,distance:d})>C)break;F=N}var A={isMatch:S>=0,score:0===T?.001:T};return v&&(A.matchedIndices=i(k,m)),A}},function(e,t){e.exports=function(e,t){var n=t.errors,r=void 0===n?0:n,i=t.currentLocation,o=void 0===i?0:i,a=t.expectedLocation,s=void 0===a?0:a,l=t.distance,d=void 0===l?100:l,c=r/e.length,u=Math.abs(s-o);return d?c+u/d:u?1:c}},function(e,t){e.exports=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[],r=-1,i=-1,o=0,a=e.length;o<a;o+=1){var s=e[o];s&&-1===r?r=o:s||-1===r||((i=o-1)-r+1>=t&&n.push([r,i]),r=-1)}return e[o-1]&&o-r>=t&&n.push([r,o-1]),n}},function(e,t){e.exports=function(e){for(var t={},n=e.length,r=0;r<n;r+=1)t[e.charAt(r)]=0;for(var i=0;i<n;i+=1)t[e.charAt(i)]|=1<<n-i-1;return t}},function(e,t){var n=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},r=function(e){return null==e?"":function(e){if("string"==typeof e)return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(e)},i=function(e){return"string"==typeof e},o=function(e){return"number"==typeof e};e.exports={get:function(e,t){var a=[];return function e(t,s){if(s){var l=s.indexOf("."),d=s,c=null;-1!==l&&(d=s.slice(0,l),c=s.slice(l+1));var u=t[d];if(null!=u)if(c||!i(u)&&!o(u))if(n(u))for(var h=0,p=u.length;h<p;h+=1)e(u[h],c);else c&&e(u,c);else a.push(r(u))}else a.push(t)}(e,t),a},isArray:n,isString:i,isNum:o,toString:r}}])},18474:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(67294),a=d(o),s=d(n(45697)),l=d(n(54087));function d(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var h=function(e){function t(){var e,n,r;c(this,t);for(var i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.events=["resize","scroll","touchstart","touchmove","touchend","pageshow","load"],r.subscribers=[],r.rafHandle=null,r.subscribe=function(e){r.subscribers=r.subscribers.concat(e)},r.unsubscribe=function(e){r.subscribers=r.subscribers.filter((function(t){return t!==e}))},r.notifySubscribers=function(e){if(!r.framePending){var t=e.currentTarget;r.rafHandle=(0,l.default)((function(){r.framePending=!1;var e=r.node.getBoundingClientRect(),n=e.top,i=e.bottom;r.subscribers.forEach((function(e){return e({distanceFromTop:n,distanceFromBottom:i,eventSource:t===window?document.body:r.node})}))})),r.framePending=!0}},r.getParent=function(){return r.node},u(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"getChildContext",value:function(){return{subscribe:this.subscribe,unsubscribe:this.unsubscribe,getParent:this.getParent}}},{key:"componentDidMount",value:function(){var e=this;this.events.forEach((function(t){return window.addEventListener(t,e.notifySubscribers)}))}},{key:"componentWillUnmount",value:function(){var e=this;this.rafHandle&&(l.default.cancel(this.rafHandle),this.rafHandle=null),this.events.forEach((function(t){return window.removeEventListener(t,e.notifySubscribers)}))}},{key:"render",value:function(){var e=this;return a.default.createElement("div",r({},this.props,{ref:function(t){return e.node=t},onScroll:this.notifySubscribers,onTouchStart:this.notifySubscribers,onTouchMove:this.notifySubscribers,onTouchEnd:this.notifySubscribers}))}}]),t}(o.PureComponent);h.childContextTypes={subscribe:s.default.func,unsubscribe:s.default.func,getParent:s.default.func},t.default=h},78579:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(67294),o=l(i),a=l(n(73935)),s=l(n(45697));function l(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var u=function(e){function t(){var e,n,r;d(this,t);for(var i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r=c(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.state={isSticky:!1,wasSticky:!1,style:{}},r.handleContainerEvent=function(e){var t=e.distanceFromTop,n=e.distanceFromBottom,i=e.eventSource,o=r.context.getParent(),a=!1;r.props.relative&&(a=i!==o,t=-(i.scrollTop+i.offsetTop)+r.placeholder.offsetTop);var s=r.placeholder.getBoundingClientRect(),l=r.content.getBoundingClientRect().height,d=n-r.props.bottomOffset-l,c=!!r.state.isSticky,u=a?c:t<=-r.props.topOffset&&n>-r.props.bottomOffset;n=(r.props.relative?o.scrollHeight-o.scrollTop:n)-l;var h=u?{position:"fixed",top:d>0?r.props.relative?o.offsetTop-o.offsetParent.scrollTop:0:d,left:s.left,width:s.width}:{};r.props.disableHardwareAcceleration||(h.transform="translateZ(0)"),r.setState({isSticky:u,wasSticky:c,distanceFromTop:t,distanceFromBottom:n,calculatedHeight:l,style:h})},c(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"componentWillMount",value:function(){if(!this.context.subscribe)throw new TypeError("Expected Sticky to be mounted within StickyContainer");this.context.subscribe(this.handleContainerEvent)}},{key:"componentWillUnmount",value:function(){this.context.unsubscribe(this.handleContainerEvent)}},{key:"componentDidUpdate",value:function(){this.placeholder.style.paddingBottom=this.props.disableCompensation?0:(this.state.isSticky?this.state.calculatedHeight:0)+"px"}},{key:"render",value:function(){var e=this,t=o.default.cloneElement(this.props.children({isSticky:this.state.isSticky,wasSticky:this.state.wasSticky,distanceFromTop:this.state.distanceFromTop,distanceFromBottom:this.state.distanceFromBottom,calculatedHeight:this.state.calculatedHeight,style:this.state.style}),{ref:function(t){e.content=a.default.findDOMNode(t)}});return o.default.createElement("div",null,o.default.createElement("div",{ref:function(t){return e.placeholder=t}}),t)}}]),t}(i.Component);u.propTypes={topOffset:s.default.number,bottomOffset:s.default.number,relative:s.default.bool,children:s.default.func.isRequired},u.defaultProps={relative:!1,topOffset:0,bottomOffset:0,disableCompensation:!1,disableHardwareAcceleration:!1},u.contextTypes={subscribe:s.default.func,unsubscribe:s.default.func,getParent:s.default.func},t.default=u},58439:(e,t,n)=>{"use strict";t.L9=t.Le=void 0;var r=o(n(78579)),i=o(n(18474));function o(e){return e&&e.__esModule?e:{default:e}}t.Le=r.default,t.L9=i.default,r.default},49997:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});var r=n(67294),i=n(51995),o=n(61988),a=n(91877),s=n(93185),l=n(74069),d=n(36644),c=n(97381),u=n(60193),h=n(11965);function p({extensions:e,placeholder:t,id:n}){return(0,h.tZ)(u.ZP,{id:n,placeholder:t,extensions:e,autoComplete:"off",autoFocus:!0})}var f=n(3741),m=n(31069);const g=async e=>{var t;let n;try{n=await m.Z.get({endpoint:`/dashboardasync/api/read?_oc_DashboardModelViewAsync=changed_on&_od_DashboardModelViewAsync=desc&_flt_2_dashboard_title=${e}`})}catch(e){return[{title:(0,o.t)("An error occurred while fetching dashboards")}]}return null==(t=n)?void 0:t.json.result.map((e=>({title:e.dashboard_title,...e})))},v=(0,i.iK)(l.Z)`
  margin-top: 20%;

  .ant-modal-body {
    padding: 0;
    overflow: visible;
  }
`;function b(){const e=(0,r.useRef)(),t=(0,r.useRef)(null),[n,i]=(0,r.useState)(!1),l=e=>(0,c.logEvent)(f.tB,{show_omni:e}),u=()=>{e.current=!1,i(!1),l(!1)};return(0,d.J)((()=>{function n(t){if(!(0,a.cr)(s.T.OMNIBAR))return;const n=t.ctrlKey||t.metaKey,r=["KeyK"].includes(t.code);"Escape"===t.key&&e.current?u():n&&r&&(e.current=!e.current,i(e.current),l(!!e.current))}function r(e){t.current&&!t.current.contains(e.target)&&u()}return e.current=!1,document.addEventListener("mousedown",r),document.addEventListener("keydown",n),()=>{document.removeEventListener("keydown",n),document.removeEventListener("mousedown",r)}})),(0,h.tZ)(v,{title:"",show:n,hideFooter:!0,closable:!1,onHide:()=>{},destroyOnClose:!0},(0,h.tZ)("div",{ref:t},(0,h.tZ)(p,{id:"InputOmnibar",placeholder:(0,o.t)("Search all dashboards"),extensions:[g]})))}},61310:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ou});var r={};n.r(r);var i=n(14890),o=n(37703),a=n(67294),s=n(45697),l=n.n(s),d=n(61988),c=n(93185),u=n(14278),h=n(38703),p=n(81255);function f(e){return Object.values(e).reduce(((e,t)=>(t&&t.type===p.dW&&t.meta&&t.meta.chartId&&e.push(t.meta.chartId),e)),[])}var m=n(94184),g=n.n(m),v=n(51995),b=n(11965),y=n(57902),C=n(40637),S=n(58439),x=n(23279),k=n.n(x),w=n(91033);function R(){return R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},R.apply(this,arguments)}function Z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var T=function(e){var t,n;function r(t){var n;return F(Z(n=e.call(this,t)||this),"animationFrameID",void 0),F(Z(n),"resizeObserver",void 0),F(Z(n),"target",null),F(Z(n),"resize",(function(e){var t=e.width,r=e.height,i=e.top,o=e.left;n.setState((function(){return{width:t,height:r,top:i,left:o}}))})),F(Z(n),"setTarget",(function(e){n.target=e})),n.state={width:0,height:0,top:0,left:0},n.resize=k()(n.resize,t.debounceTime),n.animationFrameID=null,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.componentDidMount=function(){var e=this;this.resizeObserver=new w.Z((function(t){void 0===t&&(t=[]),t.forEach((function(t){var n=t.contentRect,r=n.left,i=n.top,o=n.width,a=n.height;e.animationFrameID=window.requestAnimationFrame((function(){e.resize({width:o,height:a,top:i,left:r})}))}))})),this.target&&this.resizeObserver.observe(this.target)},i.componentWillUnmount=function(){this.animationFrameID&&window.cancelAnimationFrame(this.animationFrameID),this.resizeObserver&&this.resizeObserver.disconnect()},i.render=function(){var e=this.props,t=e.className,n=e.children,r=(e.debounceTime,e.parentSizeStyles),i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,["className","children","debounceTime","parentSizeStyles"]);return a.createElement("div",R({style:r,ref:this.setTarget,className:t},i),n(R({},this.state,{ref:this.target,resize:this.resize})))},r}(a.Component);F(T,"propTypes",{className:l().string,debounceTime:l().number,children:l().func.isRequired}),F(T,"defaultProps",{debounceTime:300,parentSizeStyles:{width:"100%",height:"100%"}});var _,D=n(80621),M=n(84785),E=n(2275),I=n(23493),O=n.n(I);const P=D.Mu+1,N=D.Mu+3,j=D.Mu+4,q=D.Mu+5,z={[p.U0]:{[p.yR]:D.Mu,[p.BG]:D.Mu},[p.BG]:{[p.dW]:P,[p.xh]:P,[p.BA]:P,[p.hE]:P,[p.Nc]:P,[p.Os]:P,[p.yR]:P},[p.Os]:{[p.dW]:j,[p.xh]:j,[p.BA]:j},[p.yR]:{[p.gn]:N},[p.gn]:{[p.dW]:q,[p.xh]:q,[p.BA]:N,[p.hE]:q,[p.Nc]:q,[p.Os]:N,[p.yR]:N},[p.BA]:{[p.dW]:q,[p.Nc]:q,[p.xh]:q,[p.Os]:N,[p.hE]:N,[p.yR]:N},[p.dW]:{},[p.hE]:{},[p.Nc]:{},[p.xh]:{}};function A(e){const{parentType:t,childType:n,parentDepth:r}=e;if(!t||!n||"number"!=typeof r)return!1;const i=(z[t]||{})[n];return"number"==typeof i&&r<=i}const $="DROP_TOP",U="DROP_RIGHT",L="DROP_BOTTOM",V="DROP_LEFT";let K,B={};function W(e,t){const{depth:n,parentComponent:r,component:i,orientation:o,isDraggingOverShallow:a}=t.props,s=e.getItem();if(!s||s.id===i.id)return null;if(s.type===p.yR&&i.type===p.gn&&2===n)return null;const l=A({parentType:i.type,parentDepth:n,childType:s.type}),d=r&&r.type,c=A({parentType:d,parentDepth:n+(d===p.gn||d===p.yR?0:-1),childType:s.type});if(!l&&!c)return null;const u=(i.children||[]).length>0,h="row"===o?"vertical":"horizontal",f="row"===o?"horizontal":"vertical";if(a&&l&&!c)return"vertical"===h?u?U:V:u?L:$;const m=t.ref.getBoundingClientRect(),g=e.getClientOffset()||B[i.id];if(!g||!m)return null;B[i.id]=g;const v=Math.abs(g.y-m.top),b=Math.abs(g.y-m.bottom),y=Math.abs(g.x-m.left),C=Math.abs(g.x-m.right);if(!a&&[v,b,y,C].every((e=>e>20)))return null;if(c&&!l){if("vertical"===f){const e=m.left+(m.right-m.left)/2;return g.x<e?V:U}const e=m.top+(m.bottom-m.top)/2;return g.y<e?$:L}if(c&&l){if("vertical"===f){if(y<20)return V;if(C<20)return U}else{if(v<20)return $;if(b<20)return L}return"vertical"===h?u?U:V:u?L:$}return null}const H=O()((function(e,t,n){var r,i;if(!n.mounted)return;const o=W(t,n);!function(e){const t="SCROLL_TOP"===e&&!K&&0!==document.documentElement.scrollTop,n=K&&("SCROLL_TOP"!==e||0===document.documentElement.scrollTop);t?K=setInterval((()=>{if(0===document.documentElement.scrollTop)return clearInterval(K),void(K=null);let e=document.documentElement.scrollTop-120;e<0&&(e=0),window.scroll({top:e,behavior:"smooth"})}),50):n&&(clearInterval(K),K=null)}((null==n||null==(r=n.props)||null==(i=r.component)?void 0:i.type)===p.U0?"SCROLL_TOP":null),o?n.setState((()=>({dropIndicator:o}))):n.setState((()=>({dropIndicator:null})))}),100);const G="DRAG_DROPPABLE",Q=[G,{canDrag:e=>!e.disableDragDrop,beginDrag(e){const{component:t,index:n,parentComponent:r={}}=e;return{type:t.type,id:t.id,meta:t.meta,index:n,parentId:r.id,parentType:r.type}}},function(e,t){return{dragSourceRef:e.dragSource(),dragPreviewRef:e.dragPreview(),isDragging:t.isDragging()}}],J=[G,{canDrop:e=>!e.disableDragDrop,hover(e,t,n){n&&n.mounted&&H(e,t,n)},drop(e,t,n){const r=t.getDropResult();if((!r||!r.destination)&&n.mounted)return function(e,t,n){if(!n.mounted)return;n.setState((()=>({dropIndicator:null})));const r=W(t,n);if(!r)return;const{parentComponent:i,component:o,index:a,onDrop:s,orientation:l}=n.props,d=t.getItem(),c="row"===l&&(r===$||r===L)||"column"===l&&(r===V||r===U)?"sibling":"child",u={source:{id:d.parentId,type:d.parentType,index:d.index},dragging:{id:d.id,type:d.type,meta:d.meta}};if("child"===c)u.destination={id:o.id,type:o.type,index:o.children.length};else{let e=i&&d.parentId===i.id&&d.index<a?a-1:a;r!==L&&r!==U||(e+=1),u.destination={id:i.id,type:i.type,index:e}}return s(u),B={},u}(0,t,n)}},function(e,t){return{droppableRef:e.dropTarget(),isDraggingOver:t.isOver(),isDraggingOverShallow:t.isOver({shallow:!0})}}],Y={children:l().func,className:l().string,component:E.cP.isRequired,parentComponent:E.cP,depth:l().number.isRequired,disableDragDrop:l().bool,orientation:l().oneOf(["row","column"]),index:l().number.isRequired,style:l().object,onDrop:l().func,editMode:l().bool.isRequired,useEmptyDragPreview:l().bool,isDragging:l().bool.isRequired,isDraggingOver:l().bool.isRequired,isDraggingOverShallow:l().bool.isRequired,droppableRef:l().func.isRequired,dragSourceRef:l().func.isRequired,dragPreviewRef:l().func.isRequired},X={className:null,style:null,parentComponent:null,disableDragDrop:!1,children(){},onDrop(){},orientation:"row",useEmptyDragPreview:!1};class ee extends a.PureComponent{constructor(e){super(e),this.state={dropIndicator:null},this.setRef=this.setRef.bind(this)}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}setRef(e){this.ref=e,this.props.useEmptyDragPreview?this.props.dragPreviewRef((_||((_=new Image).src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),_),{captureDraggingState:!0}):this.props.dragPreviewRef(e),this.props.droppableRef(e)}render(){const{children:e,className:t,orientation:n,dragSourceRef:r,disableDragDrop:i,isDragging:o,isDraggingOver:a,style:s,editMode:l}=this.props,{dropIndicator:d}=this.state,c=a&&d&&!i?{className:g()("drop-indicator",d===$&&"drop-indicator--top",d===L&&"drop-indicator--bottom",d===V&&"drop-indicator--left",d===U&&"drop-indicator--right")}:null,u=l?{dragSourceRef:r,dropIndicatorProps:c}:{};return(0,b.tZ)("div",{style:s,ref:this.setRef,className:g()("dragdroppable","row"===n&&"dragdroppable-row","column"===n&&"dragdroppable-column",o&&"dragdroppable--dragging",t)},e(u))}}ee.propTypes=Y,ee.defaultProps=X;const te=(0,M.DragSource)(...Q)((0,M.DropTarget)(...J)(ee)),ne={id:l().string.isRequired,type:l().string.isRequired,label:l().string.isRequired,className:l().string};class re extends a.PureComponent{render(){const{label:e,id:t,type:n,className:r}=this.props;return(0,b.tZ)(te,{component:{type:n,id:t},parentComponent:{id:D.D0,type:p.F0},index:0,depth:0,editMode:!0},(({dragSourceRef:t})=>(0,b.tZ)("div",{ref:t,className:"new-component"},(0,b.tZ)("div",{className:g()("new-component-placeholder",r)}),e)))}}function ie(){return(0,b.tZ)(re,{id:D.Nb,type:p.BA,label:(0,d.t)("Column"),className:"fa fa-long-arrow-down"})}function oe(){return(0,b.tZ)(re,{id:D.ES,type:p.hE,label:(0,d.t)("Divider"),className:"divider-placeholder"})}function ae(){return(0,b.tZ)(re,{id:D.Z1,type:p.Nc,label:(0,d.t)("Header"),className:"fa fa-header"})}function se(){return(0,b.tZ)(re,{id:D.vD,type:p.Os,label:(0,d.t)("Row"),className:"fa fa-long-arrow-right"})}function le(){return(0,b.tZ)(re,{id:D.NN,type:p.yR,label:(0,d.t)("Tabs"),className:"fa fa-window-restore"})}function de(){return(0,b.tZ)(re,{id:D.C3,type:p.xh,label:"Markdown",className:"fa fa-code"})}re.propTypes=ne,re.defaultProps={className:null};var ce=n(68969),ue=n(88239),he=n(8177),pe=n.n(he),fe=n(85105),me=n.n(fe),ge=n(99663),ve=n(46058),be=n(49135),ye=n(93196),Ce=n(75621),Se=n(94396),xe=function(e){function t(){var e,n,r,i;(0,ge.default)(this,t);for(var o=arguments.length,a=Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=r=(0,be.default)(this,(e=t.__proto__||me()(t)).call.apply(e,[this].concat(a))),r._cellRenderer=function(e){var t=e.parent,n=e.rowIndex,i=e.style,o=e.isScrolling,a=e.isVisible,s=e.key,l=r.props.rowRenderer;return pe()(i,"width").writable&&(i.width="100%"),l({index:n,style:i,isScrolling:o,isVisible:a,key:s,parent:t})},r._setRef=function(e){r.Grid=e},r._onScroll=function(e){var t=e.clientHeight,n=e.scrollHeight,i=e.scrollTop;(0,r.props.onScroll)({clientHeight:t,scrollHeight:n,scrollTop:i})},r._onSectionRendered=function(e){var t=e.rowOverscanStartIndex,n=e.rowOverscanStopIndex,i=e.rowStartIndex,o=e.rowStopIndex;(0,r.props.onRowsRendered)({overscanStartIndex:t,overscanStopIndex:n,startIndex:i,stopIndex:o})},i=n,(0,be.default)(r,i)}return(0,ye.default)(t,e),(0,ve.default)(t,[{key:"forceUpdateGrid",value:function(){this.Grid&&this.Grid.forceUpdate()}},{key:"getOffsetForRow",value:function(e){var t=e.alignment,n=e.index;return this.Grid?this.Grid.getOffsetForCell({alignment:t,rowIndex:n,columnIndex:0}).scrollTop:0}},{key:"invalidateCellSizeAfterRender",value:function(e){var t=e.columnIndex,n=e.rowIndex;this.Grid&&this.Grid.invalidateCellSizeAfterRender({rowIndex:n,columnIndex:t})}},{key:"measureAllRows",value:function(){this.Grid&&this.Grid.measureAllCells()}},{key:"recomputeGridSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.columnIndex,n=void 0===t?0:t,r=e.rowIndex,i=void 0===r?0:r;this.Grid&&this.Grid.recomputeGridSize({rowIndex:i,columnIndex:n})}},{key:"recomputeRowHeights",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.recomputeGridSize({rowIndex:e,columnIndex:0})}},{key:"scrollToPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.scrollToPosition({scrollTop:e})}},{key:"scrollToRow",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.scrollToCell({columnIndex:0,rowIndex:e})}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.noRowsRenderer,r=e.scrollToIndex,i=e.width,o=g()("ReactVirtualized__List",t);return a.createElement(Ce.Z,(0,ue.default)({},this.props,{autoContainerWidth:!0,cellRenderer:this._cellRenderer,className:o,columnWidth:i,columnCount:1,noContentRenderer:n,onScroll:this._onScroll,onSectionRendered:this._onSectionRendered,ref:this._setRef,scrollToRow:r}))}}]),t}(a.PureComponent);xe.defaultProps={autoHeight:!1,estimatedRowSize:30,onScroll:function(){},noRowsRenderer:function(){return null},onRowsRendered:function(){},overscanIndicesGetter:Se.ZP,overscanRowCount:10,scrollToAlignment:"auto",scrollToIndex:-1,style:{}},xe.propTypes=null;const ke=xe;var we=n(24903),Re=n(82191),Ze=n(4715),Fe=n(69856);const Te={datasourceUrl:l().string,datasourceName:l().string,innerRef:l().func,isSelected:l().bool,lastModified:l().string,sliceName:l().string.isRequired,style:l().object,visType:l().string.isRequired},_e=v.iK.div`
  ${({theme:e})=>`\n    .chart-card {\n      border: 1px solid ${e.colors.grayscale.light2};\n      border-radius: ${e.gridUnit}px;\n      background: ${e.colors.grayscale.light5};\n      font-weight: ${e.typography.weights.light};\n      padding: ${2*e.gridUnit}px;\n      margin: 0 ${3*e.gridUnit}px\n        ${3*e.gridUnit}px\n        ${3*e.gridUnit}px;\n      position: relative;\n      cursor: move;\n      white-space: nowrap;\n      overflow: hidden;\n\n      &:hover {\n        background: ${e.colors.grayscale.light4};\n      }\n    }\n\n    .chart-card.is-selected {\n      cursor: not-allowed;\n      opacity: 0.4;\n    }\n\n    .card-title {\n      margin-right: 60px;\n      margin-bottom: ${2*e.gridUnit}px;\n      font-weight: ${e.typography.weights.bold};\n    }\n\n    .card-body {\n      display: flex;\n      flex-direction: column;\n\n      .item {\n        span {\n          word-break: break-all;\n\n          &:first-child {\n            font-weight: ${e.typography.weights.normal};\n          }\n        }\n      }\n    }\n\n    .is-added-label {\n      background: ${e.colors.grayscale.base};\n      border-radius: ${e.gridUnit}px;\n      color: ${e.colors.grayscale.light5};\n      font-size: ${e.typography.sizes.s}px;\n      text-transform: uppercase;\n      position: absolute;\n      padding: ${e.gridUnit}px\n        ${2*e.gridUnit}px;\n      top: ${8*e.gridUnit}px;\n      right: ${8*e.gridUnit}px;\n      pointer-events: none;\n    }\n  `}
`;function De({datasourceUrl:e,datasourceName:t,innerRef:n,isSelected:r,lastModified:i,sliceName:o,style:a,visType:s}){return(0,b.tZ)(_e,{ref:n,style:a},(0,b.tZ)("div",{className:g()("chart-card",r&&"is-selected")},(0,b.tZ)("div",{className:"card-title"},o),(0,b.tZ)("div",{className:"card-body"},(0,b.tZ)("div",{className:"item"},(0,b.tZ)("span",null,(0,d.t)("Modified")," "),(0,b.tZ)("span",null,i)),(0,b.tZ)("div",{className:"item"},(0,b.tZ)("span",null,(0,d.t)("Visualization")," "),(0,b.tZ)("span",null,s)),(0,b.tZ)("div",{className:"item"},(0,b.tZ)("span",null,(0,d.t)("Data source")," "),(0,b.tZ)("a",{href:e},t)))),r&&(0,b.tZ)("div",{className:"is-added-label"},(0,d.t)("Added")))}De.propTypes=Te,De.defaultProps={datasourceUrl:null,datasourceName:"-",innerRef:null,isSelected:!1,style:null,lastModified:null};const Me=De,Ee={position:"fixed",pointerEvents:"none",top:0,left:0,zIndex:101,width:344},Ie={dragItem:l().shape({index:l().number.isRequired}),slices:l().arrayOf(E.Rw),isDragging:l().bool.isRequired,currentOffset:l().shape({x:l().number.isRequired,y:l().number.isRequired})};function Oe({dragItem:e,slices:t,isDragging:n,currentOffset:r}){if(!(n&&r&&e&&t))return null;const i=t[e.index];return i&&e.parentType===p.F0&&e.type===p.dW?(0,b.tZ)(Me,{style:{...Ee,transform:`translate(${r.x}px, ${r.y}px)`},sliceName:i.slice_name,lastModified:i.changed_on_humanized,visType:i.viz_type,datasourceUrl:i.datasource_url,datasourceName:i.datasource_name}):null}Oe.propTypes=Ie,Oe.defaultProps={currentOffset:null,dragItem:null,slices:null};const Pe=(0,M.DragLayer)((e=>({dragItem:e.getItem(),currentOffset:e.getSourceClientOffset(),isDragging:e.isDragging()})))(Oe),Ne={fetchAllSlices:l().func.isRequired,isLoading:l().bool.isRequired,slices:l().objectOf(E.Rw).isRequired,lastUpdated:l().number.isRequired,errorMessage:l().string,userId:l().string.isRequired,selectedSliceIds:l().arrayOf(l().number),editMode:l().bool,height:l().number,filterboxMigrationState:Fe.Qi},je={selectedSliceIds:[],editMode:!1,errorMessage:"",height:window.innerHeight,filterboxMigrationState:Fe.Qi.NOOP},qe=["slice_name","viz_type","datasource_name"],ze={slice_name:"name",viz_type:"viz type",datasource_name:"dataset",changed_on:"recent"},Ae=v.iK.div`
  display: flex;
  flex-direction: row;
  padding: ${({theme:e})=>3*e.gridUnit}px;
`,$e=(0,v.iK)(Ze.P)`
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
  min-width: 150px;
`;class Ue extends a.Component{static sortByComparator(e){const t="changed_on"===e?-1:1;return(n,r)=>n[e]<r[e]?-1*t:n[e]>r[e]?1*t:0}constructor(e){super(e),this.state={filteredSlices:[],searchTerm:"",sortBy:"changed_on",selectedSliceIdsSet:new Set(e.selectedSliceIds)},this.rowRenderer=this.rowRenderer.bind(this),this.searchUpdated=this.searchUpdated.bind(this),this.handleKeyPress=this.handleKeyPress.bind(this),this.handleChange=this.handleChange.bind(this),this.handleSelect=this.handleSelect.bind(this)}componentDidMount(){const{userId:e,filterboxMigrationState:t}=this.props;this.slicesRequest=this.props.fetchAllSlices(e,(0,c.c)(c.T.ENABLE_FILTER_BOX_MIGRATION)&&t!==Fe.Qi.SNOOZED)}UNSAFE_componentWillReceiveProps(e){const t={};e.lastUpdated!==this.props.lastUpdated&&(t.filteredSlices=Object.values(e.slices).filter((0,we.cj)(this.state.searchTerm,qe)).sort(Ue.sortByComparator(this.state.sortBy))),e.selectedSliceIds!==this.props.selectedSliceIds&&(t.selectedSliceIdsSet=new Set(e.selectedSliceIds)),Object.keys(t).length&&this.setState(t)}componentWillUnmount(){this.slicesRequest&&this.slicesRequest.abort&&this.slicesRequest.abort()}getFilteredSortedSlices(e,t){return Object.values(this.props.slices).filter((0,we.cj)(e,qe)).sort(Ue.sortByComparator(t))}handleKeyPress(e){"Enter"===e.key&&(e.preventDefault(),this.searchUpdated(e.target.value))}handleChange(e){this.searchUpdated(e.target.value)}searchUpdated(e){this.setState((t=>({searchTerm:e,filteredSlices:this.getFilteredSortedSlices(e,t.sortBy)})))}handleSelect(e){this.setState((t=>({sortBy:e,filteredSlices:this.getFilteredSortedSlices(t.searchTerm,e)})))}rowRenderer({key:e,index:t,style:n}){const{filteredSlices:r,selectedSliceIdsSet:i}=this.state,o=r[t],a=i.has(o.slice_id),s=p.dW,l=D.Jd,d={chartId:o.slice_id,sliceName:o.slice_name};return(0,b.tZ)(te,{key:e,component:{type:s,id:l,meta:d},parentComponent:{id:D.D0,type:p.F0},index:t,depth:0,disableDragDrop:a,editMode:this.props.editMode,useEmptyDragPreview:!0,style:{}},(({dragSourceRef:e})=>(0,b.tZ)(Me,{innerRef:e,style:n,sliceName:o.slice_name,lastModified:o.changed_on_humanized,visType:o.viz_type,datasourceUrl:o.datasource_url,datasourceName:o.datasource_name,isSelected:a})))}render(){const e=this.props.height-30-64-16;return(0,b.tZ)("div",{className:"slice-adder-container"},(0,b.tZ)(Ae,null,(0,b.tZ)(Re.II,{placeholder:(0,d.t)("Filter your charts"),className:"search-input",onChange:this.handleChange,onKeyPress:this.handleKeyPress}),(0,b.tZ)($e,{id:"slice-adder-sortby",value:this.state.sortBy,onChange:this.handleSelect,options:Object.entries(ze).map((([e,t])=>({label:(0,d.t)("Sort by %s",t),value:e}))),placeholder:(0,d.t)("Sort by")})),this.props.isLoading&&(0,b.tZ)(h.Z,null),!this.props.isLoading&&this.state.filteredSlices.length>0&&(0,b.tZ)(ke,{width:376,height:e,rowCount:this.state.filteredSlices.length,rowHeight:112,rowRenderer:this.rowRenderer,searchTerm:this.state.searchTerm,sortBy:this.state.sortBy,selectedSliceIds:this.props.selectedSliceIds}),this.props.errorMessage&&(0,b.tZ)("div",{className:"error-message"},this.props.errorMessage),(0,b.tZ)(Pe,{slices:this.state.filteredSlices}))}}Ue.propTypes=Ne,Ue.defaultProps=je;const Le=Ue,Ve=(0,o.$j)((function({sliceEntities:e,dashboardInfo:t,dashboardState:n},r){return{height:r.height,userId:t.userId,selectedSliceIds:n.sliceIds,slices:e.slices,isLoading:e.isLoading,errorMessage:e.errorMessage,lastUpdated:e.lastUpdated,editMode:n.editMode,filterboxMigrationState:n.filterboxMigrationState}}),(function(e){return(0,i.DE)({fetchAllSlices:ce.To},e)}))(Le),Ke=(0,v.iK)(C.ZP)`
  line-height: inherit;
  margin-top: ${({theme:e})=>2*e.gridUnit}px;
`,Be=v.iK.div`
  height: 100%;
  position: fixed;
  right: 0;
  top: 0;

  .ReactVirtualized__List {
    padding-bottom: ${({topOffset:e})=>`${124+e}px`};
  }
`,We=({isStandalone:e,topOffset:t=0})=>(0,b.tZ)(Be,{topOffset:t,className:"dashboard-builder-sidepane"},(0,b.tZ)(T,null,(({height:n})=>(0,b.tZ)(S.L9,null,(0,b.tZ)(S.Le,{topOffset:-t,bottomOffset:1/0},(({style:r,isSticky:i})=>{const{pageYOffset:o}=window,a=o<59&&!e,s=t+(59-o-4);return(0,b.tZ)("div",{className:"viewport",style:{...r,top:a?s:t}},(0,b.tZ)(Ke,{id:"tabs",className:"tabs-components"},(0,b.tZ)(C.ZP.TabPane,{key:1,tab:(0,d.t)("Components")},(0,b.tZ)(le,null),(0,b.tZ)(se,null),(0,b.tZ)(ie,null),(0,b.tZ)(ae,null),(0,b.tZ)(de,null),(0,b.tZ)(oe,null)),(0,b.tZ)(C.ZP.TabPane,{key:2,tab:(0,d.t)("Charts"),className:"tab-charts"},(0,b.tZ)(Ve,{height:n+(i?59:0)}))))}))))));var He=n(74599),Ge=n(39969),Qe=n.n(Ge),Je=n(30381),Ye=n.n(Je),Xe=n(37488),et=n(83268),tt=n(3741),nt=n(91877),rt=n(38097),it=n(35932),ot=n(38270),at=n(36674),st=n(9679),lt=(n(15306),n(31069)),dt=n(27600),ct=n(5872),ut=n.n(ct),ht=n(87189),pt=n(10222);const ft=e=>{const{url:t,copyMenuItemTitle:n,emailMenuItemTitle:r,emailSubject:i,emailBody:o,addDangerToast:s,addSuccessToast:l,...c}=e,u=(0,ht.n)(t);return(0,b.tZ)(a.Fragment,null,(0,b.tZ)(Re.v2.Item,ut()({key:"copy-url"},c),(0,b.tZ)("div",{onClick:async function(){try{const e=await u();await(0,pt.Z)(e),l((0,d.t)("Copied to clipboard!"))}catch(e){s((0,d.t)("Sorry, your browser does not support copying."))}},role:"button",tabIndex:0},n)),(0,b.tZ)(Re.v2.Item,ut()({key:"share-by-email"},c),(0,b.tZ)("div",{onClick:async function(){try{const e=await u(),t=`${o}${e}`;window.location.href=`mailto:?Subject=${i}%20&Body=${t}`}catch(e){s((0,d.t)("Sorry, something went wrong. Try again later."))}},role:"button",tabIndex:0},r)))};var mt=n(68073),gt=n(94670);const vt=v.iK.div`
  ${({theme:e})=>`\n    .css-editor-header {\n      display: flex;\n      flex-direction: row;\n      justify-content: space-between;\n      margin-bottom: ${2*e.gridUnit}px;\n\n      h5 {\n        margin-top: ${e.gridUnit}px;\n      }\n    }\n    .css-editor {\n      border: 1px solid ${e.colors.grayscale.light1};\n    }\n  `}
`,bt={initialCss:l().string,triggerNode:l().node.isRequired,onChange:l().func,templates:l().array};class yt extends a.PureComponent{constructor(e){super(e),this.state={css:e.initialCss},this.changeCss=this.changeCss.bind(this),this.changeCssTemplate=this.changeCssTemplate.bind(this)}componentDidMount(){gt.ry.preload()}changeCss(e){this.setState({css:e},(()=>{this.props.onChange(e)}))}changeCssTemplate({key:e}){this.changeCss(e)}renderTemplateSelector(){if(this.props.templates){const e=(0,b.tZ)(Re.v2,{onClick:this.changeCssTemplate},this.props.templates.map((e=>(0,b.tZ)(Re.v2.Item,{key:e.css},e.label))));return(0,b.tZ)(Re.Lt,{overlay:e,placement:"bottomRight"},(0,b.tZ)(it.Z,null,(0,d.t)("Load a CSS template")))}return null}render(){return(0,b.tZ)(mt.Z,{triggerNode:this.props.triggerNode,modalTitle:(0,d.t)("CSS"),modalBody:(0,b.tZ)(vt,null,(0,b.tZ)("div",{className:"css-editor-header"},(0,b.tZ)("h5",null,(0,d.t)("Live CSS editor")),this.renderTemplateSelector()),(0,b.tZ)(gt.ry,{className:"css-editor",minLines:12,maxLines:30,onChange:this.changeCss,height:"200px",width:"100%",editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,value:this.state.css||""}))})}}yt.propTypes=bt,yt.defaultProps={initialCss:"",onChange:()=>{}};const Ct=yt;var St=n(81315),xt=n(29487),kt=n(49238);const wt=[[0,(0,d.t)("Don't refresh")],[10,(0,d.t)("10 seconds")],[30,(0,d.t)("30 seconds")],[60,(0,d.t)("1 minute")],[300,(0,d.t)("5 minutes")],[1800,(0,d.t)("30 minutes")],[3600,(0,d.t)("1 hour")],[21600,(0,d.t)("6 hours")],[43200,(0,d.t)("12 hours")],[86400,(0,d.t)("24 hours")]].map((e=>({value:e[0],label:e[1]}))),Rt=(0,v.iK)(mt.Z)`
  .ant-modal-body {
    overflow: visible;
  }
`,Zt=v.iK.div`
  margin-top: ${({theme:e})=>6*e.gridUnit}px;
`;class Ft extends a.PureComponent{constructor(e){super(e),this.modalRef=void 0,this.modalRef=a.createRef(),this.state={refreshFrequency:e.refreshFrequency},this.handleFrequencyChange=this.handleFrequencyChange.bind(this),this.onSave=this.onSave.bind(this),this.onCancel=this.onCancel.bind(this)}onSave(){var e;this.props.onChange(this.state.refreshFrequency,this.props.editMode),null==(e=this.modalRef.current)||e.close()}onCancel(){var e;this.setState({refreshFrequency:this.props.refreshFrequency}),null==(e=this.modalRef.current)||e.close()}handleFrequencyChange(e){this.setState({refreshFrequency:e||wt[0].value})}render(){const{refreshLimit:e=0,refreshWarning:t,editMode:n}=this.props,{refreshFrequency:r=0}=this.state,i=!!r&&!!t&&r<e;return(0,b.tZ)(Rt,{ref:this.modalRef,triggerNode:this.props.triggerNode,modalTitle:(0,d.t)("Refresh interval"),modalBody:(0,b.tZ)("div",null,(0,b.tZ)(kt.lX,null,(0,d.t)("Refresh frequency")),(0,b.tZ)(St.Z,{ariaLabel:(0,d.t)("Refresh interval"),options:wt,value:r,onChange:this.handleFrequencyChange,sortComparator:(0,St.m)("value")}),i&&(0,b.tZ)(Zt,null,(0,b.tZ)(xt.Z,{type:"warning",message:(0,b.tZ)(a.Fragment,null,(0,b.tZ)("div",null,t),(0,b.tZ)("br",null),(0,b.tZ)("strong",null,(0,d.t)("Are you sure you want to proceed?")))}))),modalFooter:(0,b.tZ)(a.Fragment,null,(0,b.tZ)(it.Z,{buttonStyle:"primary",buttonSize:"small",onClick:this.onSave},n?(0,d.t)("Save"):(0,d.t)("Save for this session")),(0,b.tZ)(it.Z,{onClick:this.onCancel,buttonSize:"small"},(0,d.t)("Cancel")))})}}Ft.defaultProps={refreshLimit:0,refreshWarning:null};const Tt=Ft;var _t=n(87183),Dt=n(87253);const Mt={saveType:D.TN,colorNamespace:void 0,colorScheme:void 0,shouldPersistRefreshFrequency:!1};class Et extends a.PureComponent{constructor(e){super(e),this.modal=void 0,this.onSave=void 0,this.state={saveType:e.saveType,newDashName:`${e.dashboardTitle} [copy]`,duplicateSlices:!1},this.modal=null,this.handleSaveTypeChange=this.handleSaveTypeChange.bind(this),this.handleNameChange=this.handleNameChange.bind(this),this.saveDashboard=this.saveDashboard.bind(this),this.setModalRef=this.setModalRef.bind(this),this.toggleDuplicateSlices=this.toggleDuplicateSlices.bind(this),this.onSave=this.props.onSave.bind(this)}setModalRef(e){this.modal=e}toggleDuplicateSlices(){this.setState((e=>({duplicateSlices:!e.duplicateSlices})))}handleSaveTypeChange(e){this.setState({saveType:e.target.value})}handleNameChange(e){this.setState({newDashName:e,saveType:D.kS})}saveDashboard(){var e,t;const{saveType:n,newDashName:r}=this.state,{dashboardTitle:i,dashboardInfo:o,layout:a,customCss:s,colorNamespace:l,colorScheme:c,expandedSlices:u,dashboardId:h,refreshFrequency:p,shouldPersistRefreshFrequency:f,lastModifiedTime:m}=this.props,g=c&&null!=o&&null!=(e=o.metadata)&&e.label_colors?o.metadata.label_colors:{},v=f?p:null==(t=o.metadata)?void 0:t.refresh_frequency,b={positions:a,css:s,color_namespace:l,color_scheme:c,label_colors:g,expanded_slices:u,dashboard_title:n===D.kS?r:i,duplicate_slices:this.state.duplicateSlices,refresh_frequency:v,last_modified_time:m};var y;n!==D.kS||r?(this.onSave(b,h,n).then((e=>{n===D.kS&&e&&e.json&&e.json.id&&(window.location.href=`/superset/dashboard/${e.json.id}/`)})),null==(y=this.modal)||y.close()):this.props.addDangerToast((0,d.t)("You must pick a name for the new dashboard"))}render(){return(0,b.tZ)(mt.Z,{ref:this.setModalRef,triggerNode:this.props.triggerNode,modalTitle:(0,d.t)("Save dashboard"),modalBody:(0,b.tZ)("div",null,(0,b.tZ)(_t.Y,{value:D.TN,onChange:this.handleSaveTypeChange,checked:this.state.saveType===D.TN,disabled:!this.props.canOverwrite},(0,d.t)("Overwrite Dashboard [%s]",this.props.dashboardTitle)),(0,b.tZ)("hr",null),(0,b.tZ)(_t.Y,{value:D.kS,onChange:this.handleSaveTypeChange,checked:this.state.saveType===D.kS},(0,d.t)("Save as:")),(0,b.tZ)(Re.II,{type:"text",placeholder:(0,d.t)("[dashboard name]"),value:this.state.newDashName,onFocus:e=>this.handleNameChange(e.target.value),onChange:e=>this.handleNameChange(e.target.value)}),(0,b.tZ)("div",{className:"m-l-25 m-t-5"},(0,b.tZ)(Dt.ZP,{checked:this.state.duplicateSlices,onChange:()=>this.toggleDuplicateSlices()}),(0,b.tZ)("span",{className:"m-l-5"},(0,d.t)("also copy (duplicate) charts")))),modalFooter:(0,b.tZ)("div",null,(0,b.tZ)(it.Z,{buttonStyle:"primary",onClick:this.saveDashboard},(0,d.t)("Save")))})}}Et.defaultProps=Mt;const It=Et;var Ot=n(14505),Pt=n(81395),Nt=n(31758),jt=n(41609),qt=n.n(jt);const zt=[p.gn,p.U0];function At({currentNode:e={},components:t={},filterFields:n=[],selectedChartId:r}){if(!e)return null;const{type:i}=e;if(p.dW===i&&e&&e.meta&&e.meta.chartId){const t={value:e.meta.chartId,label:e.meta.sliceName||`${i} ${e.meta.chartId}`,type:i,showCheckbox:r!==e.meta.chartId};return{...t,children:n.map((n=>({value:`${e.meta.chartId}:${n}`,label:`${t.label}`,type:"filter_box",showCheckbox:!1})))}}let o=[];if(e.children&&e.children.length&&e.children.forEach((e=>{const i=At({currentNode:t[e],components:t,filterFields:n,selectedChartId:r}),a=t[e].type;zt.includes(a)?o.push(i):o=o.concat(i)})),zt.includes(i)){let t=null;return t=i===p.U0?(0,d.t)("All charts"):e.meta&&e.meta.text?e.meta.text:`${i} ${e.id}`,{value:e.id,label:t,type:i,children:o}}return o}function $t({components:e={},filterFields:t=[],selectedChartId:n}){return qt()(e)?[]:[{...At({currentNode:e[D._4],components:e,filterFields:t,selectedChartId:n})}]}function Ut(e=[],t=-1){const n=[],r=(e,i)=>{e&&e.children&&(-1===t||i<t)&&(n.push(e.value),e.children.forEach((e=>r(e,i+1))))};return e.length>0&&e.forEach((e=>{r(e,0)})),n}function Lt({activeFilterField:e,checkedFilterFields:t}){return(0,st.o)(e?[e]:t)}var Vt=n(20194);function Kt({activeFilterField:e,checkedFilterFields:t}){if(e)return(0,Vt._)(e).chartId;if(t.length){const{chartId:e}=(0,Vt._)(t[0]);return t.some((t=>(0,Vt._)(t).chartId!==e))?null:e}return null}function Bt({checkedFilterFields:e=[],activeFilterField:t,filterScopeMap:n={},layout:r={}}){const i=Lt({checkedFilterFields:e,activeFilterField:t}),o=t?[t]:e,a=$t({components:r,filterFields:o,selectedChartId:Kt({checkedFilterFields:e,activeFilterField:t})}),s=new Set;o.forEach((e=>{(n[e].checked||[]).forEach((t=>{s.add(`${t}:${e}`)}))}));const l=[...s],d=n[i]?n[i].expanded:Ut(a,1);return{[i]:{nodes:a,nodesFiltered:[...a],checked:l,expanded:d}}}var Wt=n(94654),Ht=n.n(Wt),Gt=n(83927),Qt=n.n(Gt),Jt=n(58809),Yt=n.n(Jt),Xt=n(8816),en=n.n(Xt);function tn({tabScopes:e,parentNodeValue:t,forceAggregate:n=!1,hasChartSiblings:r=!1,tabChildren:i=[],immuneChartSiblings:o=[]}){if(n||!r&&Object.entries(e).every((([e,{scope:t}])=>t&&t.length&&e===t[0]))){const n=function({tabs:e=[],tabsInScope:t=[]}){const n=[];return e.forEach((({value:e,children:r})=>{r&&!t.includes(e)&&r.forEach((({value:e,children:r})=>{r&&!t.includes(e)&&n.push(...r.filter((({type:e})=>e===p.dW)))}))})),n.map((({value:e})=>e))}({tabs:i,tabsInScope:Ht()(e,(({scope:e})=>e))}),r=Ht()(Object.values(e),(({immune:e})=>e));return{scope:[t],immune:[...new Set([...n,...r])]}}const a=Object.values(e).filter((({scope:e})=>e&&e.length));return{scope:Ht()(a,(({scope:e})=>e)),immune:a.length?Ht()(a,(({immune:e})=>e)):Ht()(Object.values(e),(({immune:e})=>e)).concat(o)}}function nn({currentNode:e={},filterId:t,checkedChartIds:n=[]}){if(!e)return{};const{value:r,children:i}=e,o=i.filter((({type:e})=>e===p.dW)),a=i.filter((({type:e})=>e===p.gn)),s=o.filter((({value:e})=>t!==e&&!n.includes(e))).map((({value:e})=>e)),l=en()(Yt()((e=>e.value)),Qt()((e=>nn({currentNode:e,filterId:t,checkedChartIds:n}))))(a);if(!qt()(o)&&o.some((({value:e})=>n.includes(e)))){if(qt()(a))return{scope:[r],immune:s};const{scope:e,immune:t}=tn({tabScopes:l,parentNodeValue:r,forceAggregate:!0,tabChildren:a});return{scope:e,immune:s.concat(t)}}return a.length?tn({tabScopes:l,parentNodeValue:r,hasChartSiblings:!qt()(o),tabChildren:a,immuneChartSiblings:s}):{scope:[],immune:s}}function rn({filterKey:e,nodes:t=[],checkedChartIds:n=[]}){if(t.length){const{chartId:r}=(0,Vt._)(e);return nn({currentNode:t[0],filterId:r,checkedChartIds:n})}return{}}var on=n(43399),an=n(28388),sn=n.n(an);const ln=(0,v.iK)(rt.Z.BarChartOutlined)`
  ${({theme:e})=>`\n    position: relative;\n    top: ${e.gridUnit-1}px;\n    color: ${e.colors.primary.base};\n    margin-right: ${2*e.gridUnit}px;\n  `}
`;function dn({currentNode:e={},selectedChartId:t}){if(!e)return null;const{label:n,value:r,type:i,children:o}=e;if(o&&o.length){const a=o.map((e=>dn({currentNode:e,selectedChartId:t})));return{...e,label:(0,b.tZ)("span",{className:g()(`filter-scope-type ${i.toLowerCase()}`,{"selected-filter":t===r})},i===p.dW&&(0,b.tZ)(ln,null),n),children:a}}return{...e,label:(0,b.tZ)("span",{className:g()(`filter-scope-type ${i.toLowerCase()}`,{"selected-filter":t===r})},n)}}function cn({nodes:e,selectedChartId:t}){return e?e.map((e=>dn({currentNode:e,selectedChartId:t}))):[]}var un=n(13842);const hn={check:(0,b.tZ)(un.lU,null),uncheck:(0,b.tZ)(un.zq,null),halfCheck:(0,b.tZ)(un.dc,null),expandClose:(0,b.tZ)("span",{className:"rct-icon rct-icon-expand-close"}),expandOpen:(0,b.tZ)("span",{className:"rct-icon rct-icon-expand-open"}),expandAll:(0,b.tZ)("span",{className:"rct-icon rct-icon-expand-all"},(0,d.t)("Expand all")),collapseAll:(0,b.tZ)("span",{className:"rct-icon rct-icon-collapse-all"},(0,d.t)("Collapse all")),parentClose:(0,b.tZ)("span",{className:"rct-icon rct-icon-parent-close"}),parentOpen:(0,b.tZ)("span",{className:"rct-icon rct-icon-parent-open"}),leaf:(0,b.tZ)("span",{className:"rct-icon rct-icon-leaf"})},pn={nodes:l().arrayOf(E.ck).isRequired,checked:l().arrayOf(l().oneOfType([l().number,l().string])).isRequired,expanded:l().arrayOf(l().oneOfType([l().number,l().string])).isRequired,onCheck:l().func.isRequired,onExpand:l().func.isRequired,selectedChartId:l().number},fn=()=>{};function mn({nodes:e=[],checked:t=[],expanded:n=[],onCheck:r,onExpand:i,selectedChartId:o}){return(0,b.tZ)(sn(),{showExpandAll:!0,expandOnClick:!0,showNodeIcon:!1,nodes:cn({nodes:e,selectedChartId:o}),checked:t,expanded:n,onCheck:r,onExpand:i,onClick:fn,icons:hn})}mn.propTypes=pn,mn.defaultProps={selectedChartId:null};const gn={label:l().string.isRequired,isSelected:l().bool.isRequired};function vn({label:e,isSelected:t}){return(0,b.tZ)("span",{className:g()("filter-field-item filter-container",{"is-selected":t})},(0,b.tZ)(kt.lX,{htmlFor:e},e))}function bn({nodes:e,activeKey:t}){if(!e)return[];const n=e[0],r=n.children.map((e=>({...e,children:e.children.map((e=>{const{label:n,value:r}=e;return{...e,label:(0,b.tZ)(vn,{isSelected:r===t,label:n})}}))})));return[{...n,label:(0,b.tZ)("span",{className:"root"},n.label),children:r}]}vn.propTypes=gn;const yn={activeKey:l().string,nodes:l().arrayOf(E.ck).isRequired,checked:l().arrayOf(l().oneOfType([l().number,l().string])).isRequired,expanded:l().arrayOf(l().oneOfType([l().number,l().string])).isRequired,onCheck:l().func.isRequired,onExpand:l().func.isRequired,onClick:l().func.isRequired};function Cn({activeKey:e,nodes:t=[],checked:n=[],expanded:r=[],onClick:i,onCheck:o,onExpand:a}){return(0,b.tZ)(sn(),{showExpandAll:!0,showNodeIcon:!1,expandOnClick:!0,nodes:bn({nodes:t,activeKey:e}),checked:n,expanded:r,onClick:i,onCheck:o,onExpand:a,icons:hn})}Cn.propTypes=yn,Cn.defaultProps={activeKey:null};const Sn={dashboardFilters:l().objectOf(E.Er).isRequired,layout:l().object.isRequired,updateDashboardFiltersScope:l().func.isRequired,setUnsavedChanges:l().func.isRequired,onCloseModal:l().func.isRequired},xn=v.iK.div`
  height: ${({theme:e})=>16*e.gridUnit}px;

  // TODO: replace hardcoded color with theme variable after refactoring filter-scope-selector.less to Emotion
  border-top: ${({theme:e})=>e.gridUnit/4}px solid #cfd8dc;
  padding: ${({theme:e})=>6*e.gridUnit}px;
  margin: 0 0 0 ${({theme:e})=>6*-e.gridUnit}px;
  text-align: right;

  .btn {
    margin-right: ${({theme:e})=>4*e.gridUnit}px;

    &:last-child {
      margin-right: 0;
    }
  }
`;class kn extends a.PureComponent{constructor(e){super(e);const{dashboardFilters:t,layout:n}=e;if(Object.keys(t).length>0){const e=function({dashboardFilters:e={}}){const t=Object.values(e).map((e=>{const{chartId:t,filterName:n,columns:r,labels:i}=e,o=Object.keys(r).map((e=>({value:(0,Vt.w)({chartId:t,column:e}),label:i[e]||e})));return{value:t,label:n,children:o,showCheckbox:!0}}));return[{value:D.dU,type:p.U0,label:(0,d.t)("All filters"),children:t}]}({dashboardFilters:t}),r=e[0].children;this.allfilterFields=[],r.forEach((({children:e})=>{e.forEach((e=>{this.allfilterFields.push(e.value)}))})),this.defaultFilterKey=r[0].children[0].value;const i=Object.values(t).reduce(((e,{chartId:r,columns:i})=>({...e,...Object.keys(i).reduce(((e,i)=>{const o=(0,Vt.w)({chartId:r,column:i}),a=$t({components:n,filterFields:[o],selectedChartId:r}),s=Ut(a,1),l=((0,on.Q1)({filterScope:t[r].scopes[i]})||[]).filter((e=>e!==r));return{...e,[o]:{nodes:a,nodesFiltered:[...a],checked:l,expanded:s}}}),{})})),{}),{chartId:o}=(0,Vt._)(this.defaultFilterKey),a=[],s=this.defaultFilterKey,l=[D.dU].concat(o),c=Bt({checkedFilterFields:a,activeFilterField:s,filterScopeMap:i,layout:n});this.state={showSelector:!0,activeFilterField:s,searchText:"",filterScopeMap:{...i,...c},filterFieldNodes:e,checkedFilterFields:a,expandedFilterIds:l}}else this.state={showSelector:!1};this.filterNodes=this.filterNodes.bind(this),this.onChangeFilterField=this.onChangeFilterField.bind(this),this.onCheckFilterScope=this.onCheckFilterScope.bind(this),this.onExpandFilterScope=this.onExpandFilterScope.bind(this),this.onSearchInputChange=this.onSearchInputChange.bind(this),this.onCheckFilterField=this.onCheckFilterField.bind(this),this.onExpandFilterField=this.onExpandFilterField.bind(this),this.onClose=this.onClose.bind(this),this.onSave=this.onSave.bind(this)}onCheckFilterScope(e=[]){const{activeFilterField:t,filterScopeMap:n,checkedFilterFields:r}=this.state,i=Lt({activeFilterField:t,checkedFilterFields:r}),o=t?[t]:r,a={...n[i],checked:e},s=function({checked:e=[],filterFields:t=[],filterScopeMap:n={}}){const r=e.reduce(((e,t)=>{const[n,r]=t.split(":");return{...e,[r]:(e[r]||[]).concat(parseInt(n,10))}}),{});return t.reduce(((e,t)=>{const{chartId:i}=(0,Vt._)(t),o=(r[t]||[]).filter((e=>e!==i));return{...e,[t]:{...n[t],checked:o}}}),{})}({checked:e,filterFields:o,filterScopeMap:n});this.setState((()=>({filterScopeMap:{...n,...s,[i]:a}})))}onExpandFilterScope(e=[]){const{activeFilterField:t,checkedFilterFields:n,filterScopeMap:r}=this.state,i=Lt({activeFilterField:t,checkedFilterFields:n}),o={...r[i],expanded:e};this.setState((()=>({filterScopeMap:{...r,[i]:o}})))}onCheckFilterField(e=[]){const{layout:t}=this.props,{filterScopeMap:n}=this.state,r=Bt({checkedFilterFields:e,activeFilterField:null,filterScopeMap:n,layout:t});this.setState((()=>({activeFilterField:null,checkedFilterFields:e,filterScopeMap:{...n,...r}})))}onExpandFilterField(e=[]){this.setState((()=>({expandedFilterIds:e})))}onChangeFilterField(e={}){const{layout:t}=this.props,n=e.value,{activeFilterField:r,checkedFilterFields:i,filterScopeMap:o}=this.state;if(n===r){const e=Bt({checkedFilterFields:i,activeFilterField:null,filterScopeMap:o,layout:t});this.setState({activeFilterField:null,filterScopeMap:{...o,...e}})}else if(this.allfilterFields.includes(n)){const e=Bt({checkedFilterFields:i,activeFilterField:n,filterScopeMap:o,layout:t});this.setState({activeFilterField:n,filterScopeMap:{...o,...e}})}}onSearchInputChange(e){this.setState({searchText:e.target.value},this.filterTree)}onClose(){this.props.onCloseModal()}onSave(){const{filterScopeMap:e}=this.state,t=this.allfilterFields.reduce(((t,n)=>{const{nodes:r}=e[n];return{...t,[n]:rn({filterKey:n,nodes:r,checkedChartIds:e[n].checked})}}),{});this.props.updateDashboardFiltersScope(t),this.props.setUnsavedChanges(!0),this.props.onCloseModal()}filterTree(){if(this.state.searchText){const e=e=>{const{activeFilterField:t,checkedFilterFields:n,filterScopeMap:r}=e,i=Lt({activeFilterField:t,checkedFilterFields:n}),o=r[i].nodes.reduce(this.filterNodes,[]),a=Ut([...o]),s={...r[i],nodesFiltered:o,expanded:a};return{filterScopeMap:{...r,[i]:s}}};this.setState(e)}else this.setState((e=>{const{activeFilterField:t,checkedFilterFields:n,filterScopeMap:r}=e,i=Lt({activeFilterField:t,checkedFilterFields:n}),o={...r[i],nodesFiltered:r[i].nodes};return{filterScopeMap:{...r,[i]:o}}}))}filterNodes(e=[],t={}){const{searchText:n}=this.state,r=(t.children||[]).reduce(this.filterNodes,[]);return(t.label.toLocaleLowerCase().indexOf(n.toLocaleLowerCase())>-1||r.length)&&e.push({...t,children:r}),e}renderFilterFieldList(){const{activeFilterField:e,filterFieldNodes:t,checkedFilterFields:n,expandedFilterIds:r}=this.state;return(0,b.tZ)(Cn,{activeKey:e,nodes:t,checked:n,expanded:r,onClick:this.onChangeFilterField,onCheck:this.onCheckFilterField,onExpand:this.onExpandFilterField})}renderFilterScopeTree(){const{filterScopeMap:e,activeFilterField:t,checkedFilterFields:n,searchText:r}=this.state,i=Lt({activeFilterField:t,checkedFilterFields:n}),o=Kt({activeFilterField:t,checkedFilterFields:n});return(0,b.tZ)(a.Fragment,null,(0,b.tZ)("input",{className:"filter-text scope-search multi-edit-mode",placeholder:(0,d.t)("Search..."),type:"text",value:r,onChange:this.onSearchInputChange}),(0,b.tZ)(mn,{nodes:e[i].nodesFiltered,checked:e[i].checked,expanded:e[i].expanded,onCheck:this.onCheckFilterScope,onExpand:this.onExpandFilterScope,selectedChartId:o}))}renderEditingFiltersName(){const{dashboardFilters:e}=this.props,{activeFilterField:t,checkedFilterFields:n}=this.state,r=[].concat(t||n).map((t=>{const{chartId:n,column:r}=(0,Vt._)(t);return e[n].labels[r]||r}));return(0,b.tZ)("div",{className:"selected-fields multi-edit-mode"},0===r.length&&(0,d.t)("No filter is selected."),1===r.length&&(0,d.t)("Editing 1 filter:"),r.length>1&&(0,d.t)("Batch editing %d filters:",r.length),(0,b.tZ)("span",{className:"selected-scopes"},r.join(", ")))}render(){const{showSelector:e}=this.state;return(0,b.tZ)("div",{className:"filter-scope-container"},(0,b.tZ)("div",{className:"filter-scope-header"},(0,b.tZ)("h4",null,(0,d.t)("Configure filter scopes")),e&&this.renderEditingFiltersName()),(0,b.tZ)("div",{className:"filter-scope-body"},e?(0,b.tZ)("div",{className:"filters-scope-selector"},(0,b.tZ)("div",{className:g()("filter-field-pane multi-edit-mode")},this.renderFilterFieldList()),(0,b.tZ)("div",{className:"filter-scope-pane multi-edit-mode"},this.renderFilterScopeTree())):(0,b.tZ)("div",{className:"warning-message"},(0,d.t)("There are no filters in this dashboard."))),(0,b.tZ)(xn,null,(0,b.tZ)(it.Z,{buttonSize:"small",onClick:this.onClose},(0,d.t)("Close")),e&&(0,b.tZ)(it.Z,{buttonSize:"small",buttonStyle:"primary",onClick:this.onSave},(0,d.t)("Save"))))}}kn.propTypes=Sn;const wn=(0,o.$j)((function({dashboardLayout:e,dashboardFilters:t}){return{dashboardFilters:t,layout:e.present}}),(function(e){return(0,i.DE)({updateDashboardFiltersScope:Pt.l6,setUnsavedChanges:Nt.if},e)}))(kn),Rn=v.iK.div((({theme:{gridUnit:e}})=>({padding:2*e,paddingBottom:3*e})));class Zn extends a.PureComponent{constructor(e){super(e),this.modal=void 0,this.modal=a.createRef(),this.handleCloseModal=this.handleCloseModal.bind(this)}handleCloseModal(){this.modal.current&&this.modal.current.close()}render(){const e={onCloseModal:this.handleCloseModal};return(0,b.tZ)(mt.Z,{ref:this.modal,triggerNode:this.props.triggerNode,modalBody:(0,b.tZ)(Rn,null,(0,b.tZ)(wn,e)),width:"80%"})}}var Fn=n(56727),Tn=n(94435),_n=n.n(Tn),Dn=n(15926),Mn=n.n(Dn),En=n(50361),In=n.n(En);function On(e){const t=e;return Object.keys(t).forEach((e=>{void 0===t[e]?t[e]=null:null!==t[e]&&"object"==typeof t[e]&&(t[e]=On(t[e]))})),t}function Pn(e){return On(In()(e))}var Nn=n(11370);function jn({pathname:e,filters:t={},hash:n="",standalone:r,dataMask:i}){const o=new(_n());o.set(dt.KD.preselectFilters.name,JSON.stringify((0,Nn.Z)(t))),r&&o.set(dt.KD.standalone.name,r.toString()),i&&o.set(dt.KD.nativeFilters.name,Mn().encode(Pn(i)));const a=n?`#${n}`:"";return`${e}?${o.toString()}${a}`}var qn=n(23525);const zn={addSuccessToast:l().func.isRequired,addDangerToast:l().func.isRequired,dashboardInfo:l().object.isRequired,dashboardId:l().number.isRequired,dashboardTitle:l().string.isRequired,dataMask:l().object.isRequired,customCss:l().string.isRequired,colorNamespace:l().string,colorScheme:l().string,onChange:l().func.isRequired,updateCss:l().func.isRequired,forceRefreshAllCharts:l().func.isRequired,refreshFrequency:l().number.isRequired,shouldPersistRefreshFrequency:l().bool.isRequired,setRefreshFrequency:l().func.isRequired,startPeriodicRender:l().func.isRequired,editMode:l().bool.isRequired,userCanEdit:l().bool.isRequired,userCanShare:l().bool.isRequired,userCanSave:l().bool.isRequired,isLoading:l().bool.isRequired,layout:l().object.isRequired,expandedSlices:l().object.isRequired,onSave:l().func.isRequired,showPropertiesModal:l().func.isRequired,refreshLimit:l().number,refreshWarning:l().string,lastModifiedTime:l().number.isRequired,filterboxMigrationState:Fe.Qi},An={colorNamespace:void 0,colorScheme:void 0,refreshLimit:0,refreshWarning:null,filterboxMigrationState:Fe.Qi.NOOP},$n="refresh-dashboard",Un="edit-properties",Ln="download-as-image",Vn="toggle-fullscreen",Kn=v.iK.div`
  margin-left: ${({theme:e})=>2.5*e.gridUnit}px;
  span {
    color: ${({theme:e})=>e.colors.grayscale.base};
  }
`;class Bn extends a.PureComponent{static discardChanges(){window.location.reload()}constructor(e){super(e),this.state={css:e.customCss,cssTemplates:[]},this.changeCss=this.changeCss.bind(this),this.changeRefreshInterval=this.changeRefreshInterval.bind(this),this.handleMenuClick=this.handleMenuClick.bind(this)}UNSAFE_componentWillMount(){(0,Ot.Z)(this.state.css),lt.Z.get({endpoint:"/csstemplateasyncmodelview/api/read"}).then((({json:e})=>{const t=e.result.map((e=>({value:e.template_name,css:e.css,label:e.template_name})));this.setState({cssTemplates:t})})).catch((()=>{this.props.addDangerToast((0,d.t)("An error occurred while fetching available CSS templates"))}))}changeCss(e){this.setState({css:e},(()=>{(0,Ot.Z)(e)})),this.props.onChange(),this.props.updateCss(e)}changeRefreshInterval(e,t){this.props.setRefreshFrequency(e,t),this.props.startPeriodicRender(1e3*e)}handleMenuClick({key:e,domEvent:t}){switch(e){case $n:this.props.forceRefreshAllCharts();break;case Un:this.props.showPropertiesModal();break;case Ln:{const e=document.querySelector(".ant-dropdown:not(.ant-dropdown-hidden)");e.style.visibility="hidden",(0,Fn.Z)(".dashboard",this.props.dashboardTitle,{},!0)(t).then((()=>{e.style.visibility="visible"}));break}case Vn:{const e=jn({dataMask:this.props.dataMask,pathname:window.location.pathname,filters:(0,on.De)(),hash:window.location.hash,standalone:!(0,qn.e)(dt.KD.standalone)});window.location.replace(e);break}}}render(){const{dashboardTitle:e,dashboardId:t,dashboardInfo:n,dataMask:r,refreshFrequency:i,shouldPersistRefreshFrequency:o,editMode:a,customCss:s,colorNamespace:l,colorScheme:c,layout:u,expandedSlices:h,onSave:p,userCanEdit:f,userCanShare:m,userCanSave:g,isLoading:v,refreshLimit:y,refreshWarning:C,lastModifiedTime:S,addSuccessToast:x,addDangerToast:k,filterboxMigrationState:w}=this.props,R=`${(0,d.t)("Superset dashboard")} ${e}`,Z=(0,d.t)("Check out this dashboard: "),F=jn({dataMask:r,pathname:window.location.pathname,filters:(0,on.De)(),hash:window.location.hash}),T=(0,b.tZ)(Re.v2,{onClick:this.handleMenuClick,selectable:!1},g&&(0,b.tZ)(Re.v2.Item,{key:"save-modal"},(0,b.tZ)(It,{addSuccessToast:this.props.addSuccessToast,addDangerToast:this.props.addDangerToast,dashboardId:t,dashboardTitle:e,dashboardInfo:n,saveType:D.kS,layout:u,expandedSlices:h,refreshFrequency:i,shouldPersistRefreshFrequency:o,lastModifiedTime:S,customCss:s,colorNamespace:l,colorScheme:c,onSave:p,triggerNode:(0,b.tZ)("span",null,(0,d.t)("Save as")),canOverwrite:f})),m&&(0,b.tZ)(ft,{url:F,copyMenuItemTitle:(0,d.t)("Copy dashboard URL"),emailMenuItemTitle:(0,d.t)("Share dashboard by email"),emailSubject:R,emailBody:Z,addSuccessToast:x,addDangerToast:k}),(0,b.tZ)(Re.v2.Item,{key:$n,disabled:v},(0,d.t)("Refresh dashboard")),(0,b.tZ)(Re.v2.Divider,null),(0,b.tZ)(Re.v2.Item,{key:"autorefresh-modal"},(0,b.tZ)(Tt,{refreshFrequency:i,refreshLimit:y,refreshWarning:C,onChange:this.changeRefreshInterval,editMode:a,triggerNode:(0,b.tZ)("span",null,(0,d.t)("Set auto-refresh interval"))})),a&&w!==Fe.Qi.CONVERTED&&(0,b.tZ)(Re.v2.Item,{key:"set-filter-mapping"},(0,b.tZ)(Zn,{className:"m-r-5",triggerNode:(0,d.t)("Set filter mapping")})),a&&(0,b.tZ)(Re.v2.Item,{key:Un},(0,d.t)("Edit dashboard properties")),a&&(0,b.tZ)(Re.v2.Item,{key:"edit-css"},(0,b.tZ)(Ct,{triggerNode:(0,b.tZ)("span",null,(0,d.t)("Edit CSS")),initialCss:this.state.css,templates:this.state.cssTemplates,onChange:this.changeCss})),!a&&(0,b.tZ)(Re.v2.Item,{key:Ln},(0,d.t)("Download as image")),!a&&(0,b.tZ)(Re.v2.Item,{key:Vn},(0,qn.e)(dt.KD.standalone)?(0,d.t)("Exit fullscreen"):(0,d.t)("Enter fullscreen")));return(0,b.tZ)(Re.$i,{overlay:T,trigger:["click"],getPopupContainer:e=>e.closest(".dashboard-header")},(0,b.tZ)(Kn,{id:"save-dash-split-button",role:"button"},(0,b.tZ)(rt.Z.MoreHoriz,null)))}}Bn.propTypes=zn,Bn.defaultProps=An;const Wn=Bn;var Hn=n(48600),Gn=n(58593),Qn=n(37921);const Jn={dashboardId:l().number.isRequired,isPublished:l().bool.isRequired,savePublished:l().func.isRequired,canEdit:l().bool.isRequired,canSave:l().bool.isRequired},Yn=(0,d.t)("This dashboard is not published, it will not show up in the list of dashboards. Click here to publish this dashboard."),Xn=(0,d.t)("This dashboard is not published which means it will not show up in the list of dashboards. Favorite it to see it there or access it by using the URL directly."),er=(0,d.t)("This dashboard is published. Click to make it a draft.");class tr extends a.Component{componentDidMount(){this.togglePublished=this.togglePublished.bind(this)}togglePublished(){this.props.savePublished(this.props.dashboardId,!this.props.isPublished)}render(){return this.props.isPublished?this.props.canEdit&&this.props.canSave?(0,b.tZ)(Gn.u,{id:"published-dashboard-tooltip",placement:"bottom",title:er},(0,b.tZ)(Qn.Z,{onClick:()=>{this.togglePublished()}},(0,d.t)("Published"))):null:this.props.canEdit&&this.props.canSave?(0,b.tZ)(Gn.u,{id:"unpublished-dashboard-tooltip",placement:"bottom",title:Yn},(0,b.tZ)(Qn.Z,{onClick:()=>{this.togglePublished()}},(0,d.t)("Draft"))):(0,b.tZ)(Gn.u,{id:"unpublished-dashboard-tooltip",placement:"bottom",title:Xn},(0,b.tZ)(Qn.Z,null,(0,d.t)("Draft")))}}tr.propTypes=Jn;const nr={onUndo:l().func.isRequired,onRedo:l().func.isRequired};class rr extends a.PureComponent{constructor(e){super(e),this.handleKeydown=this.handleKeydown.bind(this)}componentDidMount(){document.addEventListener("keydown",this.handleKeydown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeydown)}handleKeydown(e){if(e.ctrlKey||e.metaKey){const t="z"===e.key||90===e.keyCode,n="y"===e.key||89===e.keyCode;document&&document.querySelector(".dashboard-markdown--editing")||!t&&!n||(e.preventDefault(),(t?this.props.onUndo:this.props.onRedo)())}}render(){return null}}rr.propTypes=nr;const ir=rr;var or=n(13272),ar=n(97860);const sr=e=>{e&&clearInterval(e)},lr={addSuccessToast:l().func.isRequired,addDangerToast:l().func.isRequired,addWarningToast:l().func.isRequired,user:r.UserWithPermissionsAndRoles,dashboardInfo:l().object.isRequired,dashboardTitle:l().string.isRequired,dataMask:l().object.isRequired,charts:l().objectOf(E.$6).isRequired,layout:l().object.isRequired,expandedSlices:l().object.isRequired,customCss:l().string.isRequired,colorNamespace:l().string,colorScheme:l().string,setColorSchemeAndUnsavedChanges:l().func.isRequired,isStarred:l().bool.isRequired,isPublished:l().bool.isRequired,isLoading:l().bool.isRequired,onSave:l().func.isRequired,onChange:l().func.isRequired,fetchFaveStar:l().func.isRequired,fetchCharts:l().func.isRequired,fetchUISpecificReport:l().func.isRequired,saveFaveStar:l().func.isRequired,savePublished:l().func.isRequired,updateDashboardTitle:l().func.isRequired,editMode:l().bool.isRequired,setEditMode:l().func.isRequired,showBuilderPane:l().func.isRequired,updateCss:l().func.isRequired,logEvent:l().func.isRequired,hasUnsavedChanges:l().bool.isRequired,maxUndoHistoryExceeded:l().bool.isRequired,lastModifiedTime:l().number.isRequired,onRefresh:l().func.isRequired,onUndo:l().func.isRequired,onRedo:l().func.isRequired,undoLength:l().number.isRequired,redoLength:l().number.isRequired,setMaxUndoHistoryExceeded:l().func.isRequired,maxUndoHistoryToast:l().func.isRequired,refreshFrequency:l().number.isRequired,shouldPersistRefreshFrequency:l().bool.isRequired,setRefreshFrequency:l().func.isRequired,dashboardInfoChanged:l().func.isRequired,dashboardTitleChanged:l().func.isRequired},dr=v.iK.div`
  background: ${({theme:e})=>e.colors.grayscale.light5};
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  padding: 0 ${({theme:e})=>6*e.gridUnit}px;
  border-bottom: 1px solid ${({theme:e})=>e.colors.grayscale.light2};

  .action-button > span {
    color: ${({theme:e})=>e.colors.grayscale.base};
  }
  button,
  .fave-unfave-icon {
    margin-left: ${({theme:e})=>2*e.gridUnit}px;
  }
  .button-container {
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    .action-button {
      font-size: ${({theme:e})=>e.typography.sizes.xl}px;
      margin-left: ${({theme:e})=>2.5*e.gridUnit}px;
    }
  }
`;class cr extends a.PureComponent{static discardChanges(){const e=new(Qe())(window.location.href);e.searchParams.delete("edit"),window.location.assign(e)}constructor(e){super(e),this.state={didNotifyMaxUndoHistoryToast:!1,emphasizeUndo:!1,showingPropertiesModal:!1,showingReportModal:!1},this.handleChangeText=this.handleChangeText.bind(this),this.handleCtrlZ=this.handleCtrlZ.bind(this),this.handleCtrlY=this.handleCtrlY.bind(this),this.toggleEditMode=this.toggleEditMode.bind(this),this.forceRefresh=this.forceRefresh.bind(this),this.startPeriodicRender=this.startPeriodicRender.bind(this),this.overwriteDashboard=this.overwriteDashboard.bind(this),this.showPropertiesModal=this.showPropertiesModal.bind(this),this.hidePropertiesModal=this.hidePropertiesModal.bind(this),this.showReportModal=this.showReportModal.bind(this),this.hideReportModal=this.hideReportModal.bind(this),this.renderReportModal=this.renderReportModal.bind(this)}componentDidMount(){const{refreshFrequency:e,user:t,dashboardInfo:n}=this.props;this.startPeriodicRender(1e3*e),this.canAddReports()&&this.props.fetchUISpecificReport(t.userId,"dashboard_id","dashboards",n.id,t.email)}componentDidUpdate(e){if(this.props.refreshFrequency!==e.refreshFrequency){const{refreshFrequency:e}=this.props;this.startPeriodicRender(1e3*e)}}UNSAFE_componentWillReceiveProps(e){const{user:t}=this.props;D.Q9-e.undoLength<=0&&!this.state.didNotifyMaxUndoHistoryToast&&(this.setState((()=>({didNotifyMaxUndoHistoryToast:!0}))),this.props.maxUndoHistoryToast()),e.undoLength>D.Q9&&!this.props.maxUndoHistoryExceeded&&this.props.setMaxUndoHistoryExceeded(),this.canAddReports()&&e.dashboardInfo.id!==this.props.dashboardInfo.id&&this.props.fetchUISpecificReport(t.userId,"dashboard_id","dashboards",e.dashboardInfo.id,t.email)}componentWillUnmount(){sr(this.refreshTimer),this.props.setRefreshFrequency(0),clearTimeout(this.ctrlYTimeout),clearTimeout(this.ctrlZTimeout)}handleChangeText(e){const{updateDashboardTitle:t,onChange:n}=this.props;e&&this.props.dashboardTitle!==e&&(t(e),n())}handleCtrlY(){this.props.onRedo(),this.setState({emphasizeRedo:!0},(()=>{this.ctrlYTimeout&&clearTimeout(this.ctrlYTimeout),this.ctrlYTimeout=setTimeout((()=>{this.setState({emphasizeRedo:!1})}),100)}))}handleCtrlZ(){this.props.onUndo(),this.setState({emphasizeUndo:!0},(()=>{this.ctrlZTimeout&&clearTimeout(this.ctrlZTimeout),this.ctrlZTimeout=setTimeout((()=>{this.setState({emphasizeUndo:!1})}),100)}))}forceRefresh(){if(!this.props.isLoading){const e=Object.keys(this.props.charts);return this.props.logEvent(tt.H3,{force:!0,interval:0,chartCount:e.length}),this.props.onRefresh(e,!0,0,this.props.dashboardInfo.id)}return!1}startPeriodicRender(e){let t;if(e){const n=wt.find((t=>t.value===e/1e3));t=n?n.label:Ye().duration(e,"millisecond").humanize()}this.refreshTimer=function({interval:e=0,periodicRender:t,refreshTimer:n}){return sr(n),e>0?setInterval(t,e):0}({interval:e,periodicRender:()=>{const{fetchCharts:n,logEvent:r,charts:i,dashboardInfo:o}=this.props,{metadata:a}=o,s=a.timed_refresh_immune_slices||[],l=Object.values(i).filter((e=>-1===s.indexOf(e.id))).map((e=>e.id));return r(tt.S,{interval:e,chartCount:l.length}),this.props.addWarningToast((0,d.t)("This dashboard is currently auto refreshing; the next auto refresh will be in %s.",t)),"fetch"===o.common.conf.DASHBOARD_AUTO_REFRESH_MODE?n(l,!1,.2*e,o.id):n(l,!0,.2*e,o.id)},refreshTimer:this.refreshTimer})}toggleEditMode(){this.props.logEvent(tt.vH,{edit_mode:!this.props.editMode}),this.props.setEditMode(!this.props.editMode)}overwriteDashboard(){var e,t;const{dashboardTitle:n,layout:r,expandedSlices:i,customCss:o,colorNamespace:a,colorScheme:s,dashboardInfo:l,refreshFrequency:c,shouldPersistRefreshFrequency:u,lastModifiedTime:h}=this.props,p={positions:r,expanded_slices:i,css:o,color_namespace:a,color_scheme:s,label_colors:s&&null!=l&&null!=(e=l.metadata)&&e.label_colors?l.metadata.label_colors:{},dashboard_title:n,refresh_frequency:u?c:null==(t=l.metadata)?void 0:t.refresh_frequency,last_modified_time:h},f=(0,st.o)(r).length,m=l.common.conf.SUPERSET_DASHBOARD_POSITION_DATA_LIMIT||D.Bu;f>=m?this.props.addDangerToast((0,d.t)("Your dashboard is too large. Please reduce its size before saving it.")):(f>=.9*m&&this.props.addWarningToast("Your dashboard is near the size limit."),this.props.onSave(p,l.id,D.TN))}showPropertiesModal(){this.setState({showingPropertiesModal:!0})}hidePropertiesModal(){this.setState({showingPropertiesModal:!1})}showReportModal(){this.setState({showingReportModal:!0})}hideReportModal(){this.setState({showingReportModal:!1})}renderReportModal(){return Object.keys(this.props.reports).length?(0,b.tZ)(Hn.Z,{showReportModal:this.showReportModal,toggleActive:this.props.toggleActive,deleteActiveReport:this.props.deleteActiveReport}):(0,b.tZ)(a.Fragment,null,(0,b.tZ)("span",{role:"button",title:(0,d.t)("Schedule email report"),tabIndex:0,className:"action-button",onClick:this.showReportModal},(0,b.tZ)(rt.Z.Calendar,null)))}canAddReports(){if(!(0,nt.cr)(c.T.ALERT_REPORTS))return!1;const{user:e}=this.props;return!(null==e||!e.userId)&&Object.keys(e.roles||[]).map((t=>e.roles[t].filter((e=>"menu_access"===e[0]&&"Manage"===e[1]))))[0].length>0}render(){const{dashboardTitle:e,layout:t,expandedSlices:n,customCss:r,colorNamespace:i,dataMask:o,setColorSchemeAndUnsavedChanges:s,colorScheme:l,onUndo:c,onRedo:u,undoLength:h,redoLength:p,onChange:f,onSave:m,updateCss:g,editMode:v,isPublished:y,user:C,dashboardInfo:S,hasUnsavedChanges:x,isLoading:k,refreshFrequency:w,shouldPersistRefreshFrequency:R,setRefreshFrequency:Z,lastModifiedTime:F,filterboxMigrationState:T}=this.props,_=S.dash_edit_perm&&T!==Fe.Qi.REVIEWING,D=S.dash_share_perm,M=S.dash_save_perm&&T!==Fe.Qi.REVIEWING,E=!v&&this.canAddReports(),I=S.common.conf.SUPERSET_DASHBOARD_PERIODICAL_REFRESH_LIMIT,O=S.common.conf.SUPERSET_DASHBOARD_PERIODICAL_REFRESH_WARNING_MESSAGE;return(0,b.tZ)(dr,{className:"dashboard-header","data-test-id":`${S.id}`},(0,b.tZ)("div",{className:"dashboard-component-header header-large"},S.certified_by&&(0,b.tZ)(a.Fragment,null,(0,b.tZ)(et.Z,{certifiedBy:S.certified_by,details:S.certification_details})," "),(0,b.tZ)(ot.Z,{title:e,canEdit:_&&v,onSaveTitle:this.handleChangeText,showTooltip:!1}),(0,b.tZ)(tr,{dashboardId:S.id,isPublished:y,savePublished:this.props.savePublished,canEdit:_,canSave:M}),(null==C?void 0:C.userId)&&(0,b.tZ)(at.Z,{itemId:S.id,fetchFaveStar:this.props.fetchFaveStar,saveFaveStar:this.props.saveFaveStar,isStarred:this.props.isStarred,showTooltip:!0})),(0,b.tZ)("div",{className:"button-container"},M&&(0,b.tZ)("div",{className:"button-container"},v&&(0,b.tZ)(a.Fragment,null,(0,b.tZ)(Xe.Z,{className:"m-r-5"},(0,b.tZ)(it.Z,{buttonSize:"small",onClick:c,disabled:h<1,buttonStyle:this.state.emphasizeUndo?"primary":void 0,showMarginRight:!1},(0,b.tZ)("i",{title:"Undo",className:"undo-action fa fa-reply"})," "),(0,b.tZ)(it.Z,{buttonSize:"small",onClick:u,disabled:p<1,buttonStyle:this.state.emphasizeRedo?"primary":void 0,showMarginRight:!1}," ",(0,b.tZ)("i",{title:"Redo",className:"redo-action fa fa-share"}))),(0,b.tZ)(it.Z,{buttonSize:"small",className:"m-r-5",onClick:this.constructor.discardChanges,buttonStyle:"default"},(0,d.t)("Discard changes")),(0,b.tZ)(it.Z,{buttonSize:"small",disabled:!x,buttonStyle:"primary",onClick:this.overwriteDashboard},(0,d.t)("Save")))),v&&(0,b.tZ)(ir,{onUndo:this.handleCtrlZ,onRedo:this.handleCtrlY}),!v&&_&&(0,b.tZ)(a.Fragment,null,(0,b.tZ)("span",{role:"button",title:(0,d.t)("Edit dashboard"),tabIndex:0,className:"action-button",onClick:this.toggleEditMode},(0,b.tZ)(rt.Z.EditAlt,null))),E&&this.renderReportModal(),this.state.showingPropertiesModal&&(0,b.tZ)(or.Z,{dashboardId:S.id,show:this.state.showingPropertiesModal,onHide:this.hidePropertiesModal,colorScheme:this.props.colorScheme,onSubmit:e=>{const{dashboardInfoChanged:t,dashboardTitleChanged:n}=this.props;t({slug:e.slug,metadata:JSON.parse(e.jsonMetadata),certified_by:e.certifiedBy,certification_details:e.certificationDetails}),s(e.colorScheme),n(e.title),e.slug&&window.history.pushState({event:"dashboard_properties_changed"},"",`/superset/dashboard/${e.slug}/`)},onlyApply:!0}),this.state.showingReportModal&&(0,b.tZ)(ar.Z,{show:this.state.showingReportModal,onHide:this.hideReportModal,props:{userId:C.userId,userEmail:C.email,dashboardId:S.id,creationMethod:"dashboards"}}),(0,b.tZ)(Wn,{addSuccessToast:this.props.addSuccessToast,addDangerToast:this.props.addDangerToast,dashboardId:S.id,dashboardTitle:e,dashboardInfo:S,dataMask:o,layout:t,expandedSlices:n,customCss:r,colorNamespace:i,colorScheme:l,onSave:m,onChange:f,forceRefreshAllCharts:this.forceRefresh,startPeriodicRender:this.startPeriodicRender,refreshFrequency:w,shouldPersistRefreshFrequency:R,setRefreshFrequency:Z,updateCss:g,editMode:v,hasUnsavedChanges:x,userCanEdit:_,userCanShare:D,userCanSave:M,isLoading:k,showPropertiesModal:this.showPropertiesModal,refreshLimit:I,refreshWarning:O,lastModifiedTime:F,filterboxMigrationState:T})))}}cr.propTypes=lr,cr.defaultProps={colorNamespace:void 0,colorScheme:void 0};const ur=cr;function hr(e){return Object.values(e).some((e=>e.chartUpdateStartTime>(e.chartUpdateEndTime||0)))}var pr=n(41295),fr=n(40701),mr=n(72570),gr=n(97381),vr=n(61358);const br=(0,o.$j)((function({dashboardLayout:e,dashboardState:t,reports:n,dashboardInfo:r,charts:i,dataMask:o,user:a}){return{dashboardInfo:r,undoLength:e.past.length,redoLength:e.future.length,layout:e.present,dashboardTitle:((e.present[D.M2]||{}).meta||{}).text,expandedSlices:t.expandedSlices,refreshFrequency:t.refreshFrequency,shouldPersistRefreshFrequency:!!t.shouldPersistRefreshFrequency,customCss:t.css,colorNamespace:t.colorNamespace,colorScheme:t.colorScheme,charts:i,dataMask:o,user:a,isStarred:!!t.isStarred,isPublished:!!t.isPublished,isLoading:hr(i),hasUnsavedChanges:!!t.hasUnsavedChanges,maxUndoHistoryExceeded:!!t.maxUndoHistoryExceeded,lastModifiedTime:Math.max(t.lastModifiedTime,r.last_modified_time),editMode:!!t.editMode,slug:r.slug,metadata:r.metadata,reports:n,filterboxMigrationState:t.filterboxMigrationState}}),(function(e){return(0,i.DE)({addSuccessToast:mr.ws,addDangerToast:mr.Gb,addWarningToast:mr.Dz,onUndo:fr.Ou,onRedo:fr.az,setEditMode:Nt.Mb,showBuilderPane:Nt.O8,setColorSchemeAndUnsavedChanges:Nt.ps,fetchFaveStar:Nt.Lb,saveFaveStar:Nt.TN,savePublished:Nt.dr,fetchCharts:Nt.Mn,updateDashboardTitle:fr.A7,updateCss:Nt.Sn,onChange:Nt.z2,onSave:Nt.M8,setMaxUndoHistoryExceeded:Nt.uN,maxUndoHistoryToast:Nt.Qt,logEvent:gr.logEvent,setRefreshFrequency:Nt.sL,onRefresh:Nt.Yy,dashboardInfoChanged:pr.a8,dashboardTitleChanged:fr.Ww,updateDataMask:He.eG,fetchUISpecificReport:vr.Aw,toggleActive:vr.M,deleteActiveReport:vr.MZ},e)}))(ur),yr=v.iK.div`
  display: flex;
  align-items: center;
  color: ${({theme:e})=>e.colors.grayscale.base};
  &:hover {
    color: ${({theme:e})=>e.colors.primary.base};
  }
`,Cr=v.iK.span`
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
`,Sr=({icon:e,label:t,onClick:n})=>(0,b.tZ)(yr,{tabIndex:0,role:"button",onClick:e=>{e.preventDefault(),n(e)}},e,t&&(0,b.tZ)(Cr,null,t));var xr=n(22428),kr=n(1510),wr=n(99543);function Rr(e){return Object.entries(e).map((([e,t])=>({col:e,op:Array.isArray(t)?"IN":"==",val:t}))).filter((e=>null!==e.val))}const Zr=({child:e,layout:t,scope:n,activeFilters:r,filterId:i,extraFormData:o})=>{var a,s;const l=null==(a=t[e])||null==(s=a.meta)?void 0:s.chartId;if(t[e].type===p.dW){if(n.excluded.includes(l))return;return r[i]||(r[i]={scope:[],values:o}),void r[i].scope.push(l)}t[e].children.forEach((e=>Zr({child:e,layout:t,scope:n,activeFilters:r,filterId:i,extraFormData:o})))},Fr=(e,t)=>Object.values(e).filter((e=>e[t])).reduce(((e,n)=>({...e,[n.id]:t?n[t]:n})),{}),Tr=({chartConfiguration:e,nativeFilters:t,dataMask:n,layout:r})=>{const i={};return Object.values(n).forEach((({id:n,extraFormData:o})=>{var a,s,l,d,c;const u=null!=(a=null!=(s=null==t||null==(l=t[n])?void 0:l.scope)?s:null==e||null==(d=e[n])||null==(c=d.crossFilters)?void 0:c.scope)?a:{rootPath:[D._4],excluded:[n]};u.rootPath.forEach((e=>{var t,a;null==(t=r[e])||null==(a=t.children)||a.forEach((e=>{Zr({child:e,layout:r,scope:u,activeFilters:i,filterId:n,extraFormData:o})}))}))})),i},_r={},Dr={};var Mr,Er=n(18446),Ir=n.n(Er),Or=n(12515),Pr=n(5144),Nr=n(11064),jr=n(16355),qr=n(74069),zr=n(83601);!function(e){e[e.all=0]="all",e[e.specific=1]="specific"}(Mr||(Mr={}));const Ar=({type:e,meta:t},n)=>{var r,i;return!(e!==p.gn&&e!==p.dW&&e!==p.U0||n&&"filter_box"===(null==(r=n[null==t?void 0:t.chartId])||null==(i=r.formData)?void 0:i.viz_type))},$r=(e,t,n,r,i,o,a)=>{let s=t;if(Ar(e,r)&&e.type!==p.U0&&i.includes(e.id)){var l;const n=a(e.meta.sliceNameOverride||e.meta.sliceName||e.meta.text||e.meta.defaultText||e.id.toString(),o.includes(null==(l=e.meta)?void 0:l.chartId),(0,d.t)("This chart might be incompatible with the filter (datasets don't match)")),r={key:e.id,title:n,children:[]};t.children.push(r),s=r}e.children.forEach((e=>$r(n[e],s,n,r,i,o,a)))},Ur=(e,t,n,r)=>{n.forEach((n=>{var i,o;Ur(e,t,((e,t)=>{var n;return[...(null==(n=e[t])?void 0:n.children)||[],...Object.values(e).filter((n=>n.parents&&n.parents[n.parents.length-1]===t&&!Ar(e[n.parents[n.parents.length-1]]))).map((({id:e})=>e))]})(t,n),r),(null==(i=t[n])?void 0:i.type)!==p.dW||r.includes(null==(o=t[n])?void 0:o.meta.chartId)||e.push(n)}))},Lr=(e,t)=>{const n=[];return Ur(n,t,[...e.rootPath],[...e.excluded]),[...new Set(n)]},Vr=(e,t=[])=>({rootPath:[D._4],excluded:e?[e,...t]:t}),Kr=(e,t)=>!e||e.rootPath[0]===D._4&&!e.excluded.filter((e=>e!==t)).length,Br=(e,t,n)=>{let r=(0,b.tZ)("span",null,e);return t&&(r=(0,b.tZ)(a.Fragment,null,r," ",(0,b.tZ)(Gn.u,{title:n},(0,b.tZ)(rt.Z.Info,{iconSize:"m"})))),r},Wr=({formScope:e,initialScope:t,forceUpdate:n,updateFormValues:r,chartId:i,initiallyExcludedCharts:s=[]})=>{const[l,c]=(0,a.useState)([D._4]),{treeData:u,layout:h}=function(e,t=[],n=(e=>e)){const r=(0,o.v9)((({dashboardLayout:{present:e}})=>e)),i=(0,o.v9)((({charts:e})=>e)),s={children:[],key:D._4,type:p.U0,title:(0,d.t)("All panels")},l=(0,a.useMemo)((()=>Object.values(r).reduce(((t,n)=>{const{id:r,parents:i=[],type:o,meta:a}=n;return o===p.dW&&e!==(null==a?void 0:a.chartId)?[...new Set([...t,...i,r])]:t}),[])),[r,e]);return(0,a.useMemo)((()=>{$r(r[D._4],s,r,i,l,t,n)}),[r,s,i,t,n]),{treeData:[s],layout:r}}(i,s,Br),[f,m]=(0,a.useState)(!0),g=(0,a.useMemo)((()=>Lr({...e||t},h)),[e,t,h]);return(0,b.tZ)(Re.mp,{checkable:!0,selectable:!1,onExpand:e=>{c(e),m(!1)},expandedKeys:l,autoExpandParent:f,onCheck:e=>{n();const t=((e,t)=>{if(!e.length)return{rootPath:[],excluded:[]};const n=e.filter((e=>{var n;return(null==(n=t[e])?void 0:n.type)===p.dW})).map((e=>{var n;return[D._4,...(null==(n=t[e])?void 0:n.parents)||[]].filter((e=>Ar(t[e])))}));n.sort(((e,t)=>e.length-t.length));const r=n.map((e=>e[n[0].length-1])),i=[];return Object.entries(t).forEach((([t,n])=>{var o;const a=n.parents||[];n.type===p.dW&&null!=(o=[D._4,...a])&&o.find((n=>((t,n)=>r.includes(t)&&!e.includes(n))(n,t)))&&i.push(n.meta.chartId)})),{rootPath:[...new Set(r)],excluded:i}})(e,h);void 0!==i&&(t.excluded=[...new Set([...t.excluded,i])]),r({scope:t})},checkedKeys:g,treeData:u})},Hr=v.iK.div`
  display: flex;
  flex-direction: column;
  & > * {
    margin-bottom: ${({theme:e})=>e.gridUnit}px;
  }
  padding: 0px ${({theme:e})=>4*e.gridUnit}px;
`,Gr=(0,v.iK)(Re.l0.Item)`
  margin-bottom: 0;
`,Qr=({pathToFormValue:e=[],formScopingType:t,formFilterScope:n,forceUpdate:r,filterScope:i,updateFormValues:o,chartId:s,initiallyExcludedCharts:l})=>{const[c]=(0,a.useState)(i||Vr(s,l)),[u]=(0,a.useState)(Kr(c,s)?Mr.all:Mr.specific),[h,p]=(0,a.useState)(!!i),f=(0,a.useCallback)((e=>{o(e),p(!0)}),[o]),m=(0,a.useCallback)((()=>{if(i||h)return;const e=Vr(s,l);o({scope:e,scoping:Kr(e,s)?Mr.all:Mr.specific})}),[s,i,h,l,o]);return(0,zr.d)(m),(0,b.tZ)(Hr,null,(0,b.tZ)(Gr,{name:[...e,"scoping"],initialValue:u},(0,b.tZ)(_t.Y.Group,{onChange:({target:{value:e}})=>{if(e===Mr.all){const e=Vr(s);o({scope:e})}p(!0),r()}},(0,b.tZ)(_t.Y,{value:Mr.all},(0,d.t)("Apply to all panels")),(0,b.tZ)(_t.Y,{value:Mr.specific},(0,d.t)("Apply to specific panels")))),(0,b.tZ)(Re.ZT.Text,{type:"secondary"},(null!=t?t:u)===Mr.specific?(0,d.t)("Only selected panels will be affected by this filter"):(0,d.t)("All panels with this column will be affected by this filter")),(null!=t?t:u)===Mr.specific&&(0,b.tZ)(Wr,{updateFormValues:f,initialScope:c,formScope:n,forceUpdate:r,chartId:s,initiallyExcludedCharts:l}),(0,b.tZ)(Gr,{name:[...e,"scope"],hidden:!0,initialValue:c}))};var Jr=n(10752),Yr=n.n(Jr),Xr=n(88889),ei=n(55786);const ti="filters",ni={filter_time:[Xr.Z.TEMPORAL],filter_timegrain:[Xr.Z.TEMPORAL],filter_timecolumn:[Xr.Z.TEMPORAL],filter_select:[Xr.Z.BOOLEAN,Xr.Z.STRING,Xr.Z.NUMERIC,Xr.Z.TEMPORAL],filter_range:[Xr.Z.NUMERIC]},ri=()=>{const[,e]=a.useState({});return a.useCallback((()=>e({})),[])},ii=(e,t,n)=>{const r=e.getFieldValue(ti)||{};e.setFields([{name:ti,value:{...r,[t]:{...r[t],...n}}}])},oi=e=>({value:e.id,label:e.table_name}),ai=e=>{const t=(0,ei.Z)(null==e?void 0:e.column_types);return 0===t.length||t.includes(Xr.Z.TEMPORAL)},si=(e,t)=>{var n;return!t.type_generic||!(e in ni)||(null==(n=ni[e])?void 0:n.includes(t.type_generic))},li=({form:e,scope:t,chartId:n})=>{const r=ri(),i=e.getFieldValue("scope"),o=e.getFieldValue("scoping");return(0,b.tZ)(Qr,{updateFormValues:t=>{((e,t)=>{e.setFieldsValue({...t})})(e,{...t})},filterScope:t,chartId:n,formFilterScope:i,forceUpdate:r,formScopingType:o})};var di=n(89734),ci=n.n(di),ui=n(44908),hi=n.n(ui),pi=n(68122),fi=n(53350),mi=n(53931);const gi=[];function vi(){return(0,o.v9)((e=>{var t,n;return(null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.native_filter_configuration)||gi}))}function bi(){return(0,o.v9)((e=>{var t;return null==(t=e.dashboardLayout)?void 0:t.present}))}function yi(){const e=bi();return(0,a.useMemo)((()=>Object.values(e).some((e=>e.type===p.gn))),[e])}var Ci=n(27034),Si=n(22068);const xi="FILTER",ki=v.iK.div`
  ${({isDragging:e,theme:t})=>`\n    opacity: ${e?.3:1};\n    cursor: ${e?"grabbing":"pointer"};\n    width: 100%;\n    display: flex;\n    padding:  ${t.gridUnit}px\n  `}
`,wi=(0,v.iK)(rt.Z.Drag,{shouldForwardProp:e=>"isDragging"!==e})`
  ${({isDragging:e,theme:t})=>`\n    font-size: ${t.typography.sizes.m}px;\n    margin-top: 15px;\n    cursor: ${e?"grabbing":"grab"};\n    padding-left: ${t.gridUnit}px;\n  `}
`;var Ri={name:"aco78w",styles:"flex-grow:4"};const Zi=({index:e,onRearrage:t,filterIds:n,children:r})=>{const i=(0,a.useRef)(null),[{isDragging:o},s]=(0,Ci.c)({item:{filterIds:n,type:xi,index:e},collect:e=>({isDragging:e.isDragging()})}),[,l]=(0,Si.L)({accept:xi,hover:(n,r)=>{var o;if(!i.current)return;const a=n.index,s=e;if(a===s)return;const l=null==(o=i.current)?void 0:o.getBoundingClientRect(),d=(l.bottom-l.top)/2,c=r.getClientOffset().y-l.top;a<s&&c<d||a>s&&c>d||(t(a,s),n.index=s)}});return s(l(i)),(0,b.tZ)(ki,{ref:i,isDragging:o},(0,b.tZ)(wi,{isDragging:o,alt:"Move icon",className:"dragIcon"}),(0,b.tZ)("div",{css:Ri},r))},Fi=v.iK.div`
  ${({theme:e})=>`\n      display: flex;\n      padding: ${2*e.gridUnit}px;\n      width: 100%;\n      border-radius: ${e.borderRadius}px;\n      &.active {\n        color: ${e.colors.grayscale.dark1};\n        border-radius: ${e.borderRadius}px;\n        background-color: ${e.colors.secondary.light4};\n        span, .anticon {\n          color: ${e.colors.grayscale.dark1};\n        }\n      }\n      &:hover {\n        color: ${e.colors.primary.light1};\n        span, .anticon {\n          color: ${e.colors.primary.light1};\n        }\n      }\n      &.errored div, &.errored .warning {\n        color: ${e.colors.error.base};\n      }\n  `}
`,Ti=(0,v.iK)(rt.Z.Trash)`
  color: ${({theme:e})=>e.colors.grayscale.light3};
`,_i=(0,v.iK)(rt.Z.Warning)`
  color: ${({theme:e})=>e.colors.error.base};
  &.anticon {
    margin-left: auto;
  }
`,Di=v.iK.div`
  height: 100%;
  overflow-y: auto;
`;var Mi={name:"7whenc",styles:"display:flex;width:100%"},Ei={name:"1vr7vmn",styles:"align-items:center;display:flex"},Ii={name:"1je5tt7",styles:"align-self:flex-end;margin-left:auto"},Oi={name:"1je5tt7",styles:"align-self:flex-end;margin-left:auto"};const Pi=({getFilterTitle:e,onChange:t,onRemove:n,restoreFilter:r,onRearrage:i,currentFilterId:o,removedFilters:a,filterGroups:s,erroredFilters:l=[]})=>(0,b.tZ)(Di,null,(()=>{const c=[];return s.forEach(((s,u)=>{c.push((0,b.tZ)(Zi,{key:u,onRearrage:i,index:u,filterIds:s},s.map((i=>(i=>{const s=!!a[i],c=l.includes(i),u=o===i,h=[];return c&&h.push("errored"),u&&h.push("active"),(0,b.tZ)(Fi,{role:"tab",key:`filter-title-tab-${i}`,onClick:()=>t(i),className:h.join(" ")},(0,b.tZ)("div",{css:Mi},(0,b.tZ)("div",{css:Ei},s?(0,d.t)("(Removed)"):e(i)),!a[i]&&c&&(0,b.tZ)(_i,{className:"warning"}),s&&(0,b.tZ)("span",{css:Ii,role:"button",tabIndex:0,onClick:e=>{e.preventDefault(),r(i)}},(0,d.t)("Undo?"))),(0,b.tZ)("div",{css:Oi},s?null:(0,b.tZ)(Ti,{onClick:e=>{e.stopPropagation(),n(i)},alt:"RemoveFilter"})))})(i)))))})),c})()),Ni=v.iK.div`
  color: ${({theme:e})=>e.colors.primary.dark1};
`,ji=v.iK.div`
  ${({theme:e})=>`\n    color: ${e.colors.grayscale.dark1};\n    font-size: ${e.typography.sizes.l}px;\n    padding-top: ${4*e.gridUnit}px;\n    padding-right: ${4*e.gridUnit}px;\n    padding-left: ${4*e.gridUnit}px;\n    padding-bottom: ${2*e.gridUnit}px;\n  `}
`,qi=v.iK.div`
  ${({theme:e})=>`\n  cursor: pointer;\n  margin: ${4*e.gridUnit}px;\n  &:hover {\n    color: ${e.colors.primary.base};\n  }\n`}
`,zi=v.iK.div`
  height: 100%;
  display: flex;
  flex-direction: column;
`,Ai=({getFilterTitle:e,onChange:t,onAdd:n,onRemove:r,onRearrage:i,restoreFilter:o,currentFilterId:a,filterGroups:s,removedFilters:l,erroredFilters:c})=>{const u=(0,v.Fg)(),h=[{label:"Filter",type:mi.B.NATIVE_FILTER},{label:"Divider",type:mi.B.DIVIDER}],p=(0,b.tZ)(Re.$t,{mode:"horizontal"},h.map((e=>(0,b.tZ)(Re.$t.Item,{onClick:()=>{return t=e.type,n(t),void setTimeout((()=>{const e=document.getElementById("native-filters-tabs");if(e){const t=e.getElementsByClassName("ant-tabs-nav-list")[0];t.scrollTop=t.scrollHeight}}),0);var t}},e.label))));return(0,b.tZ)(zi,null,(0,b.tZ)(ji,null,"Filters"),(0,b.tZ)("div",{css:(0,b.iv)({height:"100%",overflowY:"auto",marginLeft:3*u.gridUnit},"","")},(0,b.tZ)(Pi,{filterGroups:s,currentFilterId:a,removedFilters:l,getFilterTitle:e,erroredFilters:c,onChange:t,onRemove:r,onRearrage:i,restoreFilter:o})),(0,b.tZ)(Re.Lt,{overlay:p,arrow:!0,placement:"topLeft",trigger:["hover"]},(0,b.tZ)(qi,null,(0,b.tZ)(Ni,{className:"fa fa-plus"})," ",(0,b.tZ)("span",null,(0,d.t)("Add")))))},$i=v.iK.div`
  display: flex;
  height: 100%;
`,Ui=v.iK.div`
  flex-grow: 3;
  margin-left: ${({theme:e})=>-1*e.gridUnit-1};
`,Li=v.iK.div`
  width: 270px;
  border-right: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
`,Vi=({getFilterTitle:e,onChange:t,onRemove:n,onRearrange:r,restoreFilter:i,onAdd:o,erroredFilters:a,children:s,currentFilterId:l,filterGroups:d,removedFilters:c})=>{const u=d.flat().filter((e=>e===l))[0];return(0,b.tZ)($i,null,(0,b.tZ)(Li,null,(0,b.tZ)(Ai,{currentFilterId:l,filterGroups:d,removedFilters:c,erroredFilters:a,getFilterTitle:e,onChange:t,onAdd:e=>o(e),onRearrage:r,onRemove:e=>n(e),restoreFilter:i})),(0,b.tZ)(Ui,null,d.flat().map((e=>(0,b.tZ)("div",{key:e,style:{height:"100%",overflowY:"auto",display:e===u?"":"none"}},s(e))))))};var Ki=n(9882),Bi=n(43700);const Wi=v.iK.div`
  display: flex;
  flex-direction: row;
  background-color: ${({level:e,theme:t})=>t.colors[e].light2};
  border-radius: ${({theme:e})=>e.borderRadius}px;
  border: 1px solid ${({level:e,theme:t})=>t.colors[e].base};
  color: ${({level:e,theme:t})=>t.colors[e].dark2};
  padding: ${({theme:e})=>2*e.gridUnit}px;
  margin-bottom: ${({theme:e})=>e.gridUnit}px;
  width: 100%;
`,Hi=v.iK.div`
  display: flex;
  flex-direction: column;
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
`,Gi=v.iK.span`
  font-weight: ${({theme:e})=>e.typography.weights.bold};
`;function Qi({body:e,level:t="error",title:n}){const r=(0,v.Fg)().colors[t].base;return(0,b.tZ)(Wi,{level:t,role:"alert"},"error"===t?(0,b.tZ)(rt.Z.ErrorSolid,{iconColor:r}):(0,b.tZ)(rt.Z.WarningSolid,{iconColor:r}),(0,b.tZ)(Hi,null,(0,b.tZ)(Gi,null,n),(0,b.tZ)("p",null,e)))}var Ji=n(73375),Yi=n(46566),Xi=n(77997);const eo=(e,t,n=((...e)=>JSON.stringify([...e])))=>(...r)=>{const i=n(...r);if(t.has(i))return t.get(i);const o=e(...r);return t.set(i,o),o},to=v.iK.div`
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  min-height: ${({theme:e})=>10*e.gridUnit}px;
  padding-top: ${({theme:e})=>2*e.gridUnit+2}px;

  .checkbox {
    margin-bottom: ${({theme:e,checked:t})=>t?e.gridUnit:0}px;
  }

  & > div {
    margin-bottom: ${({theme:e})=>2*e.gridUnit}px;
  }
`,no=e=>{const{checked:t,disabled:n,title:r,tooltip:i,children:o,onChange:s=(()=>{}),initialValue:l=!1}=e,[d,c]=(0,a.useState)(l);return(0,a.useEffect)((()=>{void 0!==t&&c(t)}),[t]),(0,b.tZ)(to,{checked:d},(0,b.tZ)(Re.XZ,{className:"checkbox",checked:d,disabled:n,onChange:e=>{const n=e.target.checked;void 0===t&&c(n),s(n)}},(0,b.tZ)(a.Fragment,null,r," ",i&&(0,b.tZ)(Ki.V,{placement:"top",tooltip:i}))),d&&o)};var ro=n(67337),io=n(14114),oo=n(98286);const ao=new Map,so=eo(lt.Z.get,ao,(({endpoint:e})=>e||""));function lo({allowClear:e=!1,filterValues:t=(()=>!0),form:n,formField:r="column",filterId:i,datasetId:o,value:s,onChange:l,mode:c}){var u;const[h,p]=(0,a.useState)(),{addDangerToast:f}=(0,io.e)(),m=(0,a.useCallback)((()=>{n.setFields([{name:["filters",i,r],touched:!1,value:null}])}),[n,i,r]),g=(0,a.useMemo)((()=>(0,ei.Z)(h).filter(t).map((e=>e.column_name)).map((e=>({label:e,value:e})))),[h,t]),v=null==(u=n.getFieldValue("filters"))?void 0:u[i].filterType,y=(0,a.useMemo)((()=>null==h?void 0:h.find((e=>e.column_name===s))),[h,s]);return(0,a.useEffect)((()=>{y&&!si(v,y)&&m()}),[y,v,m]),function(e,t){const n=(0,ro.D)(e);(0,a.useEffect)((()=>{e!==n&&t(n)}),[e,n,t])}(o,(e=>{null!=e&&m(),null!=o&&so({endpoint:`/api/v1/dataset/${o}`}).then((({json:{result:e}})=>{const t=Array.isArray(s)?s:[s];e.columns.some((e=>null==t?void 0:t.includes(e.column_name)))||m(),p(e.columns)}),(async e=>{const{error:t,message:n}=await(0,oo.O)(e);let r=n||t||(0,d.t)("An error has occurred");"Forbidden"===n&&(r=(0,d.t)("You do not have permission to edit this dashboard")),f(r)}))})),(0,b.tZ)(Ze.P,{mode:c,value:"multiple"===c?s||[]:s,ariaLabel:(0,d.t)("Column select"),onChange:l,options:g,placeholder:(0,d.t)("Select a column"),notFoundContent:(0,d.t)("No compatible columns found"),showSearch:!0,allowClear:e})}const co=new Map,uo=eo(lt.Z.get,co,(({endpoint:e})=>e||"")),ho=({onChange:e,value:t})=>{const n=(0,a.useCallback)((({error:e,message:t})=>{let n=t||e||(0,d.t)("An error has occurred");return"Forbidden"===t&&(n=(0,d.t)("You do not have permission to edit this dashboard")),n}),[]);return(0,b.tZ)(Ze.P,{ariaLabel:(0,d.t)("Dataset"),value:t,options:async(e,t,r)=>{const i="table_name",o=Mn().encode({filters:[{col:i,opr:"ct",value:e}],page:t,page_size:r,order_column:i,order_direction:"asc"});return uo({endpoint:`/api/v1/dataset/?q=${o}`}).then((e=>({data:e.json.result.map(oi),totalCount:e.json.count}))).catch((async e=>{const t=n(await(0,oo.O)(e));throw new Error(t)}))},onChange:e})},po=e=>(0,a.useMemo)((()=>(0,b.tZ)(ho,e)),[]);var fo=n(88274);const mo=({hasDefaultValue:e,filterId:t,hasDataset:n,form:r,setDataMask:i,formData:o,enableNoResults:a})=>{var s,l;const c=(r.getFieldValue("filters")||{})[t],u=null==c?void 0:c.defaultValueQueriesData,p=n&&null===u,f=null==(s=c.defaultDataMask)?void 0:s.filterState.value,m=e&&null==f;return p?(0,b.tZ)(h.Z,{position:"inline-centered"}):(0,b.tZ)(fo.Z,{height:32,width:"filter_time"===(null==c?void 0:c.filterType)?350:250,appSection:jr.Tr.FILTER_CONFIG_MODAL,behaviors:[jr.cg.NATIVE_FILTER],formData:o,queriesData:n?null==c?void 0:c.defaultValueQueriesData:[{data:[{}]}],chartType:null==c?void 0:c.filterType,hooks:{setDataMask:i},enableNoResults:a,filterState:{...null==(l=c.defaultDataMask)?void 0:l.filterState,validateMessage:m&&(0,d.t)("Value is required"),validateStatus:m&&"error"}})};var go=n(37687);const vo=(0,v.iK)(kt.xJ)`
  margin-bottom: 0;
`;const bo=v.iK.div`
  display: flex;
  flex-direction: column;
  height: 400px; // arbitrary
  text-align: center;
  justify-content: center;
  align-items: center;
  color: ${({theme:e})=>e.colors.grayscale.base};
`,yo=({onClick:e})=>(0,b.tZ)(bo,null,(0,b.tZ)("p",null,(0,d.t)("You have removed this filter.")),(0,b.tZ)("div",null,(0,b.tZ)(it.Z,{buttonStyle:"primary",onClick:e},(0,d.t)("Restore Filter")))),Co=(0,v.iK)(C.ZP.TabPane)`
  padding: ${({theme:e})=>4*e.gridUnit}px 0px;
`,So=v.iK.div`
  ${({theme:e})=>`\n    display: flex;\n    flex-direction: row-reverse;\n    justify-content: space-between;\n    padding: 0px ${4*e.gridUnit}px;\n  `}
`,xo=v.iK.div`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  width: 100%;
  padding: 0px ${({theme:e})=>4*e.gridUnit}px;
`,ko=(0,v.iK)(kt.xJ)`
  width: 49%;
  margin-bottom: ${({theme:e})=>4*e.gridUnit}px;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  & .ant-form-item-control-input {
    min-height: ${({theme:e})=>10*e.gridUnit}px;
  }
`,wo=(0,v.iK)(kt.xJ)`
  margin-bottom: 0;
  padding-bottom: 0;
  min-width: 50%;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  .ant-form-item-control-input-content > div > div {
    height: auto;
  }

  & .ant-form-item-control-input {
    min-height: ${({theme:e})=>10*e.gridUnit}px;
  }
`,Ro=(0,v.iK)(kt.xJ)`
  min-width: 50%;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  .ant-form-item {
    margin-bottom: 0;
  }

  .ant-form-item-control-input-content > div > div {
    height: auto;
  }

  .ant-form-item-extra {
    display: none;
  }

  & .ant-form-item-control-input {
    height: auto;
  }
`,Zo=v.iK.span`
  color: ${({theme:e})=>e.colors.grayscale.base};
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  text-transform: uppercase;
`,Fo=(0,v.iK)(kt.xJ)`
  margin-bottom: 0;
`,To=v.iK.div`
  display: flex;
  flex-direction: row;
  align-items: center;
`,_o=(0,v.iK)(rt.Z.Refresh)`
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
  color: ${({theme:e})=>e.colors.primary.base};
`,Do=(0,v.iK)(Bi.Z)`
  border-left: 0;
  border-top: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  border-radius: 0;

  .ant-collapse-header {
    border-bottom: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
    border-top: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
    margin-top: -1px;
    border-radius: 0;
  }

  .ant-collapse-content {
    border: 0;
  }

  .ant-collapse-content-box {
    padding-top: ${({theme:e})=>2*e.gridUnit}px;
  }

  &.ant-collapse > .ant-collapse-item {
    border: 0;
    border-radius: 0;
  }
`,Mo=(0,v.iK)(C.ZP)`
  .ant-tabs-nav {
    position: sticky;
    top: 0;
    background: white;
    z-index: 1;
  }

  .ant-tabs-nav-list {
    padding: 0;
  }

  .ant-form-item-label {
    padding-bottom: 0;
  }
`,Eo=v.iK.span`
  color: ${({theme:e})=>e.colors.error.base};
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  margin-left: ${({theme:e})=>e.gridUnit-1}px;
  &:before {
    content: '*';
  }
`,Io={configuration:{key:"configuration",name:(0,d.t)("Configuration")},scoping:{key:"scoping",name:(0,d.t)("Scoping")}},Oo={basic:{key:"basic",name:(0,d.t)("Basic")},advanced:{key:"advanced",name:(0,d.t)("Advanced")}},Po=["filter_select","filter_range"],No=["enableEmptyFilter","multiSelect"],jo={[(0,d.t)("Select filter")]:(0,d.t)("Value"),[(0,d.t)("Range filter")]:(0,d.t)("Numerical range"),[(0,d.t)("Time filter")]:(0,d.t)("Time range"),[(0,d.t)("Time column")]:(0,d.t)("Time column"),[(0,d.t)("Time grain")]:(0,d.t)("Time grain"),[(0,d.t)("Group By")]:(0,d.t)("Group by")},qo=new Map,zo=eo(lt.Z.get,qo,(({endpoint:e})=>e||"")),Ao=({filterId:e,filterToEdit:t,removedFilters:n,form:r,parentFilters:i,activeFilterPanelKeys:s,isActive:l,restoreFilter:u,onFilterHierarchyChange:p,handleActiveFilterPanelChange:f,setErroredFilters:m},g)=>{var v,y,C,S,x,k,w,R,Z,F,T,_,D,M,E,I,O,P,N,j,q,z,A;const $=!!n[e],[U,L]=(0,a.useState)(""),[V,K]=(0,a.useState)([]),[B,W]=(0,a.useState)(Io.configuration.key),[H,G]=(0,a.useState)(null),Q=ri(),[J,Y]=(0,a.useState)(),X=(0,a.useMemo)((()=>({})),[]),ee=null==(v=r.getFieldValue("filters"))?void 0:v[e],te=ee||H||X,ne=(0,a.useMemo)((()=>i.map((e=>({value:e.id,label:e.title})))),[i]),re=(null==te||null==(y=te.parentFilter)?void 0:y.value)||(null==t||null==(C=t.cascadeParentIds)?void 0:C[0]),ie=ne.find((({value:e})=>e===re)),oe=!!ie,ae=(0,Nr.Z)().items,se=Object.entries(ae).filter((([,{value:e}])=>{var t;return null==(t=e.behaviors)?void 0:t.includes(jr.cg.NATIVE_FILTER)})).map((([e])=>e)),le=(0,o.v9)((({datasources:e})=>e)),de=(0,o.v9)((({charts:e})=>e)),ce=(0,a.useMemo)((()=>Object.values(le).some((e=>ai(e)))),[le]),ue=(0,a.useMemo)((()=>{const e=Object.values(le).find((e=>{var t;return e.id===(null==te||null==(t=te.dataset)?void 0:t.value)}));return!e||ai(e)}),[null==te||null==(S=te.dataset)?void 0:S.value,le]),he=!(null==(x=ae[null==te?void 0:te.filterType])||null==(k=x.value)||!k.datasourceCount),pe=null!=(w=null!=(R=null==te||null==(Z=te.dataset)?void 0:Z.value)?R:null==t||null==(F=t.targets[0])?void 0:F.datasetId)?w:((e,t)=>{var n;const r=new Map;let i="",o=0;return Object.values(t).forEach((e=>{const{formData:t}=e;if(t){const{datasource:e}=t,n=(r.get(e)||0)+1;r.set(e,n),n>o&&(o=n,i=e)}})),null==(n=e[i])?void 0:n.id})(le,de),{controlItems:fe={},mainControlItems:me={}}=te?function({datasetId:e,disabled:t,forceUpdate:n,form:r,filterId:i,filterType:o,filterToEdit:s,formFilter:l,removed:c}){var u;const h=null!=(u=((e={})=>{var t,n;return null!=(t=null==(n=Yr()(e.controlPanelSections))?void 0:n.reduce(((e,{controlSetRows:t=[]})=>[...e,...Yr()(t)]),[]))?t:[]})((0,go.Z)().get(o)))?u:[],p={},f={};return h.filter((e=>"groupby"===(null==e?void 0:e.name))).forEach((t=>{var o,u,h,p,m,g,v,y,C;const S=null!=(o=null==s||null==(u=s.controlValues)?void 0:u[t.name])?o:null==t||null==(h=t.config)?void 0:h.default,x=null==s||null==(p=s.targets[0])||null==(m=p.column)?void 0:m.name,k=(0,b.tZ)(a.Fragment,null,(0,b.tZ)(vo,{name:["filters",i,"requiredFirst",t.name],hidden:!0,initialValue:(null==t||null==(g=t.config)?void 0:g.requiredFirst)&&(null==s?void 0:s.requiredFirst)}),(0,b.tZ)(ko,{name:["filters",i,"column"],initialValue:x,label:(0,b.tZ)(Zo,null,(null==(v=t.config)?void 0:v.label)||(0,d.t)("Column")),rules:[{required:(null==(y=t.config)?void 0:y.required)&&!c,message:(0,d.t)("Column is required")}]},(0,b.tZ)(lo,{mode:(null==(C=t.config)?void 0:C.multiple)&&"multiple",form:r,filterId:i,datasetId:e,filterValues:e=>si((null==l?void 0:l.filterType)||"",e),onChange:()=>{ii(r,i,{defaultDataMask:null}),n()}})));f[t.name]={element:k,checked:S}})),h.filter((e=>{var t;return(null==e||null==(t=e.config)?void 0:t.renderTrigger)&&"sortAscending"!==e.name})).forEach((e=>{var o,c,u,h;const f=null!=(o=null==s||null==(c=s.controlValues)?void 0:c[e.name])?o:null==e||null==(u=e.config)?void 0:u.default,m=(0,b.tZ)(a.Fragment,null,(0,b.tZ)(vo,{name:["filters",i,"requiredFirst",e.name],hidden:!0,initialValue:(null==e||null==(h=e.config)?void 0:h.requiredFirst)&&(null==s?void 0:s.requiredFirst)}),(0,b.tZ)(Gn.u,{key:e.name,placement:"left",title:e.config.affectsDataMask&&t&&(0,d.t)('Populate "Default value" to enable this control')},(0,b.tZ)(wo,{key:e.name,name:["filters",i,"controlValues",e.name],initialValue:f,valuePropName:"checked",colon:!1},(0,b.tZ)(Re.XZ,{disabled:e.config.affectsDataMask&&t,onChange:({target:{checked:t}})=>{e.config.requiredFirst&&ii(r,i,{requiredFirst:{...null==l?void 0:l.requiredFirst,[e.name]:t}}),e.config.resetConfig&&ii(r,i,{defaultDataMask:null}),n()}},e.config.label," ",e.config.description&&(0,b.tZ)(Ki.V,{placement:"top",label:e.config.name,tooltip:e.config.description})))));p[e.name]={element:m,checked:f}})),{controlItems:p,mainControlItems:f}}({datasetId:pe,disabled:!1,forceUpdate:Q,form:r,filterId:e,filterType:null==te?void 0:te.filterType,filterToEdit:t,formFilter:te,removed:$}):{},ge=!!me.groupby,ve=!(null==(_=(null!=(T=ae[null==te?void 0:te.filterType])?T:{}).value)||!_.enableNoResults),be=ge&&!!V.length,ye=!he||pe&&((null==te?void 0:te.column)||!ge),Ce=Po.includes(null==te?void 0:te.filterType),Se=Xo.includes(null==te?void 0:te.filterType),xe=null==(D=null==te?void 0:te.isDataDirty)||D,ke=t=>{ii(r,e,t),L(""),Q()},we=(0,a.useCallback)(((t=!1)=>{var n,i;if(!he||null==te||null==(n=te.dataset)||!n.value)return void Q();const o=(0,kr.zi)({datasetId:null==te||null==(i=te.dataset)?void 0:i.value,groupby:null==te?void 0:te.column,...te});ke({defaultValueQueriesData:null,isDataDirty:!1}),(0,xr.getChartDataRequest)({formData:o,force:t,requestParams:{dashboardId:0}}).then((({response:e,json:t})=>{if((0,nt.cr)(c.T.GLOBAL_ASYNC_QUERIES)){const n="result"in t?t.result[0]:t;if(200===e.status)ke({defaultValueQueriesData:[n]});else{if(202!==e.status)throw new Error(`Received unexpected response status (${e.status}) while fetching chart data`);(0,Xi.YJ)(n).then((e=>{ke({defaultValueQueriesData:e})})).catch((e=>{L(e.message||e.error||(0,d.t)("Check configuration"))}))}}else ke({defaultValueQueriesData:t.result})})).catch((t=>{t.json().then((n=>{(t=>{ii(r,e,{defaultValueQueriesData:null}),L(t),Q()})(n.message||t.statusText||(0,d.t)("Check configuration"))}))}))}),[e,Q,r,te,he]),Fe=(0,kr.zi)({datasetId:pe,groupby:ge?null==te?void 0:te.column:void 0,...te}),[Te,_e,De,Me]=((e,t)=>{var n,r;const i=!(null==e||null==(n=e.controlValues)||!n.enableEmptyFilter),o=!(null==e||null==(r=e.controlValues)||!r.defaultToFirstItem),[s,l]=(0,a.useState)(!1),[c,u]=(0,a.useState)(i),[h,p]=(0,a.useState)(""),f=(e=!1)=>{const t=i&&!o;u(t),l(!!t||e)};return(0,a.useEffect)((()=>{var t,n;f(!o&&!(null==e||null==(t=e.defaultDataMask)||null==(n=t.filterState)||!n.value))}),[o,i]),(0,a.useEffect)((()=>{var e,n;f(!o&&!(null==t||null==(e=t.defaultDataMask)||null==(n=e.filterState)||!n.value))}),[]),(0,a.useEffect)((()=>{let e="";o?e=(0,d.t)('Default value set automatically when "Default to first item" is checked'):c?e=(0,d.t)('Default value must be set when "Required" is checked'):s&&(e=(0,d.t)('Default value must be set when "Filter has default value" is checked')),p(e)}),[s,c,o]),[s,c,h,f]})(te,t),Ee=!pe||J||(null==te||null==(M=te.dataset)?void 0:M.label),Ie=(0,a.useCallback)((()=>{r.setFields([{name:"changed",value:!0}])}),[r]),Oe=(0,a.useCallback)((t=>{ii(r,e,t),Ie()}),[e,r,Ie]),Pe=!!(null!=te&&te.adhoc_filters||null!=te&&te.time_range||null!=t&&null!=(E=t.adhoc_filters)&&E.length||null!=t&&t.time_range),Ne="boolean"==typeof(null==te||null==(I=te.controlValues)?void 0:I.sortAscending)||"boolean"==typeof(null==t||null==(O=t.controlValues)?void 0:O.sortAscending);let je=null==t||null==(P=t.controlValues)?void 0:P.sortAscending;"boolean"==typeof(null==te||null==(N=te.controlValues)?void 0:N.sortAscending)&&(je=te.controlValues.sortAscending);const qe=!he||!xe&&ye||!me.groupby,ze=t=>{var n;const i=null==(n=r.getFieldValue("filters"))?void 0:n[e].controlValues;ii(r,e,{controlValues:{...i,sortAscending:t}}),Q()},Ae=()=>setTimeout((()=>r.validateFields([["filters",e,"adhoc_filters"],["filters",e,"time_range"]])),0),$e=(null==te?void 0:te.time_range)&&"No filter"!==te.time_range,Ue=(null==te||null==(j=te.adhoc_filters)?void 0:j.length)>0,Le=null==te||null==(q=te.controlValues)?void 0:q.defaultToFirstItem,Ve="filter_select"===(null==te?void 0:te.filterType)||"filter_range"===(null==te?void 0:te.filterType),Ke=(null==te?void 0:te.filterType)===(null==t?void 0:t.filterType)?null==t?void 0:t.defaultDataMask:null,Be=()=>$e||Ue?Promise.resolve():Promise.reject(new Error((0,d.t)("Pre-filter is required")));(0,a.useEffect)((()=>{pe&&zo({endpoint:`/api/v1/dataset/${pe}`}).then((e=>{var t,n,r;K(null==(t=e.json)||null==(n=t.result)?void 0:n.metrics);const i=null==(r=e.json)?void 0:r.result;i.type=i.datasource_type,i.filter_select=!0,Y(i)})).catch((e=>{(0,mr.Gb)(e.message)}))}),[pe]),(0,a.useImperativeHandle)(g,(()=>({changeTab(e){W(e)}}))),((e,t)=>{var n;const r=ri(),i=(e.getFieldValue("filters")||{})[t];(0,a.useEffect)((()=>{ii(e,t,{isDataDirty:!0,defaultValueQueriesData:null}),r()}),[e,null==i?void 0:i.filterType,null==i?void 0:i.column,null==i||null==(n=i.dataset)?void 0:n.value,JSON.stringify(null==i?void 0:i.adhoc_filters),null==i?void 0:i.time_range,r,t])})(r,e),(0,a.useEffect)((()=>{he&&ye&&Te&&xe&&we()}),[he,ye,Te,xe,we,Ee]),(0,a.useEffect)((()=>{if(l&&!qt()(fe)){const t=oe||Pe||Ne||Object.keys(fe).filter((e=>!No.includes(e))).some((e=>fe[e].checked));f(t?[`${e}-${Oo.basic.key}`,`${e}-${Oo.advanced.key}`]:`${e}-${Oo.basic.key}`)}}),[l]);const We=(0,a.useMemo)((()=>{var e;const t=[];return void 0===(null==te||null==(e=te.dataset)?void 0:e.value)?[]:(Object.values(de).forEach((e=>{var n,r,i;const o=null==(n=e.formData)?void 0:n.datasource;void 0!==o&&(null==(r=le[o])?void 0:r.id)!==(null==te||null==(i=te.dataset)?void 0:i.value)&&t.push(e.id)})),t)}),[JSON.stringify(de),null==te||null==(z=te.dataset)?void 0:z.value,JSON.stringify(le)]);return(0,a.useEffect)((()=>{$&&G(ee)}),[$]),(0,a.useEffect)((()=>{H&&!$&&(ii(r,e,H),G(null))}),[ee,e,r,$,H]),$?(0,b.tZ)(yo,{onClick:()=>u(e)}):(0,b.tZ)(Mo,{activeKey:B,onChange:e=>W(e),centered:!0},(0,b.tZ)(Co,{tab:Io.configuration.name,key:Io.configuration.key,forceRender:!0},(0,b.tZ)(So,null,(0,b.tZ)(ko,{name:["filters",e,"type"],hidden:!0,initialValue:mi.B.NATIVE_FILTER},(0,b.tZ)(Re.II,null)),(0,b.tZ)(ko,{name:["filters",e,"name"],label:(0,b.tZ)(Zo,null,(0,d.t)("Filter name")),initialValue:null==t?void 0:t.name,rules:[{required:!$,message:(0,d.t)("Name is required")}]},(0,b.tZ)(Re.II,Yo("name-input"))),(0,b.tZ)(ko,ut()({name:["filters",e,"filterType"],rules:[{required:!$,message:(0,d.t)("Name is required")}],initialValue:(null==t?void 0:t.filterType)||"filter_select",label:(0,b.tZ)(Zo,null,(0,d.t)("Filter Type"))},Yo("filter-type")),(0,b.tZ)(Ze.P,{ariaLabel:(0,d.t)("Filter type"),options:se.map((e=>{var t,n,r;const i=null==(t=ae[e])?void 0:t.value.name,o=i?jo[i]:void 0,a=1===(null==(n=ni[e])?void 0:n.length)&&(null==(r=ni[e])?void 0:r.includes(Xr.Z.TEMPORAL))&&!ce;return{value:e,label:o||i,customLabel:a?(0,b.tZ)(Gn.u,{title:(0,d.t)("Datasets do not contain a temporal column")},o||i):void 0,disabled:a}})),onChange:t=>{ii(r,e,{filterType:t,defaultDataMask:null,column:null}),Q()}}))),he&&(0,b.tZ)(xo,null,Ee?(0,b.tZ)(ko,ut()({name:["filters",e,"dataset"],label:(0,b.tZ)(Zo,null,(0,d.t)("Dataset")),initialValue:J?{label:J.table_name,value:J.id}:void 0,rules:[{required:!$,message:(0,d.t)("Dataset is required")}]},Yo("datasource-input")),(0,b.tZ)(po,{onChange:t=>{t.value!==pe&&ii(r,e,{dataset:t,defaultDataMask:null,column:null}),Q()}})):(0,b.tZ)(ko,{label:(0,b.tZ)(Zo,null,(0,d.t)("Dataset"))},(0,b.tZ)(h.Z,{position:"inline-centered"})),he&&Object.keys(me).map((e=>me[e].element))),(0,b.tZ)(Do,{activeKey:s,onChange:e=>{f(e)},expandIconPosition:"right",key:`native-filter-config-${e}`},(0,b.tZ)(Bi.Z.Panel,{forceRender:!0,header:Oo.basic.name,key:`${e}-${Oo.basic.key}`},(0,b.tZ)(Fo,{name:["filters",e,"defaultValueQueriesData"],hidden:!0,initialValue:null}),(0,b.tZ)(Fo,{name:["filters",e,"defaultValue"]},(0,b.tZ)(no,{checked:Te,disabled:_e||Le,initialValue:Te,title:(0,d.t)("Filter has default value"),tooltip:De,onChange:e=>{Me(e),Ie()}},!$&&(0,b.tZ)(Ro,{name:["filters",e,"defaultDataMask"],initialValue:Ke,label:(0,b.tZ)(Zo,null,(0,d.t)("Default Value")),required:Te,rules:[{validator:()=>{var t,n;if(null!=te&&null!=(t=te.defaultDataMask)&&null!=(n=t.filterState)&&n.value){const e=r.getFieldsError();return m((t=>t.length&&!e.find((e=>e.errors.length>0))?[]:t)),Promise.resolve()}return m((t=>t.includes(e)?t:[...t,e])),Promise.reject(new Error((0,d.t)("Default value is required")))}}]},U?(0,b.tZ)(Qi,{title:(0,d.t)("Cannot load filter"),body:U,level:"error"}):qe?(0,b.tZ)(To,null,(0,b.tZ)(mo,{setDataMask:t=>{var n,i;Ir()(null==Ke||null==(n=Ke.filterState)?void 0:n.value,null==t||null==(i=t.filterState)?void 0:i.value)||Ie(),ii(r,e,{defaultDataMask:t}),r.validateFields([["filters",e,"defaultDataMask"]]),Q()},hasDefaultValue:Te,filterId:e,hasDataset:he,form:r,formData:Fe,enableNoResults:ve}),he&&pe&&(0,b.tZ)(Gn.u,{title:(0,d.t)("Refresh the default values")},(0,b.tZ)(_o,{onClick:()=>we(!0)}))):(0,d.t)('Fill all required fields to enable "Default Value"')))),Object.keys(fe).filter((e=>No.includes(e))).map((e=>fe[e].element)),(0,b.tZ)(ko,{name:["filters",e,"description"],initialValue:null==t?void 0:t.description,label:(0,b.tZ)(Zo,null,(0,d.t)("Description"))},(0,b.tZ)(Re.Kx,null))),Ve&&(0,b.tZ)(Bi.Z.Panel,{forceRender:!0,header:Oo.advanced.name,key:`${e}-${Oo.advanced.key}`},Se&&(0,b.tZ)(Fo,{name:["filters",e,"hierarchicalFilter"]},(0,b.tZ)(no,{title:(0,d.t)("Filter is hierarchical"),initialValue:oe,onChange:t=>{Ie(),setTimeout((()=>{t?r.validateFields([["filters",e,"parentFilter"]]):ii(r,e,{parentFilter:void 0}),p(e,t?r.getFieldValue("filters")[e].parentFilter:void 0)}),0)}},(0,b.tZ)(Ro,{name:["filters",e,"parentFilter"],label:(0,b.tZ)(Zo,null,(0,d.t)("Parent filter")),initialValue:ie,normalize:e=>e?{value:e}:void 0,required:!0,rules:[{required:!0,message:(0,d.t)("Parent filter is required")}]},(0,b.tZ)((({value:e,...t})=>{const r=null==e?void 0:e.value,i=r&&n[r];let o=ne;return i&&(o=[{label:(0,d.t)("(deleted)"),value:r},...ne]),(0,b.tZ)(Ze.P,ut()({ariaLabel:(0,d.t)("Parent filter"),placeholder:(0,d.t)("None"),options:o,allowClear:!0,value:r},t))}),null)))),Object.keys(fe).filter((e=>!No.includes(e))).map((e=>fe[e].element)),he&&Ce&&(0,b.tZ)(Fo,{name:["filters",e,"preFilter"]},(0,b.tZ)(no,{initialValue:Pe,title:(0,d.t)("Pre-filter available values"),onChange:e=>{Ie(),e&&Ae()}},(0,b.tZ)(Ro,{name:["filters",e,"adhoc_filters"],initialValue:null==t?void 0:t.adhoc_filters,required:!0,rules:[{validator:Be}]},(0,b.tZ)(Yi.Z,{columns:(null==J||null==(A=J.columns)?void 0:A.filter((e=>e.filterable)))||[],savedMetrics:(null==J?void 0:J.metrics)||[],datasource:J,onChange:t=>{ii(r,e,{adhoc_filters:t}),Q(),Ae()},label:(0,b.tZ)("span",null,(0,b.tZ)(Zo,null,(0,d.t)("Pre-filter")),!$e&&(0,b.tZ)(Eo,null))})),ue&&(0,b.tZ)(wo,{name:["filters",e,"time_range"],label:(0,b.tZ)(Zo,null,(0,d.t)("Time range")),initialValue:(null==t?void 0:t.time_range)||"No filter",required:!Ue,rules:[{validator:Be}]},(0,b.tZ)(Ji.Z,{name:"time_range",endpoints:["inclusive","exclusive"],onChange:t=>{ii(r,e,{time_range:t}),Q(),Ae()}})),$e&&(0,b.tZ)(wo,{name:["filters",e,"granularity_sqla"],label:(0,b.tZ)(a.Fragment,null,(0,b.tZ)(Zo,null,(0,d.t)("Time column"))," ",(0,b.tZ)(Ki.V,{placement:"top",tooltip:(0,d.t)("Optional time column if time range should apply to another column than the default time column")})),initialValue:null==t?void 0:t.granularity_sqla},(0,b.tZ)(lo,{allowClear:!0,form:r,formField:"granularity_sqla",filterId:e,filterValues:e=>!!e.is_dttm,datasetId:pe,onChange:t=>{ii(r,e,{granularity_sqla:t}),Q()}})))),"filter_range"!==(null==te?void 0:te.filterType)&&(0,b.tZ)(Fo,{name:["filters",e,"sortFilter"]},(0,b.tZ)(no,{initialValue:Ne,title:(0,d.t)("Sort filter values"),onChange:e=>{ze(e||void 0),Ie()}},(0,b.tZ)(wo,{name:["filters",e,"controlValues","sortAscending"],initialValue:je,label:(0,b.tZ)(Zo,null,(0,d.t)("Sort type"))},(0,b.tZ)(_t.Y.Group,{onChange:e=>{ze(e.target.value)}},(0,b.tZ)(_t.Y,{value:!0},(0,d.t)("Sort ascending")),(0,b.tZ)(_t.Y,{value:!1},(0,d.t)("Sort descending")))),be&&(0,b.tZ)(Ro,{name:["filters",e,"sortMetric"],initialValue:null==t?void 0:t.sortMetric,label:(0,b.tZ)(a.Fragment,null,(0,b.tZ)(Zo,null,(0,d.t)("Sort Metric"))," ",(0,b.tZ)(Ki.V,{placement:"top",tooltip:(0,d.t)("If a metric is specified, sorting will be done based on the metric value")}))},(0,b.tZ)(Ze.P,{allowClear:!0,ariaLabel:(0,d.t)("Sort metric"),name:"sortMetric",options:V.map((e=>{var t;return{value:e.metric_name,label:null!=(t=e.verbose_name)?t:e.metric_name}})),onChange:t=>{void 0!==t&&(ii(r,e,{sortMetric:t}),Q())}}))))))),(0,b.tZ)(Co,{tab:Io.scoping.name,key:Io.scoping.key,forceRender:!0},(0,b.tZ)(Qr,{updateFormValues:Oe,pathToFormValue:["filters",e],forceUpdate:Q,filterScope:null==t?void 0:t.scope,formFilterScope:null==te?void 0:te.scope,formScopingType:null==te?void 0:te.scoping,initiallyExcludedCharts:We})))},$o=(0,a.forwardRef)(Ao);var Uo={name:"ihui0v",styles:"text-align:left;& .ant-alert-action{align-self:center;}"},Lo={name:"zjik7",styles:"display:flex"};function Vo({title:e,onConfirm:t,onDismiss:n,children:r}){return(0,b.tZ)(xt.Z,{closable:!1,type:"warning",key:"alert",message:e,css:Uo,description:r,action:(0,b.tZ)("div",{css:Lo},(0,b.tZ)(it.Z,{key:"cancel",buttonSize:"small",buttonStyle:"secondary",onClick:n},(0,d.t)("Keep editing")),(0,b.tZ)(it.Z,{key:"submit",buttonSize:"small",buttonStyle:"primary",onClick:t},(0,d.t)("Yes, cancel")))})}const Ko=({canSave:e=!0,onCancel:t,handleSave:n,onDismiss:r,onConfirmCancel:i,saveAlertVisible:o})=>o?(0,b.tZ)(Vo,{key:"cancel-confirm",title:(0,d.t)("There are unsaved changes."),onConfirm:i,onDismiss:r},(0,d.t)("Are you sure you want to cancel?")):(0,b.tZ)(a.Fragment,null,(0,b.tZ)(it.Z,{key:"cancel",buttonStyle:"secondary",onClick:t},(0,d.t)("Cancel")),(0,b.tZ)(it.Z,{disabled:!e,key:"submit",buttonStyle:"primary",onClick:n},(0,d.t)("Save")));var Bo=n(92242);const Wo=v.iK.div`
  ${({theme:e})=>`\n    padding: ${4*e.gridUnit}px;\n  `}
`,Ho=({componentId:e,divider:t})=>(0,b.tZ)(Wo,null,(0,b.tZ)(kt.xJ,{initialValue:t?t.title:"",label:(0,d.t)("Title"),name:["filters",e,"title"],rules:[{required:!0,message:(0,d.t)("Title is required"),whitespace:!0}]},(0,b.tZ)(Re.II,null)),(0,b.tZ)(kt.xJ,{initialValue:t?t.description:"",label:(0,d.t)("Description"),name:["filters",e,"description"]},(0,b.tZ)(Re.Kx,{rows:4})),(0,b.tZ)(kt.xJ,{hidden:!0,name:["filters",e,"type"],initialValue:mi.B.DIVIDER})),Go=(0,v.iK)(qr.o)`
  min-width: 700px;
  .ant-modal-body {
    padding: 0px;
  }
`,Qo=v.iK.div`
  display: flex;
  height: 700px;
  flex-direction: row;
  .filters-list {
    width: ${({theme:e})=>50*e.gridUnit}px;
    overflow: auto;
  }
`,Jo=(0,v.iK)(Re.l0)`
  width: 100%;
`,Yo=(0,fi.Q)("filters-config-modal"),Xo=["filter_select"];function ea({isOpen:e,initialFilterId:t,createNewOnOpen:n,onSave:r,onCancel:i}){const[o]=Re.l0.useForm(),s=(0,a.useRef)(),l=vi(),c=function(){const e=vi();return(0,a.useMemo)((()=>e.reduce(((e,t)=>(e[t.id]=t,e)),{})),[e])}(),[u,h]=(0,a.useState)([]),[p,f]=(0,a.useState)({}),[m,g]=(0,a.useState)(!1),v=(0,a.useMemo)((()=>hi()([...(0,Bo.QN)(l),...u]).filter((e=>{var t;return!p[e]||(null==(t=p[e])?void 0:t.isPending)}))),[l,u,p]),C=null!=t?t:v[0],[S,x]=(0,a.useState)(C),[w,R]=(0,a.useState)([]),[Z,F]=(0,a.useState)({filters:{}}),T=u.filter((e=>!p[e])),_=e=>{const t=p[e];null!=t&&t.isPending&&clearTimeout(t.timerId),f((t=>({...t,[e]:null})))},D=()=>l.map((e=>({id:e.id,parentId:e.type===mi.B.NATIVE_FILTER&&e.cascadeParentIds[0]||null}))),[M,E]=(0,a.useState)((()=>D())),[I,O]=(0,a.useState)((()=>(0,Bo.Zh)(M))),[P,N]=(0,a.useState)(`${C}-${Oo.basic.key}`),j=(0,a.useCallback)((e=>{const t=(0,Bo.W6)(e);h([...u,t]),x(t),g(!1),E((e=>[...e,{id:t,parentId:null}])),O([...I,[t]]),N(`${t}-${Oo.basic.key}`)}),[u,I,x,E,O,h]);((e,t,n)=>{const r=(0,ro.D)(e);(0,a.useEffect)((()=>{n&&e&&!r&&t(mi.B.NATIVE_FILTER)}),[n,e,r,t])})(e,j,n),((e,t,n,r)=>{(0,a.useEffect)((()=>{const i=e[t];if(i&&!i.isPending){const i=n.flat().find((n=>!e[n]&&n!==t));i&&r(i)}}),[t,e,n,r])})(p,S,I,x);const q=(0,Bo.EJ)(f,g,O,E,M),z=(e=!1)=>{if(h([]),x(C),f({}),g(!1),F({filters:{}}),R([]),!e){const e=D();E(e),O((0,Bo.Zh)(e)),o.resetFields(["filters"])}o.setFieldsValue({changed:!1})},A=e=>{const t=Z.filters[e],n=c[e];return t&&"name"in t&&t.name||t&&"title"in t&&t.title||n&&"name"in n&&n.name||n&&"title"in n&&n.title||"[untitled]"},$=e=>v.filter((t=>t!==e&&!p[t])).filter((e=>{const t=Z.filters[e]||c[e];return t&&"filterType"in t&&Xo.includes(t.filterType)})).map((e=>({id:e,title:A(e)}))),U=(0,a.useCallback)((()=>{const e=o.getFieldsError(),t=[];e.forEach((e=>{const n=e.name[1];e.errors.length>0&&!t.includes(n)&&t.push(n)})),!t.length&&w.length>0?R([]):t.length>0&&!Ir()(ci()(w),ci()(t))&&R(t)}),[o,w]),L=async()=>{const e=await(0,Bo.G$)(o,S,c,v,p,x);U(),e?((e=>{Object.keys(c).forEach((e=>{var t;const n=c[e];if(!("cascadeParentIds"in n))return;const r=null==(t=n.cascadeParentIds)?void 0:t[0];r&&p[r]&&(n.cascadeParentIds=[])}));const t=null==e?void 0:e.filters;t&&Object.keys(t).forEach((e=>{var n;const r=t[e];if(!("parentFilter"in r))return;const i=null==(n=r.parentFilter)?void 0:n.value;i&&p[i]&&(r.parentFilter=void 0)}))})(e),(0,Bo.GA)(c,I.flat(),p,r,e)(),z(!0)):s.current.changeTab("configuration")},V=()=>{z(),i()},K=()=>{const e=o.getFieldValue("changed"),t=(0,Bo.Zh)(D()).flat(),n=I.flat().length!==t.length||I.flat().some(((e,n)=>e!==t[n]));T.length>0||o.isFieldsTouched()||e||n?g(!0):V()},B=(0,a.useCallback)(((e,t)=>{const n=M.findIndex((t=>t.id===e)),r=[...M];r.splice(n,1,{id:e,parentId:t?t.value:null}),E(r),O((0,Bo.Zh)(r))}),[E,O,M]),W=(0,a.useMemo)((()=>k()(((e,t)=>{const n=e.filters&&Object.values(e.filters).some((e=>null!==e.name)),r=e.filters&&Object.values(e.filters).some((e=>null!==e.title));(n||r)&&F(t);const i=Object.keys(e.filters).filter((t=>e.filters[t].parentFilter)).map((t=>({id:t,parentFilter:e.filters[t].parentFilter})));if(i.length>0){const e=i[0];B(e.id,e.parentFilter)}g(!1),U()}),pi.M)),[B,U]);return(0,a.useEffect)((()=>{R((e=>e.filter((e=>!p[e]))))}),[p]),(0,b.tZ)(Go,{visible:e,maskClosable:!1,title:(0,d.t)("Filters configuration and scoping"),width:"50%",destroyOnClose:!0,onCancel:K,onOk:L,centered:!0,footer:(0,b.tZ)(Ko,{onDismiss:()=>g(!1),onCancel:K,handleSave:L,canSave:!w.length,saveAlertVisible:m,onConfirmCancel:V})},(0,b.tZ)(y.Z,null,(0,b.tZ)(Qo,null,(0,b.tZ)(Jo,{form:o,onValuesChange:W,layout:"vertical"},(0,b.tZ)(Vi,{erroredFilters:w,onRemove:q,onAdd:j,onChange:e=>{x(e),N(`${e}-${Oo.basic.key}`)},getFilterTitle:A,currentFilterId:S,removedFilters:p,restoreFilter:_,onRearrange:(e,t)=>{const n=I.map((e=>[...e])),r=n.splice(e,1)[0];n.splice(t,0,r),O(n)},filterGroups:I},(e=>(e=>e.startsWith(Bo.Ky)?(0,b.tZ)(Ho,{componentId:e,divider:c[e]}):(0,b.tZ)($o,{ref:s,form:o,filterId:e,filterToEdit:c[e],removedFilters:p,restoreFilter:_,parentFilters:$(e),onFilterHierarchyChange:B,key:e,activeFilterPanelKeys:P,handleActiveFilterPanelChange:e=>N(e),isActive:S===e,setErroredFilters:R}))(e)))))))}const ta=({isOpen:e,chartId:t,onClose:n})=>{var r,i;const s=(0,o.I0)(),[l]=Re.l0.useForm(),c=(0,o.v9)((({dashboardInfo:e})=>{var t;return null==e||null==(t=e.metadata)?void 0:t.chart_configuration})),u=null==c||null==(r=c[t])||null==(i=r.crossFilters)?void 0:i.scope,h=()=>{s((0,pr.Aw)({...c,[t]:{id:t,crossFilters:{scope:l.getFieldValue("scope")}}})),n()};return(0,b.tZ)(qr.o,{visible:e,maskClosable:!1,title:(0,d.t)("Cross Filter Scoping"),width:"55%",destroyOnClose:!0,onCancel:n,onOk:h,centered:!0,footer:(0,b.tZ)(a.Fragment,null,(0,b.tZ)(it.Z,{key:"cancel",buttonStyle:"secondary",onClick:n},(0,d.t)("Cancel")),(0,b.tZ)(it.Z,{key:"submit",buttonStyle:"primary",onClick:h},(0,d.t)("Save")))},(0,b.tZ)(Jo,{preserve:!1,form:l,layout:"vertical"},(0,b.tZ)(li,{form:l,scope:u,chartId:t})))};var na=n(15423);const ra="cross_filter_scoping",ia="download_as_image",oa="explore_chart",aa="export_csv",sa="export_full_csv",la="force_refresh",da="resize_label",ca="toggle_chart_description",ua=v.iK.div`
  padding: ${({theme:e})=>e.gridUnit/4}px
    ${({theme:e})=>1.5*e.gridUnit}px;

  .dot {
    display: block;
  }

  &:hover {
    cursor: pointer;
  }
`,ha=v.iK.div`
  height: auto;
  margin: ${({theme:e})=>e.gridUnit}px 0;
  color: ${({theme:e})=>e.colors.grayscale.base};
  line-height: ${({theme:e})=>1.5*e.typography.sizes.m}px;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  justify-content: flex-start;
`,pa=".dashboard-component-chart-holder",fa=()=>(0,b.tZ)(ua,null,(0,b.tZ)("span",{className:"dot"}),(0,b.tZ)("span",{className:"dot"}),(0,b.tZ)("span",{className:"dot"}));class ma extends a.PureComponent{constructor(e){super(e),this.toggleControls=this.toggleControls.bind(this),this.refreshChart=this.refreshChart.bind(this),this.handleMenuClick=this.handleMenuClick.bind(this),this.state={showControls:!1,showCrossFilterScopingModal:!1}}refreshChart(){this.props.updatedDttm&&this.props.forceRefresh(this.props.slice.slice_id,this.props.dashboardId)}toggleControls(){this.setState((e=>({showControls:!e.showControls})))}handleMenuClick({key:e,domEvent:t}){switch(e){case la:this.refreshChart();break;case ra:this.setState({showCrossFilterScopingModal:!0});break;case ca:this.props.toggleExpandSlice&&this.props.toggleExpandSlice(this.props.slice.slice_id);break;case oa:this.props.logExploreChart&&this.props.logExploreChart(this.props.slice.slice_id);break;case aa:this.props.exportCSV&&this.props.exportCSV(this.props.slice.slice_id);break;case da:this.props.handleToggleFullSize();break;case sa:this.props.exportFullCSV&&this.props.exportFullCSV(this.props.slice.slice_id);break;case ia:{const e=document.querySelector(".ant-dropdown:not(.ant-dropdown-hidden)");e.style.visibility="hidden",(0,Fn.Z)(pa,this.props.slice.slice_name)(t).then((()=>{e.style.visibility="visible"}));break}}}render(){var e;const{slice:t,isFullSize:n,componentId:r,cachedDttm:i=[],updatedDttm:o=null,addSuccessToast:s=(()=>{}),addDangerToast:l=(()=>{}),supersetCanShare:u=!1,isCached:h=[]}=this.props,p=(0,Nr.Z)().items,f="table"===t.viz_type,m=Object.entries(p).filter((([,{value:e}])=>{var t;return null==(t=e.behaviors)?void 0:t.includes(jr.cg.INTERACTIVE_CHART)})).find((([e])=>e===t.viz_type)),g=null==(e=t.form_data)?void 0:e.emit_filter,v=(i||[]).map((e=>Ye().utc(e).fromNow())),y=o?Ye().utc(o).fromNow():"",C=[...new Set(h.map((e=>e?(0,d.t)("Cached %s",v):y?(0,d.t)("Fetched %s",y):""))||"")],S=C.map(((e,t)=>(0,b.tZ)("div",{key:`tooltip-${t}`},C.length>1?(0,d.t)("Query %s: %s",t+1,e):e))),x=n?(0,d.t)("Minimize chart"):(0,d.t)("Maximize chart"),k=(0,b.tZ)(Re.v2,{onClick:this.handleMenuClick,selectable:!1},(0,b.tZ)(Re.v2.Item,{key:la,disabled:"loading"===this.props.chartStatus,style:{height:"auto",lineHeight:"initial"}},(0,d.t)("Force refresh"),(0,b.tZ)(ha,null,S)),(0,b.tZ)(Re.v2.Divider,null),t.description&&(0,b.tZ)(Re.v2.Item,{key:ca},(0,d.t)("Toggle chart description")),this.props.supersetCanExplore&&(0,b.tZ)(Re.v2.Item,{key:oa},(0,b.tZ)("a",{href:this.props.exploreUrl,rel:"noopener noreferrer"},(0,d.t)("View chart in Explore"))),this.props.supersetCanExplore&&(0,b.tZ)(Re.v2.Item,{key:"view_query"},(0,b.tZ)(mt.Z,{triggerNode:(0,b.tZ)("span",null,(0,d.t)("View query")),modalTitle:(0,d.t)("View query"),modalBody:(0,b.tZ)(na.Z,{latestQueryFormData:this.props.formData}),draggable:!0,resizable:!0,responsive:!0})),u&&(0,b.tZ)(ft,{url:jn({pathname:window.location.pathname,filters:(0,on.De)(),hash:r}),copyMenuItemTitle:(0,d.t)("Copy chart URL"),emailMenuItemTitle:(0,d.t)("Share chart by email"),emailSubject:(0,d.t)("Superset chart"),emailBody:(0,d.t)("Check out this chart: "),addSuccessToast:s,addDangerToast:l}),(0,b.tZ)(Re.v2.Item,{key:da},x),(0,b.tZ)(Re.v2.Item,{key:ia},(0,d.t)("Download as image")),"filter_box"!==this.props.slice.viz_type&&this.props.supersetCanCSV&&(0,b.tZ)(Re.v2.Item,{key:aa},(0,d.t)("Export CSV")),"filter_box"!==this.props.slice.viz_type&&(0,nt.cr)(c.T.ALLOW_FULL_CSV_EXPORT)&&this.props.supersetCanCSV&&f&&(0,b.tZ)(Re.v2.Item,{key:sa},(0,d.t)("Export full CSV")),(0,nt.cr)(c.T.DASHBOARD_CROSS_FILTERS)&&m&&g&&(0,b.tZ)(Re.v2.Item,{key:ra},(0,d.t)("Cross-filter scoping")));return(0,b.tZ)(a.Fragment,null,(0,b.tZ)(ta,{chartId:t.slice_id,isOpen:this.state.showCrossFilterScopingModal,onClose:()=>this.setState({showCrossFilterScopingModal:!1})}),n&&(0,b.tZ)(rt.Z.FullscreenExitOutlined,{style:{fontSize:22},onClick:()=>{this.props.handleToggleFullSize()}}),(0,b.tZ)(Re.$i,{overlay:k,trigger:["click"],placement:"bottomRight",getPopupContainer:e=>e.closest(pa)},(0,b.tZ)("span",{id:`slice_${t.slice_id}-controls`,role:"button","aria-label":"More Options"},(0,b.tZ)(fa,null))))}}const ga=ma;var va=n(87185),ba=n.n(va);const ya={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm193.5 301.7l-210.6 292a31.8 31.8 0 01-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.2 0 19.9 4.9 25.9 13.3l71.2 98.8 157.2-218c6-8.3 15.6-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.5 12.7z"}}]},name:"check-circle",theme:"filled"};var Ca=n(27029),Sa=function(e,t){return a.createElement(Ca.Z,Object.assign({},e,{ref:t,icon:ya}))};Sa.displayName="CheckCircleFilled";const xa=a.forwardRef(Sa),ka={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm-32 232c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V296zm32 440a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"exclamation-circle",theme:"filled"};var wa=function(e,t){return a.createElement(Ca.Z,Object.assign({},e,{ref:t,icon:ka}))};wa.displayName="ExclamationCircleFilled";const Ra=a.forwardRef(wa),Za={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm192 472c0 4.4-3.6 8-8 8H328c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h368c4.4 0 8 3.6 8 8v48z"}}]},name:"minus-circle",theme:"filled"};var Fa=function(e,t){return a.createElement(Ca.Z,Object.assign({},e,{ref:t,icon:Za}))};Fa.displayName="MinusCircleFilled";const Ta=a.forwardRef(Fa);var _a=n(76697);const Da=v.iK.div`
  display: inline-block;
  color: ${({theme:e})=>e.colors.grayscale.light5};
  background: ${({theme:e})=>e.colors.grayscale.base};
  border-radius: 1em;
  vertical-align: text-top;
  padding: ${({theme:e})=>`${e.gridUnit}px ${2*e.gridUnit}px`};
  font-size: ${({theme:e})=>e.typography.sizes.m}px;
  font-weight: bold;
  min-width: 1em;
  min-height: 1em;
  line-height: 1em;
  vertical-align: middle;
  white-space: nowrap;

  svg {
    position: relative;
    top: -2px;
    color: ${({theme:e})=>e.colors.grayscale.light5};
    width: 1em;
    height: 1em;
    display: inline-block;
    vertical-align: middle;
  }

  &:hover {
    cursor: pointer;
    background: ${({theme:e})=>e.colors.grayscale.dark1};
  }

  &.has-cross-filters {
    background: ${({theme:e})=>e.colors.primary.base};
    &:hover {
      background: ${({theme:e})=>e.colors.primary.dark1};
    }
  }

  &.has-incompatible-filters {
    color: ${({theme:e})=>e.colors.grayscale.dark2};
    background: ${({theme:e})=>e.colors.alert.base};
    &:hover {
      background: ${({theme:e})=>e.colors.alert.dark1};
    }
    svg {
      color: ${({theme:e})=>e.colors.grayscale.dark2};
    }
  }

  &.filters-inactive {
    color: ${({theme:e})=>e.colors.grayscale.light5};
    background: ${({theme:e})=>e.colors.grayscale.light1};
    padding: ${({theme:e})=>e.gridUnit}px;
    text-align: center;
    height: 22px;
    width: 22px;

    &:hover {
      background: ${({theme:e})=>e.colors.grayscale.base};
    }
  }
`,Ma=v.iK.span`
  position: relative;
  margin-right: ${({theme:e})=>e.gridUnit}px;
  font-weight: ${({bold:e,theme:t})=>e?t.typography.weights.bold:"auto"};
  color: ${({color:e,theme:t})=>e||t.colors.grayscale.light5};
  display: flex;
  align-items: center;
  & > * {
    margin-right: ${({theme:e})=>e.gridUnit}px;
  }
`,Ea=v.iK.i`
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  left: -${({theme:e})=>5*e.gridUnit}px;
`,Ia=v.iK.button`
  cursor: pointer;
  display: flex;
  flex-wrap: wrap;
  text-align: left;
  padding: 0;
  border: none;
  background: none;
  outline: none;
  width: 100%;

  &::-moz-focus-inner {
    border: 0;
  }

  & i svg {
    color: transparent;
    margin-right: ${({theme:e})=>e.gridUnit}px;
  }

  &:hover i svg {
    color: inherit;
  }
`,Oa=v.iK.div`
  margin: 0 -${({theme:e})=>4*e.gridUnit}px;
`,Pa=v.iK.div`
  padding-left: ${({theme:e})=>6*e.gridUnit}px;
  margin: -${({theme:e})=>3*e.gridUnit}px 0;
`,Na=v.iK.div`
  min-width: 200px;
  max-width: 300px;
  overflow-x: hidden;
`,ja=v.iK.div`
  max-width: 100%;
  flex-grow: 1;
  overflow: auto;
  color: ${({theme:e})=>e.colors.grayscale.light5};
`,qa=v.iK.div`
  ${({theme:e})=>`\n  padding-top: ${3*e.gridUnit}px;\n  max-width: 100%;\n  flex-grow: 1;\n  overflow: auto;\n  color: ${e.colors.grayscale.light5};\n  `}
`;var za=n(76570);n(14670);const Aa=(0,d.t)("Please apply filter changes"),$a=e=>null==e?"":"string"==typeof e||"number"==typeof e?`${e}`:Array.isArray(e)?e.join(", "):"object"==typeof e?JSON.stringify(e):(0,d.t)("Unknown value"),Ua=({filterSetFilterValues:e,dataMaskSelected:t})=>e.find((({dataMask:e={}})=>{const n=Object.entries(t);return n.every((([t,r])=>{var i;const o=(0,wr.JB)(r.filterState,null==e||null==(i=e[t])?void 0:i.filterState,{ignoreUndefined:!0,ignoreNull:!0}),a=n.length===Object.keys(null!=e?e:{}).length;return o&&a}))})),La=({indicator:{column:e,name:t,value:n,path:r=[]},onClick:i=(()=>{}),text:o})=>{const s=$a(n);return(0,b.tZ)(a.Fragment,null,(0,b.tZ)(Ia,{onClick:()=>i([...r,`LABEL-${e}`])},(0,b.tZ)(Ma,{bold:!0},(0,b.tZ)(Ea,null,(0,b.tZ)(za.Z,null)),t,s?": ":""),(0,b.tZ)(ja,null,s)),o&&(0,b.tZ)(qa,null,o))},Va=({appliedCrossFilterIndicators:e=[],appliedIndicators:t=[],incompatibleIndicators:n=[],unsetIndicators:r=[],onHighlightFilterSource:i,children:s})=>{const[l,c]=(0,a.useState)(!1),u=(0,v.Fg)(),h=(0,o.v9)((e=>{var t;return null==(t=e.dashboardState)?void 0:t.activeTabs}));(0,a.useEffect)((()=>{l&&window.addEventListener("resize",(()=>c(!1)),{once:!0})}),[l]),(0,a.useEffect)((()=>{c(!1)}),[h]);const p=()=>{const r=[];return e.length&&r.push("appliedCrossFilters"),t.length&&r.push("applied"),n.length&&r.push("incompatible"),r.length?r:["unset"]},[f,m]=(0,a.useState)((()=>[...p()])),g=e=>`${e.column} - ${e.name}`,y=(0,b.tZ)(Na,null,(0,b.tZ)(b.xB,{styles:(0,b.iv)(".filterStatusPopover{.ant-popover-inner{background-color:",u.colors.grayscale.dark2,"cc;.ant-popover-inner-content{padding-top:0;padding-bottom:0;}}&.ant-popover-placement-bottom,&.ant-popover-placement-bottomLeft,&.ant-popover-placement-bottomRight{&>.ant-popover-content>.ant-popover-arrow{border-top-color:",u.colors.grayscale.dark2,"cc;border-left-color:",u.colors.grayscale.dark2,"cc;}}&.ant-popover-placement-top,&.ant-popover-placement-topLeft,&.ant-popover-placement-topRight{&>.ant-popover-content>.ant-popover-arrow{border-bottom-color:",u.colors.grayscale.dark2,"cc;border-right-color:",u.colors.grayscale.dark2,"cc;}}&.ant-popover-placement-left,&.ant-popover-placement-leftTop,&.ant-popover-placement-leftBottom{&>.ant-popover-content>.ant-popover-arrow{border-top-color:",u.colors.grayscale.dark2,"cc;border-right-color:",u.colors.grayscale.dark2,"cc;}}&.ant-popover-placement-right,&.ant-popover-placement-rightTop,&.ant-popover-placement-rightBottom{&>.ant-popover-content>.ant-popover-arrow{border-bottom-color:",u.colors.grayscale.dark2,"cc;border-left-color:",u.colors.grayscale.dark2,"cc;}}&.ant-popover{color:",u.colors.grayscale.light4,";z-index:99;}}","")}),(0,b.tZ)(Oa,null,(0,b.tZ)(Bi.Z,{ghost:!0,light:!0,activeKey:f,onChange:function(e){m("string"==typeof e?[e]:e)}},e.length?(0,b.tZ)(Bi.Z.Panel,{key:"appliedCrossFilters",header:(0,b.tZ)(Ma,{bold:!0,color:u.colors.primary.light1},(0,b.tZ)(rt.Z.CursorTarget,{css:(0,b.iv)({fill:u.colors.primary.light1},"",""),iconSize:"xl"}),(0,d.t)("Applied Cross Filters (%d)",e.length))},(0,b.tZ)(Pa,{css:(0,b.iv)({paddingBottom:3*u.gridUnit},"","")},e.map((e=>(0,b.tZ)(La,{key:g(e),indicator:e,onClick:i}))))):null,t.length?(0,b.tZ)(Bi.Z.Panel,{key:"applied",header:(0,b.tZ)(Ma,{bold:!0,color:u.colors.success.base},(0,b.tZ)(xa,null)," ",(0,d.t)("Applied Filters (%d)",t.length))},(0,b.tZ)(Pa,{css:(0,b.iv)({paddingBottom:3*u.gridUnit},"","")},t.map((e=>(0,b.tZ)(La,{key:g(e),indicator:e,onClick:i}))))):null,n.length?(0,b.tZ)(Bi.Z.Panel,{key:"incompatible",header:(0,b.tZ)(Ma,{bold:!0,color:u.colors.alert.base},(0,b.tZ)(Ra,null)," ",(0,d.t)("Incompatible Filters (%d)",n.length))},(0,b.tZ)(Pa,{css:(0,b.iv)({paddingBottom:3*u.gridUnit},"","")},n.map((e=>(0,b.tZ)(La,{key:g(e),indicator:e,onClick:i}))))):null,r.length?(0,b.tZ)(Bi.Z.Panel,{key:"unset",header:(0,b.tZ)(Ma,{bold:!0,color:u.colors.grayscale.light1},(0,b.tZ)(Ta,null)," ",(0,d.t)("Unset Filters (%d)",r.length)),disabled:!r.length},(0,b.tZ)(Pa,{css:(0,b.iv)({paddingBottom:3*u.gridUnit},"","")},r.map((e=>(0,b.tZ)(La,{key:g(e),indicator:e,onClick:i}))))):null)));return(0,b.tZ)(_a.Z,{overlayClassName:"filterStatusPopover",content:y,visible:l,onVisibleChange:function(e){c(e),e&&m(p())},placement:"bottom",trigger:"click"},s)};var Ka,Ba;!function(e){e.NativeFilters="nativeFilters",e.CrossFilters="crossFilters"}(Ka||(Ka={})),function(e){e.Unset="UNSET",e.Applied="APPLIED",e.Incompatible="INCOMPATIBLE",e.CrossFilterApplied="CROSS_FILTER_APPLIED"}(Ba||(Ba={}));const Wa=new Set(Object.values(Fe.i2)),Ha=e=>null!=e&&e.label?e.label:null!=e&&e.value?(0,ei.Z)(null==e?void 0:e.value).join(", "):null,Ga=(e,t,n)=>{const r=t.columns[e],i=Array.isArray(r)?r:[r];if(null==r||t.isDateFilter&&r===Fe.vM||0===i.length)return[];if(t.isDateFilter&&Wa.has(e)){const t=((e===Fe.i2.time_grain_sqla?n.time_grain_sqla:n.granularity)||[]).reduce(((e,[t,n])=>({...e,[t]:n})),{});return i.map((e=>t[e]||e))}return i},Qa=e=>{var t,n;return new Set(((null==e||null==(t=e.queriesResponse)||null==(n=t[0])?void 0:n.applied_filters)||[]).map((e=>e.column)))},Ja=e=>{var t,n;return new Set(((null==e||null==(t=e.queriesResponse)||null==(n=t[0])?void 0:n.rejected_filters)||[]).map((e=>e.column)))},Ya={},Xa={},es={},ts={},ns={},rs=[],is=({chartId:e})=>{var t,n;const r=(0,o.I0)(),i=(0,o.v9)((e=>e.datasources)),s=(0,o.v9)((e=>e.dashboardFilters)),l=(0,o.v9)((e=>{var t;return null==(t=e.nativeFilters)?void 0:t.filters})),d=(0,o.v9)((e=>e.dashboardInfo)),u=(0,o.v9)((e=>e.charts)),h=(0,o.v9)((e=>e.dashboardLayout.present)),p=(0,o.v9)((e=>e.dataMask)),[f,m]=(0,a.useState)(rs),[v,y]=(0,a.useState)(rs),C=(0,a.useCallback)((e=>{r((0,Nt.E2)(e))}),[r]),S=u[e],x=(0,ro.D)(S),k=null==x?void 0:x.chartStatus,w=(0,ro.D)(s),R=(0,ro.D)(i),Z=(null==S?void 0:S.chartStatus)&&["rendered","success"].includes(S.chartStatus);(0,a.useEffect)((()=>{if(!Z&&v.length>0)y(rs);else if("success"!==k){var t,n,r,o,a,l,d,c;(null==S||null==(t=S.queriesResponse)||null==(n=t[0])?void 0:n.rejected_filters)===(null==x||null==(r=x.queriesResponse)||null==(o=r[0])?void 0:o.rejected_filters)&&(null==S||null==(a=S.queriesResponse)||null==(l=a[0])?void 0:l.applied_filters)===(null==x||null==(d=x.queriesResponse)||null==(c=d[0])?void 0:c.applied_filters)&&s===w&&i===R||y(((e,t,n,r)=>{const i=Qa(r),o=Ja(r),a=Object.values(t).filter((t=>t.chartId!==e)),s=Object.entries(n).filter((([e])=>a.find((t=>t.datasourceId===e)))).map((([,e])=>e)),l=Xa[e];if(Ya[e]&&(0,wr.JB)(null==l?void 0:l.appliedColumns,i)&&(0,wr.JB)(null==l?void 0:l.rejectedColumns,o)&&(0,wr.JB)(null==l?void 0:l.matchingFilters,a)&&(0,wr.JB)(null==l?void 0:l.matchingDatasources,s))return Ya[e];const d=a.reduce(((t,r)=>t.concat(((e,t,n,r,i)=>{const o=(e,t)=>r.has(e)&&t.columns[e]?Ba.Applied:i.has(e)?Ba.Incompatible:Ba.Unset;return Object.keys(t.columns).filter((n=>(0,on.Q1)({filterScope:t.scopes[n]}).includes(e))).map((e=>({column:e,name:t.labels[e]||e,value:Ga(e,t,n),status:o(e,t),path:t.directPathToFilter})))})(e,r,n[r.datasourceId]||{},i,o))),[]);return d.sort(((e,t)=>e.name.localeCompare(t.name))),Ya[e]=d,Xa[e]={appliedColumns:i,rejectedColumns:o,matchingFilters:a,matchingDatasources:s},d})(e,s,i,S))}}),[S,e,s,v.length,i,null==x?void 0:x.queriesResponse,k,w,R,Z]);const F=(0,ro.D)(l),T=(0,ro.D)(h),_=(0,ro.D)(p),D=(0,ro.D)(null==(t=d.metadata)?void 0:t.chart_configuration);(0,a.useEffect)((()=>{if(!Z&&f.length>0)m(rs);else if("success"!==k){var t,n,r,i,o,a,s,u,g,v;(null==S||null==(t=S.queriesResponse)||null==(n=t[0])?void 0:n.rejected_filters)===(null==x||null==(r=x.queriesResponse)||null==(i=r[0])?void 0:i.rejected_filters)&&(null==S||null==(o=S.queriesResponse)||null==(a=o[0])?void 0:a.applied_filters)===(null==x||null==(s=x.queriesResponse)||null==(u=s[0])?void 0:u.applied_filters)&&l===F&&h===T&&p===_&&D===(null==(g=d.metadata)?void 0:g.chart_configuration)||m(((e,t,n,r,i,o=ns)=>{const a=Qa(r),s=Ja(r),l=ts[n];if(es[n]&&(0,wr.JB)(null==l?void 0:l.appliedColumns,a)&&(0,wr.JB)(null==l?void 0:l.rejectedColumns,s)&&(null==l?void 0:l.nativeFilters)===e&&(null==l?void 0:l.dashboardLayout)===i&&(null==l?void 0:l.chartConfiguration)===o&&(null==l?void 0:l.dataMask)===t)return es[n];const d=({label:e,column:t,type:n=Ka.NativeFilters})=>{const r=null!==e;return n===Ka.CrossFilters&&r?Ba.CrossFilterApplied:!t&&r?Ba.Applied:t&&s.has(t)?Ba.Incompatible:t&&a.has(t)&&r?Ba.Applied:Ba.Unset};let u=[];(0,c.c)(c.T.DASHBOARD_NATIVE_FILTERS)&&(u=e&&Object.values(e).filter((e=>e.type===mi.B.NATIVE_FILTER&&Lr(e.scope,i).some((e=>{var t,r;return(null==(t=i[e])||null==(r=t.meta)?void 0:r.chartId)===n})))).map((e=>{var n,r,i;const o=null==(n=e.targets[0])||null==(r=n.column)?void 0:r.name,a=null==(i=t[e.id])?void 0:i.filterState,s=Ha(a);return{column:o,name:e.name,path:[e.id],status:d({label:s,column:o}),value:s}})));let h=[];(0,c.c)(c.T.DASHBOARD_CROSS_FILTERS)&&(h=Object.values(o).filter((e=>{var t;return Lr(null==e||null==(t=e.crossFilters)?void 0:t.scope,i).some((e=>{var t,r;return(null==(t=i[e])||null==(r=t.meta)?void 0:r.chartId)===n}))})).map((e=>{var n,r,o;const a=null==(n=t[e.id])?void 0:n.filterState,s=Ha(a),l=null==a?void 0:a.filters,c=l&&Object.keys(l)[0],u=Object.values(i).find((t=>{var n;return(null==t||null==(n=t.meta)?void 0:n.chartId)===e.id}));return{column:c,name:null==u||null==(r=u.meta)?void 0:r.sliceName,path:[...null!=(o=null==u?void 0:u.parents)?o:[],null==u?void 0:u.id],status:d({label:s,type:Ka.CrossFilters}),value:s}})).filter((e=>e.status===Ba.CrossFilterApplied)));const p=h.concat(u);return es[n]=p,ts[n]={nativeFilters:e,dashboardLayout:i,chartConfiguration:o,dataMask:t,appliedColumns:a,rejectedColumns:s},p})(l,p,e,S,h,null==(v=d.metadata)?void 0:v.chart_configuration))}}),[S,e,null==(n=d.metadata)?void 0:n.chart_configuration,p,l,f.length,h,null==x?void 0:x.queriesResponse,D,k,T,_,F,Z]);const M=(0,a.useMemo)((()=>ba()((e=>{const t=[Ba.Applied,Ba.Unset,Ba.Incompatible];return e.sort(((e,n)=>t.indexOf(e.status)-t.indexOf(n.status)))})([...v,...f]),((e,t)=>e.column===t.column&&e.name===t.name&&(e.status!==Ba.Applied||t.status!==Ba.Applied)))),[v,f]),E=(0,a.useMemo)((()=>M.filter((e=>e.status===Ba.CrossFilterApplied))),[M]),I=(0,a.useMemo)((()=>M.filter((e=>e.status===Ba.Applied))),[M]),O=(0,a.useMemo)((()=>M.filter((e=>e.status===Ba.Unset))),[M]),P=(0,a.useMemo)((()=>M.filter((e=>e.status===Ba.Incompatible))),[M]);if(!(E.length||I.length||P.length||O.length))return null;const N=!E.length&&!I.length&&!P.length;return(0,b.tZ)(Va,{appliedCrossFilterIndicators:E,appliedIndicators:I,unsetIndicators:O,incompatibleIndicators:P,onHighlightFilterSource:C},(0,b.tZ)(Da,{className:g()("filter-counts",!!P.length&&"has-incompatible-filters",!!E.length&&"has-cross-filters",N&&"filters-inactive")},(0,b.tZ)(rt.Z.Filter,{iconSize:"m"}),!N&&(0,b.tZ)("span",null,I.length+E.length),P.length?(0,b.tZ)(a.Fragment,null," ",(0,b.tZ)(rt.Z.AlertSolid,null),(0,b.tZ)("span",null,P.length)):null))},os=a.memo(is),as=(0,d.t)("Annotation layers are still loading."),ss=(0,d.t)("One ore more annotation layers failed loading."),ls=(0,v.iK)(rt.Z.CursorTarget)`
  cursor: pointer;
  color: ${({theme:e})=>e.colors.primary.base};
  height: 22px;
  width: 22px;
`,ds=({innerRef:e=null,forceRefresh:t=(()=>({})),updateSliceName:n=(()=>({})),toggleExpandSlice:r=(()=>({})),logExploreChart:i=(()=>({})),exploreUrl:s="#",exportCSV:l=(()=>({})),editMode:c=!1,annotationQuery:u={},annotationError:h={},cachedDttm:p=null,updatedDttm:f=null,isCached:m=[],isExpanded:g=!1,sliceName:v="",supersetCanExplore:y=!1,supersetCanShare:C=!1,supersetCanCSV:S=!1,sliceCanEdit:x=!1,exportFullCSV:k,slice:w,componentId:R,dashboardId:Z,addSuccessToast:F,addDangerToast:T,handleToggleFullSize:_,isFullSize:D,chartStatus:M,formData:E})=>{const I=(0,o.I0)(),O=(0,o.v9)((e=>{var t,n;return null==(t=e.dataMask[null==w?void 0:w.slice_id])||null==(n=t.filterState)?void 0:n.value})),P=(0,a.useMemo)((()=>({value:O,name:(0,d.t)("Emitted values")})),[O]);return(0,b.tZ)("div",{className:"chart-header",ref:e},(0,b.tZ)("div",{className:"header-title"},(0,b.tZ)(ot.Z,{title:v||(c?"---":""),canEdit:c,emptyText:"",onSaveTitle:n,showTooltip:!1}),!!Object.values(u).length&&(0,b.tZ)(Gn.u,{id:"annotations-loading-tooltip",placement:"top",title:as},(0,b.tZ)("i",{role:"img","aria-label":as,className:"fa fa-refresh warning"})),!!Object.values(h).length&&(0,b.tZ)(Gn.u,{id:"annoation-errors-tooltip",placement:"top",title:ss},(0,b.tZ)("i",{role:"img","aria-label":ss,className:"fa fa-exclamation-circle danger"}))),(0,b.tZ)("div",{className:"header-controls"},!c&&(0,b.tZ)(a.Fragment,null,O&&(0,b.tZ)(Gn.u,{placement:"top",title:(0,b.tZ)(La,{indicator:P,text:(0,d.t)("Click to clear emitted filters")})},(0,b.tZ)(ls,{onClick:()=>I((0,He.ze)(null==w?void 0:w.slice_id))})),(0,b.tZ)(os,{chartId:w.slice_id}),(0,b.tZ)(ga,{slice:w,isCached:m,isExpanded:g,cachedDttm:p,updatedDttm:f,toggleExpandSlice:r,forceRefresh:t,logExploreChart:i,exploreUrl:s,exportCSV:l,exportFullCSV:k,supersetCanExplore:y,supersetCanShare:C,supersetCanCSV:S,sliceCanEdit:x,componentId:R,dashboardId:Z,addSuccessToast:F,addDangerToast:T,handleToggleFullSize:_,isFullSize:D,chartStatus:M,formData:E}))))},cs={height:l().number.isRequired};function us({height:e}){return(0,b.tZ)("div",{className:"missing-chart-container",style:{height:e+20}},(0,b.tZ)("div",{className:"missing-chart-body"},(0,d.t)("There is no chart definition associated with this component, could it have been deleted?"),(0,b.tZ)("br",null),(0,b.tZ)("br",null),(0,d.t)("Delete this container and save to remove this message.")))}us.propTypes=cs;const hs={id:l().number.isRequired,componentId:l().string.isRequired,dashboardId:l().number.isRequired,width:l().number.isRequired,height:l().number.isRequired,updateSliceName:l().func.isRequired,isComponentVisible:l().bool,handleToggleFullSize:l().func.isRequired,chart:E.$6.isRequired,formData:l().object.isRequired,labelColors:l().object,datasource:l().object,slice:E.Rw.isRequired,sliceName:l().string.isRequired,timeout:l().number.isRequired,maxRows:l().number.isRequired,filterboxMigrationState:Fe.Qi,filters:l().object.isRequired,refreshChart:l().func.isRequired,logEvent:l().func.isRequired,toggleExpandSlice:l().func.isRequired,changeFilter:l().func.isRequired,setFocusedFilterField:l().func.isRequired,unsetFocusedFilterField:l().func.isRequired,editMode:l().bool.isRequired,isExpanded:l().bool.isRequired,isCached:l().bool,supersetCanExplore:l().bool.isRequired,supersetCanShare:l().bool.isRequired,supersetCanCSV:l().bool.isRequired,sliceCanEdit:l().bool.isRequired,addSuccessToast:l().func.isRequired,addDangerToast:l().func.isRequired,ownState:l().object,filterState:l().object},ps=Object.keys(hs).filter((e=>"width"!==e&&"height"!==e&&"isComponentVisible"!==e)),fs=new Set(["filter_box"]),ms=v.iK.div`
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;

  &.is-deactivated {
    opacity: 0.5;
    background-color: ${({theme:e})=>e.colors.grayscale.light1};
  }
`;class gs extends a.Component{constructor(e){super(e),this.logExploreChart=()=>{this.props.logEvent(tt.oK,{slice_id:this.props.slice.slice_id,is_cached:this.props.isCached})},this.getChartUrl=()=>(0,Or.Cl)(this.props.formData),this.state={width:e.width,height:e.height,descriptionHeight:0},this.changeFilter=this.changeFilter.bind(this),this.handleFilterMenuOpen=this.handleFilterMenuOpen.bind(this),this.handleFilterMenuClose=this.handleFilterMenuClose.bind(this),this.exportCSV=this.exportCSV.bind(this),this.exportFullCSV=this.exportFullCSV.bind(this),this.forceRefresh=this.forceRefresh.bind(this),this.resize=this.resize.bind(this),this.setDescriptionRef=this.setDescriptionRef.bind(this),this.setHeaderRef=this.setHeaderRef.bind(this)}shouldComponentUpdate(e,t){if(t.width!==this.state.width||t.height!==this.state.height||t.descriptionHeight!==this.state.descriptionHeight||!Ir()(e.datasource,this.props.datasource))return!0;if(e.isComponentVisible){if(e.chart.triggerQuery)return!0;if(e.isFullSize!==this.props.isFullSize)return clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this.resize,350),!1;e.width===this.props.width&&e.height===this.props.height||(clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this.resize,350));for(let t=0;t<ps.length;t+=1){const n=ps[t];if(!(0,wr.JB)(e[n],this.props[n]))return!0}}return this.props.cacheBusterProp!==e.cacheBusterProp}componentWillUnmount(){clearTimeout(this.resizeTimeout)}componentDidUpdate(e){if(this.props.isExpanded!==e.isExpanded){const e=this.props.isExpanded&&this.descriptionRef?this.descriptionRef.offsetHeight:0;this.setState({descriptionHeight:e})}}getChartHeight(){const e=this.getHeaderHeight();return this.state.height-e-this.state.descriptionHeight}getHeaderHeight(){return this.headerRef&&this.headerRef.offsetHeight||22}setDescriptionRef(e){this.descriptionRef=e}setHeaderRef(e){this.headerRef=e}resize(){const{width:e,height:t}=this.props;this.setState((()=>({width:e,height:t})))}changeFilter(e={}){this.props.logEvent(tt.Qg,{id:this.props.chart.id,columns:Object.keys(e)}),this.props.changeFilter(this.props.chart.id,e)}handleFilterMenuOpen(e,t){this.props.setFocusedFilterField(e,t)}handleFilterMenuClose(e,t){this.props.unsetFocusedFilterField(e,t)}exportCSV(e=!1){this.props.logEvent(tt.PC,{slice_id:this.props.slice.slice_id,is_cached:this.props.isCached}),(0,Or.pe)({formData:e?{...this.props.formData,row_limit:this.props.maxRows}:this.props.formData,resultType:"full",resultFormat:"csv"})}exportFullCSV(){this.exportCSV(!0)}forceRefresh(){return this.props.logEvent(tt.TD,{slice_id:this.props.slice.slice_id,is_cached:this.props.isCached}),this.props.refreshChart(this.props.chart.id,!0,this.props.dashboardId)}render(){const{id:e,componentId:t,dashboardId:n,chart:r,slice:i,datasource:o,isExpanded:a,editMode:s,filters:l,formData:d,labelColors:c,updateSliceName:u,sliceName:h,toggleExpandSlice:p,timeout:f,supersetCanExplore:m,supersetCanShare:v,supersetCanCSV:y,sliceCanEdit:C,addSuccessToast:S,addDangerToast:x,ownState:k,filterState:w,handleToggleFullSize:R,isFullSize:Z,filterboxMigrationState:F}=this.props,{width:T}=this.state;if(!r||!i)return(0,b.tZ)(us,{height:this.getChartHeight()});const{queriesResponse:_,chartUpdateEndTime:D,chartStatus:M}=r,E="loading"===M,I="filter_box"===i.viz_type&&[Fe.Qi.REVIEWING,Fe.Qi.CONVERTED].includes(F),O=(null==_?void 0:_.map((({is_cached:e})=>e)))||[],P=(null==_?void 0:_.map((({cached_dttm:e})=>e)))||[],N=fs.has(i.viz_type),j=(0,on.Z3)(e)?function({activeFilters:e={},filterId:t}){return Object.entries(e).reduce(((e,n)=>{const[r,{values:i}]=n,{chartId:o,column:a}=(0,Vt._)(r);return o===t?{...e,[a]:i}:e}),{})}({activeFilters:l,filterId:e}):{};return(0,b.tZ)("div",{className:"chart-slice","data-test-chart-id":e,"data-test-viz-type":i.viz_type,"data-test-chart-name":i.slice_name},(0,b.tZ)(ds,{innerRef:this.setHeaderRef,slice:i,isExpanded:!!a,isCached:O,cachedDttm:P,updatedDttm:D,toggleExpandSlice:p,forceRefresh:this.forceRefresh,editMode:s,annotationQuery:r.annotationQuery,logExploreChart:this.logExploreChart,exploreUrl:this.getChartUrl(),exportCSV:this.exportCSV,exportFullCSV:this.exportFullCSV,updateSliceName:u,sliceName:h,supersetCanExplore:m,supersetCanShare:v,supersetCanCSV:y,sliceCanEdit:C,componentId:t,dashboardId:n,filters:l,addSuccessToast:S,addDangerToast:x,handleToggleFullSize:R,isFullSize:Z,chartStatus:r.chartStatus,formData:d}),a&&i.description_markeddown&&(0,b.tZ)("div",{className:"slice_description bs-callout bs-callout-default",ref:this.setDescriptionRef,dangerouslySetInnerHTML:{__html:i.description_markeddown}}),(0,b.tZ)("div",{className:g()("dashboard-chart",N&&"dashboard-chart--overflowable")},(E||I)&&(0,b.tZ)(ms,{className:g()(I&&"is-deactivated"),style:{width:T,height:this.getChartHeight()}}),(0,b.tZ)(Pr.Z,{width:T,height:this.getChartHeight(),addFilter:this.changeFilter,onFilterMenuOpen:this.handleFilterMenuOpen,onFilterMenuClose:this.handleFilterMenuClose,annotationData:r.annotationData,chartAlert:r.chartAlert,chartId:e,chartStatus:M,datasource:o,dashboardId:n,initialValues:j,formData:d,labelColors:c,ownState:k,filterState:w,queriesResponse:r.queriesResponse,timeout:f,triggerQuery:r.triggerQuery,vizType:i.viz_type,isDeactivatedViz:I,filterboxMigrationState:F})))}}gs.propTypes=hs,gs.defaultProps={isCached:!1,isComponentVisible:!0};var vs=n(9531);const bs={},ys=(0,o.$j)((function({charts:e,dashboardInfo:t,dashboardState:n,dashboardLayout:r,dataMask:i,datasources:o,sliceEntities:a,nativeFilters:s,common:l},d){var c,u,h,p;const{id:f}=d,m=e[f]||bs,g=m&&m.form_data&&o[m.form_data.datasource]||vs.t,{colorScheme:v,colorNamespace:b}=n,y=(null==t||null==(c=t.metadata)?void 0:c.label_colors)||{},C=function({chart:e,charts:t,filters:n,nativeFilters:r,chartConfiguration:i,colorScheme:o,colorNamespace:a,sliceId:s,layout:l,dataMask:d,labelColors:c}){const u=Dr[s];if(_r[s]===n&&(0,wr.JB)(null==u?void 0:u.color_scheme,o,{ignoreUndefined:!0})&&(0,wr.JB)(null==u?void 0:u.color_namespace,a,{ignoreUndefined:!0})&&(0,wr.JB)(null==u?void 0:u.label_colors,c,{ignoreUndefined:!0})&&u&&(0,wr.JB)(null==u?void 0:u.dataMask,d,{ignoreUndefined:!0}))return u;let h={};const p=Tr({chartConfiguration:i,dataMask:d,layout:l,nativeFilters:r.filters}),f=Object.entries(p).filter((([,{scope:t}])=>t.includes(e.id))).map((([e])=>e));f.length&&(h={extra_form_data:(0,kr.vk)(d,t,f)});const m={...e.formData,label_colors:c,...o&&{color_scheme:o},extra_filters:Rr(n),...h};return _r[s]=n,Dr[s]={...m,dataMask:d},m}({layout:r.present,chart:m,chartConfiguration:null==(u=t.metadata)?void 0:u.chart_configuration,charts:e,filters:(0,on._f)(f),colorScheme:v,colorNamespace:b,sliceId:f,nativeFilters:s,dataMask:i,labelColors:y});return C.dashboardId=t.id,{chart:m,datasource:g,labelColors:y,slice:a.slices[f],timeout:t.common.conf.SUPERSET_WEBSERVER_TIMEOUT,filters:(0,on.De)()||bs,formData:C,editMode:n.editMode,isExpanded:!!n.expandedSlices[f],supersetCanExplore:!!t.superset_can_explore,supersetCanShare:!!t.superset_can_share,supersetCanCSV:!!t.superset_can_csv,sliceCanEdit:!!t.slice_can_edit,ownState:null==(h=i[f])?void 0:h.ownState,filterState:null==(p=i[f])?void 0:p.filterState,maxRows:l.conf.SQL_MAX_ROW,filterboxMigrationState:n.filterboxMigrationState}}),(function(e){return(0,i.DE)({updateComponents:fr.WZ,addSuccessToast:mr.ws,addDangerToast:mr.Gb,toggleExpandSlice:Nt.WL,changeFilter:Pt.M6,setFocusedFilterField:Nt.GH,unsetFocusedFilterField:Nt.oY,refreshChart:xr.refreshChart,logEvent:gr.logEvent},e)}))(gs);var Cs=n(13433);const Ss={url:l().string,emailSubject:l().string,emailContent:l().string,addDangerToast:l().func.isRequired,placement:l().oneOf(["right","left","top","bottom"])};class xs extends a.Component{constructor(e){super(e),this.state={shortUrl:""},this.onShortUrlSuccess=this.onShortUrlSuccess.bind(this),this.getCopyUrl=this.getCopyUrl.bind(this)}onShortUrlSuccess(e){this.setState((()=>({shortUrl:e})))}getCopyUrl(e){e.stopPropagation(),(0,qn.O)(this.props.url).then(this.onShortUrlSuccess).catch(this.props.addDangerToast)}renderPopover(){const e=(0,d.t)("%s%s",this.props.emailContent,this.state.shortUrl);return(0,b.tZ)("div",{id:"shorturl-popover"},(0,b.tZ)(Cs.Z,{text:this.state.shortUrl,copyNode:(0,b.tZ)("i",{className:"fa fa-clipboard",title:(0,d.t)("Copy to clipboard")})}),"  ",(0,b.tZ)("a",{href:`mailto:?Subject=${this.props.emailSubject}%20&Body=${e}`},(0,b.tZ)("i",{className:"fa fa-envelope"})))}render(){return(0,b.tZ)(_a.Z,{trigger:"click",placement:this.props.placement,onClick:this.getCopyUrl,content:this.renderPopover()},(0,b.tZ)("span",{className:"short-link-trigger btn btn-default btn-sm",role:"button"},(0,b.tZ)("i",{className:"short-link-trigger fa fa-link"})," "))}}xs.defaultProps={url:window.location.href.substring(window.location.origin.length),placement:"left",emailSubject:"",emailContent:""},xs.propTypes=Ss;const ks=(0,io.Z)(xs);var ws=n(56967);const Rs={anchorLinkId:l().string.isRequired,filters:l().object,showShortLinkButton:l().bool,inFocus:l().bool,placement:l().oneOf(["right","left","top","bottom"])};class Zs extends a.PureComponent{componentDidMount(){const e=(0,ws.Z)(),{anchorLinkId:t}=this.props;e&&t===e&&this.scrollToView()}UNSAFE_componentWillReceiveProps(e){const{inFocus:t=!1}=e;t&&this.scrollToView()}scrollToView(e=0){const{anchorLinkId:t}=this.props,n=document.getElementById(t);n&&setTimeout((()=>{n.scrollIntoView({block:"center",behavior:"smooth"})}),e)}render(){const{anchorLinkId:e,filters:t,showShortLinkButton:n,placement:r}=this.props;return(0,b.tZ)("span",{className:"anchor-link-container",id:e},n&&(0,b.tZ)(ks,{url:jn({pathname:window.location.pathname,filters:t,hash:e}),emailSubject:(0,d.t)("Superset chart"),emailContent:(0,d.t)("Check out this chart in dashboard:"),placement:r}))}}Zs.propTypes=Rs,Zs.defaultProps={inFocus:!1,showShortLinkButton:!1,placement:"right",filters:{}};const Fs=Zs,Ts={onDelete:l().func.isRequired};class _s extends a.PureComponent{render(){const{onDelete:e}=this.props;return(0,b.tZ)(Sr,{onClick:e,icon:(0,b.tZ)(rt.Z.Trash,{iconSize:"xl"})})}}_s.propTypes=Ts,_s.defaultProps={};const Ds=v.iK.div`
  .hover-menu {
    opacity: 0;
    position: absolute;
    z-index: 10;
    font-size: ${({theme:e})=>e.typography.sizes.m};
  }

  .hover-menu--left {
    width: ${({theme:e})=>6*e.gridUnit}px;
    top: 50%;
    transform: translate(0, -50%);
    left: ${({theme:e})=>-7*e.gridUnit}px;
    padding: ${({theme:e})=>2*e.gridUnit}px 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }

  .hover-menu--left > :nth-child(n):not(:only-child):not(:last-child) {
    margin-bottom: ${({theme:e})=>3*e.gridUnit}px;
  }

  .hover-menu--top {
    height: ${({theme:e})=>6*e.gridUnit}px;
    top: ${({theme:e})=>-6*e.gridUnit}px;
    left: 50%;
    transform: translate(-50%);
    padding: 0 ${({theme:e})=>2*e.gridUnit}px;
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
  }
`;class Ms extends a.PureComponent{render(){const{innerRef:e,position:t,children:n}=this.props;return(0,b.tZ)(Ds,{className:"hover-menu-container"},(0,b.tZ)("div",{ref:e,className:g()("hover-menu","left"===t&&"hover-menu--left","top"===t&&"hover-menu--top")},n))}}Ms.defaultProps={position:"left",innerRef:null,children:null};var Es=n(29119);const Is={right:function(){return(0,b.tZ)("div",{className:"resize-handle resize-handle--right"})},bottom:function(){return(0,b.tZ)("div",{className:"resize-handle resize-handle--bottom"})},bottomRight:function(){return(0,b.tZ)("div",{className:"resize-handle resize-handle--bottom-right"})}},Os={top:!1,right:!0,bottom:!0,left:!1,topRight:!1,bottomRight:!0,bottomLeft:!1,topLeft:!1},Ps={widthAndHeight:Os,widthOnly:{...Os,bottomRight:!1,bottom:!1},heightOnly:{...Os,bottomRight:!1,right:!1},notAdjustable:{...Os,bottomRight:!1,bottom:!1,right:!1}},Ns=Number.MAX_VALUE,js={id:l().string.isRequired,children:l().node,adjustableWidth:l().bool,adjustableHeight:l().bool,gutterWidth:l().number,widthStep:l().number,heightStep:l().number,widthMultiple:l().number,heightMultiple:l().number,minWidthMultiple:l().number,maxWidthMultiple:l().number,minHeightMultiple:l().number,maxHeightMultiple:l().number,staticHeight:l().number,staticHeightMultiple:l().number,staticWidth:l().number,staticWidthMultiple:l().number,onResizeStop:l().func,onResize:l().func,onResizeStart:l().func,editMode:l().bool.isRequired},qs={children:null,adjustableWidth:!0,adjustableHeight:!0,gutterWidth:D.es,widthStep:D.cd,heightStep:D.cd,widthMultiple:null,heightMultiple:null,minWidthMultiple:1,maxWidthMultiple:Ns,minHeightMultiple:1,maxHeightMultiple:Ns,staticHeight:null,staticHeightMultiple:null,staticWidth:null,staticWidthMultiple:null,onResizeStop:null,onResize:null,onResizeStart:null},zs=[D.cd,D.cd],As={right:"resizable-container-handle--right",bottom:"resizable-container-handle--bottom"};class $s extends a.PureComponent{constructor(e){super(e),this.state={isResizing:!1},this.handleResizeStart=this.handleResizeStart.bind(this),this.handleResize=this.handleResize.bind(this),this.handleResizeStop=this.handleResizeStop.bind(this)}handleResizeStart(e,t,n){const{id:r,onResizeStart:i}=this.props;i&&i({id:r,direction:t,ref:n}),this.setState((()=>({isResizing:!0})))}handleResize(e,t,n){const{onResize:r,id:i}=this.props;r&&r({id:i,direction:t,ref:n})}handleResizeStop(e,t,n,r){const{id:i,onResizeStop:o,widthStep:a,heightStep:s,widthMultiple:l,heightMultiple:d,adjustableHeight:c,adjustableWidth:u,gutterWidth:h}=this.props;if(o){const e=l+Math.round(r.width/(a+h)),t=d+Math.round(r.height/s);o({id:i,widthMultiple:u?e:null,heightMultiple:c?t:null}),this.setState((()=>({isResizing:!1})))}}render(){const{children:e,adjustableWidth:t,adjustableHeight:n,widthStep:r,heightStep:i,widthMultiple:o,heightMultiple:a,staticHeight:s,staticHeightMultiple:l,staticWidth:d,staticWidthMultiple:c,minWidthMultiple:u,maxWidthMultiple:h,minHeightMultiple:p,maxHeightMultiple:f,gutterWidth:m,editMode:v}=this.props,y={width:t?(r+m)*o-m:c&&c*r||d||void 0,height:n?i*a:l&&l*i||s||void 0};let C=Ps.notAdjustable;v&&t&&n?C=Ps.widthAndHeight:v&&t?C=Ps.widthOnly:v&&n&&(C=Ps.heightOnly);const{isResizing:S}=this.state;return(0,b.tZ)(Es.e,{enable:C,grid:zs,minWidth:t?u*(r+m)-m:void 0,minHeight:n?p*i:void 0,maxWidth:t?Math.max(y.width,Math.min(Ns,h*(r+m)-m)):void 0,maxHeight:n?Math.max(y.height,Math.min(Ns,f*i)):void 0,size:y,onResizeStart:this.handleResizeStart,onResize:this.handleResize,onResizeStop:this.handleResizeStop,handleComponent:Is,className:g()("resizable-container",S&&"resizable-container--resizing"),handleClasses:As},e)}}$s.propTypes=js,$s.defaultProps=qs;const Us=$s,Ls={id:l().string.isRequired,parentId:l().string.isRequired,dashboardId:l().number.isRequired,component:E.cP.isRequired,parentComponent:E.cP.isRequired,getComponentById:l().func.isRequired,index:l().number.isRequired,depth:l().number.isRequired,editMode:l().bool.isRequired,directPathToChild:l().arrayOf(l().string),directPathLastUpdated:l().number,focusedFilterScope:l().object,fullSizeChartId:l().oneOf([l().number,null]),availableColumnCount:l().number.isRequired,columnWidth:l().number.isRequired,onResizeStart:l().func.isRequired,onResize:l().func.isRequired,onResizeStop:l().func.isRequired,deleteComponent:l().func.isRequired,updateComponents:l().func.isRequired,handleComponentDrop:l().func.isRequired,setFullSizeChartId:l().func.isRequired},Vs=a.forwardRef((({chartId:e,...t},n)=>{const r=(0,v.Fg)(),i=(0,o.v9)((e=>e.nativeFilters)),a=function(e,t){if(!e.focusedFilterField)return null;const{chartId:n,column:r}=e.focusedFilterField;return{chartId:n,scope:t[n].scopes[r]}}((0,o.v9)((e=>e.dashboardState)),(0,o.v9)((e=>e.dashboardFilters))),s=i.focusedFilterId;if(!a&&!s)return(0,b.tZ)("div",ut()({ref:n},t));const l={borderColor:r.colors.primary.light2,opacity:1,boxShadow:`0px 0px ${2*r.gridUnit}px ${r.colors.primary.base}`,pointerEvents:"auto"};var d,c;if(s){if(null!=(d=i.filters[s])&&null!=(c=d.chartsInScope)&&c.includes(e))return(0,b.tZ)("div",ut()({ref:n,style:l},t))}else if(e===a.chartId||(0,on.Q1)({filterScope:a.scope}).includes(e))return(0,b.tZ)("div",ut()({ref:n,style:l},t));return(0,b.tZ)("div",ut()({ref:n,style:{opacity:.3,pointerEvents:"none"}},t))}));class Ks extends a.Component{static renderInFocusCSS(e){return(0,b.tZ)("style",null,`label[for=${e}] + .Select .Select__control {\n                    border-color: #00736a;\n                    transition: border-color 1s ease-in-out;\n           }`)}static getDerivedStateFromProps(e,t){const{component:n,directPathToChild:r,directPathLastUpdated:i}=e,{label:o,chart:a}=function(e){const t={};if(e.length>0){const n=e.slice();for(;n.length;){const e=n.pop(),r=e.split("-")[0];if(t[r.toLowerCase()]=e,!D.Ep.includes(r))break}}return t}(r);return i!==t.directPathLastUpdated&&n.id===a?{outlinedComponentId:n.id,outlinedColumnName:o,directPathLastUpdated:i}:null}constructor(e){super(e),this.state={isFocused:!1,outlinedComponentId:null,outlinedColumnName:null,directPathLastUpdated:0},this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleUpdateSliceName=this.handleUpdateSliceName.bind(this),this.handleToggleFullSize=this.handleToggleFullSize.bind(this)}componentDidMount(){this.hideOutline({},this.state)}componentDidUpdate(e,t){this.hideOutline(t,this.state)}hideOutline(e,t){const{outlinedComponentId:n}=t,{outlinedComponentId:r}=e;n&&!r&&setTimeout((()=>{this.setState((()=>({outlinedComponentId:null,outlinedColumnName:null})))}),2e3)}handleChangeFocus(e){this.setState((()=>({isFocused:e})))}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleUpdateSliceName(e){const{component:t,updateComponents:n}=this.props;n({[t.id]:{...t,meta:{...t.meta,sliceNameOverride:e}}})}handleToggleFullSize(){const{component:e,fullSizeChartId:t,setFullSizeChartId:n}=this.props,{chartId:r}=e.meta;n(t===r?null:r)}render(){var e,t,n;const{isFocused:r}=this.state,{component:i,parentComponent:o,index:a,depth:s,availableColumnCount:l,columnWidth:d,onResizeStart:c,onResize:u,onResizeStop:h,handleComponentDrop:f,editMode:m,isComponentVisible:v,dashboardId:y,fullSizeChartId:C,getComponentById:S=(()=>{})}=this.props,{chartId:x}=i.meta,k=C===x,w=null==(e=S(null==(n=o.parents)?void 0:n.find((e=>e.startsWith(p.BA)))))||null==(t=e.meta)?void 0:t.width;let R=i.meta.width||D.cx;o.type===p.BA?R=o.meta.width||D.cx:w&&R>w&&(R=w);let Z=0,F=0;return k?(Z=window.innerWidth-32,F=window.innerHeight-32):(Z=Math.floor(R*d+(R-1)*D.es-32),F=Math.floor(i.meta.height*D.cd-32)),(0,b.tZ)(te,{component:i,parentComponent:o,orientation:o.type===p.Os?"column":"row",index:a,depth:s,onDrop:f,disableDragDrop:r,editMode:m},(({dropIndicatorProps:e,dragSourceRef:t})=>(0,b.tZ)(Us,{id:i.id,adjustableWidth:o.type===p.Os,adjustableHeight:!0,widthStep:d,widthMultiple:R,heightStep:D.cd,heightMultiple:i.meta.height,minWidthMultiple:D.cx,minHeightMultiple:D.AA,maxWidthMultiple:l+R,onResizeStart:c,onResize:u,onResizeStop:h,editMode:m},(0,b.tZ)(Vs,{chartId:x,ref:t,className:g()("dashboard-component","dashboard-component-chart-holder",this.state.outlinedComponentId?"fade-in":"fade-out",k&&"full-size")},!m&&(0,b.tZ)(Fs,{anchorLinkId:i.id,inFocus:!!this.state.outlinedComponentId}),!!this.state.outlinedComponentId&&Ks.renderInFocusCSS(this.state.outlinedColumnName),(0,b.tZ)(ys,{componentId:i.id,id:i.meta.chartId,dashboardId:y,width:Z,height:F,sliceName:i.meta.sliceNameOverride||i.meta.sliceName||"",updateSliceName:this.handleUpdateSliceName,isComponentVisible:v,handleToggleFullSize:this.handleToggleFullSize,isFullSize:k}),m&&(0,b.tZ)(Ms,{position:"top"},(0,b.tZ)("div",null,(0,b.tZ)(_s,{onDelete:this.handleDeleteComponent})))),e&&(0,b.tZ)("div",e))))}}Ks.propTypes=Ls,Ks.defaultProps={directPathToChild:[],directPathLastUpdated:0};const Bs=(0,o.$j)((function(e){return{directPathToChild:e.dashboardState.directPathToChild,directPathLastUpdated:e.dashboardState.directPathLastUpdated}}))(Ks);var Ws=n(78186);const Hs=(0,v.iK)(Re.v2.Item)`
  &.ant-menu-item {
    height: auto;
    line-height: 1.4;

    padding-top: ${({theme:e})=>e.gridUnit}px;
    padding-bottom: ${({theme:e})=>e.gridUnit}px;

    margin-top: 0;
    margin-bottom: 0;

    &:not(:last-child) {
      margin-bottom: 0;
    }

    &:hover {
      background: ${({theme:e})=>e.colors.grayscale.light3};
    }

    &.active {
      font-weight: ${({theme:e})=>e.typography.weights.bold};
      background: ${({theme:e})=>e.colors.grayscale.light2};
    }
  }

  &.ant-menu-item-selected {
    color: unset;
  }
`;var Gs={name:"s5xdrg",styles:"display:flex;align-items:center"};const Qs=e=>{const{value:t,options:n,onChange:r,renderButton:i=(e=>e.label),renderOption:o=(e=>(0,b.tZ)("div",{className:e.className},e.label))}=e,a=(0,v.Fg)(),s=n.find((e=>e.value===t));return(0,b.tZ)(Re.Lt,{trigger:["click"],overlayStyle:{zIndex:a.zIndex.max},overlay:(0,b.tZ)(Re.v2,{onClick:({key:e})=>r(e)},n.map((e=>(0,b.tZ)(Hs,{id:"menu-item",key:e.value,className:g()("dropdown-item",{active:e.value===t})},o(e)))))},(0,b.tZ)("div",{role:"button",css:Gs},s&&i(s),(0,b.tZ)(rt.Z.CaretDown,{iconColor:a.colors.grayscale.base,css:(0,b.iv)({marginTop:.5*a.gridUnit},"","")})))},Js=[{value:"edit",label:(0,d.t)("Edit")},{value:"preview",label:(0,d.t)("Preview")}];class Ys extends a.PureComponent{render(){const{id:e,value:t,onChange:n}=this.props;return(0,b.tZ)(Qs,{id:e,options:Js,value:t,onChange:n})}}class Xs extends a.PureComponent{constructor(e){super(e),this.container=void 0,this.state={isFocused:e.isFocused},this.setRef=this.setRef.bind(this),this.handleClick=this.handleClick.bind(this)}UNSAFE_componentWillReceiveProps(e){e.editMode&&e.isFocused&&!this.state.isFocused?(document.addEventListener("click",this.handleClick),document.addEventListener("drag",this.handleClick),this.setState({isFocused:!0})):this.state.isFocused&&!e.editMode&&(document.removeEventListener("click",this.handleClick),document.removeEventListener("drag",this.handleClick),this.setState({isFocused:!1}))}componentWillUnmount(){document.removeEventListener("click",this.handleClick),document.removeEventListener("drag",this.handleClick)}setRef(e){this.container=e}handleClick(e){if(!this.props.editMode)return;const{onChangeFocus:t,shouldFocus:n,disableClick:r}=this.props,i=n(e,this.container);r||!i||this.state.isFocused?!i&&this.state.isFocused&&(document.removeEventListener("click",this.handleClick),document.removeEventListener("drag",this.handleClick),this.setState((()=>({isFocused:!1}))),t&&t(!1)):(document.addEventListener("click",this.handleClick),document.addEventListener("drag",this.handleClick),this.setState((()=>({isFocused:!0}))),t&&t(!0))}render(){var e;const{children:t,menuItems:n,editMode:r,style:i}=this.props,{isFocused:o}=this.state;return(0,b.tZ)("div",{ref:this.setRef,onClick:this.handleClick,role:"none",className:g()("with-popover-menu",r&&o&&"with-popover-menu--focused"),style:i},t,r&&o&&(null!=(e=null==n?void 0:n.length)?e:0)>0&&(0,b.tZ)("div",{className:"popover-menu"},n.map(((e,t)=>(0,b.tZ)("div",{className:"menu-item",key:`menu-item-${t}`},e)))))}}Xs.defaultProps={children:null,disableClick:!1,onChangeFocus:null,menuItems:[],isFocused:!1,shouldFocus:(e,t)=>{var n;return(null==t?void 0:t.contains(e.target))||"menu-item"===e.target.id||"menu-item"===(null==(n=e.target.parentNode)?void 0:n.id)},style:null};const el={id:l().string.isRequired,parentId:l().string.isRequired,component:E.cP.isRequired,parentComponent:E.cP.isRequired,index:l().number.isRequired,depth:l().number.isRequired,editMode:l().bool.isRequired,logEvent:l().func.isRequired,addDangerToast:l().func.isRequired,undoLength:l().number.isRequired,redoLength:l().number.isRequired,availableColumnCount:l().number.isRequired,columnWidth:l().number.isRequired,onResizeStart:l().func.isRequired,onResize:l().func.isRequired,onResizeStop:l().func.isRequired,deleteComponent:l().func.isRequired,handleComponentDrop:l().func.isRequired,updateComponents:l().func.isRequired},tl="# ✨Markdown\n## ✨Markdown\n### ✨Markdown\n\n<br />\n\nClick here to edit [markdown](https://bit.ly/1dQOfRK)",nl=(0,d.t)("This markdown component has an error.");class rl extends a.PureComponent{constructor(e){super(e),this.state={isFocused:!1,markdownSource:e.component.meta.code,editor:null,editorMode:"preview",undoLength:e.undoLength,redoLength:e.redoLength},this.renderStartTime=tt.Yd.getTimestamp(),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleChangeEditorMode=this.handleChangeEditorMode.bind(this),this.handleMarkdownChange=this.handleMarkdownChange.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleResizeStart=this.handleResizeStart.bind(this),this.setEditor=this.setEditor.bind(this)}componentDidMount(){this.props.logEvent(tt.aD,{viz_type:"markdown",start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:tt.Yd.getTimestamp()-this.renderStartTime})}static getDerivedStateFromProps(e,t){const{hasError:n,editorMode:r,markdownSource:i,undoLength:o,redoLength:a}=t,{component:s,undoLength:l,redoLength:d}=e;return l!==o||d!==a?{...t,undoLength:l,redoLength:d,markdownSource:s.meta.code,hasError:!1}:n||"preview"!==r||s.meta.code===i?t:{...t,markdownSource:s.meta.code}}static getDerivedStateFromError(){return{hasError:!0}}componentDidUpdate(e){!this.state.editor||e.component.meta.width===this.props.component.meta.width&&e.columnWidth===this.props.columnWidth||this.state.editor.resize(!0),this.props.editMode&&gt.cE.preload()}componentDidCatch(){this.state.editor&&"preview"===this.state.editorMode&&this.props.addDangerToast((0,d.t)("This markdown component has an error. Please revert your recent changes."))}setEditor(e){e.getSession().setUseWrapMode(!0),this.setState({editor:e})}handleChangeFocus(e){const t=!!e,n=t?"edit":"preview";this.setState((()=>({isFocused:t}))),this.handleChangeEditorMode(n)}handleChangeEditorMode(e){const t={...this.state,editorMode:e};"preview"===e&&(this.updateMarkdownContent(),t.hasError=!1),this.setState(t)}updateMarkdownContent(){const{updateComponents:e,component:t}=this.props;t.meta.code!==this.state.markdownSource&&e({[t.id]:{...t,meta:{...t.meta,code:this.state.markdownSource}}})}handleMarkdownChange(e){this.setState({markdownSource:e})}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleResizeStart(e){const{editorMode:t}=this.state,{editMode:n,onResizeStart:r}=this.props,i="edit"===t;r(e),n&&i&&this.updateMarkdownContent()}renderEditMode(){return(0,b.tZ)(gt.cE,{onChange:this.handleMarkdownChange,width:"100%",height:"100%",showGutter:!1,editorProps:{$blockScrolling:!0},value:"string"==typeof this.state.markdownSource?this.state.markdownSource:tl,readOnly:!1,onLoad:this.setEditor})}renderPreviewMode(){const{hasError:e}=this.state;return(0,b.tZ)(Ws.Z,{source:e?nl:this.state.markdownSource||tl})}render(){const{isFocused:e,editorMode:t}=this.state,{component:n,parentComponent:r,index:i,depth:o,availableColumnCount:a,columnWidth:s,onResize:l,onResizeStop:d,handleComponentDrop:c,editMode:u}=this.props,h=r.type===p.BA?r.meta.width||D.cx:n.meta.width||D.cx,f="edit"===t;return(0,b.tZ)(te,{component:n,parentComponent:r,orientation:r.type===p.Os?"column":"row",index:i,depth:o,onDrop:c,disableDragDrop:e,editMode:u},(({dropIndicatorProps:t,dragSourceRef:i})=>(0,b.tZ)(Xs,{onChangeFocus:this.handleChangeFocus,menuItems:[(0,b.tZ)(Ys,{id:`${n.id}-mode`,value:this.state.editorMode,onChange:this.handleChangeEditorMode})],editMode:u},(0,b.tZ)("div",{className:g()("dashboard-markdown",f&&"dashboard-markdown--editing"),id:n.id},(0,b.tZ)(Us,{id:n.id,adjustableWidth:r.type===p.Os,adjustableHeight:!0,widthStep:s,widthMultiple:h,heightStep:D.cd,heightMultiple:n.meta.height,minWidthMultiple:D.cx,minHeightMultiple:D.AA,maxWidthMultiple:a+h,onResizeStart:this.handleResizeStart,onResize:l,onResizeStop:d,editMode:!e&&u},(0,b.tZ)("div",{ref:i,className:"dashboard-component dashboard-component-chart-holder"},u&&(0,b.tZ)(Ms,{position:"top"},(0,b.tZ)(_s,{onDelete:this.handleDeleteComponent})),u&&f?this.renderEditMode():this.renderPreviewMode()))),t&&(0,b.tZ)("div",t))))}}rl.propTypes=el,rl.defaultProps={};const il=(0,o.$j)((function(e){return{undoLength:e.dashboardLayout.past.length,redoLength:e.dashboardLayout.future.length}}))(rl);function ol({position:e="left",innerRef:t=null,dotCount:n=8}){return(0,b.tZ)("div",{ref:t,className:g()("drag-handle","left"===e&&"drag-handle--left","top"===e&&"drag-handle--top")},Array(n).fill(null).map(((e,t)=>(0,b.tZ)("div",{key:`handle-dot-${t}`,className:"drag-handle-dot"}))))}var al=n(713);function sl(e){return(0,b.tZ)("div",{className:g()("background-style-option",e.className)},`${e.label} background`)}function ll(e){return(0,b.tZ)("div",{className:g()("background-style-option",e.className)},e.label)}class dl extends a.PureComponent{render(){const{id:e,value:t,onChange:n}=this.props;return(0,b.tZ)(Qs,{id:e,options:al.Z,value:t,onChange:n,renderButton:sl,renderOption:ll})}}const cl={id:l().string.isRequired,parentId:l().string.isRequired,component:E.cP.isRequired,parentComponent:E.cP.isRequired,index:l().number.isRequired,depth:l().number.isRequired,editMode:l().bool.isRequired,availableColumnCount:l().number.isRequired,columnWidth:l().number.isRequired,minColumnWidth:l().number.isRequired,onResizeStart:l().func.isRequired,onResize:l().func.isRequired,onResizeStop:l().func.isRequired,deleteComponent:l().func.isRequired,handleComponentDrop:l().func.isRequired,updateComponents:l().func.isRequired};class ul extends a.PureComponent{constructor(e){super(e),this.state={isFocused:!1},this.handleChangeBackground=this.handleUpdateMeta.bind(this,"background"),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this)}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleChangeFocus(e){this.setState((()=>({isFocused:Boolean(e)})))}handleUpdateMeta(e,t){const{updateComponents:n,component:r}=this.props;t&&r.meta[e]!==t&&n({[r.id]:{...r,meta:{...r.meta,[e]:t}}})}render(){const{component:e,parentComponent:t,index:n,availableColumnCount:r,columnWidth:i,minColumnWidth:o,depth:a,onResizeStart:s,onResize:l,onResizeStop:d,handleComponentDrop:c,editMode:u,onChangeTab:h,isComponentVisible:p}=this.props,f=e.children||[],m=al.Z.find((t=>t.value===(e.meta.background||D.HE)));return(0,b.tZ)(te,{component:e,parentComponent:t,orientation:"column",index:n,depth:a,onDrop:c,editMode:u},(({dropIndicatorProps:t,dragSourceRef:n})=>(0,b.tZ)(Us,{id:e.id,adjustableWidth:!0,adjustableHeight:!1,widthStep:i,widthMultiple:e.meta.width,minWidthMultiple:o,maxWidthMultiple:r+(e.meta.width||0),onResizeStart:s,onResize:l,onResizeStop:d,editMode:u},(0,b.tZ)(Xs,{isFocused:this.state.isFocused,onChangeFocus:this.handleChangeFocus,disableClick:!0,menuItems:[(0,b.tZ)(dl,{id:`${e.id}-background`,value:e.meta.background,onChange:this.handleChangeBackground})],editMode:u},u&&(0,b.tZ)(Ms,{innerRef:n,position:"top"},(0,b.tZ)(ol,{position:"top"}),(0,b.tZ)(_s,{onDelete:this.handleDeleteComponent}),(0,b.tZ)(Sr,{onClick:this.handleChangeFocus,icon:(0,b.tZ)(rt.Z.Cog,{iconSize:"xl"})})),(0,b.tZ)("div",{className:g()("grid-column",0===f.length&&"grid-column--empty",m.className)},f.map(((t,n)=>(0,b.tZ)(Ll,{key:t,id:t,parentId:e.id,depth:a+1,index:n,availableColumnCount:e.meta.width,columnWidth:i,onResizeStart:s,onResize:l,onResizeStop:d,isComponentVisible:p,onChangeTab:h}))),t&&(0,b.tZ)("div",t))))))}}ul.propTypes=cl,ul.defaultProps={};const hl=ul,pl={id:l().string.isRequired,parentId:l().string.isRequired,component:E.cP.isRequired,depth:l().number.isRequired,parentComponent:E.cP.isRequired,index:l().number.isRequired,editMode:l().bool.isRequired,handleComponentDrop:l().func.isRequired,deleteComponent:l().func.isRequired};class fl extends a.PureComponent{constructor(e){super(e),this.handleDeleteComponent=this.handleDeleteComponent.bind(this)}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}render(){const{component:e,depth:t,parentComponent:n,index:r,handleComponentDrop:i,editMode:o}=this.props;return(0,b.tZ)(te,{component:e,parentComponent:n,orientation:"row",index:r,depth:t,onDrop:i,editMode:o},(({dropIndicatorProps:e,dragSourceRef:t})=>(0,b.tZ)("div",{ref:t},o&&(0,b.tZ)(Ms,{position:"left"},(0,b.tZ)(_s,{onDelete:this.handleDeleteComponent})),(0,b.tZ)("div",{className:"dashboard-component dashboard-component-divider"}),e&&(0,b.tZ)("div",e))))}}fl.propTypes=pl;const ml=fl;var gl=n(79271);const vl={id:l().string.isRequired,parentId:l().string.isRequired,component:E.cP.isRequired,depth:l().number.isRequired,parentComponent:E.cP.isRequired,index:l().number.isRequired,editMode:l().bool.isRequired,filters:l().object.isRequired,handleComponentDrop:l().func.isRequired,deleteComponent:l().func.isRequired,updateComponents:l().func.isRequired};class bl extends a.PureComponent{constructor(e){super(e),this.state={isFocused:!1},this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleUpdateMeta=this.handleUpdateMeta.bind(this),this.handleChangeSize=this.handleUpdateMeta.bind(this,"headerSize"),this.handleChangeBackground=this.handleUpdateMeta.bind(this,"background"),this.handleChangeText=this.handleUpdateMeta.bind(this,"text")}handleChangeFocus(e){this.setState((()=>({isFocused:e})))}handleUpdateMeta(e,t){const{updateComponents:n,component:r}=this.props;t&&r.meta[e]!==t&&n({[r.id]:{...r,meta:{...r.meta,[e]:t}}})}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}render(){const{isFocused:e}=this.state,{component:t,depth:n,parentComponent:r,index:i,handleComponentDrop:o,editMode:a,filters:s}=this.props,l=gl.Z.find((e=>e.value===(t.meta.headerSize||D.u_))),d=al.Z.find((e=>e.value===(t.meta.background||D.HE)));return(0,b.tZ)(te,{component:t,parentComponent:r,orientation:"row",index:i,depth:n,onDrop:o,disableDragDrop:e,editMode:a},(({dropIndicatorProps:e,dragSourceRef:r})=>(0,b.tZ)("div",{ref:r},a&&n<=2&&(0,b.tZ)(Ms,{position:"left"},(0,b.tZ)(ol,{position:"left"})),(0,b.tZ)(Xs,{onChangeFocus:this.handleChangeFocus,menuItems:[(0,b.tZ)(Qs,{id:`${t.id}-header-style`,options:gl.Z,value:t.meta.headerSize,onChange:this.handleChangeSize}),(0,b.tZ)(dl,{id:`${t.id}-background`,value:t.meta.background,onChange:this.handleChangeBackground})],editMode:a},(0,b.tZ)("div",{className:g()("dashboard-component","dashboard-component-header",l.className,d.className)},a&&(0,b.tZ)(Ms,{position:"top"},(0,b.tZ)(_s,{onDelete:this.handleDeleteComponent})),(0,b.tZ)(ot.Z,{title:t.meta.text,canEdit:a,onSaveTitle:this.handleChangeText,showTooltip:!1}),!a&&(0,b.tZ)(Fs,{anchorLinkId:t.id,filters:s,showShortLinkButton:!0}))),e&&(0,b.tZ)("div",e))))}}bl.propTypes=vl,bl.defaultProps={};const yl=bl,Cl={id:l().string.isRequired,parentId:l().string.isRequired,component:E.cP.isRequired,parentComponent:E.cP.isRequired,index:l().number.isRequired,depth:l().number.isRequired,editMode:l().bool.isRequired,availableColumnCount:l().number.isRequired,columnWidth:l().number.isRequired,occupiedColumnCount:l().number.isRequired,onResizeStart:l().func.isRequired,onResize:l().func.isRequired,onResizeStop:l().func.isRequired,handleComponentDrop:l().func.isRequired,deleteComponent:l().func.isRequired,updateComponents:l().func.isRequired};class Sl extends a.PureComponent{constructor(e){super(e),this.state={isFocused:!1},this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleUpdateMeta=this.handleUpdateMeta.bind(this),this.handleChangeBackground=this.handleUpdateMeta.bind(this,"background"),this.handleChangeFocus=this.handleChangeFocus.bind(this)}handleChangeFocus(e){this.setState((()=>({isFocused:Boolean(e)})))}handleUpdateMeta(e,t){const{updateComponents:n,component:r}=this.props;t&&r.meta[e]!==t&&n({[r.id]:{...r,meta:{...r.meta,[e]:t}}})}handleDeleteComponent(){const{deleteComponent:e,component:t,parentId:n}=this.props;e(t.id,n)}render(){const{component:e,parentComponent:t,index:n,availableColumnCount:r,columnWidth:i,occupiedColumnCount:o,depth:a,onResizeStart:s,onResize:l,onResizeStop:d,handleComponentDrop:c,editMode:u,onChangeTab:h,isComponentVisible:p}=this.props,f=e.children||[],m=al.Z.find((t=>t.value===(e.meta.background||D.HE)));return(0,b.tZ)(te,{component:e,parentComponent:t,orientation:"row",index:n,depth:a,onDrop:c,editMode:u},(({dropIndicatorProps:t,dragSourceRef:n})=>(0,b.tZ)(Xs,{isFocused:this.state.isFocused,onChangeFocus:this.handleChangeFocus,disableClick:!0,menuItems:[(0,b.tZ)(dl,{id:`${e.id}-background`,value:m.value,onChange:this.handleChangeBackground})],editMode:u},u&&(0,b.tZ)(Ms,{innerRef:n,position:"left"},(0,b.tZ)(ol,{position:"left"}),(0,b.tZ)(_s,{onDelete:this.handleDeleteComponent}),(0,b.tZ)(Sr,{onClick:this.handleChangeFocus,icon:(0,b.tZ)(rt.Z.Cog,{iconSize:"xl"})})),(0,b.tZ)("div",{className:g()("grid-row",0===f.length&&"grid-row--empty",m.className)},f.map(((t,n)=>(0,b.tZ)(Ll,{key:t,id:t,parentId:e.id,depth:a+1,index:n,availableColumnCount:r-o,columnWidth:i,onResizeStart:s,onResize:l,onResizeStop:d,isComponentVisible:p,onChangeTab:h}))),t&&(0,b.tZ)("div",t)))))}}Sl.propTypes=Cl;const xl=Sl,kl="RENDER_TAB",wl="RENDER_TAB_CONTENT",Rl={id:l().string.isRequired,parentId:l().string.isRequired,component:E.cP.isRequired,parentComponent:E.cP.isRequired,index:l().number.isRequired,depth:l().number.isRequired,renderType:l().oneOf([kl,wl]).isRequired,onDropOnTab:l().func,editMode:l().bool.isRequired,filters:l().object.isRequired,availableColumnCount:l().number,columnWidth:l().number,onResizeStart:l().func,onResize:l().func,onResizeStop:l().func,handleComponentDrop:l().func.isRequired,updateComponents:l().func.isRequired,setDirectPathToChild:l().func.isRequired},Zl={availableColumnCount:0,columnWidth:0,onDropOnTab(){},onResizeStart(){},onResize(){},onResizeStop(){}},Fl=v.iK.div`
  ${({isHighlighted:e,theme:{gridUnit:t,colors:n}})=>`\n    padding: ${t}px ${2*t}px;\n    margin: ${-t}px ${-2*t}px;\n    transition: box-shadow 0.2s ease-in-out;\n    ${e&&`box-shadow: 0 0 ${t}px ${n.primary.light1};`}\n  `}
`,Tl=e=>e.dropIndicatorProps&&(0,b.tZ)("div",{className:"drop-indicator drop-indicator--bottom"}),_l=e=>e.dropIndicatorProps&&(0,b.tZ)("div",{className:"drop-indicator drop-indicator--top"});class Dl extends a.PureComponent{constructor(e){super(e),this.handleChangeText=this.handleChangeText.bind(this),this.handleDrop=this.handleDrop.bind(this),this.handleTopDropTargetDrop=this.handleTopDropTargetDrop.bind(this),this.handleChangeTab=this.handleChangeTab.bind(this)}handleChangeTab({pathToTabIndex:e}){this.props.setDirectPathToChild(e)}handleChangeText(e){const{updateComponents:t,component:n}=this.props;e&&e!==n.meta.text&&t({[n.id]:{...n,meta:{...n.meta,text:e}}})}handleDrop(e){this.props.handleComponentDrop(e),this.props.onDropOnTab(e)}handleTopDropTargetDrop(e){e&&this.props.handleComponentDrop({...e,destination:{...e.destination,index:0}})}renderTabContent(){const{component:e,parentComponent:t,depth:n,availableColumnCount:r,columnWidth:i,onResizeStart:o,onResize:a,onResizeStop:s,editMode:l,isComponentVisible:d}=this.props;return(0,b.tZ)("div",{className:"dashboard-component-tabs-content"},l&&(0,b.tZ)(te,{component:e,parentComponent:t,orientation:"column",index:0,depth:n,onDrop:this.handleTopDropTargetDrop,editMode:!0,className:"empty-droptarget"},_l),e.children.map(((t,l)=>(0,b.tZ)(Ll,{key:t,id:t,parentId:e.id,depth:n,index:l,onDrop:this.handleDrop,availableColumnCount:r,columnWidth:i,onResizeStart:o,onResize:a,onResizeStop:s,isComponentVisible:d,onChangeTab:this.handleChangeTab}))),l&&(0,b.tZ)(te,{component:e,parentComponent:t,orientation:"column",index:e.children.length,depth:n,onDrop:this.handleDrop,editMode:!0,className:"empty-droptarget"},Tl))}renderTab(){const{component:e,parentComponent:t,index:n,depth:r,editMode:i,filters:o,isFocused:a,isHighlighted:s}=this.props;return(0,b.tZ)(te,{component:e,parentComponent:t,orientation:"column",index:n,depth:r,onDrop:this.handleDrop,editMode:i},(({dropIndicatorProps:t,dragSourceRef:r})=>(0,b.tZ)(Fl,{isHighlighted:s,className:"dragdroppable-tab",ref:r},(0,b.tZ)(ot.Z,{title:e.meta.text,defaultTitle:e.meta.defaultText,placeholder:e.meta.placeholder,canEdit:i&&a,onSaveTitle:this.handleChangeText,showTooltip:!1,editing:i&&a}),!i&&(0,b.tZ)(Fs,{anchorLinkId:e.id,filters:o,showShortLinkButton:!0,placement:n>=5?"left":"right"}),t&&(0,b.tZ)("div",t))))}render(){const{renderType:e}=this.props;return e===kl?this.renderTab():this.renderTabContent()}}function Ml({currentComponent:e,directPathToChild:t=[]}){if(!e||0===t.length||-1===t.indexOf(e.id))return-1;const n=t.findIndex((t=>t===e.id)),r=t[n+1];return e.children.indexOf(r)>=0?e.children.findIndex((e=>e===r)):-1}function El(e,t){const n=(e.parents||[]).slice();return n.push(e.id),n.push(e.children[t]),n}function Il(e=[]){if(e.length>0){const t=e.slice();for(;t.length;){const e=t.pop(),n=e&&e.split("-")[0];if(!D.Ep.includes(n))return e}}return null}Dl.propTypes=Rl,Dl.defaultProps=Zl;const Ol={id:l().string.isRequired,parentId:l().string.isRequired,component:E.cP.isRequired,parentComponent:E.cP.isRequired,index:l().number.isRequired,depth:l().number.isRequired,renderTabContent:l().bool,editMode:l().bool.isRequired,renderHoverMenu:l().bool,directPathToChild:l().arrayOf(l().string),filterboxMigrationState:Fe.Qi,logEvent:l().func.isRequired,setActiveTabs:l().func,availableColumnCount:l().number,columnWidth:l().number,onResizeStart:l().func,onResize:l().func,onResizeStop:l().func,createComponent:l().func.isRequired,handleComponentDrop:l().func.isRequired,onChangeTab:l().func.isRequired,deleteComponent:l().func.isRequired,updateComponents:l().func.isRequired},Pl={renderTabContent:!0,renderHoverMenu:!0,availableColumnCount:0,columnWidth:0,directPathToChild:[],filterboxMigrationState:Fe.Qi.NOOP,setActiveTabs(){},onResizeStart(){},onResize(){},onResizeStop(){}},Nl=v.iK.div`
  width: 100%;
  background-color: ${({theme:e})=>e.colors.grayscale.light5};

  .dashboard-component-tabs-content {
    min-height: ${({theme:e})=>12*e.gridUnit}px;
    margin-top: ${({theme:e})=>e.gridUnit/4}px;
    position: relative;
  }

  .ant-tabs {
    overflow: visible;

    .ant-tabs-nav-wrap {
      min-height: ${({theme:e})=>12.5*e.gridUnit}px;
    }

    .ant-tabs-content-holder {
      overflow: visible;
    }
  }

  div .ant-tabs-tab-btn {
    text-transform: none;
  }
`;class jl extends a.PureComponent{constructor(e){super(e),this.showDeleteConfirmModal=e=>{const{component:t,deleteComponent:n}=this.props;Re.u_.confirm({title:(0,d.t)("Delete dashboard tab?"),content:(0,b.tZ)("span",null,"Deleting a tab will remove all content within it. You may still reverse this action with the ",(0,b.tZ)("b",null,"undo")," button (cmd + z) until you save your changes."),onOk:()=>{n(e,t.id);const r=t.children.indexOf(e);this.handleDeleteTab(r)},okType:"danger",okText:"DELETE",cancelText:"CANCEL",icon:null})},this.handleEdit=(e,t)=>{const{component:n,createComponent:r}=this.props;"add"===t?r({destination:{id:n.id,type:n.type,index:n.children.length},dragging:{id:D.Xk,type:p.gn}}):"remove"===t&&this.showDeleteConfirmModal(e)};const t=Math.max(0,Ml({currentComponent:e.component,directPathToChild:e.directPathToChild})),{children:n}=e.component,r=n[t];this.state={tabIndex:t,activeKey:r},this.handleClickTab=this.handleClickTab.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleDeleteTab=this.handleDeleteTab.bind(this),this.handleDropOnTab=this.handleDropOnTab.bind(this),this.handleDrop=this.handleDrop.bind(this)}componentDidMount(){this.props.setActiveTabs(this.state.activeKey)}componentDidUpdate(e,t){t.activeKey===this.state.activeKey&&e.filterboxMigrationState===this.props.filterboxMigrationState||this.props.setActiveTabs(this.state.activeKey,t.activeKey)}UNSAFE_componentWillReceiveProps(e){const t=Math.max(0,e.component.children.length-1),n=this.props.component.children,r=e.component.children;if(this.state.tabIndex>t&&this.setState((()=>({tabIndex:t}))),r.length){const e=r[r.length-1];r.length>n.length&&this.setState((()=>({activeKey:e,tabIndex:t}))),r.length<n.length&&this.setState((()=>({activeKey:r[0]})))}if(e.isComponentVisible&&Il(e.directPathToChild)!==Il(this.props.directPathToChild)){const t=Ml({currentComponent:e.component,directPathToChild:e.directPathToChild});t>-1&&t!==this.state.tabIndex&&this.setState((()=>({tabIndex:t,activeKey:r[t]})))}}handleClickTab(e){const{component:t}=this.props,{children:n}=t;if(e!==this.state.tabIndex){const n=El(t,e),r=n[n.length-1];this.props.logEvent(tt.Iq,{target_id:r,index:e}),this.props.onChangeTab({pathToTabIndex:n})}this.setState((()=>({activeKey:n[e]})))}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleDeleteTab(e){this.handleClickTab(Math.max(0,e-1))}handleDropOnTab(e){const{component:t}=this.props,{destination:n}=e;if(n){const e=n.id===t.id?n.index:t.children.indexOf(n.id);e>-1&&setTimeout((()=>{this.handleClickTab(e)}),30)}}handleDrop(e){e.dragging.type!==p.yR&&this.props.handleComponentDrop(e)}render(){const{depth:e,component:t,parentComponent:n,index:r,availableColumnCount:i,columnWidth:o,onResizeStart:a,onResize:s,onResizeStop:l,renderTabContent:d,renderHoverMenu:c,isComponentVisible:u,editMode:h,nativeFilters:p}=this.props,{children:f}=t,{tabIndex:m,activeKey:g}=this.state;let v;return null!=p&&p.focusedFilterId&&(v=p.filters[p.focusedFilterId].tabsInScope),(0,b.tZ)(te,{component:t,parentComponent:n,orientation:"row",index:r,depth:e,onDrop:this.handleDrop,editMode:h},(({dropIndicatorProps:r,dragSourceRef:p})=>(0,b.tZ)(Nl,{className:"dashboard-component dashboard-component-tabs"},h&&c&&(0,b.tZ)(Ms,{innerRef:p,position:"left"},(0,b.tZ)(ol,{position:"left"}),(0,b.tZ)(_s,{onDelete:this.handleDeleteComponent})),(0,b.tZ)(C.cl,{id:t.id,activeKey:g,onChange:e=>{this.handleClickTab(f.indexOf(e))},onEdit:this.handleEdit,type:h?"editable-card":"card"},f.map(((n,r)=>{var c;return(0,b.tZ)(C.cl.TabPane,{key:n,tab:(0,b.tZ)(Ll,{id:n,parentId:t.id,depth:e,index:r,renderType:kl,availableColumnCount:i,columnWidth:o,onDropOnTab:this.handleDropOnTab,isFocused:g===n,isHighlighted:g!==n&&(null==(c=v)?void 0:c.includes(n))})},d&&(0,b.tZ)(Ll,{id:n,parentId:t.id,depth:e,index:r,renderType:wl,availableColumnCount:i,columnWidth:o,onResizeStart:a,onResize:s,onResizeStop:l,onDropOnTab:this.handleDropOnTab,isComponentVisible:m===r&&u}))}))),r&&n.id!==D._4&&(0,b.tZ)("div",r))))}}jl.propTypes=Ol,jl.defaultProps=Pl;const ql=(0,o.$j)((function(e){return{nativeFilters:e.nativeFilters,directPathToChild:e.dashboardState.directPathToChild,filterboxMigrationState:e.dashboardState.filterboxMigrationState}}))(jl),zl={[p.dW]:Bs,[p.xh]:il,[p.BA]:hl,[p.hE]:ml,[p.Nc]:yl,[p.Os]:xl,[p.gn]:Dl,[p.yR]:ql};var Al=n(72673);const $l={id:l().string,parentId:l().string,depth:l().number,index:l().number,renderHoverMenu:l().bool,renderTabContent:l().bool,onChangeTab:l().func,component:E.cP.isRequired,parentComponent:E.cP.isRequired,createComponent:l().func.isRequired,deleteComponent:l().func.isRequired,updateComponents:l().func.isRequired,handleComponentDrop:l().func.isRequired,logEvent:l().func.isRequired,directPathToChild:l().arrayOf(l().string),directPathLastUpdated:l().number,dashboardId:l().number.isRequired,isComponentVisible:l().bool};class Ul extends a.PureComponent{render(){const{component:e}=this.props,t=e?zl[e.type]:null;return t?(0,b.tZ)(t,this.props):null}}Ul.propTypes=$l,Ul.defaultProps={isComponentVisible:!0};const Ll=(0,o.$j)((function({dashboardLayout:e,dashboardState:t,dashboardInfo:n},r){const i=e.present,{id:o,parentId:a}=r,s=i[o],l={component:s,getComponentById:e=>i[e],parentComponent:i[a],editMode:t.editMode,filters:(0,on.De)(),dashboardId:n.id,fullSizeChartId:t.fullSizeChartId};if(s){const e=s.type;if(e===p.Os||e===p.BA){const{occupiedWidth:t,minimumWidth:n}=(0,Al.Z)({id:o,components:i});e===p.Os&&(l.occupiedColumnCount=t),e===p.BA&&(l.minColumnWidth=n)}}return l}),(function(e){return(0,i.DE)({addDangerToast:mr.Gb,createComponent:fr.LM,deleteComponent:fr.v7,updateComponents:fr.WZ,handleComponentDrop:fr._p,setDirectPathToChild:Nt.E2,setFullSizeChartId:Nt.zL,setActiveTabs:Nt.$_,logEvent:gr.logEvent},e)}))(Ul);var Vl,Kl=n(5977),Bl=n(90057),Wl=n(8868);!function(e){e.AllFilters="allFilters",e.FilterSets="filterSets"}(Vl||(Vl={}));const Hl=e=>Object.values(e).reduce(((e,t)=>({...e,[t.id]:t.extraFormData})),{}),Gl=(e,t)=>{var n;const r=null==t?void 0:t.value;return(null==(n=e.controlValues)?void 0:n.enableEmptyFilter)&&null==r};var Ql=n(52794),Jl=n(24350),Yl=n.n(Jl),Xl=n(63105),ed=n.n(Xl),td=n(14073);const nd=()=>(0,o.v9)((e=>e.nativeFilters.filterSets||{})),rd=()=>{const e=(0,o.v9)((e=>{var t;return null==(t=e.dashboardState)?void 0:t.preselectNativeFilters})),t=(0,o.v9)((e=>e.nativeFilters.filters));return(0,a.useMemo)((()=>Object.entries(t).reduce(((t,[n,r])=>({...t,[n]:{...r,preselect:null==e?void 0:e[n]}})),{})),[t,e])},id=()=>{const e=(0,o.v9)((e=>e.dataMask));return(0,a.useMemo)((()=>Object.values(e).filter((e=>String(e.id).startsWith(Bo.rW))).reduce(((e,t)=>({...e,[t.id]:t})),{})),[e])},od=(e,t)=>{const n=nd(),r=Object.values(n),i=(0,a.useMemo)((()=>!!r.find((({name:t})=>t===e))),[r,e]);return t!==e&&i},ad=v.iK.div`
  display: flex;
  & button {
    ${({disabled:e})=>"pointer-events: "+(e?"none":"all")};
    flex: 1;
  }
`,sd=v.iK.div`
  display: grid;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  grid-gap: 10px;
  grid-template-columns: 1fr 1fr;
`,ld=({onCancel:e,editMode:t,onEdit:n,onCreate:r,disabled:i,filterSetName:o})=>{const s=od(o),l=!o||s||i;return(0,b.tZ)(a.Fragment,null,t?(0,b.tZ)(sd,null,(0,b.tZ)(it.Z,{buttonStyle:"tertiary",buttonSize:"small",onClick:e},(0,d.t)("Cancel")),(0,b.tZ)(Gn.u,{placement:"right",title:!o&&(0,d.t)("Please filter set name")||s&&(0,d.t)("Filter set with this name already exists")||i&&Aa},(0,b.tZ)(ad,{disabled:l},(0,b.tZ)(it.Z,ut()({disabled:l,buttonStyle:"primary",htmlType:"submit",buttonSize:"small",onClick:r},Fc("create-filter-set-button")),(0,d.t)("Create"))))):(0,b.tZ)(Gn.u,{placement:"bottom",title:i&&Aa},(0,b.tZ)(ad,{disabled:i},(0,b.tZ)(it.Z,ut()({disabled:i,buttonStyle:"tertiary",buttonSize:"small",onClick:n},Fc("new-filter-set-button")),(0,d.t)("Create new filter set")))))},dd={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 190h-69.9c-9.8 0-19.1 4.5-25.1 12.2L404.7 724.5 207 474a32 32 0 00-25.1-12.2H112c-6.7 0-10.4 7.7-6.3 12.9l273.9 347c12.8 16.2 37.4 16.2 50.3 0l488.4-618.9c4.1-5.1.4-12.8-6.3-12.8z"}}]},name:"check",theme:"outlined"};var cd=function(e,t){return a.createElement(Ca.Z,Object.assign({},e,{ref:t,icon:dd}))};cd.displayName="CheckOutlined";const ud=a.forwardRef(cd),hd={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M176 511a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"ellipsis",theme:"outlined"};var pd=function(e,t){return a.createElement(Ca.Z,Object.assign({},e,{ref:t,icon:hd}))};pd.displayName="EllipsisOutlined";const fd=a.forwardRef(pd),md=v.iK.div`
  display: flex;
  align-items: center;
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
`,gd=(0,v.iK)(Re.UO)`
  &.ant-collapse-ghost > .ant-collapse-item {
    & > .ant-collapse-content > .ant-collapse-content-box {
      padding: 0;
      padding-top: 0;
      padding-bottom: 0;
      font-size: ${({theme:e})=>e.typography.sizes.s}px;
    }
    & > .ant-collapse-header {
      padding: 0;
      display: flex;
      align-items: center;
      flex-direction: row-reverse;
      justify-content: flex-end;
      max-width: max-content;
      & .ant-collapse-arrow {
        position: static;
        padding-left: ${({theme:e})=>e.gridUnit}px;
      }
  }
`,vd=v.iK.div`
  padding-top: ${({theme:e})=>e.gridUnit}px;
  padding-bottom: ${({theme:e})=>e.gridUnit}px;
`,bd=({dataMask:e,filterSet:t})=>{const n=(0,v.Fg)(),r=rd(),i=Object.values(r).filter((e=>e.type===mi.B.NATIVE_FILTER));let o=null!=i?i:[];return null!=t&&t.nativeFilters&&(o=Object.values(null==t?void 0:t.nativeFilters)),(0,b.tZ)(gd,{ghost:!0,expandIconPosition:"right",defaultActiveKey:t?void 0:["filters"],expandIcon:({isActive:e})=>{const t=n.colors.grayscale.base,r=e?rt.Z.CaretUpOutlined:rt.Z.CaretDownOutlined;return(0,b.tZ)(r,{iconColor:t})}},(0,b.tZ)(Re.UO.Panel,ut()({},Fc("collapse-filter-set-description"),{header:(0,b.tZ)(md,null,(0,b.tZ)(Re.ZT.Text,{type:"secondary"},(0,d.t)("Filters (%d)",o.length))),key:"filters"}),o.map((({id:n,name:i})=>{var o,a,s,l,c;const u=t&&!(0,wr.JB)(null==(o=r[n])?void 0:o.controlValues,null==t||null==(a=t.nativeFilters)||null==(s=a[n])?void 0:s.controlValues,{ignoreUndefined:!0}),h=!Object.keys(r).includes(n);return(0,b.tZ)(Re.u,{title:h&&(0,d.t)("This filter doesn't exist in dashboard. It will not be applied.")||u&&(0,d.t)("Filter metadata changed in dashboard. It will not be applied."),placement:"bottomLeft",key:n},(0,b.tZ)(vd,null,(0,b.tZ)(Re.ZT.Text,{strong:!0,delete:h,mark:u},i,": "),(0,b.tZ)(Re.ZT.Text,{delete:h,mark:u},$a(null==e||null==(l=e[n])||null==(c=l.filterState)?void 0:c.value)||(0,b.tZ)(Re.ZT.Text,{type:"secondary"},(0,d.t)("None")))))}))))},yd=(0,v.iK)(it.Z)`
  padding: 0;
`,Cd=v.iK.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
`,Sd=v.iK.div`
  display: flex;
  justify-content: flex-end;
  align-items: center;
  & > *,
  & > button.superset-button {
    ${({theme:e})=>`margin-left: ${2*e.gridUnit}px`};
  }
`,xd=({editMode:e,setFilterSetName:t,onDelete:n,onEdit:r,filterSetName:i,dataMaskSelected:o,filterSet:s,isApplied:l,onRebuild:c})=>{var u,h;const p=(0,b.tZ)(Re.v2,null,(0,b.tZ)(Re.v2.Item,{onClick:r},(0,d.t)("Edit")),(0,b.tZ)(Re.v2.Item,{onClick:c},(0,b.tZ)(Gn.u,{placement:"right",title:(0,d.t)("Remove invalid filters")},(0,d.t)("Rebuild"))),(0,b.tZ)(Re.v2.Item,{onClick:n,danger:!0},(0,d.t)("Delete")));return(0,b.tZ)(a.Fragment,null,(0,b.tZ)(Cd,null,(0,b.tZ)(Re.ZT.Text,{strong:!0,editable:{editing:e,icon:(0,b.tZ)("span",null),onChange:t}},null!=(u=null==s?void 0:s.name)?u:i),(0,b.tZ)(Sd,null,l&&(0,b.tZ)(ud,{style:{color:v.K6.colors.success.base}}),n&&(0,b.tZ)(Re.Lt,{overlay:p,placement:"bottomRight",trigger:["click"]},(0,b.tZ)(yd,ut()({onClick:e=>{e.stopPropagation(),e.preventDefault()}},Fc("filter-set-menu-button"),{buttonStyle:"link",buttonSize:"xsmall"}),(0,b.tZ)(fd,null))))),(0,b.tZ)(bd,{filterSet:s,dataMask:null!=(h=null==s?void 0:s.dataMask)?h:o}))},kd=v.iK.div`
  display: grid;
  align-items: center;
  justify-content: center;
  grid-template-columns: 1fr;

  & button.superset-button {
    margin-left: 0;
  }
  & input {
    width: 100%;
  }
`,wd=v.iK.div`
  ${({theme:e,"data-selected":t,onClick:n})=>`\n    display: grid;\n    align-items: center;\n    justify-content: center;\n    grid-template-columns: 1fr;\n    grid-gap: ${e.gridUnit}px;\n    border-bottom: 1px solid ${e.colors.grayscale.light2};\n    padding: ${2*e.gridUnit}px ${4*e.gridUnit}px;\n    cursor: ${n?"pointer":"auto"};\n    background: ${t?e.colors.primary.light5:"transparent"};\n  `}
`,Rd=(0,d.t)("New filter set"),Zd=({dataMaskSelected:e,onEditFilterSet:t,disabled:n,onFilterSelectionChange:r,tab:i})=>{const s=(0,o.I0)(),[l,d]=(0,a.useState)(Rd),[c,u]=(0,a.useState)(!1),h=id(),p=nd(),f=Object.values(p),m=rd(),g=Object.values(m),[v,y]=(0,a.useState)(null);(0,a.useEffect)((()=>{var t;if(i===Vl.AllFilters)return;if(!f.length)return void y(null);const n=Ua({dataMaskSelected:e,filterSetFilterValues:f});y(null!=(t=null==n?void 0:n.id)?t:null)}),[i,e,f]);const C=(e,t)=>{var n,r,i;return!g.find((t=>(null==t?void 0:t.id)===e))||!(0,wr.JB)(null==(n=m[e])?void 0:n.controlValues,null==t||null==(r=t.nativeFilters)||null==(i=r[e])?void 0:i.controlValues,{ignoreUndefined:!0})},S=(e,t)=>{var n;const i=null==t?void 0:t.target;if(i){var o;const e=i.closest(`[data-anchor=${Fc("filter-set-wrapper",!0)}]`);if(null!=e&&null!=(o=e.querySelector(".ant-collapse-header"))&&o.contains(i)||null!=i&&i.closest(".ant-dropdown"))return}if(y(e),!e)return;const a=p[e];(null!=(n=Object.values(null==a?void 0:a.dataMask))?n:[]).forEach((e=>{const{extraFormData:t,filterState:n,id:i}=e;C(i,a)||r({id:i},{extraFormData:t,filterState:n})}))};return(0,b.tZ)(kd,null,!v&&(0,b.tZ)(wd,null,(0,b.tZ)(xd,{dataMaskSelected:e,editMode:c,setFilterSetName:d,filterSetName:l}),(0,b.tZ)(ld,{filterSetName:l.trim(),disabled:n,onCancel:()=>{u(!1),d(Rd)},editMode:c,onEdit:()=>u(!0),onCreate:()=>{const e={name:l.trim(),nativeFilters:m,dataMask:Object.keys(m).reduce(((e,t)=>({...e,[t]:h[t]})),{})};s((0,Ql.xQ)(e)),u(!1),d(Rd)}})),f.map((r=>(0,b.tZ)(wd,ut()({},Fc("filter-set-wrapper"),{"data-anchor":Fc("filter-set-wrapper",!0),"data-selected":r.id===v,onClick:e=>S(r.id,e),key:r.id}),(0,b.tZ)(xd,{isApplied:r.id===v&&!n,onDelete:()=>{return e=r.id,s((0,Ql.$l)(e)),void(e===v&&y(null));var e},onEdit:()=>{return e=r.id,S(e),void t(e);var e},onRebuild:()=>(e=>{var t;const n=p[e],r=Object.values(null!=(t=null==n?void 0:n.dataMask)?t:{}).filter((e=>{const{id:t}=e;return!C(t,n)})).reduce(((e,t)=>({...e,[t.id]:m[t.id]})),{}),i={...n,nativeFilters:r,dataMask:Object.keys(r).reduce(((e,t)=>{var r;return{...e,[t]:null==(r=n.dataMask)?void 0:r[t]}}),{})};s((0,Ql.ql)(i))})(r.id),dataMaskSelected:e,filterSet:r})))))},Fd={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8zm475.7 440l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z"}}]},name:"warning",theme:"outlined"};var Td=function(e,t){return a.createElement(Ca.Z,Object.assign({},e,{ref:t,icon:Fd}))};Td.displayName="WarningOutlined";const _d=a.forwardRef(Td),Dd=v.iK.div`
  display: grid;
  grid-template-columns: 1fr;
  align-items: flex-start;
  justify-content: flex-start;
  grid-gap: ${({theme:e})=>e.gridUnit}px;
  background: ${({theme:e})=>e.colors.primary.light4};
  padding: ${({theme:e})=>2*e.gridUnit}px;
`,Md=(0,v.iK)(Re.ZT.Text)`
  color: ${({theme:e})=>e.colors.primary.dark2};
`,Ed=(0,v.iK)(Re.ZT.Text)`
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  & .anticon {
    padding: ${({theme:e})=>e.gridUnit}px;
  }
`,Id=v.iK.div`
  display: flex;
  & button {
    ${({disabled:e})=>"pointer-events: "+(e?"none":"all")};
    flex: 1;
  }
`,Od=({filterSetId:e,onCancel:t,dataMaskSelected:n,disabled:r})=>{const i=id(),s=(0,o.I0)(),l=nd(),c=rd(),u=Object.values(l),[h,p]=(0,a.useState)(l[e].name),f=od(h,l[e].name),m=(0,a.useMemo)((()=>Ua({dataMaskSelected:n,filterSetFilterValues:u})),[n,u]),g=m&&m.id!==e,v=r||g||f;return(0,b.tZ)(Dd,null,(0,b.tZ)(Md,{strong:!0},(0,d.t)("Editing filter set:")),(0,b.tZ)(Md,{editable:{editing:!0,icon:(0,b.tZ)("span",null),onChange:p}},h),(0,b.tZ)(sd,null,(0,b.tZ)(it.Z,{ghost:!0,buttonStyle:"tertiary",buttonSize:"small",onClick:t},(0,d.t)("Cancel")),(0,b.tZ)(Re.u,{placement:"right",title:f&&(0,d.t)("Filter set with this name already exists")||g&&(0,d.t)("Filter set already exists")||r&&Aa},(0,b.tZ)(Id,{disabled:v},(0,b.tZ)(it.Z,ut()({disabled:v,buttonStyle:"primary",htmlType:"submit",buttonSize:"small",onClick:()=>{s((0,Ql.ql)({id:e,name:h,nativeFilters:c,dataMask:{...i}})),t()}},Fc("filter-set-edit-save")),(0,d.t)("Save"))))),g&&(0,b.tZ)(Ed,{mark:!0},(0,b.tZ)(_d,null),(0,d.t)('This filter set is identical to: "%s"',null==m?void 0:m.name)))},Pd=(0,v.iK)(it.Z)`
  padding: 0;
`,Nd=({createNewOnOpen:e,dashboardId:t,children:n})=>{const r=(0,o.I0)(),[i,s]=(0,a.useState)(!1);function l(){s(!1)}return(0,b.tZ)(a.Fragment,null,(0,b.tZ)(Pd,ut()({},Fc("create-filter"),{buttonStyle:"link",buttonSize:"xsmall",onClick:()=>s(!0)}),n),(0,b.tZ)(ea,{isOpen:i,onSave:async function(e){r(await(0,Ql.RY)(e)),l()},onCancel:l,createNewOnOpen:e,key:`filters-for-${t}`}))},jd=v.iK.h4`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  margin: 0;
  padding: ${({theme:e})=>2*e.gridUnit}px;

  & > span {
    flex-grow: 1;
  }
`,qd=v.iK.div`
  display: grid;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  grid-gap: 10px;
  grid-template-columns: 1fr 1fr;
  ${({theme:e})=>`padding: 0 ${2*e.gridUnit}px`};

  .btn {
    flex: 1;
  }
`,zd=(0,v.iK)(it.Z)`
  padding: 0;
`,Ad=v.iK.div`
  padding: ${({theme:e})=>e.gridUnit}px
    ${({theme:e})=>2*e.gridUnit}px;
`,$d=({onApply:e,onClearAll:t,isApplyDisabled:n,dataMaskSelected:r,dataMaskApplied:i,toggleFiltersBar:a})=>{const s=(0,v.Fg)(),l=rd(),c=Object.values(l),u=(0,o.v9)((({dashboardInfo:e})=>e.dash_edit_perm)),h=(0,o.v9)((({dashboardInfo:e})=>e.id)),p=Object.values(i).every((e=>{var t,n,i;return null===(null==(t=r[e.id])||null==(n=t.filterState)?void 0:n.value)||!r[e.id]&&null===(null==(i=e.filterState)?void 0:i.value)}));return(0,b.tZ)(Ad,null,(0,b.tZ)(jd,null,(0,b.tZ)("span",null,(0,d.t)("Filters")),u&&(0,b.tZ)(Nd,{dashboardId:h,createNewOnOpen:0===c.length},(0,b.tZ)(rt.Z.Edit,{iconColor:s.colors.grayscale.base})),(0,b.tZ)(zd,ut()({},Fc("collapse-button"),{buttonStyle:"link",buttonSize:"xsmall",onClick:()=>a(!1)}),(0,b.tZ)(rt.Z.Expand,{iconColor:s.colors.grayscale.base}))),(0,b.tZ)(qd,{className:"filter-action-buttons"},(0,b.tZ)(it.Z,ut()({disabled:p,buttonStyle:"tertiary",buttonSize:"small",className:"filter-clear-all-button",onClick:t},Fc("clear-button")),(0,d.t)("Clear all")),(0,b.tZ)(it.Z,ut()({disabled:n,buttonStyle:"primary",htmlType:"submit",buttonSize:"small",className:"filter-apply-button",onClick:e},Fc("apply-button")),(0,d.t)("Apply"))))};var Ud,Ld=n(73935),Vd=(Ud=function(e,t){return Ud=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},Ud(e,t)},function(e,t){function n(){this.constructor=e}Ud(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Kd="html",Bd="svg",Wd=function(e){var t,n,r,i={};if(e===Kd)r=document.createElement("div");else{if(e!==Bd)throw new Error('Invalid element type "'+e+'" for createPortalNode: must be "html" or "svg".');r=document.createElementNS("http://www.w3.org/2000/svg","g")}var o={element:r,elementType:e,setPortalProps:function(e){i=e},getInitialPortalProps:function(){return i},mount:function(r,i){if(i!==n){if(o.unmount(),r!==t&&!function(e,t){if(t===Kd)return e instanceof HTMLElement;if(t===Bd)return e instanceof SVGElement;throw new Error('Unrecognized element type "'+t+'" for validateElementType.')}(r,e))throw new Error('Invalid element type for portal: "'+e+'" portalNodes must be used with '+e+" elements, but OutPortal is within <"+r.tagName+">.");r.replaceChild(o.element,i),t=r,n=i}},unmount:function(e){e&&e!==n||t&&n&&(t.replaceChild(n,o.element),t=void 0,n=void 0)}};return o},Hd=function(e){function t(t){var n=e.call(this,t)||this;return n.addPropsChannel=function(){Object.assign(n.props.node,{setPortalProps:function(e){n.setState({nodeProps:e})}})},n.state={nodeProps:n.props.node.getInitialPortalProps()},n}return Vd(t,e),t.prototype.componentDidMount=function(){this.addPropsChannel()},t.prototype.componentDidUpdate=function(){this.addPropsChannel()},t.prototype.render=function(){var e=this,t=this.props,n=t.children,r=t.node;return Ld.createPortal(a.Children.map(n,(function(t){return a.isValidElement(t)?a.cloneElement(t,e.state.nodeProps):t})),r.element)},t}(a.PureComponent),Gd=function(e){function t(t){var n=e.call(this,t)||this;return n.placeholderNode=a.createRef(),n.passPropsThroughPortal(),n}return Vd(t,e),t.prototype.passPropsThroughPortal=function(){var e=Object.assign({},this.props,{node:void 0});this.props.node.setPortalProps(e)},t.prototype.componentDidMount=function(){var e=this.props.node;this.currentPortalNode=e;var t=this.placeholderNode.current,n=t.parentNode;e.mount(n,t),this.passPropsThroughPortal()},t.prototype.componentDidUpdate=function(){var e=this.props.node;this.currentPortalNode&&e!==this.currentPortalNode&&(this.currentPortalNode.unmount(this.placeholderNode.current),this.currentPortalNode=e);var t=this.placeholderNode.current,n=t.parentNode;e.mount(n,t),this.passPropsThroughPortal()},t.prototype.componentWillUnmount=function(){this.props.node.unmount(this.placeholderNode.current)},t.prototype.render=function(){return a.createElement("div",{ref:this.placeholderNode})},t}(a.PureComponent),Qd=Wd.bind(null,Kd),Jd=(Wd.bind(null,Bd),n(8802)),Yd=n.n(Jd);const Xd=k()(((e,t)=>{e(t?(0,Ql.$7)(t):(0,Ql.Up)())}),300),ec=v.iK.div`
  & > div {
    height: auto !important;
    min-height: ${32}px;
  }
`,tc=[{data:[{}]}],nc=[jr.cg.NATIVE_FILTER],rc=({dataMaskSelected:e,filter:t,directPathToChild:n,onFilterSelectionChange:r,inView:i=!0,showOverflow:s,parentRef:l})=>{var u,p,f;const{id:m,targets:g,filterType:v,adhoc_filters:y,time_range:C}=t,S=(0,Nr.Z)().get(v),x=function(e,t){const{filters:n}=(0,o.v9)((e=>e.nativeFilters)),r=n[e];return(0,a.useMemo)((()=>{var e;const n=null!=(e=null==r?void 0:r.cascadeParentIds)?e:[];let i={};return n.forEach((e=>{const n=null==t?void 0:t[e];i=(0,kr.on)(i,null==n?void 0:n.extraFormData)})),i}),[t,null==r?void 0:r.cascadeParentIds])}(m,e),k=(0,o.v9)((e=>e.dashboardState.isRefreshing)),[w,R]=(0,a.useState)([]),[Z,F]=(0,a.useState)(""),[T,_]=(0,a.useState)({inView:!1}),[D,M]=(0,a.useState)({}),[E,I]=(0,a.useState)(i),O=(0,a.useRef)(null),[P]=g,{datasetId:N,column:j={}}=P,{name:q}=j,z=!!N,[A,$]=(0,a.useState)(z),[U,L]=(0,a.useState)(!1),V=(0,o.I0)();(0,a.useEffect)((()=>{!E&&i&&I(!0)}),[i,E,I]),(0,a.useEffect)((()=>{var e;if(!E)return;const n=(0,kr.zi)({...t,datasetId:N,cascadingFilters:x,groupby:q,inputRef:O,adhoc_filters:y,time_range:C}),r=(null==(e=t.dataMask)?void 0:e.ownState)||{};if(!U&&(!Yd()(T,n,((e,t,n)=>"url_params"===n||void 0))||!Ir()(D,r)||k)){if(_(n),M(r),!z)return;L(!0),(0,xr.getChartDataRequest)({formData:n,force:!1,requestParams:{dashboardId:0},ownState:r}).then((({response:e,json:t})=>{if((0,nt.cr)(c.T.GLOBAL_ASYNC_QUERIES)){const n="result"in t?t.result[0]:t;if(200===e.status)L(!1),$(!1),R([n]);else{if(202!==e.status)throw new Error(`Received unexpected response status (${e.status}) while fetching chart data`);(0,Xi.YJ)(n).then((e=>{L(!1),$(!1),R(e)})).catch((e=>{F(e.message||e.error||(0,d.t)("Check configuration")),L(!1),$(!1)}))}}else R(t.result),F(""),L(!1),$(!1)})).catch((e=>{F(e.statusText),L(!1),$(!1)}))}}),[E,x,N,q,JSON.stringify(t),z,U,k]),(0,a.useEffect)((()=>{if((null==n?void 0:n[0])===t.id){const e=setTimeout((()=>{var e;null==O||null==(e=O.current)||e.focus()}),200);return()=>clearTimeout(e)}}),[O,n,t.id]);const K=(0,a.useCallback)((e=>r(t,e)),[t,r]),B=(0,a.useCallback)((()=>Xd(V,m)),[V,m]),W=(0,a.useCallback)((()=>Xd(V)),[V]),H=(0,a.useMemo)((()=>({setDataMask:K,setFocusedFilter:B,unsetFocusedFilter:W})),[K,B,W]),G=Gl(t,null==(u=t.dataMask)?void 0:u.filterState),Q=(0,a.useMemo)((()=>{var e;return{...null==(e=t.dataMask)?void 0:e.filterState,validateStatus:G&&"error"}}),[null==(p=t.dataMask)?void 0:p.filterState,G]);return Z?(0,b.tZ)(Qi,{title:(0,d.t)("Cannot load filter"),body:Z,level:"error"}):(0,b.tZ)(ec,null,A?(0,b.tZ)(h.Z,{position:"inline-centered"}):(0,b.tZ)(fo.Z,{height:32,width:"100%",showOverflow:s,formData:T,parentRef:l,queriesData:z?w:tc,chartType:v,behaviors:nc,filterState:Q,ownState:null==(f=t.dataMask)?void 0:f.ownState,enableNoResults:null==S?void 0:S.enableNoResults,isRefreshing:U,hooks:H}))},ic=v.iK.div`
  position: absolute;
  right: 0;
`,oc=v.iK.h4`
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  color: ${({theme:e})=>e.colors.grayscale.dark1};
  margin: 0;
  overflow-wrap: break-word;
`,ac=v.iK.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  margin-bottom: ${({theme:e})=>e.gridUnit}px;
`,sc=(0,v.iK)(kt.l0)`
  width: 100%;
  && .ant-form-item-label > label {
    text-transform: none;
    width: 100%;
    padding-right: ${({theme:e})=>11*e.gridUnit}px;
  }
  .ant-form-item-tooltip {
    margin-bottom: ${({theme:e})=>e.gridUnit}px;
  }
`,lc=(0,v.iK)(kt.xJ)`
  .ant-form-item-label {
    label.ant-form-item-required:not(.ant-form-item-required-mark-optional) {
      &::after {
        display: none;
      }
    }
  }
`,dc=v.iK.div`
  font-size: ${({theme:e})=>e.typography.sizes.m}px;
  display: flex;
`,cc=()=>(0,b.tZ)("span",{css:e=>({color:e.colors.error.base,fontSize:`${e.typography.sizes.s}px`,paddingLeft:"1px"})},"*"),uc=({description:e})=>(0,b.tZ)(dc,null,(0,b.tZ)(Gn.u,{title:e,placement:"right",overlayInnerStyle:{display:"-webkit-box",overflow:"hidden",WebkitLineClamp:20,WebkitBoxOrient:"vertical",textOverflow:"ellipsis"}},(0,b.tZ)("i",{className:"fa fa-info-circle text-muted",css:e=>({paddingLeft:`${e.gridUnit}px`,cursor:"pointer"})}))),hc=({dataMaskSelected:e,filter:t,icon:n,onFilterSelectionChange:r,directPathToChild:i,inView:o,showOverflow:s,parentRef:l})=>{var d,c,u;const{name:h="<undefined>"}=t,p=Gl(t,null==(d=t.dataMask)?void 0:d.filterState),f=!(null==(c=t.controlValues)||!c.enableEmptyFilter),m=(0,a.useMemo)((()=>(0,b.tZ)(ac,null,(0,b.tZ)(oc,null,h),f&&(0,b.tZ)(cc,null),t.description&&t.description.trim()&&(0,b.tZ)(uc,{description:t.description}),(0,b.tZ)(ic,null,n))),[h,f,t.description,n]);return(0,b.tZ)(sc,{layout:"vertical"},(0,b.tZ)(lc,{label:m,required:null==t||null==(u=t.controlValues)?void 0:u.enableEmptyFilter,validateStatus:p?"error":void 0},(0,b.tZ)(rc,{dataMaskSelected:e,filter:t,showOverflow:s,directPathToChild:i,onFilterSelectionChange:r,inView:o,parentRef:l})))},pc=a.memo(hc),fc=v.iK.div`
  display: flex;
  width: 100%;
  flex-direction: column;
  align-items: center;
  .ant-form-item {
    margin-bottom: ${({theme:e})=>4*e.gridUnit}px;
  }
`,mc=({dataMaskSelected:e,filter:t,directPathToChild:n,onFilterSelectionChange:r,parentRef:i})=>{var o;return(0,b.tZ)(a.Fragment,null,(0,b.tZ)(pc,{dataMaskSelected:e,filter:t,directPathToChild:n,parentRef:i,showOverflow:!0,onFilterSelectionChange:r}),(0,b.tZ)(fc,null,null==(o=t.cascadeChildren)?void 0:o.map((t=>(0,b.tZ)(mc,{key:t.id,dataMaskSelected:e,filter:t,directPathToChild:n,onFilterSelectionChange:r})))))},gc=mc,vc=v.iK.div`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  background-color: ${({theme:e})=>e.colors.grayscale.light4};
  margin: ${({theme:e})=>-1*e.gridUnit}px
    ${({theme:e})=>-4*e.gridUnit}px; // to override default antd padding
  padding: ${({theme:e})=>2*e.gridUnit}px
    ${({theme:e})=>4*e.gridUnit}px;

  & > *:last-child {
    cursor: pointer;
  }
`,bc=v.iK.h4`
  display: flex;
  align-items: center;
  color: ${({theme:e})=>e.colors.grayscale.dark1};
  margin: 0;
  padding: 0;
`,yc=e=>b.iv`
  margin-right: ${e.gridUnit}px;
  color: ${e.colors.grayscale.dark1};
  width: ${4*e.gridUnit}px;
`,Cc=(0,v.iK)(Da)`
  padding: ${({theme:e})=>e.gridUnit}px
    ${({theme:e})=>2*e.gridUnit}px;
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  background: ${({theme:e})=>e.colors.grayscale.light1};
`,Sc=v.iK.div`
  max-height: 700px;
  overflow: auto;
`,xc=({dataMaskSelected:e,filter:t,visible:n,onVisibleChange:r,onFilterSelectionChange:i,directPathToChild:o,inView:s})=>{var l;const[c,u]=(0,a.useState)(),h=e[t.id],p=(0,a.useRef)();(0,a.useEffect)((()=>{u(o);const e=setTimeout((()=>u(void 0)),500);return()=>clearTimeout(e)}),[o,u]);const f=(0,a.useCallback)((e=>{var t;const n=e.cascadeChildren||[],r=null==h||null==(t=h.filterState)?void 0:t.value,i=n.flatMap((e=>f(e)||[]));return i.length>0?i:null!=r?[e]:null}),[h]),m=e=>[e,...(e.cascadeChildren||[]).flatMap(m)],g=m(t),v=(0,a.useMemo)((()=>f(t)||[t]),[t,f]);if((0,a.useEffect)((()=>{const e=null==c?void 0:c[0];g.filter((e=>!v.includes(e))).some((t=>t.id===e))&&r(!0)}),[c]),null==(l=t.cascadeChildren)||!l.length)return(0,b.tZ)(pc,{dataMaskSelected:e,filter:t,directPathToChild:o,onFilterSelectionChange:i,inView:s});const y=(0,b.tZ)(vc,null,(0,b.tZ)(bc,null,(0,b.tZ)(rt.Z.Edit,{iconSize:"l",css:e=>yc(e)}),(0,d.t)("Select parent filters")," (",g.length,")"),(0,b.tZ)(rt.Z.Close,{iconSize:"l",css:e=>yc(e),onClick:()=>r(!1)})),C=(0,b.tZ)(Sc,null,(0,b.tZ)(gc,{dataMaskSelected:e,key:t.id,filter:t,directPathToChild:n?c:void 0,onFilterSelectionChange:i,parentRef:p}));return(0,b.tZ)(_a.Z,{content:C,title:y,trigger:"click",visible:n,onVisibleChange:r,placement:"rightTop",id:t.id,overlayStyle:{width:"400px",position:"relative",overflow:"auto"},ref:p},(0,b.tZ)("div",null,v.map((n=>(0,b.tZ)(pc,{dataMaskSelected:e,key:n.id,filter:n,onFilterSelectionChange:i,directPathToChild:c,inView:s,icon:(0,b.tZ)(a.Fragment,null,0!==t.cascadeChildren.length&&(0,b.tZ)(Cc,{onClick:()=>r(!0)},(0,b.tZ)(rt.Z.Filter,{iconSize:"m"})," ",g.length))})))))},kc=a.memo(xc),wc=v.iK.div`
  padding: ${({theme:e})=>4*e.gridUnit}px;
  &:hover {
    cursor: pointer;
  }
`,Rc=({directPathToChild:e,dataMaskSelected:t,onFilterSelectionChange:n})=>{const[r,i]=(0,a.useState)(null),s=rd(),l=(0,a.useMemo)((()=>Object.values(s)),[s]),c=(0,a.useMemo)((()=>{const e=new Array(l.length);for(let t=0;t<l.length;t+=1)e[t]=Qd();return e}),[l.length]),u=(0,a.useMemo)((()=>{const e=l.map((e=>({...e,dataMask:t[e.id]})));return function(e){const t=function(e){const t={};return e.forEach((e=>{const[n]="cascadeParentIds"in e&&e.cascadeParentIds||[];n&&(t[n]||(t[n]=[]),t[n].push(e))})),t}(e),n=e=>{const r=t[e.id]||[];return{...e,cascadeChildren:r.map(n)}};return e.filter((e=>{var t;return e.type===mi.B.DIVIDER||!(null!=(t=e.cascadeParentIds)&&t.length)})).map(n)}(e)}),[l,t]),h=new Set(u.map((e=>e.id))),[f,m]=function(e){const t=yi(),n=function(){const e=(0,o.v9)((e=>{var t;return null==(t=e.dashboardState)?void 0:t.activeTabs})),t=function(){const e=bi();return t=>{const n=Object.values(e).find((e=>{var n;return(null==(n=e.meta)?void 0:n.chartId)===t}));return null==n?void 0:n.parents.filter((t=>e[t].type===p.gn))}}();return n=>{var r;return n.type===mi.B.DIVIDER||"chartsInScope"in n&&(null==(r=n.chartsInScope)?void 0:r.some((n=>{const r=t(n);return 0===(null==r?void 0:r.length)||(null==r?void 0:r.every((t=>e.includes(t))))})))}}();return(0,a.useMemo)((()=>{let r=[];const i=[];return t?e.forEach((e=>{n(e)?r.push(e):i.push(e)})):r=e,[r,i]}),[e,t,n])}(u),g=yi()&&u.length>0,v=(0,a.useCallback)((o=>{const a=u[o];return a.type===mi.B.DIVIDER?(0,b.tZ)("div",null,(0,b.tZ)("h3",null,a.title),(0,b.tZ)("p",null,a.description)):(0,b.tZ)(kc,{key:a.id,dataMaskSelected:t,visible:r===a.id,onVisibleChange:e=>i(e?a.id:null),filter:a,onFilterSelectionChange:n,directPathToChild:e,inView:!1})}),[u,JSON.stringify(t),e,n,r]);return(0,b.tZ)(wc,null,c.filter(((e,t)=>h.has(l[t].id))).map(((e,t)=>(0,b.tZ)(Hd,{node:e},v(t)))),f.map((e=>{const t=l.findIndex((t=>t.id===e.id));return(0,b.tZ)(Gd,{node:c[t],inView:!0})})),g&&(0,b.tZ)(Re.UO,{ghost:!0,bordered:!0,expandIconPosition:"right",collapsible:0===m.length?"disabled":void 0,css:e=>(0,b.iv)("&.ant-collapse{margin-top:",f.length>0?6*e.gridUnit:0,"px;&>.ant-collapse-item{&>.ant-collapse-header{padding-left:0;padding-bottom:",2*e.gridUnit,"px;&>.ant-collapse-arrow{right:",e.gridUnit,"px;}}& .ant-collapse-content-box{padding:",4*e.gridUnit,"px 0 0;}}}","")},(0,b.tZ)(Re.UO.Panel,{header:(0,d.t)("Filters out of scope (%d)",m.length),key:"1"},m.map((e=>{const t=u.findIndex((t=>t.id===e.id));return(0,b.tZ)(Gd,{node:c[t],inView:!0})})))))},Zc=a.memo(Rc),Fc=(0,fi.Q)("filter-bar"),Tc=v.iK.div`
  width: ${({theme:e})=>8*e.gridUnit}px;

  & .ant-tabs-top > .ant-tabs-nav {
    margin: 0;
  }
  &.open {
    width: ${({width:e})=>e}px; // arbitrary...
  }
`,_c=v.iK.div`
  & .ant-typography-edit-content {
    left: 0;
    margin-top: 0;
    width: 100%;
  }
  position: absolute;
  top: 0;
  left: 0;
  flex-direction: column;
  flex-grow: 1;
  width: ${({width:e})=>e}px;
  background: ${({theme:e})=>e.colors.grayscale.light5};
  border-right: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  border-bottom: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  min-height: 100%;
  display: none;
  &.open {
    display: flex;
  }
`,Dc=v.iK.div`
  position: absolute;
  top: ${({offset:e})=>e}px;
  left: 0;
  height: 100%;
  width: ${({theme:e})=>8*e.gridUnit}px;
  padding-top: ${({theme:e})=>2*e.gridUnit}px;
  display: none;
  text-align: center;
  &.open {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: ${({theme:e})=>2*e.gridUnit}px;
  }
  svg {
    cursor: pointer;
  }
`,Mc=(0,v.iK)(rt.Z.Collapse)`
  color: ${({theme:e})=>e.colors.primary.base};
  margin-bottom: ${({theme:e})=>3*e.gridUnit}px;
`,Ec=(0,v.iK)(rt.Z.Filter)`
  color: ${({theme:e})=>e.colors.grayscale.base};
`,Ic=(0,v.iK)(Re.mQ)`
  & .ant-tabs-nav-list {
    width: 100%;
  }
  & .ant-tabs-tab {
    display: flex;
    justify-content: center;
    margin: 0;
    flex: 1;
  }
`,Oc=({filtersOpen:e,toggleFiltersBar:t,directPathToChild:n,width:r,height:i,offset:s})=>{const l=(0,Kl.k6)(),u=id(),[p,f]=(0,a.useState)(null),[m,v]=(0,Bl.x)(u),y=(0,o.I0)(),C=nd(),S=Object.values(C),[x,k]=(0,a.useState)(Vl.AllFilters),w=rd(),R=(0,ro.D)(w),Z=Object.values(w),F=(0,a.useCallback)(((e,t)=>{v((n=>{var r,i,o;void 0!==(null==(r=t.filterState)?void 0:r.value)&&void 0===(null==(i=m[e.id])||null==(o=i.filterState)?void 0:o.value)&&e.requiredFirst&&y((0,He.eG)(e.id,t)),n[e.id]={...(0,Wl.H)(e.id),...t}}))}),[m,y,v,x]),T=(0,a.useCallback)((e=>{const{location:t}=l,{search:n}=t,r=new(_n())(n),i=new(_n());r.forEach(((e,t)=>{t!==dt.KD.nativeFilters.name&&i.append(t,e)})),i.set(dt.KD.nativeFilters.name,Mn().encode(Pn(e))),l.replace({search:i.toString()})}),[l]);(0,a.useEffect)((()=>{if(R){const e={};Object.values(w).forEach((t=>{const n=t.filterType,r=t.targets,i=t.defaultDataMask,o=null==R?void 0:R[t.id],a=null==o?void 0:o.filterType,s=null==o?void 0:o.targets,l=null==o?void 0:o.defaultDataMask,d=n!==a,c=!Ir()(r,s),u=!Ir()(i,l);(d||c||u)&&(e[t.id]=(0,Wl.H)(t.id))})),qt()(e)||(v((t=>({...t,...e}))),Object.keys(e).forEach((e=>y((0,He.ze)(e)))))}}),[JSON.stringify(w),JSON.stringify(R)]),(0,a.useEffect)((()=>{v((()=>u))}),[JSON.stringify(u),v]);const _=JSON.stringify(u);(0,a.useEffect)((()=>{T(u)}),[_,T]);const D=(0,a.useCallback)((()=>{Object.keys(m).forEach((e=>{m[e]&&y((0,He.eG)(e,m[e]))}))}),[m,y]),M=(0,a.useCallback)((()=>{Object.keys(m).forEach((e=>{m[e]&&y((0,He.ze)(e))}))}),[m,y]),E=(0,a.useCallback)((()=>t(!0)),[t]);((e,t)=>{const n=rd(),r=id();(0,a.useEffect)((()=>{Object.keys(e).forEach((e=>{n[e]||t((t=>{delete t[e]}))}))}),[r,e,n,t])})(m,v);const I=((e,t,n)=>{const r=Object.values(e),i=Object.values(t);return(0,wr.JB)(Hl(e),Hl(t),{ignoreUndefined:!0})||r.length!==i.length||n.some((t=>{var n;return Gl(t,null==e||null==(n=e[null==t?void 0:t.id])?void 0:n.filterState)}))})(m,u,Z),O=(()=>{const[e,t]=(0,a.useState)(!1),n=rd(),r=(0,a.useContext)(td.MigrationContext);let i=(0,o.v9)((e=>e.charts)),s=0;if(!e)if(r===Fe.Qi.REVIEWING){i=Yl()(ed()(i,(e=>{var t;return"filter_box"!==(null==(t=e.formData)?void 0:t.viz_type)})),"id");const e=document.querySelectorAll('[data-test-viz-type="filter_box"]').length;s=document.querySelectorAll('[data-ui-anchor="chart"]').length-e}else s=document.querySelectorAll('[data-ui-anchor="chart"]').length;return(0,a.useEffect)((()=>{if(e)return;if(Object.values(n).find((({requiredFirst:e})=>e)))return void t(!0);let r;0===s&&(r=setTimeout((()=>{t(!0)}),1e3)),s>0&&void 0!==r&&clearTimeout(r);const o=Object.values(i).filter((({chartStatus:e})=>"loading"!==e)).length;s>0&&o>=s&&t(!0)}),[i,e,s]),e})(),P=(0,a.useMemo)((()=>({overflow:"auto",height:i})),[i]),N=Z.filter((e=>e.type===mi.B.NATIVE_FILTER)).length;return(0,b.tZ)(Tc,ut()({},Fc(),{className:g()({open:e}),width:r}),(0,b.tZ)(Dc,ut()({},Fc("collapsable"),{className:g()({open:!e}),onClick:E,offset:s}),(0,b.tZ)(Mc,ut()({},Fc("expand-button"),{iconSize:"l"})),(0,b.tZ)(Ec,ut()({},Fc("filter-icon"),{iconSize:"l"}))),(0,b.tZ)(_c,{className:g()({open:e}),width:r},(0,b.tZ)($d,{toggleFiltersBar:t,onApply:D,onClearAll:M,isApplyDisabled:I,dataMaskSelected:m,dataMaskApplied:u}),O?(0,nt.cr)(c.T.DASHBOARD_NATIVE_FILTERS_SET)?(0,b.tZ)(Ic,{centered:!0,onChange:k,defaultActiveKey:Vl.AllFilters,activeKey:p?Vl.AllFilters:void 0},(0,b.tZ)(Re.mQ.TabPane,{tab:(0,d.t)("All filters (%(filterCount)d)",{filterCount:N}),key:Vl.AllFilters,css:P},p&&(0,b.tZ)(Od,{dataMaskSelected:m,disabled:!I,onCancel:()=>f(null),filterSetId:p}),(0,b.tZ)(Zc,{dataMaskSelected:m,directPathToChild:n,onFilterSelectionChange:F})),(0,b.tZ)(Re.mQ.TabPane,{disabled:!!p,tab:(0,d.t)("Filter sets (%(filterSetCount)d)",{filterSetCount:S.length}),key:Vl.FilterSets,css:P},(0,b.tZ)(Zd,{onEditFilterSet:f,disabled:!I,dataMaskSelected:m,tab:x,onFilterSelectionChange:F}))):(0,b.tZ)("div",{css:P},(0,b.tZ)(Zc,{dataMaskSelected:m,directPathToChild:n,onFilterSelectionChange:F})):(0,b.tZ)("div",{css:(0,b.iv)({height:i},"","")},(0,b.tZ)(h.Z,null))))},Pc=a.memo(Oc),Nc=e=>{const t=e[D._4].children[0];return t===D.PV?e[D._4]:e[t]},jc=(e,t)=>"ant-tabs-nav-wrap"===e.target.className||t.contains(e.target),qc={depth:l().number.isRequired,editMode:l().bool.isRequired,gridComponent:E.cP.isRequired,handleComponentDrop:l().func.isRequired,isComponentVisible:l().bool.isRequired,resizeComponent:l().func.isRequired,setDirectPathToChild:l().func.isRequired,width:l().number.isRequired},zc=e=>e.dropIndicatorProps&&(0,b.tZ)("div",{className:"drop-indicator drop-indicator--bottom"}),Ac=e=>e.dropIndicatorProps&&(0,b.tZ)("div",{className:"drop-indicator drop-indicator--top"});class $c extends a.PureComponent{constructor(e){super(e),this.state={isResizing:!1,rowGuideTop:null},this.handleResizeStart=this.handleResizeStart.bind(this),this.handleResize=this.handleResize.bind(this),this.handleResizeStop=this.handleResizeStop.bind(this),this.handleTopDropTargetDrop=this.handleTopDropTargetDrop.bind(this),this.getRowGuidePosition=this.getRowGuidePosition.bind(this),this.setGridRef=this.setGridRef.bind(this),this.handleChangeTab=this.handleChangeTab.bind(this)}getRowGuidePosition(e){return e&&this.grid?e.getBoundingClientRect().bottom-this.grid.getBoundingClientRect().top-2:null}setGridRef(e){this.grid=e}handleResizeStart({ref:e,direction:t}){let n=null;"bottom"!==t&&"bottomRight"!==t||(n=this.getRowGuidePosition(e)),this.setState((()=>({isResizing:!0,rowGuideTop:n})))}handleResize({ref:e,direction:t}){"bottom"!==t&&"bottomRight"!==t||this.setState((()=>({rowGuideTop:this.getRowGuidePosition(e)})))}handleResizeStop({id:e,widthMultiple:t,heightMultiple:n}){this.props.resizeComponent({id:e,width:t,height:n}),this.setState((()=>({isResizing:!1,rowGuideTop:null})))}handleTopDropTargetDrop(e){e&&this.props.handleComponentDrop({...e,destination:{...e.destination,index:0}})}handleChangeTab({pathToTabIndex:e}){this.props.setDirectPathToChild(e)}render(){const{gridComponent:e,handleComponentDrop:t,depth:n,editMode:r,width:i,isComponentVisible:o}=this.props,a=(i+D.es)/D.cz-D.es,{isResizing:s,rowGuideTop:l}=this.state;return i<100?null:(0,b.tZ)("div",{className:"dashboard-grid",ref:this.setGridRef},(0,b.tZ)("div",{className:"grid-content"},r&&(0,b.tZ)(te,{component:e,depth:n,parentComponent:null,index:0,orientation:"column",onDrop:this.handleTopDropTargetDrop,className:"empty-droptarget",editMode:!0},zc),e.children.map(((t,r)=>(0,b.tZ)(Ll,{key:t,id:t,parentId:e.id,depth:n+1,index:r,availableColumnCount:D.cz,columnWidth:a,isComponentVisible:o,onResizeStart:this.handleResizeStart,onResize:this.handleResize,onResizeStop:this.handleResizeStop,onChangeTab:this.handleChangeTab}))),r&&e.children.length>0&&(0,b.tZ)(te,{component:e,depth:n,parentComponent:null,index:e.children.length,orientation:"column",onDrop:t,className:"empty-droptarget",editMode:!0},Ac),s&&Array(D.cz).fill(null).map(((e,t)=>(0,b.tZ)("div",{key:`grid-column-${t}`,className:"grid-column-guide",style:{left:t*D.es+t*a,width:a}}))),s&&l&&(0,b.tZ)("div",{className:"grid-row-guide",style:{top:l,width:i}})))}}$c.propTypes=qc,$c.defaultProps={};const Uc=$c,Lc=(0,o.$j)((function({dashboardState:e}){return{editMode:e.editMode}}),(function(e){return(0,i.DE)({handleComponentDrop:fr._p,resizeComponent:fr.iO,setDirectPathToChild:Nt.E2},e)}))(Uc),Vc=({topLevelTabs:e})=>{const t=(0,o.v9)((e=>e.dashboardLayout.present)),n=(0,o.v9)((e=>{var t;return null==(t=e.nativeFilters)?void 0:t.filters})),r=(0,o.v9)((e=>e.dashboardState.directPathToChild)),[i,s]=(0,a.useState)(((e,t)=>Math.max(0,Ml({currentComponent:Nc(e),directPathToChild:t})))(t,r)),l=(0,o.I0)();(0,a.useEffect)((()=>{const e=Ml({currentComponent:Nc(t),directPathToChild:r});e>-1&&s(e)}),[Il(r)]);const d=Object.values(null!=n?n:{}).map((e=>({id:e.id,scope:e.scope,type:e.type})));(0,a.useEffect)((()=>{if(!(0,c.c)(c.T.DASHBOARD_NATIVE_FILTERS)||0===d.length)return;const e=d.map((e=>{if(e.id.startsWith(Bo.Ky))return{filterId:e.id,tabsInScope:[],chartsInScope:[]};const{scope:n}=e,r=(0,on.Q1)({filterScope:{scope:n.rootPath,immune:n.excluded}}),i=(0,kr.Rz)(t,r);return{filterId:e.id,tabsInScope:Array.from(i),chartsInScope:r}}));l((0,Ql.xk)(e))}),[JSON.stringify(d),t,l]);const u=e?e.children:[D.PV],h=Math.min(i,u.length-1),p=0===h?D.PV:h.toString();return(0,b.tZ)("div",{className:"grid-container"},(0,b.tZ)(T,null,(({width:e})=>(0,b.tZ)(C.ZP,{id:D.PV,activeKey:p,renderTabBar:()=>(0,b.tZ)(a.Fragment,null),fullWidth:!1,animated:!1,allowOverflow:!0},u.map(((n,r)=>(0,b.tZ)(C.ZP.TabPane,{key:0===r?D.PV:r.toString()},(0,b.tZ)(Lc,{gridComponent:t[n],depth:D.Mu+1,width:e,isComponentVisible:r===i}))))))))},Kc=v.iK.div`
  display: grid;
  grid-template-columns: auto 1fr;
  grid-template-rows: auto 1fr;
  flex: 1;
  /* Special cases */

  /* A row within a column has inset hover menu */
  .dragdroppable-column .dragdroppable-row .hover-menu--left {
    left: -12px;
    background: ${({theme:e})=>e.colors.grayscale.light5};
    border: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  }

  .dashboard-component-tabs {
    position: relative;
  }

  /* A column within a column or tabs has inset hover menu */
  .dragdroppable-column .dragdroppable-column .hover-menu--top,
  .dashboard-component-tabs .dragdroppable-column .hover-menu--top {
    top: -12px;
    background: ${({theme:e})=>e.colors.grayscale.light5};
    border: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  }

  /* move Tabs hover menu to top near actual Tabs */
  .dashboard-component-tabs > .hover-menu-container > .hover-menu--left {
    top: 0;
    transform: unset;
    background: transparent;
  }

  /* push Chart actions to upper right */
  .dragdroppable-column .dashboard-component-chart-holder .hover-menu--top,
  .dragdroppable .dashboard-component-header .hover-menu--top {
    right: 8px;
    top: 8px;
    background: transparent;
    border: none;
    transform: unset;
    left: unset;
  }
  div:hover > .hover-menu-container .hover-menu,
  .hover-menu-container .hover-menu:hover {
    opacity: 1;
  }
`,Bc=v.iK.div`
  grid-column: 1;
  grid-row: 1 / span 2;
  z-index: 11;
`,Wc=v.iK.div`
  position: sticky;
  top: -1px;
  width: ${({width:e})=>e}px;
  flex: 0 0 ${({width:e})=>e}px;
`,Hc=v.iK.div`
  grid-column: 2;
  grid-row: 1;
  position: sticky;
  top: 0px;
  z-index: 100;
`,Gc=v.iK.div`
  grid-column: 2;
  grid-row: 2;
  // @z-index-above-dashboard-header (100) + 1 = 101
  ${({fullSizeChartId:e})=>e&&"z-index: 101;"}
`,Qc=v.iK.div`
  display: flex;
  flex-direction: row;
  flex-wrap: nowrap;
  height: auto;
  flex: 1;

  .grid-container .dashboard-component-tabs {
    box-shadow: none;
    padding-left: 0;
  }

  .grid-container {
    /* without this, the grid will not get smaller upon toggling the builder panel on */
    width: 0px;
    flex: 1;
    position: relative;
    margin-top: ${({theme:e})=>6*e.gridUnit}px;
    margin-right: ${({theme:e})=>8*e.gridUnit}px;
    margin-bottom: ${({theme:e})=>6*e.gridUnit}px;
    margin-left: ${({theme:e,dashboardFiltersOpen:t,editMode:n})=>t||n?8*e.gridUnit:0}px;

    ${({editMode:e,theme:t})=>e&&`\n      max-width: calc(100% - ${374+16*t.gridUnit}px);\n    `}
  }

  .dashboard-builder-sidepane {
    width: ${374}px;
  }

  .dashboard-component-chart-holder {
    // transitionable traits to show filter relevance
    transition: opacity ${({theme:e})=>e.transitionTiming}s,
      border-color ${({theme:e})=>e.transitionTiming}s,
      box-shadow ${({theme:e})=>e.transitionTiming}s;
    border: 0 solid transparent;
  }
`,Jc=()=>{const e=(0,o.I0)(),t=(0,o.v9)((e=>e.dashboardLayout.present)),n=(0,o.v9)((e=>e.dashboardState.editMode)),r=(0,o.v9)((e=>e.dashboardState.directPathToChild)),i=(0,o.v9)((e=>e.dashboardState.fullSizeChartId)),s=(0,a.useCallback)((({pathToTabIndex:t})=>{e((0,Nt.E2)(t))}),[e]),l=(0,a.useCallback)((()=>{e((0,fr.g3)());const n=El(Nc(t),0);e((0,Nt.E2)(n))}),[t,e]),d=(0,a.useCallback)((t=>e((0,fr._p)(t))),[e]),u=t[D._4],p=u.children[0],f=p!==D.PV?t[p]:void 0,m=(0,qn.e)(dt.KD.standalone),v=m===D._B.REPORT,C=m===D._B.HIDE_NAV_AND_TITLE||v,S=(C?0:72)+(f?50:0),{showDashboard:x,dashboardFiltersOpen:k,toggleDashboardFiltersOpen:w,nativeFiltersEnabled:R}=(()=>{var e;const t=(0,a.useContext)(td.MigrationContext),[n,r]=(0,a.useState)(!1),[i,s]=(0,a.useState)(null==(e=(0,qn.e)(dt.KD.showFilters))||e),l=(0,o.v9)((e=>{var t;return null==(t=e.dashboardInfo.metadata)?void 0:t.show_native_filters})),d=(0,o.v9)((({dashboardInfo:e})=>e.dash_edit_perm)),u=rd(),h=Object.values(u),p=l&&(0,nt.cr)(c.T.DASHBOARD_NATIVE_FILTERS)&&(d||!d&&0!==h.length),f=h.filter((e=>e.requiredFirst)),m=id(),g=n||!p||!(p&&f.length&&f.find((({id:e})=>{var t,n;return void 0===(null==(t=m[e])||null==(n=t.filterState)?void 0:n.value)}))),v=(0,a.useCallback)((e=>{s(null!=e?e:!i)}),[i]);return(0,a.useEffect)((()=>{0===h.length&&p&&["CONVERTED","REVIEWING","NOOP"].includes(t)?v(!1):v(!0)}),[h.length,t]),(0,a.useEffect)((()=>{g&&r(!0)}),[g]),{showDashboard:g,dashboardFiltersOpen:i,toggleDashboardFiltersOpen:v,nativeFiltersEnabled:p}})(),Z=k?260:32,[F,T]=function(e){const t=(0,a.useRef)(null),[n,r]=(0,a.useState)(!1),i=e=>{const[t]=e;r(t.intersectionRatio<1)};return(0,a.useEffect)((()=>{const n=new IntersectionObserver(i,e),r=t.current;return r&&n.observe(r),()=>{r&&n.unobserve(r)}}),[t,e]),[t,n]}({threshold:[1]}),_=`calc(100vh - ${80+(T||m?0:53)+((0,nt.cr)(c.T.DASHBOARD_NATIVE_FILTERS_SET)?46:0)}px)`,M=k?0:S+20,E=(0,a.useMemo)((()=>({marginLeft:k||n?0:-32})),[k,n]),I=(0,a.useCallback)((({dropIndicatorProps:e})=>(0,b.tZ)("div",null,!C&&(0,b.tZ)(br,null),e&&(0,b.tZ)("div",e),!v&&f&&(0,b.tZ)(Xs,{shouldFocus:jc,menuItems:[(0,b.tZ)(Sr,{icon:(0,b.tZ)(rt.Z.FallOutlined,{iconSize:"xl"}),label:"Collapse tab content",onClick:l})],editMode:n},(0,b.tZ)(Ll,{id:null==f?void 0:f.id,parentId:D._4,depth:D.Mu+1,index:0,renderTabContent:!1,renderHoverMenu:!1,onChangeTab:s})))),[n,s,l,C,v,f]);return(0,b.tZ)(Kc,null,R&&!n&&(0,b.tZ)(Bc,null,(0,b.tZ)(Wc,{ref:F,width:Z},(0,b.tZ)(y.Z,null,(0,b.tZ)(Pc,{filtersOpen:k,toggleFiltersBar:w,directPathToChild:r,width:Z,height:_,offset:M})))),(0,b.tZ)(Hc,null,(0,b.tZ)(te,{component:u,parentComponent:null,depth:D.Mu,index:0,orientation:"column",onDrop:d,editMode:n,disableDragDrop:!!f,style:E},I)),(0,b.tZ)(Gc,{fullSizeChartId:i},(0,b.tZ)(b.xB,{styles:b.iv`
            // @z-index-above-dashboard-header (100) + 1 = 101
            ${i&&"div > .filterStatusPopover.ant-popover{z-index: 101}"}
          `}),(0,b.tZ)("div",{className:g()("dashboard",n&&"dashboard--editing")},(0,b.tZ)(Qc,{className:"dashboard-content",dashboardFiltersOpen:k,editMode:n},x?(0,b.tZ)(Vc,{topLevelTabs:f}):(0,b.tZ)(h.Z,null),n&&(0,b.tZ)(We,{isStandalone:!!m,topOffset:S})))))};var Yc=n(49997);const Xc=[p.dW,p.xh];function eu(e){return!Object.values(e).some((({type:e})=>e&&Xc.includes(e)))}const tu={actions:l().shape({addSliceToDashboard:l().func.isRequired,removeSliceFromDashboard:l().func.isRequired,triggerQuery:l().func.isRequired,logEvent:l().func.isRequired,clearDataMaskState:l().func.isRequired}).isRequired,dashboardInfo:E.$X.isRequired,dashboardState:E.DZ.isRequired,charts:l().objectOf(E.$6).isRequired,slices:l().objectOf(E.Rw).isRequired,activeFilters:l().object.isRequired,chartConfiguration:l().object.isRequired,datasources:l().object.isRequired,ownDataCharts:l().object.isRequired,layout:l().object.isRequired,impressionId:l().string.isRequired,initMessages:l().array,timeout:l().number,userId:l().string};class nu extends a.PureComponent{static onBeforeUnload(e){e?window.addEventListener("beforeunload",nu.unload):window.removeEventListener("beforeunload",nu.unload)}static unload(){const e=(0,d.t)("You have unsaved changes.");return window.event.returnValue=e,e}constructor(e){var t,n;super(e),this.appliedFilters=null!=(t=e.activeFilters)?t:{},this.appliedOwnDataCharts=null!=(n=e.ownDataCharts)?n:{},this.onVisibilityChange=this.onVisibilityChange.bind(this)}componentDidMount(){const e=document.getElementById("app"),t=(null==e?void 0:e.getAttribute("data-bootstrap"))||"{}",{dashboardState:n,layout:r}=this.props,i={is_soft_navigation:tt.Yd.timeOriginOffset>0,is_edit_mode:n.editMode,mount_duration:tt.Yd.getTimestamp(),is_empty:eu(r),is_published:n.isPublished,bootstrap_data_length:t.length},o=(0,ws.Z)();o&&(i.target_id=o),this.props.actions.logEvent(tt.Wl,i),"hidden"===document.visibilityState&&(this.visibilityEventData={start_offset:tt.Yd.getTimestamp(),ts:(new Date).getTime()}),window.addEventListener("visibilitychange",this.onVisibilityChange),this.applyCharts()}componentDidUpdate(){this.applyCharts()}UNSAFE_componentWillReceiveProps(e){const t=f(this.props.layout),n=f(e.layout);this.props.dashboardInfo.id===e.dashboardInfo.id&&(t.length<n.length?n.filter((e=>-1===t.indexOf(e))).forEach((t=>{return this.props.actions.addSliceToDashboard(t,(n=e.layout,r=t,Object.values(n).find((e=>e&&e.type===p.dW&&e.meta&&e.meta.chartId===r))));var n,r})):t.length>n.length&&t.filter((e=>-1===n.indexOf(e))).forEach((e=>this.props.actions.removeSliceFromDashboard(e))))}applyCharts(){const{hasUnsavedChanges:e,editMode:t}=this.props.dashboardState,{appliedFilters:n,appliedOwnDataCharts:r}=this,{activeFilters:i,ownDataCharts:o,chartConfiguration:a}=this.props;(0,c.c)(c.T.DASHBOARD_CROSS_FILTERS)&&!a||(t||(0,wr.JB)(r,o,{ignoreUndefined:!0})&&(0,wr.JB)(n,i,{ignoreUndefined:!0})||this.applyFilters(),e?nu.onBeforeUnload(!0):nu.onBeforeUnload(!1))}componentWillUnmount(){window.removeEventListener("visibilitychange",this.onVisibilityChange),this.props.actions.clearDataMaskState()}onVisibilityChange(){if("hidden"===document.visibilityState)this.visibilityEventData={start_offset:tt.Yd.getTimestamp(),ts:(new Date).getTime()};else if("visible"===document.visibilityState){const e=this.visibilityEventData.start_offset;this.props.actions.logEvent(tt.Ev,{...this.visibilityEventData,duration:tt.Yd.getTimestamp()-e})}}getAllCharts(){return Object.values(this.props.charts)}applyFilters(){const{appliedFilters:e}=this,{activeFilters:t,ownDataCharts:n}=this.props,r=Object.keys(t),i=Object.keys(e),o=new Set(r.concat(i)),a=((e,t)=>{const n=Object.keys(e),r=Object.keys(t),i=(o=n,a=r,[...o.filter((e=>!a.includes(e))),...a.filter((e=>!o.includes(e)))]).filter((n=>e[n]||t[n]));var o,a;return new Set([...n,...r]).forEach((n=>{(0,wr.JB)(e[n],t[n])||i.push(n)})),[...new Set(i)]})(n,this.appliedOwnDataCharts);[...o].forEach((n=>{if(!r.includes(n)&&i.includes(n))a.push(...e[n].scope);else if(i.includes(n)){if((0,wr.JB)(e[n].values,t[n].values,{ignoreUndefined:!0})||a.push(...t[n].scope),!(0,wr.JB)(e[n].scope,t[n].scope)){const r=(t[n].scope||[]).concat(e[n].scope||[]);a.push(...r)}}else a.push(...t[n].scope)})),this.refreshCharts([...new Set(a)]),this.appliedFilters=t,this.appliedOwnDataCharts=n}refreshCharts(e){e.forEach((e=>{this.props.actions.triggerQuery(!0,e)}))}render(){return this.context.loading?(0,b.tZ)(h.Z,null):(0,b.tZ)(a.Fragment,null,(0,b.tZ)(Yc.Z,null),(0,b.tZ)(Jc,null))}}nu.contextType=u.Zn,nu.propTypes=tu,nu.defaultProps={initMessages:[],timeout:60,userId:""};const ru=nu;var iu=n(50810);const ou=(0,o.$j)((function(e){var t,n;const{datasources:r,sliceEntities:i,charts:o,dataMask:a,dashboardInfo:s,dashboardState:l,dashboardLayout:d,impressionId:c,nativeFilters:u}=e;return{initMessages:s.common.flash_messages,timeout:s.common.conf.SUPERSET_WEBSERVER_TIMEOUT,userId:s.userId,dashboardInfo:s,dashboardState:l,charts:o,datasources:r,activeFilters:{...(0,on.De)(),...Tr({chartConfiguration:null==(t=s.metadata)?void 0:t.chart_configuration,nativeFilters:u.filters,dataMask:a,layout:d.present})},chartConfiguration:null==(n=s.metadata)?void 0:n.chart_configuration,ownDataCharts:Fr(a,"ownState"),slices:i.slices,layout:d.present,impressionId:c}}),(function(e){return{actions:(0,i.DE)({setDatasources:iu.Fy,clearDataMaskState:He.sh,addSliceToDashboard:Nt.Pi,removeSliceFromDashboard:Nt.rL,triggerQuery:xr.triggerQuery,logEvent:gr.logEvent},e)}}))(ru)},90057:(e,t,n)=>{"use strict";n.d(t,{x:()=>o,C:()=>a});var r=n(18172),i=n(67294);function o(e){var t=(0,i.useState)((function(){return(0,r.vV)("function"==typeof e?e():e,!0)})),n=t[1];return[t[0],(0,i.useCallback)((function(e){n("function"==typeof e?(0,r.ZP)(e):(0,r.vV)(e))}),[])]}function a(e,t,n){var o=(0,i.useMemo)((function(){return(0,r.ZP)(e)}),[e]);return(0,i.useReducer)(o,t,n)}}}]);