"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[666],{73728:(e,t,i)=>{i.d(t,{Z:()=>g});var o=i(98014),s=i(25660),a=i(15614);function r(){}const n=["getBins","getDomain","getScaleFunc"],l=[{key:"fillColor",accessor:"getFillColor",pickingInfo:"colorValue",getBins:{triggers:{value:{prop:"getColorValue",updateTrigger:"getColorValue"},weight:{prop:"getColorWeight",updateTrigger:"getColorWeight"},aggregation:{prop:"colorAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"lowerPercentile"},upperPercentile:{prop:"upperPercentile"},scaleType:{prop:"colorScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"colorDomain"},range:{prop:"colorRange"}},onSet:{props:"onSetColorDomain"}},nullValue:[0,0,0,0]},{key:"elevation",accessor:"getElevation",pickingInfo:"elevationValue",getBins:{triggers:{value:{prop:"getElevationValue",updateTrigger:"getElevationValue"},weight:{prop:"getElevationWeight",updateTrigger:"getElevationWeight"},aggregation:{prop:"elevationAggregation"},filterData:{prop:"_filterData",updateTrigger:"_filterData"}}},getDomain:{triggers:{lowerPercentile:{prop:"elevationLowerPercentile"},upperPercentile:{prop:"elevationUpperPercentile"},scaleType:{prop:"elevationScaleType"}}},getScaleFunc:{triggers:{domain:{prop:"elevationDomain"},range:{prop:"elevationRange"}},onSet:{props:"onSetElevationDomain"}},nullValue:-1}],c=e=>e.cellSize;class g{constructor(e){this.state={layerData:{},dimensions:{}},this.changeFlags={},this.dimensionUpdaters={},this._getCellSize=e.getCellSize||c,this._getAggregator=e.getAggregator,this._addDimension(e.dimensions||l)}static defaultDimensions(){return l}updateState(e,t){const{oldProps:i,props:o,changeFlags:s}=e;this.updateGetValueFuncs(i,o,s);const a=this.needsReProjectPoints(i,o,s);let r=!1;return s.dataChanged||a?(this.getAggregatedData(o,t),r=!0):((this.getDimensionChanges(i,o,s)||[]).forEach((e=>"function"==typeof e&&e())),r=!0),this.setState({aggregationDirty:r}),this.state}setState(e){this.state={...this.state,...e}}setDimensionState(e,t){this.setState({dimensions:{...this.state.dimensions,[e]:{...this.state.dimensions[e],...t}}})}normalizeResult(e={}){return e.hexagons?{data:e.hexagons,...e}:e.layerData?{data:e.layerData,...e}:e}getAggregatedData(e,t){const i=this._getAggregator(e)(e,t);this.setState({layerData:this.normalizeResult(i)}),this.changeFlags={layerData:!0},this.getSortedBins(e)}updateGetValueFuncs(e,t,i){for(const o in this.dimensionUpdaters){const{value:s,weight:r,aggregation:n}=this.dimensionUpdaters[o].getBins.triggers;let l=t[s.prop];this.needUpdateDimensionStep(this.dimensionUpdaters[o].getBins,e,t,i)&&(l=l?(0,a.q5)(l,{data:t.data}):(0,a._D)(t[n.prop],t[r.prop],{data:t.data})),l&&this.setDimensionState(o,{getValue:l})}}needsReProjectPoints(e,t,i){return this._getCellSize(e)!==this._getCellSize(t)||this._getAggregator(e)!==this._getAggregator(t)||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPosition)}addDimension(e){this._addDimension(e)}_addDimension(e=[]){e.forEach((e=>{const{key:t}=e;this.dimensionUpdaters[t]=this.getDimensionUpdaters(e),this.state.dimensions[t]={getValue:null,domain:null,sortedBins:null,scaleFunc:r}}))}getDimensionUpdaters({key:e,accessor:t,pickingInfo:i,getBins:o,getDomain:s,getScaleFunc:a,nullValue:r}){return{key:e,accessor:t,pickingInfo:i,getBins:{updater:this.getDimensionSortedBins,...o},getDomain:{updater:this.getDimensionValueDomain,...s},getScaleFunc:{updater:this.getDimensionScale,...a},attributeAccessor:this.getSubLayerDimensionAttribute(e,r)}}needUpdateDimensionStep(e,t,i,o){return Object.values(e.triggers).some((e=>e.updateTrigger?o.dataChanged||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged[e.updateTrigger]):t[e.prop]!==i[e.prop]))}getDimensionChanges(e,t,i){const o=[];for(const s in this.dimensionUpdaters){const a=n.find((o=>this.needUpdateDimensionStep(this.dimensionUpdaters[s][o],e,t,i)));a&&o.push(this.dimensionUpdaters[s][a].updater.bind(this,t,this.dimensionUpdaters[s]))}return o.length?o:null}getUpdateTriggers(e){const t=e.updateTriggers||{},i={};for(const o in this.dimensionUpdaters){const{accessor:s}=this.dimensionUpdaters[o];i[s]={},n.forEach((a=>{Object.values(this.dimensionUpdaters[o][a].triggers).forEach((({prop:o,updateTrigger:a})=>{if(a){const e=t[a];"object"!=typeof e||Array.isArray(e)?void 0!==e&&(i[s][o]=e):Object.assign(i[s],e)}else i[s][o]=e[o]}))}))}return i}getSortedBins(e){for(const t in this.dimensionUpdaters)this.getDimensionSortedBins(e,this.dimensionUpdaters[t])}getDimensionSortedBins(e,t){const{key:i}=t,{getValue:s}=this.state.dimensions[i],a=new o.Z(this.state.layerData.data||[],{getValue:s,filterData:e._filterData});this.setDimensionState(i,{sortedBins:a}),this.getDimensionValueDomain(e,t)}getDimensionValueDomain(e,t){const{getDomain:i,key:o}=t,{triggers:{lowerPercentile:s,upperPercentile:a,scaleType:r}}=i,n=this.state.dimensions[o].sortedBins.getValueDomainByScale(e[r.prop],[e[s.prop],e[a.prop]]);this.setDimensionState(o,{valueDomain:n}),this.getDimensionScale(e,t)}getDimensionScale(e,t){const{key:i,getScaleFunc:o,getDomain:a}=t,{domain:r,range:n}=o.triggers,{scaleType:l}=a.triggers,{onSet:c}=o,g=e[n.prop],p=e[r.prop]||this.state.dimensions[i].valueDomain,d=(0,s.ge)(l&&e[l.prop])(p,g);"object"==typeof c&&"function"==typeof e[c.props]&&e[c.props](d.domain()),this.setDimensionState(i,{scaleFunc:d})}getSubLayerDimensionAttribute(e,t){return i=>{const{sortedBins:o,scaleFunc:s}=this.state.dimensions[e],a=o.binMap[i.index];if(a&&0===a.counts)return t;const r=a&&a.value,n=s.domain();return r>=n[0]&&r<=n[n.length-1]?s(r):t}}getSubLayerAccessors(e){const t={};for(const i in this.dimensionUpdaters){const{accessor:o}=this.dimensionUpdaters[i];t[o]=this.getSubLayerDimensionAttribute(e,i)}return t}getPickingInfo({info:e}){let t=null;if(e.picked&&e.index>-1){const i=this.state.layerData.data[e.index],o={};for(const e in this.dimensionUpdaters){const{pickingInfo:t}=this.dimensionUpdaters[e],{sortedBins:s}=this.state.dimensions[e],a=s.binMap[i.index]&&s.binMap[i.index].value;o[t]=a}t=Object.assign(o,i,{points:i.filteredPoints||i.points})}return e.picked=Boolean(t),e.object=t,e}getAccessor(e){return this.dimensionUpdaters.hasOwnProperty(e)?this.dimensionUpdaters[e].attributeAccessor:r}}},15103:(e,t,i)=>{i.d(t,{Z:()=>m});var o=i(95772),s=i(93844),a=i(95644),r=i(51331),n=i(281),l=i(80744),c=i(53982),g=i(74538),p=i(1738);class d extends c.Z{constructor(e={}){const{id:t=(0,g.hQ)("column-geometry")}=e,{indices:i,attributes:o}=function(e){const{radius:t,height:i=1,nradial:o=10}=e;let{vertices:s}=e;s&&(l.Z.assert(s.length>=o),s=s.flatMap((e=>[e[0],e[1]])),(0,p.Ny)(s,p.wG.COUNTER_CLOCKWISE));const a=i>0,r=o+1,n=a?3*r+1:o,c=2*Math.PI/o,g=new Uint16Array(a?3*o*2:0),d=new Float32Array(3*n),u=new Float32Array(3*n);let h=0;if(a){for(let e=0;e<r;e++){const a=e*c,r=e%o,n=Math.sin(a),l=Math.cos(a);for(let e=0;e<2;e++)d[h+0]=s?s[2*r]:l*t,d[h+1]=s?s[2*r+1]:n*t,d[h+2]=(.5-e)*i,u[h+0]=s?s[2*r]:l,u[h+1]=s?s[2*r+1]:n,h+=3}d[h+0]=d[h-3],d[h+1]=d[h-2],d[h+2]=d[h-1],h+=3}for(let e=a?0:1;e<r;e++){const a=Math.floor(e/2)*Math.sign(.5-e%2),r=a*c,n=(a+o)%o,l=Math.sin(r),g=Math.cos(r);d[h+0]=s?s[2*n]:g*t,d[h+1]=s?s[2*n+1]:l*t,d[h+2]=i/2,u[h+2]=1,h+=3}if(a){let e=0;for(let t=0;t<o;t++)g[e++]=2*t+0,g[e++]=2*t+2,g[e++]=2*t+0,g[e++]=2*t+1,g[e++]=2*t+1,g[e++]=2*t+3}return{indices:g,attributes:{POSITION:{size:3,value:d},NORMAL:{size:3,value:u}}}}(e);super({...e,id:t,indices:i,attributes:o})}}const u=[0,0,0,255],h={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:e=>e.position},getFillColor:{type:"accessor",value:u},getLineColor:{type:"accessor",value:u},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class m extends o.Z{getShaders(){return super.getShaders({vs:"\n#define SHADER_NAME column-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec3 instancePositions;\nattribute float instanceElevations;\nattribute vec3 instancePositions64Low;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute float instanceStrokeWidths;\n\nattribute vec3 instancePickingColors;\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform bool extruded;\nuniform bool isStroke;\nuniform float coverage;\nuniform float elevationScale;\nuniform float edgeDistance;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nvarying vec4 vColor;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n\n  vec4 color = isStroke ? instanceLineColors : instanceFillColors;\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n  float elevation = 0.0;\n  float strokeOffsetRatio = 1.0;\n\n  if (extruded) {\n    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n  } else if (isStroke) {\n    float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n      widthMinPixels, widthMaxPixels) / 2.0;\n    strokeOffsetRatio -= sign(positions.z) * project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);\n  }\n  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\n  float dotRadius = radius * coverage * shouldRender;\n\n  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\n  geometry.pickingColor = instancePickingColors;\n  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\n  vec3 centroidPosition64Low = instancePositions64Low;\n  vec3 pos = vec3(project_size(rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius, 0.);\n  DECKGL_FILTER_SIZE(pos, geometry);\n\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  if (extruded && !isStroke) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);\n    vColor = vec4(lightColor, color.a * opacity);\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity);\n  }\n  DECKGL_FILTER_COLOR(vColor, geometry);\n}\n",fs:"#define SHADER_NAME column-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[s.Z,a.N,r.Z]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:u},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:u},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState({props:e,oldProps:t,changeFlags:i}){super.updateState({props:e,oldProps:t,changeFlags:i});const o=i.extensionsChanged;if(o){var s;const{gl:e}=this.context;null===(s=this.state.model)||void 0===s||s.delete(),this.state.model=this._getModel(e),this.getAttributeManager().invalidateAll()}(o||e.diskResolution!==t.diskResolution||e.vertices!==t.vertices||(e.extruded||e.stroked)!==(t.extruded||t.stroked))&&this._updateGeometry(e)}getGeometry(e,t,i){const o=new d({radius:1,height:i?2:0,vertices:t,nradial:e});let s=0;if(t)for(let i=0;i<e;i++){const o=t[i];s+=Math.sqrt(o[0]*o[0]+o[1]*o[1])/e}else s=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*s}),o}_getModel(e){return new n.Z(e,{...this.getShaders(),id:this.props.id,isInstanced:!0})}_updateGeometry({diskResolution:e,vertices:t,extruded:i,stroked:o}){const s=this.getGeometry(e,t,i||o);this.setState({fillVertexCount:s.attributes.POSITION.value.length/3,wireframeVertexCount:s.indices.value.length}),this.state.model.setProps({geometry:s})}draw({uniforms:e}){const{viewport:t}=this.context,{lineWidthUnits:i,lineWidthScale:o,lineWidthMinPixels:s,lineWidthMaxPixels:a,elevationScale:r,extruded:n,filled:l,stroked:c,wireframe:g,offset:p,coverage:d,radius:u,angle:h}=this.props,{model:m,fillVertexCount:f,wireframeVertexCount:y,edgeDistance:v}=this.state,b="pixels"===i?t.metersPerPixel:1;m.setUniforms(e).setUniforms({radius:u,angle:h/180*Math.PI,offset:p,extruded:n,coverage:d,elevationScale:r,edgeDistance:v,widthScale:o*b,widthMinPixels:s,widthMaxPixels:a}),n&&g&&(m.setProps({isIndexed:!0}),m.setVertexCount(y).setDrawMode(1).setUniforms({isStroke:!0}).draw()),l&&(m.setProps({isIndexed:!1}),m.setVertexCount(f).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!n&&c&&(m.setProps({isIndexed:!1}),m.setVertexCount(2*f/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}m.layerName="ColumnLayer",m.defaultProps=h},50600:(e,t,i)=>{i.d(t,{Z:()=>c});var o=i(67294),s=i(45697),a=i.n(s),r=i(67190);const n=" - ",l={categories:a().object,forceCategorical:a().bool,format:a().string,position:a().oneOf([null,"tl","tr","bl","br"]),showSingleCategory:a().func,toggleCategory:a().func};class c extends o.PureComponent{format(e){if(!this.props.format||this.props.forceCategorical)return e;const t=parseFloat(e);return(0,r.uf)(this.props.format,t)}formatCategoryLabel(e){if(!this.props.format)return e;if(e.includes(n)){const t=e.split(n);return this.format(t[0])+n+this.format(t[1])}return this.format(e)}render(){if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;const e=Object.entries(this.props.categories).map((e=>{let[t,i]=e;const s={color:"rgba("+i.color.join(", ")+")"},a=i.enabled?"◼":"◻";return o.createElement("li",{key:t},o.createElement("a",{href:"#",onClick:()=>this.props.toggleCategory(t),onDoubleClick:()=>this.props.showSingleCategory(t)},o.createElement("span",{style:s},a)," ",this.formatCategoryLabel(t)))})),t={position:"absolute",["t"===this.props.position.charAt(0)?"top":"bottom"]:"0px",["r"===this.props.position.charAt(1)?"right":"left"]:"10px"};return o.createElement("div",{className:"legend",style:t},o.createElement("ul",{className:"categories"},e))}}c.propTypes=l,c.defaultProps={categories:{},forceCategorical:!1,format:null,position:"tr",showSingleCategory:()=>{},toggleCategory:()=>{}}},52598:(e,t,i)=>{i.d(t,{B:()=>P,G:()=>_});var o=i(67294),s=i(45697),a=i.n(s),r=i(96486),n=i(85011),l=i(28062),c=i(89759),g=i(50600),p=i(15191),d=i(57485),u=i(88574),h=i(50980);function m(){return m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},m.apply(this,arguments)}function f(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const{getScale:y}=l,v={datasource:a().object.isRequired,formData:a().object.isRequired,getLayer:a().func.isRequired,getPoints:a().func.isRequired,height:a().number.isRequired,mapboxApiKey:a().string.isRequired,onAddFilter:a().func,payload:a().object.isRequired,setControlValue:a().func.isRequired,viewport:a().object.isRequired,width:a().number.isRequired};class b extends o.PureComponent{constructor(e){super(e),f(this,"containerRef",o.createRef()),f(this,"setTooltip",(e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)})),this.state=this.getStateFromProps(e),this.getLayers=this.getLayers.bind(this),this.onValuesChange=this.onValuesChange.bind(this),this.toggleCategory=this.toggleCategory.bind(this),this.showSingleCategory=this.showSingleCategory.bind(this)}UNSAFE_componentWillReceiveProps(e){e.payload.form_data!==this.state.formData&&this.setState(m({},this.getStateFromProps(e)))}onValuesChange(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})}getStateFromProps(e,t){const i=e.payload.data.features||[],o=i.map((e=>e.__timestamp)),s=function(e,t){const i=e.color_picker||{r:0,g:0,b:0,a:1},o=[i.r,i.g,i.b,255*i.a],s=y(e.color_scheme),a={};return t.forEach((t=>{if(null!=t.cat_color&&!a.hasOwnProperty(t.cat_color)){let r;r=e.dimension?(0,p.hexToRGB)(s(t.cat_color),255*i.a):o,a[t.cat_color]={color:r,enabled:!0}}})),a}(e.formData,i);if(t&&e.payload.form_data===t.formData)return m({},t,{categories:s});const a=e.payload.form_data.time_grain_sqla||e.payload.form_data.granularity||"P1D",{start:r,end:n,getStep:l,values:c,disabled:g}=(0,d.g)(o,a),{width:u,height:f,formData:v}=e;let{viewport:b}=e;return v.autozoom&&(b=(0,h.Z)(b,{width:u,height:f,points:e.getPoints(i)})),b.zoom<0&&(b.zoom=0),{start:r,end:n,getStep:l,values:c,disabled:g,viewport:b,selected:[],lastClick:0,formData:e.payload.form_data,categories:s}}getLayers(e){const{getLayer:t,payload:i,formData:o,onAddFilter:s}=this.props;let a=i.data.features?[...i.data.features]:[];a=this.addColor(a,o),o.js_data_mutator&&(a=(0,u.Z)(o.js_data_mutator)(a)),a=e[0]===e[1]||e[1]===this.end?a.filter((t=>t.__timestamp>=e[0]&&t.__timestamp<=e[1])):a.filter((t=>t.__timestamp>=e[0]&&t.__timestamp<e[1]));const r=this.state.categories;return o.dimension&&(a=a.filter((e=>r[e.cat_color]&&r[e.cat_color].enabled))),[t(o,m({},i,{data:m({},i.data,{features:a})}),s,this.setTooltip,this.props.datasource)]}addColor(e,t){const i=t.color_picker||{r:0,g:0,b:0,a:1},o=y(t.color_scheme);return e.map((e=>{let s;return t.dimension?(s=(0,p.hexToRGB)(o(e.cat_color),255*i.a),m({},e,{color:s})):e}))}toggleCategory(e){const t=this.state.categories[e],i=m({},this.state.categories,{[e]:m({},t,{enabled:!t.enabled})});Object.values(i).every((e=>!e.enabled))&&Object.values(i).forEach((e=>{e.enabled=!0})),this.setState({categories:i})}showSingleCategory(e){const t=m({},this.state.categories);Object.values(t).forEach((e=>{e.enabled=!1})),t[e].enabled=!0,this.setState({categories:t})}render(){return o.createElement("div",{style:{position:"relative"}},o.createElement(c.Z,{ref:this.containerRef,getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,disabled:this.state.disabled,viewport:this.state.viewport,mapboxApiAccessToken:this.props.mapboxApiKey,mapStyle:this.props.formData.mapbox_style,setControlValue:this.props.setControlValue,width:this.props.width,height:this.props.height},o.createElement(g.Z,{forceCategorical:!0,categories:this.state.categories,format:this.props.formData.legend_format,position:this.props.formData.legend_position,showSingleCategory:this.showSingleCategory,toggleCategory:this.toggleCategory})))}}function C(){return C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},C.apply(this,arguments)}function S(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}b.propTypes=v;const D={datasource:a().object.isRequired,formData:a().object.isRequired,height:a().number.isRequired,onAddFilter:a().func,payload:a().object.isRequired,setControlValue:a().func.isRequired,viewport:a().object.isRequired,width:a().number.isRequired},w={onAddFilter(){}};function _(e,t){class i extends o.PureComponent{constructor(e){super(e),S(this,"containerRef",o.createRef()),S(this,"setTooltip",(e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)}));const{width:i,height:s,formData:a}=e;let{viewport:r}=e;a.autozoom&&(r=(0,h.Z)(r,{width:i,height:s,points:t(e.payload.data.features)})),this.state={viewport:r,layer:this.computeLayer(e)},this.onViewportChange=this.onViewportChange.bind(this)}UNSAFE_componentWillReceiveProps(e){const t=C({},e.formData,{viewport:null}),i=C({},this.props.formData,{viewport:null});(0,r.isEqual)(t,i)&&e.payload===this.props.payload||this.setState({layer:this.computeLayer(e)})}onViewportChange(e){this.setState({viewport:e})}computeLayer(t){const{formData:i,payload:o,onAddFilter:s}=t;return e(i,o,s,this.setTooltip)}render(){const{formData:e,payload:t,setControlValue:i,height:s,width:a}=this.props,{layer:r,viewport:l}=this.state;return o.createElement(n.Z,{ref:this.containerRef,mapboxApiAccessToken:t.data.mapboxApiKey,viewport:l,layers:[r],mapStyle:e.mapbox_style,setControlValue:i,width:a,height:s,onViewportChange:this.onViewportChange})}}return i.propTypes=D,i.defaultProps=w,i}function P(e,t){function i(i){const{datasource:s,formData:a,height:r,payload:n,setControlValue:l,viewport:c,width:g}=i;return o.createElement(b,{datasource:s,formData:a,mapboxApiKey:n.data.mapboxApiKey,setControlValue:l,viewport:c,getLayer:e,payload:n,getPoints:t,width:g,height:r})}return i.propTypes=D,i.defaultProps=w,i}}}]);