(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{1146:function(e,t,a){},1147:function(e,t,a){},1468:function(e,t,a){"use strict";a.r(t),a.d(t,"DatasourceEditor",(function(){return De}));a(35);var n=a(47),s=a.n(n),o=a(10),i=a.n(o),r=a(28),l=a.n(r),c=a(43),d=a.n(c),h=a(6),b=a.n(h),p=a(3),u=a.n(p),m=a(5),g=a.n(m),f=a(14),O=a.n(f),j=a(16),y=a.n(j),C=a(1),v=a.n(C),S=a(2),x=a.n(S),_=a(1596),T=a(1607),w=a(1605),D=a(945),E=a(1606),I=a(236),N=a(70),L=a.n(N),R=a(73),A=a(7),k=a(91),q=a(65),K=a(18),M=a(118),P=a(925),F=a(40),B=a(79),U=a(0);var H=function({certifiedBy:e,details:t}){return Object(U.e)(B.a,{label:"certified-details",tooltip:Object(U.e)(v.a.Fragment,null,e&&Object(U.e)("div",null,Object(A.c)("Certified by %s",e)),Object(U.e)("div",null,t))},Object(U.e)(F.a,{color:R.b.colors.primary.base,name:"certified"}))},z=a(429),G=a(49),W=a(253),Q=a(189),$=a(229),J=a(859),V=a(857),Y=a(858),Z=a(29),X=a.n(Z),ee=a(232),te=a.n(ee),ae=a(1599);function ne(e,t,a){var n;return b()(n=v.a.Children).call(n,e,e=>{let n=e;return e&&e.type.name===t.name&&(n=v.a.cloneElement(e,a(e))),n&&n.props.children&&(n=v.a.cloneElement(n,{children:ne(n.props.children,t,a)})),n})}a(157);var se=a(284),oe=a(81),ie=a(127),re=a(278),le=a(1600),ce=a(63);a(3356);const de={value:x.a.any.isRequired,label:x.a.string.isRequired,description:x.a.node,fieldKey:x.a.string.isRequired,control:x.a.node.isRequired,onChange:x.a.func,compact:x.a.bool};class he extends v.a.PureComponent{constructor(e){var t;super(e),this.onChange=g()(t=this.onChange).call(t,this)}onChange(e){this.props.onChange(this.props.fieldKey,e)}render(){const{compact:e,value:t,label:a,control:n,description:s,fieldKey:o}=this.props,i=v.a.cloneElement(n,{value:t,onChange:this.onChange});return Object(U.e)(se.a,{controlId:o},Object(U.e)(ce.a,{className:"m-r-5"},a||o,e&&s&&Object(U.e)(oe.a,{placement:"right",overlay:Object(U.e)(ie.a,{id:"field-descr",bsSize:"lg"},s)},Object(U.e)("i",{className:"fa fa-info-circle m-l-5"}))),i,Object(U.e)(re.a.Feedback,null),!e&&s&&Object(U.e)(le.a,null,s))}}he.propTypes=de,he.defaultProps={controlProps:{},onChange:()=>{},compact:!1,desc:null};const be={children:x.a.node.isRequired,onChange:x.a.func.isRequired,item:x.a.object.isRequired,title:x.a.node,compact:x.a.bool};class pe extends v.a.PureComponent{constructor(e){var t;super(e),this.onChange=g()(t=this.onChange).call(t,this)}onChange(e,t){return this.props.onChange(u()({},this.props.item,{[e]:t}))}render(){const{title:e}=this.props;return Object(U.e)(ae.a,{componentClass:"fieldset",className:"CRUD"},e&&Object(U.e)("legend",null,e),ne(this.props.children,he,e=>({onChange:this.onChange,value:this.props.item[e.props.fieldKey],compact:this.props.compact})))}}function ue(e){const t=b()(e).call(e,e=>u()({},e,{id:e.id||L.a.generate()})),a={};return i()(t).call(t,e=>{a[e.id]=e}),a}pe.propTypes=be,pe.defaultProps={compact:!1,title:null};class me extends v.a.PureComponent{constructor(e){var t,a,n,s,o,i,r;super(e),this.state={expandedColumns:{},collection:ue(e.collection)},this.renderItem=g()(t=this.renderItem).call(t,this),this.onAddItem=g()(a=this.onAddItem).call(a,this),this.renderExpandableSection=g()(n=this.renderExpandableSection).call(n,this),this.getLabel=g()(s=this.getLabel).call(s,this),this.onFieldsetChange=g()(o=this.onFieldsetChange).call(o,this),this.renderTableBody=g()(i=this.renderTableBody).call(i,this),this.changeCollection=g()(r=this.changeCollection).call(r,this)}UNSAFE_componentWillReceiveProps(e){e.collection!==this.props.collection&&this.setState({collection:ue(e.collection)})}onCellChange(e,t,a){this.changeCollection(u()({},this.state.collection,{[e]:u()({},this.state.collection[e],{[t]:a})}))}onAddItem(){if(this.props.itemGenerator){let e=this.props.itemGenerator();e.id||(e=u()({},e,{id:L.a.generate()})),this.changeCollection(u()({},this.state.collection,{[e.id]:e}))}}onFieldsetChange(e){this.changeCollection(u()({},this.state.collection,{[e.id]:e}))}getLabel(e){const{columnLabels:t}=this.props;let a=t&&t[e]?t[e]:e;return te()(a).call(a,"__")&&(a=""),a}changeCollection(e){var t;(this.setState({collection:e}),this.props.onChange)&&this.props.onChange(b()(t=X()(e)).call(t,t=>e[t]))}deleteItem(e){const t=u()({},this.state.collection);delete t[e],this.changeCollection(t)}effectiveTableColumns(){var e;const{tableColumns:t,allowDeletes:a,expandFieldset:n}=this.props,o=a?s()(t).call(t,["__actions"]):t;return n?s()(e=["__expand"]).call(e,o):o}toggleExpand(e){this.onCellChange(e,"__expanded",!1),this.setState({expandedColumns:u()({},this.state.expandedColumns,{[e]:!this.state.expandedColumns[e]})})}renderHeaderRow(){const e=this.effectiveTableColumns(),{allowAddItem:t,allowDeletes:a,expandFieldset:n,extraButtons:s}=this.props;return Object(U.e)("thead",null,Object(U.e)("tr",null,n&&Object(U.e)("th",{"aria-label":"Expand",className:"tiny-cell"}),b()(e).call(e,e=>Object(U.e)("th",{key:e},this.getLabel(e))),s,a&&!t&&Object(U.e)("th",{key:"delete-item","aria-label":"Delete",className:"tiny-cell"}),t&&Object(U.e)("th",{key:"add-item"},Object(U.e)(K.a,{buttonStyle:"primary",onClick:this.onAddItem},Object(U.e)("i",{className:"fa fa-plus"})," ",Object(A.c)("Add Item")))))}renderExpandableSection(e){return ne(this.props.expandFieldset,pe,()=>({item:e,onChange:this.onFieldsetChange}))}renderCell(e,t){var a;const n=this.props.itemRenderers&&this.props.itemRenderers[t],s=e[t],o=g()(a=this.onCellChange).call(a,this,e.id,t);return n?n(s,o,this.getLabel(t),e):s}renderItem(e){const{allowAddItem:t,allowDeletes:a,expandFieldset:n,tableColumns:o}=this.props,i=!!this.state.expandedColumns[e.id]||e.__expanded;let r=[];var l,c;n&&r.push(Object(U.e)("td",{key:"__expand",className:"expand"},Object(U.e)("i",{role:"button","aria-label":"Toggle expand",tabIndex:0,className:"fa fa-caret-"+(i?"down":"right")+" text-primary pointer",onClick:g()(l=this.toggleExpand).call(l,this,e.id)})));(r=s()(r).call(r,b()(o).call(o,t=>Object(U.e)("td",{key:t},this.renderCell(e,t)))),t&&r.push(Object(U.e)("td",{key:"add"})),a)&&r.push(Object(U.e)("td",{key:"__actions"},Object(U.e)("i",{role:"button","aria-label":"Delete item",tabIndex:0,className:"fa fa-trash text-primary pointer",onClick:g()(c=this.deleteItem).call(c,this,e.id)})));const d=[Object(U.e)("tr",{className:"row",key:e.id},r)];return i&&d.push(Object(U.e)("tr",{className:"exp",key:"exp__"+e.id},Object(U.e)("td",{colSpan:this.effectiveTableColumns().length,className:"expanded"},Object(U.e)("div",null,this.renderExpandableSection(e))))),d}renderEmptyCell(){return Object(U.e)("tr",null,Object(U.e)("td",{className:"empty-collection"},this.props.emptyMessage))}renderTableBody(){var e;const t=b()(e=X()(this.state.collection)).call(e,e=>this.state.collection[e]),a=t.length?b()(t).call(t,e=>this.renderItem(e)):this.renderEmptyCell();return Object(U.e)("tbody",null,a)}render(){return Object(U.e)("div",{className:"CRUD"},Object(U.e)("table",{className:"table"},this.renderHeaderRow(),this.renderTableBody()))}}var ge=a(67);function fe(){const e=y()(["\n  align-items: center;\n  display: flex;\n\n  > svg {\n    margin-right: ","px;\n  }\n"]);return fe=function(){return e},e}function Oe(){const e=y()(["\n  .tab-content {\n    height: 600px;\n    overflow: auto;\n  }\n\n  .change-warning {\n    margin: 16px 10px 0;\n    color: ",";\n  }\n\n  .change-warning .bold {\n    font-weight: ",";\n  }\n"]);return Oe=function(){return e},e}const je=R.a.div(Oe(),({theme:e})=>e.colors.warning.base,({theme:e})=>e.typography.weights.bold),ye=R.a.div(fe(),({theme:e})=>e.gridUnit),Ce=(e,t)=>Object(U.e)(W.a,{value:e,onChange:t}),ve=["STRING","NUMERIC","DATETIME"];function Se({title:e,collection:t}){return Object(U.e)("div",null,e," ",Object(U.e)(_.a,null,t?t.length:0))}function xe({columns:e,onChange:t,editableColumnName:a,showExpression:n,allowAddItem:s,allowEditDataType:o,itemGenerator:i}){return Object(U.e)(me,{collection:e,tableColumns:["column_name","type","is_dttm","filterable","groupby"],allowDeletes:!0,allowAddItem:s,itemGenerator:i,expandFieldset:Object(U.e)(Te,null,Object(U.e)(pe,{compact:!0},n&&Object(U.e)(he,{fieldKey:"expression",label:Object(A.c)("SQL Expression"),control:Object(U.e)(J.a,{language:"markdown",offerEditInModal:!1})}),Object(U.e)(he,{fieldKey:"verbose_name",label:Object(A.c)("Label"),control:Object(U.e)(Q.a,{placeholder:Object(A.c)("Label")})}),Object(U.e)(he,{fieldKey:"description",label:Object(A.c)("Description"),control:Object(U.e)(Q.a,{placeholder:Object(A.c)("Description")})}),o&&Object(U.e)(he,{fieldKey:"type",label:Object(A.c)("Data Type"),control:Object(U.e)($.a,{choices:ve,name:"type",freeForm:!0})}),Object(U.e)(he,{fieldKey:"python_date_format",label:Object(A.c)("Datetime Format"),description:Object(U.e)("div",null,Object(A.c)("The pattern of timestamp format. For strings use "),Object(U.e)("a",{href:"https://docs.python.org/2/library/datetime.html#strftime-strptime-behavior"},Object(A.c)("python datetime string pattern")),Object(A.c)(" expression which needs to adhere to the "),Object(U.e)("a",{href:"https://en.wikipedia.org/wiki/ISO_8601"},Object(A.c)("ISO 8601")),Object(A.c)(" standard to ensure that the lexicographical ordering\n                      coincides with the chronological ordering. If the\n                      timestamp format does not adhere to the ISO 8601 standard\n                      you will need to define an expression and type for\n                      transforming the string into a date or timestamp. Note\n                      currently time zones are not supported. If time is stored\n                      in epoch format, put `epoch_s` or `epoch_ms`. If no pattern\n                      is specified we fall back to using the optional defaults on a per\n                      database/column name level via the extra parameter.")),control:Object(U.e)(Q.a,{placeholder:"%y/%m/%d"})}))),columnLabels:{column_name:Object(A.c)("Column"),type:Object(A.c)("Data Type"),groupby:Object(A.c)("Is Dimension"),is_dttm:Object(A.c)("Is Temporal"),filterable:Object(A.c)("Is Filterable")},onChange:t,itemRenderers:{column_name:(e,t)=>a?Object(U.e)(z.a,{canEdit:!0,title:e,onSaveTitle:t}):e,type:e=>Object(U.e)(q.a,null,e),is_dttm:Ce,filterable:Ce,groupby:Ce}})}function _e({label:e,formElement:t}){return Object(U.e)("div",null,Object(U.e)("div",null,Object(U.e)("strong",null,e)),Object(U.e)("div",null,t))}function Te({children:e}){return Object(U.e)(T.a,{style:{marginTop:20}},e)}Se.propTypes={title:x.a.string,collection:x.a.array},xe.propTypes={columns:x.a.array.isRequired,onChange:x.a.func.isRequired,editableColumnName:x.a.bool,showExpression:x.a.bool,allowAddItem:x.a.bool,allowEditDataType:x.a.bool,itemGenerator:x.a.func},xe.defaultProps={editableColumnName:!1,showExpression:!1,allowAddItem:!1,allowEditDataType:!1,itemGenerator:()=>({column_name:"<new column>",filterable:!0,groupby:!0})},_e.propTypes={label:x.a.string,formElement:x.a.node},Te.propTypes={children:x.a.node};const we={datasource:x.a.object.isRequired,onChange:x.a.func,addSuccessToast:x.a.func.isRequired,addDangerToast:x.a.func.isRequired};class De extends v.a.PureComponent{constructor(e){var t,a,n,s,o,i,r,l,c;super(e),this.state={datasource:e.datasource,errors:[],isDruid:"druid"===e.datasource.type||"druid"===e.datasource.datasource_type,isSqla:"table"===e.datasource.datasource_type||"table"===e.datasource.type,databaseColumns:O()(t=e.datasource.columns).call(t,e=>!e.expression),calculatedColumns:O()(a=e.datasource.columns).call(a,e=>!!e.expression),metadataLoading:!1,activeTabKey:1},this.onChange=g()(n=this.onChange).call(n,this),this.onDatasourcePropChange=g()(s=this.onDatasourcePropChange).call(s,this),this.onDatasourceChange=g()(o=this.onDatasourceChange).call(o,this),this.syncMetadata=g()(i=this.syncMetadata).call(i,this),this.setColumns=g()(r=this.setColumns).call(r,this),this.validateAndChange=g()(l=this.validateAndChange).call(l,this),this.handleTabSelect=g()(c=this.handleTabSelect).call(c,this)}onChange(){const e=u()({},this.state.datasource,{columns:[...this.state.databaseColumns,...this.state.calculatedColumns]});this.props.onChange(e,this.state.errors)}onDatasourceChange(e){this.setState({datasource:e},this.validateAndChange)}onDatasourcePropChange(e,t){const a=u()({},this.state.datasource,{[e]:t});this.setState({datasource:a},this.onDatasourceChange(a))}setColumns(e){this.setState(e,this.validateAndChange)}validateAndChange(){this.validate(this.onChange)}updateColumns(e){var t;const{databaseColumns:a}=this.state,n=b()(e).call(e,e=>e.name),s=d()(a).call(a,(e,t)=>u()({},e,{[t.column_name]:t}),{}),o=[],r={added:[],modified:[],removed:O()(t=b()(a).call(a,e=>e.column_name)).call(t,e=>!l()(n).call(n,e))};return i()(e).call(e,e=>{const t=s[e.name];t?t.type!==e.type?(o.push(u()({},t,{type:e.type})),r.modified.push(e.name)):o.push(t):(o.push({id:L.a.generate(),column_name:e.name,type:e.type,groupby:!0,filterable:!0}),r.added.push(e.name))}),(r.added.length||r.modified.length||r.removed.length)&&this.setColumns({databaseColumns:o}),r}syncMetadata(){const{datasource:e}=this.state,t="/datasource/external_metadata/"+(e.type||e.datasource_type)+"/"+e.id+"/?db_id="+e.database.id+"&schema="+(e.schema||"")+"&table_name="+(e.datasource_name||e.table_name);this.setState({metadataLoading:!0}),k.a.get({endpoint:t}).then(({json:e})=>{const t=this.updateColumns(e);t.modified.length&&this.props.addSuccessToast(Object(A.c)("Modified columns: %s",t.modified.join(", "))),t.removed.length&&this.props.addSuccessToast(Object(A.c)("Removed columns: %s",t.removed.join(", "))),t.added.length&&this.props.addSuccessToast(Object(A.c)("New columns added: %s",t.added.join(", "))),this.props.addSuccessToast(Object(A.c)("Metadata has been synced")),this.setState({metadataLoading:!1})}).catch(e=>Object(G.a)(e).then(({error:e,statusText:t})=>{this.props.addDangerToast(e||t||Object(A.c)("An error has occurred")),this.setState({metadataLoading:!1})}))}findDuplicates(e,t){const a={},n=[];return i()(e).call(e,e=>{const s=t(e);s in a?n.push(s):a[s]=null}),n}validate(e){var t;let a,n=[];const{datasource:o}=this.state;a=this.findDuplicates(o.columns,e=>e.column_name),n=s()(n).call(n,b()(a).call(a,e=>Object(A.c)("Column name [%s] is duplicated",e))),a=this.findDuplicates(o.metrics,e=>e.metric_name),n=s()(n).call(n,b()(a).call(a,e=>Object(A.c)("Metric name [%s] is duplicated",e)));const i=O()(t=this.state.calculatedColumns).call(t,e=>!e.expression&&!e.json);n=s()(n).call(n,b()(i).call(i,e=>Object(A.c)("Calculated column [%s] requires an expression",e.column_name))),this.setState({errors:n},e)}handleTabSelect(e){this.setState({activeTabKey:e})}renderSettingsFieldset(){const{datasource:e}=this.state;return Object(U.e)(pe,{title:Object(A.c)("Basic"),item:e,onChange:this.onDatasourceChange},this.state.isSqla&&Object(U.e)(he,{fieldKey:"tableSelector",label:Object(A.c)("Physical Table"),control:Object(U.e)(P.a,{dbId:e.database.id,schema:e.schema,tableName:e.datasource_name,onSchemaChange:e=>this.onDatasourcePropChange("schema",e),onTableChange:e=>this.onDatasourcePropChange("datasource_name",e),sqlLabMode:!1,clearable:!1,handleError:this.props.addDangerToast,isDatabaseSelectEnabled:!1}),description:Object(A.c)("The pointer to a physical table. Keep in mind that the chart is associated to this Superset logical table, and this logical table points the physical table referenced here.")}),Object(U.e)(he,{fieldKey:"description",label:Object(A.c)("Description"),control:Object(U.e)(J.a,{language:"markdown",offerEditInModal:!1})}),Object(U.e)(he,{fieldKey:"default_endpoint",label:Object(A.c)("Default URL"),description:Object(A.c)("Default URL to redirect to when accessing from the dataset list page"),control:Object(U.e)(Q.a,null)}),Object(U.e)(he,{fieldKey:"filter_select_enabled",label:Object(A.c)("Autocomplete filters"),description:Object(A.c)("Whether to populate autocomplete filters options"),control:Object(U.e)(W.a,null)}),this.state.isSqla&&Object(U.e)(he,{fieldKey:"fetch_values_predicate",label:Object(A.c)("Autocomplete Query Predicate"),description:Object(A.c)('When using "Autocomplete filters", this can be used to improve performance of the query fetching the values. Use this option to apply a predicate (WHERE clause) to the query selecting the distinct values from the table. Typically the intent would be to limit the scan by applying a relative time filter on a partitioned or indexed time-related field.'),control:Object(U.e)(Q.a,null)}),Object(U.e)(he,{fieldKey:"owners",label:Object(A.c)("Owners"),description:Object(A.c)("Owners of the datasource"),control:Object(U.e)(V.a,{dataEndpoint:"/users/api/read",multi:!0,mutator:e=>{var t;return b()(t=e.pks).call(t,(t,a)=>({value:t,label:e.result[a].first_name+" "+e.result[a].last_name}))}}),controlProps:{}}))}renderAdvancedFieldset(){const{datasource:e}=this.state;return Object(U.e)(pe,{title:Object(A.c)("Advanced"),item:e,onChange:this.onDatasourceChange},this.state.isSqla&&Object(U.e)(he,{fieldKey:"sql",label:Object(A.c)("SQL"),description:Object(A.c)("When specifying SQL, the dataset acts as a view. Superset will use this statement as a subquery while grouping and filtering on the generated parent queries."),control:Object(U.e)(J.a,{language:"sql",offerEditInModal:!1})}),this.state.isDruid&&Object(U.e)(he,{fieldKey:"json",label:Object(A.c)("JSON"),description:Object(U.e)("div",null,Object(A.c)("The JSON metric or post aggregation definition.")),control:Object(U.e)(J.a,{language:"json",offerEditInModal:!1})}),Object(U.e)(he,{fieldKey:"cache_timeout",label:Object(A.c)("Cache Timeout"),description:Object(A.c)("The duration of time in seconds before the cache is invalidated"),control:Object(U.e)(Q.a,null)}),Object(U.e)(he,{fieldKey:"offset",label:Object(A.c)("Hours offset"),control:Object(U.e)(Q.a,null)}),this.state.isSqla&&Object(U.e)(he,{fieldKey:"template_params",label:Object(A.c)("Template parameters"),description:Object(A.c)("A set of parameters that become available in the query using Jinja templating syntax"),control:Object(U.e)(Q.a,null)}))}renderSpatialTab(){var e;const{datasource:t}=this.state,{spatials:a,all_cols:n}=t;return Object(U.e)(w.a,{title:Object(U.e)(Se,{collection:a,title:Object(A.c)("Spatial")}),eventKey:4},Object(U.e)(me,{tableColumns:["name","config"],onChange:g()(e=this.onDatasourcePropChange).call(e,this,"spatials"),itemGenerator:()=>({name:"<new spatial>",type:"<no type>",config:null}),collection:a,allowDeletes:!0,itemRenderers:{name:(e,t)=>Object(U.e)(z.a,{canEdit:!0,title:e,onSaveTitle:t}),config:(e,t)=>Object(U.e)(Y.a,{value:e,onChange:t,choices:n})}}))}renderErrors(){var e;return this.state.errors.length>0?Object(U.e)(D.a,{bsStyle:"danger"},b()(e=this.state.errors).call(e,e=>Object(U.e)("div",{key:e},e))):null}renderMetricCollection(){var e;return Object(U.e)(me,{tableColumns:["metric_name","verbose_name","expression"],columnLabels:{metric_name:Object(A.c)("Metric"),verbose_name:Object(A.c)("Label"),expression:Object(A.c)("SQL Expression")},expandFieldset:Object(U.e)(Te,null,Object(U.e)(pe,{compact:!0},Object(U.e)(he,{fieldKey:"verbose_name",label:Object(A.c)("Label"),control:Object(U.e)(Q.a,null)}),Object(U.e)(he,{fieldKey:"description",label:Object(A.c)("Description"),control:Object(U.e)(Q.a,{placeholder:Object(A.c)("Description")})}),Object(U.e)(he,{fieldKey:"d3format",label:Object(A.c)("D3 Format"),control:Object(U.e)(Q.a,{placeholder:"%y/%m/%d"})}),Object(U.e)(he,{label:Object(A.c)("Warning Message"),fieldKey:"warning_text",description:Object(A.c)("Warning message to display in the metric selector"),control:Object(U.e)(Q.a,{placeholder:Object(A.c)("Warning Message")})}),Object(U.e)(he,{label:Object(A.c)("Certified By"),fieldKey:"certified_by",description:Object(A.c)("Person or group that has certified this metric"),control:Object(U.e)(Q.a,{placeholder:Object(A.c)("Certified By")})}),Object(U.e)(he,{label:Object(A.c)("Certification Details"),fieldKey:"certification_details",description:Object(A.c)("Details of the certification"),control:Object(U.e)(Q.a,{placeholder:Object(A.c)("Certification Details")})}))),collection:this.state.datasource.metrics,allowAddItem:!0,onChange:g()(e=this.onDatasourcePropChange).call(e,this,"metrics"),itemGenerator:()=>({metric_name:"<new metric>",verbose_name:"",expression:""}),itemRenderers:{metric_name:(e,t,a,n)=>Object(U.e)(ye,null,n.is_certified&&Object(U.e)(H,{certifiedBy:n.certified_by,details:n.certification_details}),Object(U.e)(z.a,{canEdit:!0,title:e,onSaveTitle:t})),verbose_name:(e,t)=>Object(U.e)(z.a,{canEdit:!0,title:e,onSaveTitle:t}),expression:(e,t)=>Object(U.e)(z.a,{canEdit:!0,title:e,onSaveTitle:t,extraClasses:["datasource-sql-expression"],multiLine:!0}),description:(e,t,a)=>Object(U.e)(_e,{label:a,formElement:Object(U.e)(Q.a,{value:e,onChange:t})}),d3format:(e,t,a)=>Object(U.e)(_e,{label:a,formElement:Object(U.e)(Q.a,{value:e,onChange:t})})},allowDeletes:!0})}render(){const{datasource:e,activeTabKey:t}=this.state;return Object(U.e)(je,null,this.renderErrors(),Object(U.e)("div",{className:"m-t-10"},Object(U.e)(D.a,{bsStyle:"warning"},Object(U.e)("strong",null,Object(A.c)("Be careful.")," "),Object(A.c)("Changing these settings will affect all charts using this dataset, including charts owned by other people."))),Object(U.e)(E.a,{id:"table-tabs",onSelect:this.handleTabSelect,defaultActiveKey:t},Object(U.e)(w.a,{title:Object(U.e)(Se,{collection:e.metrics,title:Object(A.c)("Metrics")}),eventKey:1},1===t&&this.renderMetricCollection()),Object(U.e)(w.a,{title:Object(U.e)(Se,{collection:this.state.databaseColumns,title:Object(A.c)("Columns")}),eventKey:2},2===t&&Object(U.e)("div",null,Object(U.e)(xe,{columns:this.state.databaseColumns,onChange:e=>this.setColumns({databaseColumns:e})}),Object(U.e)(K.a,{buttonStyle:"primary",onClick:this.syncMetadata,className:"sync-from-source",disabled:!!e.sql,tooltip:e.sql?Object(A.c)("This option is not yet available for views"):null},Object(A.c)("Sync columns from source")),this.state.metadataLoading&&Object(U.e)(M.a,null))),Object(U.e)(w.a,{title:Object(U.e)(Se,{collection:this.state.calculatedColumns,title:Object(A.c)("Calculated Columns")}),eventKey:3},3===t&&Object(U.e)(xe,{columns:this.state.calculatedColumns,onChange:e=>this.setColumns({calculatedColumns:e}),editableColumnName:!0,showExpression:!0,allowAddItem:!0,allowEditDataType:!0,itemGenerator:()=>({column_name:"<new column>",filterable:!0,groupby:!0,expression:"<enter SQL expression here>",__expanded:!0})})),Object(U.e)(w.a,{eventKey:4,title:Object(A.c)("Settings")},4===t&&Object(U.e)("div",null,Object(U.e)(I.a,{md:6},Object(U.e)(Te,null,this.renderSettingsFieldset())),Object(U.e)(I.a,{md:6},Object(U.e)(Te,null,this.renderAdvancedFieldset()))))))}}De.defaultProps={onChange:()=>{}},De.propTypes=we;t.default=Object(ge.a)(De)},151:function(e,t,a){var n,s,o;s=[t],void 0===(o="function"==typeof(n=function(e){var t,a,n,s=e;void 0===s&&(window.rison={}),s.uri_ok={"~":!0,"!":!0,"*":!0,"(":!0,")":!0,"-":!0,_:!0,".":!0,",":!0,":":!0,"@":!0,$:!0,"'":!0,"/":!0},function(){for(var e=[],t=0;t<16;t++)for(var a=0;a<16;a++)if(t+a!=0){var n=String.fromCharCode(16*t+a);/\w|[-_.\/~]/.test(n)||e.push("\\u00"+t.toString(16)+a.toString(16))}s.not_idchar=e.join("")}(),s.not_idchar=" '!:(),*@$",s.not_idstart="-0123456789",n="[^"+s.not_idstart+s.not_idchar+"][^"+s.not_idchar+"]*",s.id_ok=new RegExp("^"+n+"$"),s.next_id=new RegExp(n,"g"),s.quote=function(e){return/^[-A-Za-z0-9~!*()_.',:@$\/]*$/.test(e)?e:encodeURIComponent(e).replace("%2C",",","g").replace("%3A",":","g").replace("%40","@","g").replace("%24","$","g").replace("%2F","/","g").replace("%20","+","g")},t={"'":!0,"!":!0},a={array:function(e){var t,n,s,o,i=["!("],r=e.length;for(s=0;s<r;s+=1)o=e[s],(n=a[typeof o])&&"string"==typeof(o=n(o))&&(t&&(i[i.length]=","),i[i.length]=o,t=!0);return i[i.length]=")",i.join("")},boolean:function(e){return e?"!t":"!f"},null:function(e){return"!n"},number:function(e){return isFinite(e)?String(e).replace(/\+/,""):"!n"},object:function(e){if(e){if(e instanceof Array)return a.array(e);if("object"==typeof e.__prototype__&&void 0!==e.__prototype__.encode_rison)return e.encode_rison();var t,n,s,o,i,r=["("],l=[];for(s in e)l[l.length]=s;for(l.sort(),i=0;i<l.length;i++)o=e[s=l[i]],(n=a[typeof o])&&"string"==typeof(o=n(o))&&(t&&(r[r.length]=","),r.push(a.string(s),":",o),t=!0);return r[r.length]=")",r.join("")}return"!n"},string:function(e){return""==e?"''":s.id_ok.test(e)?e:"'"+(e=e.replace(/(['!])/g,(function(e,a){return t[a]?"!"+a:a})))+"'"},undefined:function(e){throw new Error("rison can't encode the undefined value")}},s.encode=function(e){return a[typeof e](e)},s.encode_object=function(e){if("object"!=typeof e||null===e||e instanceof Array)throw new Error("rison.encode_object expects an object argument");var t=a[typeof e](e);return t.substring(1,t.length-1)},s.encode_array=function(e){if(!(e instanceof Array))throw new Error("rison.encode_array expects an array argument");var t=a[typeof e](e);return t.substring(2,t.length-1)},s.encode_uri=function(e){return s.quote(a[typeof e](e))},s.decode=function(e){return new s.parser((function(e){throw Error("rison decoder error: "+e)})).parse(e)},s.decode_object=function(e){return s.decode("("+e+")")},s.decode_array=function(e){return s.decode("!("+e+")")},s.parser=function(e){this.errorHandler=e},s.parser.WHITESPACE="",s.parser.prototype.setOptions=function(e){e.errorHandler&&(this.errorHandler=e.errorHandler)},s.parser.prototype.parse=function(e){this.string=e,this.index=0,this.message=null;var t=this.readValue();return!this.message&&this.next()&&(t=this.error("unable to parse string as rison: '"+s.encode(e)+"'")),this.message&&this.errorHandler&&this.errorHandler(this.message,this.index),t},s.parser.prototype.error=function(e){"undefined"!=typeof console&&console.log("rison parser error: ",e),this.message=e},s.parser.prototype.readValue=function(){var e=this.next(),t=e&&this.table[e];if(t)return t.apply(this);var a=this.string,n=this.index-1;s.next_id.lastIndex=n;var o=s.next_id.exec(a);if(o.length>0){var i=o[0];return this.index=n+i.length,i}return e?this.error("invalid character: '"+e+"'"):this.error("empty expression")},s.parser.parse_array=function(e){for(var t,a=[];")"!=(t=e.next());){if(!t)return e.error("unmatched '!('");if(a.length)","!=t&&e.error("missing ','");else{if(","==t)return e.error("extra ','");--e.index}var n=e.readValue();if(void 0===n)return;a.push(n)}return a},s.parser.bangs={t:!0,f:!1,n:null,"(":s.parser.parse_array},s.parser.prototype.table={"!":function(){var e=this.string.charAt(this.index++);if(!e)return this.error('"!" at end of input');var t=s.parser.bangs[e];return"function"==typeof t?t.call(null,this):void 0===t?this.error('unknown literal: "!'+e+'"'):t},"(":function(){for(var e,t={},a=0;")"!=(e=this.next());){if(a)","!=e&&this.error("missing ','");else{if(","==e)return this.error("extra ','");--this.index}var n=this.readValue();if(void 0===n)return;if(":"!=this.next())return this.error("missing ':'");var s=this.readValue();if(void 0===s)return;t[n]=s,a++}return t},"'":function(){for(var e,t=this.string,a=this.index,n=a,s=[];"'"!=(e=t.charAt(a++));){if(!e)return this.error('unmatched "\'"');if("!"==e){if(n<a-1&&s.push(t.slice(n,a-1)),e=t.charAt(a++),!("!'".indexOf(e)>=0))return this.error('invalid string escape: "!'+e+'"');s.push(e),n=a}}return n<a-1&&s.push(t.slice(n,a-1)),this.index=a,1==s.length?s[0]:s.join("")},"-":function(){var e=this.string,t=this.index,a=t-1,n="int",s="-",o={"int+.":"frac","int+e":"exp","frac+e":"exp"};do{var i=e.charAt(t++);if(!i)break;"0"<=i&&i<="9"||(s.indexOf(i)>=0?s="":"exp"==(n=o[n+"+"+i.toLowerCase()])&&(s="-"))}while(n);return this.index=--t,"-"==(e=e.slice(a,t))?this.error("invalid number"):Number(e)}},function(e){for(var t=0;t<=9;t++)e[String(t)]=e["-"]}(s.parser.prototype.table),s.parser.prototype.next=function(){var e=this.string,t=this.index;do{if(t==e.length)return;var a=e.charAt(t++)}while(s.parser.WHITESPACE.indexOf(a)>=0);return this.index=t,a}})?n.apply(t,s):n)||(e.exports=o)},3356:function(e,t,a){},429:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));a(35);var n=a(233),s=a.n(n),o=a(1),i=a(8),r=a.n(i),l=a(7),c=a(79),d=a(0);function h({canEdit:e=!1,emptyText:t,extraClasses:a,multiLine:n=!1,noPermitTooltip:i,onSaveTitle:h,showTooltip:b=!0,style:p,title:u}){const[m,g]=Object(o.useState)(!1),[f,O]=Object(o.useState)(u),[j,y]=Object(o.useState)(u),[C,v]=Object(o.useState)(null),S=Object(o.useRef)();function x(){if(!e||m)return;const t=S.current?S.current.getBoundingClientRect():null;g(!0),v(t)}function _(){const t=s()(f).call(f);e&&(g(!1),t.length?(j!==t&&y(t),u!==t&&h(t)):O(j))}function T(e){" "===e.key&&e.stopPropagation()}function w(t){e&&O(t.target.value)}function D(e){"Enter"===e.key&&(e.preventDefault(),_())}let E;Object(o.useEffect)(()=>{f!==j&&(y(f),O(u))},[u]),f?E=f:m||(E=t);const I=m&&C?{height:C.height+"px"}:void 0;let N=n&&m?Object(d.e)("textarea",{ref:S,required:!0,value:E,className:u?void 0:"text-muted",onKeyDown:T,onChange:w,onBlur:_,onClick:x,onKeyPress:D,style:I}):Object(d.e)("input",{ref:S,required:!0,type:m?"text":"button",value:E,className:u?void 0:"text-muted",onKeyDown:T,onChange:w,onBlur:_,onClick:x,onKeyPress:D});return b&&!m&&(N=Object(d.e)(c.a,{label:"title",tooltip:e?Object(l.c)("click to edit"):i||Object(l.c)("You don't have the rights to alter this title.")},N)),Object(d.e)("span",{className:r()("editable-title",a,e&&"editable-title--editable",m&&"editable-title--editing"),style:p},N)}},925:function(e,t,a){"use strict";a.d(t,"a",(function(){return A}));a(114);var n=a(3),s=a.n(n),o=a(6),i=a.n(o),r=a(53),l=a.n(r),c=a(5),d=a.n(c),h=a(16),b=a.n(h),p=a(1),u=a.n(p),m=a(73),g=a(91),f=a(7),O=a(2),j=a.n(O),y=a(151),C=a.n(y),v=a(44),S=a(65),x=a(63),_=a(317),T=a(79),w=(a(1146),a(0));const D={onClick:j.a.func,tooltipContent:j.a.string.isRequired};class E extends u.a.PureComponent{render(){return Object(w.e)(T.a,{tooltip:this.props.tooltipContent,label:"cache-desc"},Object(w.e)("i",{"aria-label":"Icon",role:"button",tabIndex:0,className:"RefreshLabel fa fa-refresh pointer",onClick:this.props.onClick}))}}E.propTypes=D;var I=E;a(1147);function N(){const e=b()(["\n  color: ",";\n  font-size: ","px;\n  margin: 20px 0 10px 0;\n  text-transform: uppercase;\n"]);return N=function(){return e},e}const L=m.a.p(N(),({theme:e})=>e.colors.secondary.light2,({theme:e})=>e.typography.sizes.s),R={dbId:j.a.number.isRequired,schema:j.a.string,onSchemaChange:j.a.func,onDbChange:j.a.func,onSchemasLoad:j.a.func,onTablesLoad:j.a.func,getDbList:j.a.func,onTableChange:j.a.func,tableNameSticky:j.a.bool,tableName:j.a.string,database:j.a.object,sqlLabMode:j.a.bool,formMode:j.a.bool,onChange:j.a.func,clearable:j.a.bool,handleError:j.a.func.isRequired,isDatabaseSelectEnabled:j.a.bool};class A extends u.a.PureComponent{constructor(e){var t,a,n,s,o,i;super(e),this.state={schemaLoading:!1,schemaOptions:[],tableLoading:!1,tableOptions:[],dbId:e.dbId,schema:e.schema,tableName:e.tableName},this.onDatabaseChange=d()(t=this.onDatabaseChange).call(t,this),this.onSchemaChange=d()(a=this.onSchemaChange).call(a,this),this.changeTable=d()(n=this.changeTable).call(n,this),this.dbMutator=d()(s=this.dbMutator).call(s,this),this.getTableNamesBySubStr=d()(o=this.getTableNamesBySubStr).call(o,this),this.onChange=d()(i=this.onChange).call(i,this)}componentDidMount(){this.state.dbId&&(this.fetchSchemas(this.state.dbId),this.fetchTables())}onChange(){this.props.onChange({dbId:this.state.dbId,schema:this.state.schema,tableName:this.state.tableName})}onDatabaseChange(e,t){return this.changeDataBase(e,t)}onSchemaChange(e){return this.changeSchema(e)}getTableNamesBySubStr(e="undefined"){if(!this.props.dbId||!e){const e=[];return l.a.resolve({options:e})}const t=encodeURIComponent(this.props.schema),a=encodeURIComponent(e);return g.a.get({endpoint:encodeURI("/superset/tables/"+this.props.dbId+"/"+t+"/"+a)}).then(({json:e})=>{var t;return{options:i()(t=e.options).call(t,e=>({value:e.value,schema:e.schema,label:e.label,title:e.title,type:e.type}))}})}dbMutator(e){var t;return this.props.getDbList(e.result),0===e.result.length&&this.props.handleError(Object(f.c)("It seems you don't have access to any database")),i()(t=e.result).call(t,e=>s()({},e,{label:e.backend+" "+e.database_name}))}fetchTables(e=!1,t="undefined"){const{dbId:a,schema:n}=this.state,s=encodeURIComponent(n),o=encodeURIComponent(t);if(a&&n){this.setState(()=>({tableLoading:!0,tableOptions:[]}));const t=encodeURI("/superset/tables/"+a+"/"+s+"/"+o+"/"+!!e+"/");return g.a.get({endpoint:t}).then(({json:e})=>{var t;const a=i()(t=e.options).call(t,e=>({value:e.value,schema:e.schema,label:e.label,title:e.title,type:e.type}));this.setState(()=>({tableLoading:!1,tableOptions:a})),this.props.onTablesLoad(e.options)}).catch(()=>{this.setState(()=>({tableLoading:!1,tableOptions:[]})),this.props.handleError(Object(f.c)("Error while fetching table list"))})}return this.setState(()=>({tableLoading:!1,tableOptions:[]})),l.a.resolve()}fetchSchemas(e,t=!1){const a=e||this.props.dbId;if(a){this.setState({schemaLoading:!0});const e="/api/v1/database/"+a+"/schemas/?q="+C.a.encode({force:Boolean(t)});return g.a.get({endpoint:e}).then(({json:e})=>{var t;const a=i()(t=e.result).call(t,e=>({value:e,label:e,title:e}));this.setState({schemaOptions:a,schemaLoading:!1}),this.props.onSchemasLoad(a)}).catch(()=>{this.setState({schemaLoading:!1,schemaOptions:[]}),this.props.handleError(Object(f.c)("Error while fetching schema list"))})}return l.a.resolve()}changeDataBase(e,t=!1){const a=e?e.id:null;this.setState({schemaOptions:[]}),this.props.onSchemaChange(null),this.props.onDbChange(e),this.fetchSchemas(a,t),this.setState({dbId:a,schema:null,tableName:null,tableOptions:[]},this.onChange)}changeSchema(e,t=!1){const a=e?e.value:null;this.props.onSchemaChange(a),this.setState({schema:a},()=>{this.fetchTables(t),this.onChange()})}changeTable(e){if(!e)return void this.setState({tableName:""});const t=e.schema,a=e.value;this.props.tableNameSticky&&this.setState({tableName:a},this.onChange),this.props.onTableChange(a,t)}renderDatabaseOption(e){return Object(w.e)("span",{title:e.database_name},Object(w.e)(S.a,{bsStyle:"default"},e.backend),e.database_name)}renderTableOption(e){return Object(w.e)("span",{className:"TableLabel",title:e.label},Object(w.e)("span",{className:"m-r-5"},Object(w.e)("small",{className:"text-muted"},Object(w.e)("i",{className:"fa fa-"+("view"===e.type?"eye":"table")}))),e.label)}renderSelectRow(e,t){return Object(w.e)("div",{className:"section"},Object(w.e)("span",{className:"select"},e),Object(w.e)("span",{className:"refresh-col"},t))}renderDatabaseSelect(){const e=C.a.encode(s()({order_columns:"database_name",order_direction:"asc",page:0,page_size:-1},this.props.formMode?{}:{filters:[{col:"expose_in_sqllab",opr:"eq",value:!0}]}));return this.renderSelectRow(Object(w.e)(_.a,{dataEndpoint:"/api/v1/database/?q="+e,onChange:this.onDatabaseChange,onAsyncError:()=>this.props.handleError(Object(f.c)("Error while fetching database list")),clearable:!1,value:this.state.dbId,valueKey:"id",valueRenderer:e=>Object(w.e)("div",null,Object(w.e)("span",{className:"text-muted m-r-5"},Object(f.c)("Database:")),this.renderDatabaseOption(e)),optionRenderer:this.renderDatabaseOption,mutator:this.dbMutator,placeholder:Object(f.c)("Select a database"),isDisabled:!this.props.isDatabaseSelectEnabled,autoSelect:!0}))}renderSchema(){const e=!this.props.formMode&&Object(w.e)(I,{onClick:()=>this.onDatabaseChange({id:this.props.dbId},!0),tooltipContent:Object(f.c)("Force refresh schema list")});return this.renderSelectRow(Object(w.e)(v.f,{name:"select-schema",placeholder:Object(f.c)("Select a schema (%s)",this.state.schemaOptions.length),options:this.state.schemaOptions,value:this.props.schema,valueRenderer:e=>Object(w.e)("div",null,Object(w.e)("span",{className:"text-muted"},Object(f.c)("Schema:"))," ",e.label),isLoading:this.state.schemaLoading,autosize:!1,onChange:this.onSchemaChange}),e)}renderTable(){let e,t=!1;this.props.database&&this.props.database.allow_multi_schema_metadata_fetch?e=Object(f.c)("Type to search ..."):(e=Object(f.c)("Select table "),t=!0);const a=this.state.tableOptions;let n=null;n=this.props.schema&&!this.props.formMode?Object(w.e)(v.f,{name:"select-table",isLoading:this.state.tableLoading,ignoreAccents:!1,placeholder:Object(f.c)("Select table or type table name"),autosize:!1,onChange:this.changeTable,options:a,value:this.state.tableName,optionRenderer:this.renderTableOption}):this.props.formMode?Object(w.e)(v.c,{name:"select-table",isLoading:this.state.tableLoading,ignoreAccents:!1,placeholder:Object(f.c)("Select table or type table name"),autosize:!1,onChange:this.changeTable,options:a,value:this.state.tableName,optionRenderer:this.renderTableOption}):Object(w.e)(v.b,{name:"async-select-table",placeholder:e,isDisabled:t,autosize:!1,onChange:this.changeTable,value:this.state.tableName,loadOptions:this.getTableNamesBySubStr,optionRenderer:this.renderTableOption});const s=!this.props.formMode&&Object(w.e)(I,{onClick:()=>this.changeSchema({value:this.props.schema},!0),tooltipContent:Object(f.c)("Force refresh table list")});return this.renderSelectRow(n,s)}renderSeeTableLabel(){return Object(w.e)("div",{className:"section"},Object(w.e)(x.a,null,Object(f.c)("See table schema")," ",this.props.schema&&Object(w.e)("small",null,"(",this.state.tableOptions.length," in ",Object(w.e)("i",null,this.props.schema),")")))}render(){return Object(w.e)("div",{className:"TableSelector"},this.props.formMode&&Object(w.e)(L,null,Object(f.c)("datasource")),this.renderDatabaseSelect(),this.props.formMode&&Object(w.e)(L,null,Object(f.c)("schema")),this.renderSchema(),!this.props.formMode&&Object(w.e)("div",{className:"divider"}),this.props.sqlLabMode&&this.renderSeeTableLabel(),this.props.formMode&&Object(w.e)(L,null,Object(f.c)("Table")),this.renderTable())}}A.propTypes=R,A.defaultProps={onDbChange:()=>{},onSchemaChange:()=>{},onSchemasLoad:()=>{},onTablesLoad:()=>{},getDbList:()=>{},onTableChange:()=>{},onChange:()=>{},tableNameSticky:!0,sqlLabMode:!0,formMode:!1,clearable:!0,isDatabaseSelectEnabled:!0}}}]);